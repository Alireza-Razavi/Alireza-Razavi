# Report

Audit report for **2023-11-canto** generated by *ubl4nk_bot*.

## Medium Issues


*Total <b>10</b> instances over <b>1</b> issue:*

|ID|Issue|Instances|
|-|:-|:-:|
| [M-1](#M-1) | Centralization Risk for trusted owners | 10 |

## Low Issues


*Total <b>32</b> instances over <b>11</b> issues:*

|ID|Issue|Instances|
|-|:-|:-:|
| [L-1](#L-1) | Missing zero address check in functions with address parameters | 3 |
| [L-2](#L-2) | `approve()`/`safeApprove()` may revert if the current approval is not zero | 1 |
| [L-3](#L-3) | Check division by zero is prevented | 8 |
| [L-4](#L-4) | Constructor / initialization function lacks parameter validation | 2 |
| [L-5](#L-5) | Loss of precision in divisions | 8 |
| [L-6](#L-6) | Missing checks for state variable assignments | 5 |
| [L-7](#L-7) | Missing zero address check in constructor | 1 |
| [L-8](#L-8) | Consider some checks for `address(0)` when setting address state variables | 1 |
| [L-9](#L-9) | Use of `tx.origin` is unsafe in almost every context | 1 |
| [L-10](#L-10) | `safeApprove()` is deprecated | 1 |
| [L-11](#L-11) | Unspecific compiler version pragma | 1 |

## Non Critical Issues


*Total <b>285</b> instances over <b>59</b> issues:*

|ID|Issue|Instances|
|-|:-|:-:|
| [NC-1](#NC-1) | Addresses shouldn't be hard-coded | 2 |
| [NC-2](#NC-2) | Avoid the use of sensitive terms | 17 |
| [NC-3](#NC-3) | Multiple `address`/ID mappings can be combined into a single `mapping` of an `address`/ID to a `struct`, for readability | 2 |
| [NC-4](#NC-4) | Consider adding a block/deny-list | 3 |
| [NC-5](#NC-5) | Consider adding emergency-stop functionality | 3 |
| [NC-6](#NC-6) | Consider adding formal verification proofs | 1 |
| [NC-7](#NC-7) | Constants should be put on the left side of comparisons | 5 |
| [NC-8](#NC-8) | Contract does not follow the Solidity Style Guide's suggested layout ordering | 1 |
| [NC-9](#NC-9) | Contract name does not follow the Solidity Style Guide | 1 |
| [NC-10](#NC-10) | Contract should expose an `interface` | 19 |
| [NC-11](#NC-11) | Contracts should have full test coverage | 1 |
| [NC-12](#NC-12) | Convert simple `if` statements to ternary expressions | 1 |
| [NC-13](#NC-13) | Events that mark critical parameter changes should contain both the old and the new value | 11 |
| [NC-14](#NC-14) | Custom errors should be used rather than `revert()`/`require()` | 11 |
| [NC-15](#NC-15) | Solidity version is different in some files | 2 |
| [NC-16](#NC-16) | Duplicated `require()`/`revert()` checks should be refactored | 1 |
| [NC-17](#NC-17) | Enable IR-based code generation | 1 |
| [NC-18](#NC-18) | Events are emitted without the sender information | 3 |
| [NC-19](#NC-19) | Events may be emitted out of order due to reentrancy | 4 |
| [NC-20](#NC-20) |  Function ordering does not follow the Solidity Style Guide | 9 |
| [NC-21](#NC-21) | Variable names for `immutable`s should use CONSTANT_CASE | 3 |
| [NC-22](#NC-22) | Inconsistent spacing in comments | 5 |
| [NC-23](#NC-23) | Large or complicated code bases should implement invariant tests | 1 |
| [NC-24](#NC-24) | Large multiples of ten should use scientific notation | 3 |
| [NC-25](#NC-25) | Magic numbers should be replaced with constants | 14 |
| [NC-26](#NC-26) | Consider moving `msg.sender` checks to `modifier`s | 2 |
| [NC-27](#NC-27) | Named mappings are recommended | 7 |
| [NC-28](#NC-28) | Missing NatSpec from contract declarations | 3 |
| [NC-29](#NC-29) | Missing NatSpec `@author` from contract declaration | 3 |
| [NC-30](#NC-30) | Missing NatSpec `@dev` from contract declaration | 3 |
| [NC-31](#NC-31) | Missing NatSpec `@dev` from event declaration | 11 |
| [NC-32](#NC-32) | Missing NatSpec `@dev` from function declaration | 21 |
| [NC-33](#NC-33) | Missing NatSpec `@dev` from modifier declaration | 1 |
| [NC-34](#NC-34) | Event declarations should have NatSpec descriptions | 11 |
| [NC-35](#NC-35) | NatSpec documentation for function is missing | 4 |
| [NC-36](#NC-36) | Modifier declarations should have NatSpec descriptions | 1 |
| [NC-37](#NC-37) | Public variable declarations should have NatSpec descriptions | 5 |
| [NC-38](#NC-38) | Missing NatSpec `@notice` from contract declaration | 3 |
| [NC-39](#NC-39) | Missing NatSpec `@notice` from event declaration | 11 |
| [NC-40](#NC-40) | Missing NatSpec `@notice` from function declaration | 4 |
| [NC-41](#NC-41) | Missing NatSpec `@notice` from modifier declaration | 1 |
| [NC-42](#NC-42) | Missing NatSpec `@param` from event declaration | 11 |
| [NC-43](#NC-43) | Missing NatSpec `@param` from function declaration | 6 |
| [NC-44](#NC-44) | Missing NatSpec `@return` from function declaration | 8 |
| [NC-45](#NC-45) | Missing NatSpec `@title` from contract declaration | 3 |
| [NC-46](#NC-46) | Using `>` or `>=` without specifying an upper bound is unsafe | 1 |
| [NC-47](#NC-47) | State variables should include comments | 6 |
| [NC-48](#NC-48) | Lines are too long | 11 |
| [NC-49](#NC-49) | Unused import | 1 |
| [NC-50](#NC-50) | Unused contract variables | 1 |
| [NC-51](#NC-51) | Consider using `delete` rather than assigning zero/false to clear values | 1 |
| [NC-52](#NC-52) | Solidity compiler version is not fixed | 1 |
| [NC-53](#NC-53) | Expressions for constant values should use `immutable` rather than `constant` | 3 |
| [NC-54](#NC-54) | Use `@inheritdoc` for overridden functions | 1 |
| [NC-55](#NC-55) | Use the latest solidity version for deployment (`0.8.23`) | 3 |
| [NC-56](#NC-56) | Use of `override` is unnecessary | 1 |
| [NC-57](#NC-57) | Whitespace in Expressions | 1 |
| [NC-58](#NC-58) | Names of `private`/`internal` functions should be prefixed with an underscore | 1 |
| [NC-59](#NC-59) | Event is missing `indexed` fields | 10 |

## Gas Optimizations


*Total <b>135</b> instances over <b>33</b> issues:*

|ID|Issue|Instances|Gas|
|-|:-|:-:|:-:|
| [GAS-1](#GAS-1) | Optimize Gas by Using Do-While Loops | 1 | 255 |
| [GAS-2](#GAS-2) | Multiple `address`/ID mappings can be combined into a single `mapping` of an `address`/ID to a `struct`, where appropriate | 2 | - |
| [GAS-3](#GAS-3) | Consider activating via-ir for deploying | 1 | - |
| [GAS-4](#GAS-4) | Divisions can be `unchecked` to save gas | 8 | 160 |
| [GAS-5](#GAS-5) | Operator `+=` costs more gas than `<x> = <x> + <y>` for state variables | 16 | 1808 |
| [GAS-6](#GAS-6) | Duplicated `require()`/`revert()` checks should be refactored to a modifier or function to save gas | 1 | - |
| [GAS-7](#GAS-7) | Increments can be `unchecked` to save gas | 1 | 60 |
| [GAS-8](#GAS-8) | Inline `modifier`s that are only used once, to save gas | 1 | - |
| [GAS-9](#GAS-9) | `internal` functions only called once can be inlined to save gas | 1 | 30 |
| [GAS-10](#GAS-10) | Multiple accesses of the same mapping/array key/index should be cached | 19 | 798 |
| [GAS-11](#GAS-11) | Newer versions of solidity are more gas efficient | 3 | - |
| [GAS-12](#GAS-12) | Operator `>=`/`<=` costs less gas than operator `>`/`<` | 6 | 18 |
| [GAS-13](#GAS-13) | Optimize names to save gas | 3 | 66 |
| [GAS-14](#GAS-14) | Reduce gas usage by moving to Solidity 0.8.19 or later | 1 | 1000 |
| [GAS-15](#GAS-15) | Remove or replace unused state variables | 1 | - |
| [GAS-16](#GAS-16) | State variables can be packed into fewer storage slots | 1 | 20000 |
| [GAS-17](#GAS-17) | Optimize External Calls with Assembly for Memory Efficiency | 4 | 880 |
| [GAS-18](#GAS-18) | Use assembly to emit events | 11 | 418 |
| [GAS-19](#GAS-19) | Use assembly to validate `msg.sender` | 2 | - |
| [GAS-20](#GAS-20) | Use assembly to write address/contract type storage values | 2 | 100 |
| [GAS-21](#GAS-21) | Use a more recent version of solidity | 3 | - |
| [GAS-22](#GAS-22) | Use `uint256(1)`/`uint256(2)` instead of `true`/`false` to save gas for changes | 3 | 25650 |
| [GAS-23](#GAS-23) | Using bitmap to store bool states can save gas | 2 | - |
| [GAS-24](#GAS-24) | Using bools for storage incurs overhead | 3 | 300 |
| [GAS-25](#GAS-25) | State variables should be cached in stack variables rather than re-reading them from storage | 2 | 194 |
| [GAS-26](#GAS-26) | Use `calldata` instead of `memory` for function arguments that do not get mutated | 5 | - |
| [GAS-27](#GAS-27) | Use Custom Errors | 11 | 550 |
| [GAS-28](#GAS-28) | Constructors can be marked as `payable` to save deployment gas | 2 | 42 |
| [GAS-29](#GAS-29) | Functions guaranteed to revert when called by normal users can be marked `payable` | 5 | 105 |
| [GAS-30](#GAS-30) | `++i` costs less gas than `i++`, especially when it's used in `for`-loops (`--i`/`i--` too) | 1 | 5 |
| [GAS-31](#GAS-31) | Using `private` rather than `public` for constants, saves gas | 3 | - |
| [GAS-32](#GAS-32) | Use `!= 0` instead of `> 0` for unsigned integer comparison | 5 | 20 |
| [GAS-33](#GAS-33) | Using assembly to check for zero can save gas | 5 | 30 |

## Medium Issues

<a name="M-1"></a> 
### [M-1] Centralization Risk for trusted owners
Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

*There are <b>10</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

6: import {Ownable, Ownable2Step} from "/home/myubuntu/Desktop/2023-11-canto/1155tech-contracts/lib/openzeppelin-contracts/contracts/access/Ownable2Step.sol";

10: contract Market is ERC1155, Ownable2Step {

91:     constructor(string memory _uri, address _paymentToken) ERC1155(_uri) Ownable() {

104:     function changeBondingCurveAllowed(address _bondingCurve, bool _newState) external onlyOwner {

118:     ) external onlyShareCreator returns (uint256 id) {

244:     function claimPlatformFee() external onlyOwner {

300:     function restrictShareCreation(bool _isRestricted) external onlyOwner {

309:     function changeShareCreatorWhitelist(address _address, bool _isWhitelisted) external onlyOwner {

```

```solidity
File: asD/src/asD.sol

11: contract asD is ERC20, Ownable2Step {

72:     function withdrawCarry(uint256 _amount) external onlyOwner {

```



## Low Issues

<a name="L-1"></a> 
### [L-1] Missing zero address check in functions with address parameters
Adding a zero address check for each address type parameter can prevent errors.

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

/// @audit missing zero check for `_bondingCurve`
104:     function changeBondingCurveAllowed(address _bondingCurve, bool _newState) external onlyOwner {

/// @audit missing zero check for `_bondingCurve`
114:     function createNewShare(
             string memory _shareName,
             address _bondingCurve,
             string memory _metadataURI
         ) external onlyShareCreator returns (uint256 id) {

/// @audit missing zero check for `_address`
309:     function changeShareCreatorWhitelist(address _address, bool _isWhitelisted) external onlyOwner {

```


<a name="L-2"></a> 
### [L-2] `approve()`/`safeApprove()` may revert if the current approval is not zero
Calling `approve()` without first calling `approve(0)` if the current approval is non-zero will revert with some tokens, such as Tether (USDT). While Tether is known to do this, it applies to other tokens as well, which are trying to protect against [this attack vector](https://docs.google.com/document/d/1YLPtQxZu1UAvO9cZ1O2RPXBbT0mooh4DYKjA_jp-RLM/edit). `safeApprove()` itself also implements this protection. Always reset the approval to zero before changing it to a new value (`SafeERC20.forceApprove()` does this for you), or use `safeIncreaseAllowance()`/`safeDecreaseAllowance()`

*There is one instance of this issue:*
```solidity
File: asD/src/asD.sol

51:         SafeERC20.safeApprove(note, cNote, _amount);

```


<a name="L-3"></a> 
### [L-3] Check division by zero is prevented

*There are <b>8</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

197:         fee = (priceForOne * _amount * NFT_FEE_BPS) / 10_000;

275:             ((shareData[_id].shareHolderRewardsPerTokenScaled - lastClaimedValue) * tokensByAddress[_id][msg.sender]) /

285:         uint256 shareHolderFee = (_fee * HOLDER_CUT_BPS) / 10_000;

286:         uint256 shareCreatorFee = (_fee * CREATOR_CUT_BPS) / 10_000;

290:             shareData[_id].shareHolderRewardsPerTokenScaled += (shareHolderFee * 1e18) / _tokenCount;

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

23:             fee += (getFee(i) * tokenPrice) / 1e18;

35:         return 1e17 / divisor;

```

```solidity
File: asD/src/asD.sol

75:         uint256 maximumWithdrawable = (CTokenInterface(cNote).balanceOf(address(this)) * exchangeRate) /

```


<a name="L-4"></a> 
### [L-4] Constructor / initialization function lacks parameter validation
Constructors and initialization functions play a critical role in contracts by setting important initial states when the contract is first deployed before the system starts. The parameters passed to the constructor and initialization functions directly affect the behavior of the contract / protocol. If incorrect parameters are provided, the system may fail to run, behave abnormally, be unstable, or lack security. Therefore, it's crucial to carefully check each parameter in the constructor and initialization functions. If an exception is found, the transaction should be rolled back.

*There are <b>2</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

/// @audit `_priceIncrease` not validated
10:     constructor(uint256 _priceIncrease) {

```

```solidity
File: asD/src/asD.sol

/// @audit `_name` not validated
/// @audit `_symbol` not validated
/// @audit `_cNote` not validated
28:     constructor(

```


<a name="L-5"></a> 
### [L-5] Loss of precision in divisions
Division by large numbers may result in the result being zero, due to solidity not supporting fractions. Consider requiring a minimum amount for the numerator to ensure that it is always larger than the denominator.

*There are <b>8</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

197:         fee = (priceForOne * _amount * NFT_FEE_BPS) / 10_000;

275:             ((shareData[_id].shareHolderRewardsPerTokenScaled - lastClaimedValue) * tokensByAddress[_id][msg.sender]) /

285:         uint256 shareHolderFee = (_fee * HOLDER_CUT_BPS) / 10_000;

286:         uint256 shareCreatorFee = (_fee * CREATOR_CUT_BPS) / 10_000;

290:             shareData[_id].shareHolderRewardsPerTokenScaled += (shareHolderFee * 1e18) / _tokenCount;

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

23:             fee += (getFee(i) * tokenPrice) / 1e18;

35:         return 1e17 / divisor;

```

```solidity
File: asD/src/asD.sol

75:         uint256 maximumWithdrawable = (CTokenInterface(cNote).balanceOf(address(this)) * exchangeRate) /

```


<a name="L-6"></a> 
### [L-6] Missing checks for state variable assignments
There are some missing checks in these functions, and this could lead to unexpected scenarios. Consider always adding a sanity check for state variables.

*There are <b>5</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

/// @audit `_newState`
106:         whitelistedBondingCurves[_bondingCurve] = _newState;

/// @audit `_isRestricted`
302:         shareCreationRestricted = _isRestricted;

/// @audit `_isWhitelisted`
311:         whitelistedShareCreators[_address] = _isWhitelisted;

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

/// @audit `_priceIncrease`
11:         priceIncrease = _priceIncrease;

```

```solidity
File: asD/src/asD.sol

/// @audit `_cNote`
36:         cNote = _cNote;

```


<a name="L-7"></a> 
### [L-7] Missing zero address check in constructor
Constructors often take address parameters to initialize important components of a contract, such as owner or linked contracts. However, without a checking, there's a risk that an address parameter could be mistakenly set to the zero address (0x0). This could be due to an error or oversight during contract deployment. A zero address in a crucial role can cause serious issues, as it cannot perform actions like a normal address, and any funds sent to it will be irretrievable. It's therefore crucial to include a zero address check in constructors to prevent such potential problems. If a zero address is detected, the constructor should revert the transaction.

*There is one instance of this issue:*
```solidity
File: asD/src/asD.sol

/// @audit missing zero check for `_cNote`
28:     constructor(
            string memory _name,
            string memory _symbol,
            address _owner,
            address _cNote,
            address _csrRecipient
        ) ERC20(_name, _symbol) {

```


<a name="L-8"></a> 
### [L-8] Consider some checks for `address(0)` when setting address state variables
Check for zero-address to avoid the risk of setting `address(0)` for state variables after an update.

*There is one instance of this issue:*
```solidity
File: asD/src/asD.sol

/// @audit `_cNote`
36:         cNote = _cNote;

```


<a name="L-9"></a> 
### [L-9] Use of `tx.origin` is unsafe in almost every context
According to [Vitalik Buterin](https://ethereum.stackexchange.com/questions/196/how-do-i-make-my-dapp-serenity-proof), contracts should not `assume that tx.origin will continue to be usable or meaningful`. An example of this is [EIP-3074](https://eips.ethereum.org/EIPS/eip-3074#allowing-txorigin-as-signer-1) which explicitly mentions the intention to change its semantics when it's used with new op codes. There have also been calls to [remove](https://github.com/ethereum/solidity/issues/683) `tx.origin`, and there are security issues associated with using it for authorization. For these reasons, it's best to completely avoid the feature.

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

96:             turnstile.register(tx.origin);

```


<a name="L-10"></a> 
### [L-10] `safeApprove()` is deprecated
[Deprecated](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/bfff03c0d2a59bcd8e2ead1da9aed9edf0080d05/contracts/token/ERC20/utils/SafeERC20.sol#L38-L45) in favor of `safeIncreaseAllowance()` and `safeDecreaseAllowance()`. If only setting the initial allowance to the value that means infinite, `safeIncreaseAllowance()` can be used instead. The function may currently work, but if a bug is found in this version of OpenZeppelin, and the version that you're forced to upgrade to no longer has this function, you'll encounter unnecessary delays in porting and testing replacement contracts.

*There is one instance of this issue:*
```solidity
File: asD/src/asD.sol

51:         SafeERC20.safeApprove(note, cNote, _amount);

```


<a name="L-11"></a> 
### [L-11] Unspecific compiler version pragma

*There is one instance of this issue:*
```solidity
File: asD/src/asD.sol

2: pragma solidity >=0.8.0;

```



## Non Critical Issues

<a name="NC-1"></a> 
### [NC-1] Addresses shouldn't be hard-coded
It is often better to declare addresses as `constant` or `immutable` which can be assigned in constructor. This allows the code to remain the same across deployments on different networks, and avoids recompilation when addresses need to change.

*There are <b>2</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

95:             Turnstile turnstile = Turnstile(0xEcf044C5B4b867CFda001101c617eCd347095B44);

```

```solidity
File: asD/src/asD.sol

39:             Turnstile turnstile = Turnstile(0xEcf044C5B4b867CFda001101c617eCd347095B44);

```


<a name="NC-2"></a> 
### [NC-2] Avoid the use of sensitive terms
Use [alternative variants](https://www.zdnet.com/article/mysql-drops-master-slave-and-blacklist-whitelist-terminology/), e.g. allowlist/denylist instead of whitelist/blacklist

<details>
<summary>
There are <b>17</b> instances (click to show):
</summary>

```solidity
File: 1155tech-contracts/src/Market.sol

49:     mapping(address => bool) public whitelistedBondingCurves;

60:     /// @notice If true, only the whitelisted addresses can create shares

64:     mapping(address => bool) public whitelistedShareCreators;

69:     event BondingCurveStateChange(address indexed curve, bool isWhitelisted);

82:             !shareCreationRestricted || whitelistedShareCreators[msg.sender] || msg.sender == owner(),

100:     /// @notice Whitelist or remove whitelist for a bonding curve.

101:     /// @dev Whitelisting status is only checked when adding a share

103:     /// @param _newState True if whitelisted, false if not

105:         require(whitelistedBondingCurves[_bondingCurve] != _newState, "State already set");

106:         whitelistedBondingCurves[_bondingCurve] = _newState;

112:     /// @param _bondingCurve Address of the bonding curve, has to be whitelisted

119:         require(whitelistedBondingCurves[_bondingCurve], "Bonding curve not whitelisted");

306:     /// @notice Adds or removes an address from the whitelist of share creators

308:     /// @param _isWhitelisted True if whitelisted, false if not

309:     function changeShareCreatorWhitelist(address _address, bool _isWhitelisted) external onlyOwner {

310:         require(whitelistedShareCreators[_address] != _isWhitelisted, "State already set");

311:         whitelistedShareCreators[_address] = _isWhitelisted;

```

</details>


<a name="NC-3"></a> 
### [NC-3] Multiple `address`/ID mappings can be combined into a single `mapping` of an `address`/ID to a `struct`, for readability
Well-organized data structures make code reviews easier, which may lead to fewer bugs. Consider combining related mappings into mappings to structs, so it's clear what data is related

*There are <b>2</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

52:     mapping(uint256 => mapping(address => uint256)) public tokensByAddress;

55:     mapping(uint256 => mapping(address => uint256)) public rewardsLastClaimedValue;

```


<a name="NC-4"></a> 
### [NC-4] Consider adding a block/deny-list
Doing so will significantly increase centralization, but will help to prevent hackers from using stolen tokens.

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

10: contract Market is ERC1155, Ownable2Step {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

6: contract LinearBondingCurve is IBondingCurve {

```

```solidity
File: asD/src/asD.sol

11: contract asD is ERC20, Ownable2Step {

```


<a name="NC-5"></a> 
### [NC-5] Consider adding emergency-stop functionality
Consider adding `Pausable` to the following contracts so it's possible to stop them in case of an emergency.

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

10: contract Market is ERC1155, Ownable2Step {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

6: contract LinearBondingCurve is IBondingCurve {

```

```solidity
File: asD/src/asD.sol

11: contract asD is ERC20, Ownable2Step {

```


<a name="NC-6"></a> 
### [NC-6] Consider adding formal verification proofs
Formal verification is the act of proving or disproving the correctness of intended algorithms underlying a system with respect to a certain formal specification/property/invariant, using formal methods of mathematics.

Some tools that are currently available to perform these tests on smart contracts are [SMTChecker](https://docs.soliditylang.org/en/latest/smtchecker.html) and [Certora Prover](https://www.certora.com/).

*There is one instance of this issue:*
```solidity

Global finding

```


<a name="NC-7"></a> 
### [NC-7] Constants should be put on the left side of comparisons
Putting constants on the left side of comparison statements is a best practice known as [Yoda conditions](https://en.wikipedia.org/wiki/Yoda_conditions). Although solidity's static typing system prevents accidental assignments within conditionals, adopting this practice can improve code readability and consistency, especially when working across multiple languages.

*There are <b>5</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

120:         require(shareIDs[_shareName] == 0, "Share already exists");

```

```solidity
File: asD/src/asD.sol

54:         require(returnCode == 0, "Error when minting");

64:         require(returnCode == 0, "Error when redeeming"); // 0 on success: https://docs.compound.finance/v2/ctokens/#redeem-underlying

78:         if (_amount == 0) {

86:         require(returnCode == 0, "Error when redeeming"); // 0 on success: https://docs.compound.finance/v2/ctokens/#redeem

```


<a name="NC-8"></a> 
### [NC-8] Contract does not follow the Solidity Style Guide's suggested layout ordering
The [style guide](https://docs.soliditylang.org/en/v0.8.16/style-guide.html#order-of-layout) says that, within a contract, the ordering should be `1) Type declarations`, `2) State variables`, `3) Events`, `4) Modifiers`, and `5) Functions`, but the contract(s) below do not follow this ordering

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

/// @audit state variable `NFT_FEE_BPS` came earlier
/// @audit state variable `HOLDER_CUT_BPS` came earlier
/// @audit state variable `CREATOR_CUT_BPS` came earlier
/// @audit state variable `token` came earlier
/// @audit state variable `shareCount` came earlier
/// @audit state variable `shareIDs` came earlier
32:     struct ShareData {

```


<a name="NC-9"></a> 
### [NC-9] Contract name does not follow the Solidity Style Guide
According to the [Solidity Style Guide](https://docs.soliditylang.org/en/latest/style-guide.html#contract-and-library-names), contracts and libraries should be named using the CapWords style and match their filenames.

*There is one instance of this issue:*
```solidity
File: asD/src/asD.sol

11: contract asD is ERC20, Ownable2Step {

```


<a name="NC-10"></a> 
### [NC-10] Contract should expose an `interface`
All `external`/`public` functions should extend an `interface`. This is useful to make sure that the whole API is extracted.

*Note:* It is possible that the interface is out-of-scope and has not been seen by the bot.

<details>
<summary>
There are <b>19</b> instances (click to show):
</summary>

```solidity
File: 1155tech-contracts/src/Market.sol

104:     function changeBondingCurveAllowed(address _bondingCurve, bool _newState) external onlyOwner {

114:     function createNewShare(

132:     function getBuyPrice(uint256 _id, uint256 _amount) public view returns (uint256 price, uint256 fee) {

141:     function getSellPrice(uint256 _id, uint256 _amount) public view returns (uint256 price, uint256 fee) {

150:     function buy(uint256 _id, uint256 _amount) external {

174:     function sell(uint256 _id, uint256 _amount) external {

194:     function getNFTMintingPrice(uint256 _id, uint256 _amount) public view returns (uint256 fee) {

203:     function mintNFT(uint256 _id, uint256 _amount) external {

226:     function burnNFT(uint256 _id, uint256 _amount) external {

244:     function claimPlatformFee() external onlyOwner {

253:     function claimCreatorFee(uint256 _id) external {

263:     function claimHolderFee(uint256 _id) external {

300:     function restrictShareCreation(bool _isRestricted) external onlyOwner {

309:     function changeShareCreatorWhitelist(address _address, bool _isWhitelisted) external onlyOwner {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

14:     function getPriceAndFee(uint256 shareCount, uint256 amount)

27:     function getFee(uint256 shareCount) public pure override returns (uint256) {

```

```solidity
File: asD/src/asD.sol

47:     function mint(uint256 _amount) external {

60:     function burn(uint256 _amount) external {

72:     function withdrawCarry(uint256 _amount) external onlyOwner {

```

</details>


<a name="NC-11"></a> 
### [NC-11] Contracts should have full test coverage
While 100% code coverage does not guarantee that there are no bugs, it often will catch easy-to-find bugs, and will ensure that there are fewer regressions when the code invariably has to be modified. Furthermore, in order to get full coverage, code authors will often have to re-organize their code so that it is more modular, so that each component can be tested separately, which reduces interdependencies between modules and layers, and makes for code that is easier to reason about and audit.

*There is one instance of this issue:*
```solidity

Global finding

```


<a name="NC-12"></a> 
### [NC-12] Convert simple `if` statements to ternary expressions
Converting some if statements to ternaries (such as `z = (a < b) ? x : y`) can make the code more concise and easier to read.

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

29:         if (shareCount > 1) {
                divisor = log2(shareCount);
            } else {
                divisor = 1;

```


<a name="NC-13"></a> 
### [NC-13] Events that mark critical parameter changes should contain both the old and the new value
This should especially be done if the new value is not required to be different from the old value.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: 1155tech-contracts/src/Market.sol

107:         emit BondingCurveStateChange(_bondingCurve, _newState);

126:         emit ShareCreated(id, _shareName, _bondingCurve, msg.sender);

168:         emit SharesBought(_id, msg.sender, _amount, price, fee);

188:         emit SharesSold(_id, msg.sender, _amount, price, fee);

220:         emit NFTsCreated(_id, msg.sender, _amount, fee);

240:         emit NFTsBurned(_id, msg.sender, _amount, fee);

248:         emit PlatformFeeClaimed(msg.sender, amount);

258:         emit CreatorFeeClaimed(msg.sender, _id, amount);

269:         emit HolderFeeClaimed(msg.sender, _id, amount);

303:         emit ShareCreationRestricted(_isRestricted);

```

```solidity
File: asD/src/asD.sol

89:         emit CarryWithdrawal(_amount);

```

</details>


<a name="NC-14"></a> 
### [NC-14] Custom errors should be used rather than `revert()`/`require()`
Custom errors are available from solidity version 0.8.4. Custom errors are more easily processed in try-catch blocks, and are easier to re-use and maintain.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: 1155tech-contracts/src/Market.sol

105:         require(whitelistedBondingCurves[_bondingCurve] != _newState, "State already set");

119:         require(whitelistedBondingCurves[_bondingCurve], "Bonding curve not whitelisted");

120:         require(shareIDs[_shareName] == 0, "Share already exists");

151:         require(shareData[_id].creator != msg.sender, "Creator cannot buy");

254:         require(shareData[_id].creator == msg.sender, "Not creator");

301:         require(shareCreationRestricted != _isRestricted, "State already set");

310:         require(whitelistedShareCreators[_address] != _isWhitelisted, "State already set");

```

```solidity
File: asD/src/asD.sol

54:         require(returnCode == 0, "Error when minting");

64:         require(returnCode == 0, "Error when redeeming"); // 0 on success: https://docs.compound.finance/v2/ctokens/#redeem-underlying

81:             require(_amount <= maximumWithdrawable, "Too many tokens requested");

86:         require(returnCode == 0, "Error when redeeming"); // 0 on success: https://docs.compound.finance/v2/ctokens/#redeem

```

</details>


<a name="NC-15"></a> 
### [NC-15] Solidity version is different in some files

*There are <b>2</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

2: pragma solidity 0.8.19;

```

```solidity
File: asD/src/asD.sol

2: pragma solidity >=0.8.0;

```


<a name="NC-16"></a> 
### [NC-16] Duplicated `require()`/`revert()` checks should be refactored
Refactoring duplicate `require()`/`revert()` checks into a modifier or function can make the code more concise, readable and maintainable, and less likely to make errors or omissions when modifying the `require()` or `revert()`.

*There is one instance of this issue:*
```solidity
File: asD/src/asD.sol

/// @audit duplicated on line 86
64:         require(returnCode == 0, "Error when redeeming"); // 0 on success: https://docs.compound.finance/v2/ctokens/#redeem-underlying

```


<a name="NC-17"></a> 
### [NC-17] Enable IR-based code generation
The IR-based code generator was introduced with an aim to not only allow code generation to be more transparent and auditable but also to enable more powerful optimization passes that span across functions. You can enable it on the command line using `--via-ir` or with the option `{"viaIR": true}`. This will take longer to compile, but you can just simple test it before deploying and if you got a better benchmark then you can add --via-ir to your deploy command More on: https://docs.soliditylang.org/en/v0.8.17/ir-breaking-changes.html

*There is one instance of this issue:*
```solidity

Global finding

```


<a name="NC-18"></a> 
### [NC-18] Events are emitted without the sender information
When an action is triggered based on a user's action, not being able to filter based on who triggered the action makes event processing a lot more cumbersome. Including the `msg.sender` the events of these types of action will make events much more useful to end users, especially when `msg.sender` is not `tx.origin`.

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

107:         emit BondingCurveStateChange(_bondingCurve, _newState);

303:         emit ShareCreationRestricted(_isRestricted);

```

```solidity
File: asD/src/asD.sol

89:         emit CarryWithdrawal(_amount);

```


<a name="NC-19"></a> 
### [NC-19] Events may be emitted out of order due to reentrancy
Ensure that events follow the best practice of check-effects-interaction, and are emitted before external calls.

*There are <b>4</b> instances of this issue:*
```solidity
File: asD/src/asD.sol

/// @audit `.exchangeRateCurrent(..)` is called before emit
89:         emit CarryWithdrawal(_amount);

/// @audit `.balanceOf(..)` is called before emit
89:         emit CarryWithdrawal(_amount);

/// @audit `.redeemUnderlying(..)` is called before emit
89:         emit CarryWithdrawal(_amount);

/// @audit `.underlying(..)` is called before emit
89:         emit CarryWithdrawal(_amount);

```


<a name="NC-20"></a> 
### [NC-20]  Function ordering does not follow the Solidity Style Guide
According to the [solidity style guide](https://docs.soliditylang.org/en/v0.8.17/style-guide.html#order-of-functions), functions should be laid out in the following order: `constructor()`, `receive()`, `fallback()`, `external`, `public`, `internal`, `private`, but the cases below do not follow this pattern

*There are <b>9</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

/// @audit public function `getBuyPrice` came earlier from this external function
/// @audit public function `getSellPrice` came earlier from this external function
150:     function buy(uint256 _id, uint256 _amount) external {

/// @audit public function `getBuyPrice` came earlier from this external function
/// @audit public function `getSellPrice` came earlier from this external function
174:     function sell(uint256 _id, uint256 _amount) external {

/// @audit public function `getBuyPrice` came earlier from this external function
/// @audit public function `getSellPrice` came earlier from this external function
/// @audit public function `getNFTMintingPrice` came earlier from this external function
203:     function mintNFT(uint256 _id, uint256 _amount) external {

/// @audit public function `getBuyPrice` came earlier from this external function
/// @audit public function `getSellPrice` came earlier from this external function
/// @audit public function `getNFTMintingPrice` came earlier from this external function
226:     function burnNFT(uint256 _id, uint256 _amount) external {

/// @audit public function `getBuyPrice` came earlier from this external function
/// @audit public function `getSellPrice` came earlier from this external function
/// @audit public function `getNFTMintingPrice` came earlier from this external function
244:     function claimPlatformFee() external onlyOwner {

/// @audit public function `getBuyPrice` came earlier from this external function
/// @audit public function `getSellPrice` came earlier from this external function
/// @audit public function `getNFTMintingPrice` came earlier from this external function
253:     function claimCreatorFee(uint256 _id) external {

/// @audit public function `getBuyPrice` came earlier from this external function
/// @audit public function `getSellPrice` came earlier from this external function
/// @audit public function `getNFTMintingPrice` came earlier from this external function
263:     function claimHolderFee(uint256 _id) external {

/// @audit public function `getBuyPrice` came earlier from this external function
/// @audit public function `getSellPrice` came earlier from this external function
/// @audit public function `getNFTMintingPrice` came earlier from this external function
/// @audit internal function `_getRewardsSinceLastClaim` came earlier from this external function
/// @audit internal function `_splitFees` came earlier from this external function
300:     function restrictShareCreation(bool _isRestricted) external onlyOwner {

/// @audit public function `getBuyPrice` came earlier from this external function
/// @audit public function `getSellPrice` came earlier from this external function
/// @audit public function `getNFTMintingPrice` came earlier from this external function
/// @audit internal function `_getRewardsSinceLastClaim` came earlier from this external function
/// @audit internal function `_splitFees` came earlier from this external function
309:     function changeShareCreatorWhitelist(address _address, bool _isWhitelisted) external onlyOwner {

```


<a name="NC-21"></a> 
### [NC-21] Variable names for `immutable`s should use CONSTANT_CASE
For `immutable` variable names, each word should use all capital letters, with underscores separating each word (CONSTANT_CASE)

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

20:     IERC20 public immutable token;

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

8:     uint256 public immutable priceIncrease;

```

```solidity
File: asD/src/asD.sol

15:     address public immutable cNote; // Reference to the cNOTE token

```


<a name="NC-22"></a> 
### [NC-22] Inconsistent spacing in comments
Some lines use `// x` and some use `//x`. The instances below point out the usages that don't follow the majority, within each file

*There are <b>5</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

13:     //////////////////////////////////////////////////////////////*/

24:     //////////////////////////////////////////////////////////////*/

68:     //////////////////////////////////////////////////////////////*/

```

```solidity
File: asD/src/asD.sol

14:     //////////////////////////////////////////////////////////////*/

19:     //////////////////////////////////////////////////////////////*/

```


<a name="NC-23"></a> 
### [NC-23] Large or complicated code bases should implement invariant tests
This includes: large code bases, or code with lots of inline-assembly, complicated math, or complicated interactions between multiple contracts. Invariant fuzzers such as Echidna require the test writer to come up with invariants which should not be violated under any circumstances, and the fuzzer tests various inputs and function calls to ensure that the invariants always hold. Even code with 100% code coverage can still have bugs due to the order of the operations a user performs, and invariant fuzzers may help significantly.

*There is one instance of this issue:*
```solidity

Global finding

```


<a name="NC-24"></a> 
### [NC-24] Large multiples of ten should use scientific notation
Use a scientific notation rather than decimal literals (e.g. `1e6` instead of `1000000`), for better code readability.

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

197:         fee = (priceForOne * _amount * NFT_FEE_BPS) / 10_000;

285:         uint256 shareHolderFee = (_fee * HOLDER_CUT_BPS) / 10_000;

286:         uint256 shareCreatorFee = (_fee * CREATOR_CUT_BPS) / 10_000;

```


<a name="NC-25"></a> 
### [NC-25] Magic numbers should be replaced with constants
Magic numbers are hard-coded values in code that can make it difficult for developers and maintainers to understand the code, and can also cause confusion or errors. To improve the readability and maintainability of code, it is recommended to replace magic numbers with constants that have good readability.

<details>
<summary>
There are <b>14</b> instances (click to show):
</summary>

```solidity
File: 1155tech-contracts/src/Market.sol

// @audit `7700`
93:         if (block.chainid == 7700 || block.chainid == 7701) {

// @audit `7701`
93:         if (block.chainid == 7700 || block.chainid == 7701) {

// @audit `0xEcf044C5B4b867CFda001101c617eCd347095B44`
95:             Turnstile turnstile = Turnstile(0xEcf044C5B4b867CFda001101c617eCd347095B44);

// @audit `10_000`
197:         fee = (priceForOne * _amount * NFT_FEE_BPS) / 10_000;

// @audit `1e18`
276:             1e18;

// @audit `10_000`
285:         uint256 shareHolderFee = (_fee * HOLDER_CUT_BPS) / 10_000;

// @audit `10_000`
286:         uint256 shareCreatorFee = (_fee * CREATOR_CUT_BPS) / 10_000;

// @audit `1e18`
290:             shareData[_id].shareHolderRewardsPerTokenScaled += (shareHolderFee * 1e18) / _tokenCount;

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

// @audit `1e18`
23:             fee += (getFee(i) * tokenPrice) / 1e18;

// @audit `1e17`
35:         return 1e17 / divisor;

```

```solidity
File: asD/src/asD.sol

// @audit `7700`
37:         if (block.chainid == 7700 || block.chainid == 7701) {

// @audit `7701`
37:         if (block.chainid == 7700 || block.chainid == 7701) {

// @audit `0xEcf044C5B4b867CFda001101c617eCd347095B44`
39:             Turnstile turnstile = Turnstile(0xEcf044C5B4b867CFda001101c617eCd347095B44);

// @audit `1e28`
76:             1e28 -

```

</details>


<a name="NC-26"></a> 
### [NC-26] Consider moving `msg.sender` checks to `modifier`s
If some functions are only allowed to be called by some specific users, consider using a modifier instead of checking with a require statement, especially if this check is done in multiple functions.

*There are <b>2</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

151:         require(shareData[_id].creator != msg.sender, "Creator cannot buy");

254:         require(shareData[_id].creator == msg.sender, "Not creator");

```


<a name="NC-27"></a> 
### [NC-27] Named mappings are recommended
[Named mappings](https://docs.soliditylang.org/en/v0.8.18/types.html#mapping-types) (with syntax `mapping(KeyType KeyName? => ValueType ValueName?)`) are recommended.It can make the mapping variables clearer, more readable and easier to maintain.

*There are <b>7</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

30:     mapping(string => uint256) public shareIDs;

43:     mapping(uint256 => ShareData) public shareData;

46:     mapping(uint256 => address) public shareBondingCurves;

49:     mapping(address => bool) public whitelistedBondingCurves;

52:     mapping(uint256 => mapping(address => uint256)) public tokensByAddress;

55:     mapping(uint256 => mapping(address => uint256)) public rewardsLastClaimedValue;

64:     mapping(address => bool) public whitelistedShareCreators;

```


<a name="NC-28"></a> 
### [NC-28] Missing NatSpec from contract declarations
e.g. `@dev` or `@notice`, and it must appear above the contract definition braces in order to be identified by the compiler as NatSpec.

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

10: contract Market is ERC1155, Ownable2Step {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

6: contract LinearBondingCurve is IBondingCurve {

```

```solidity
File: asD/src/asD.sol

11: contract asD is ERC20, Ownable2Step {

```


<a name="NC-29"></a> 
### [NC-29] Missing NatSpec `@author` from contract declaration
Some contract definitions have an incomplete NatSpec: add a `@author` notation to improve the code documentation.

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

10: contract Market is ERC1155, Ownable2Step {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

6: contract LinearBondingCurve is IBondingCurve {

```

```solidity
File: asD/src/asD.sol

11: contract asD is ERC20, Ownable2Step {

```


<a name="NC-30"></a> 
### [NC-30] Missing NatSpec `@dev` from contract declaration
Some contract definitions have an incomplete NatSpec: add a `@dev` notation to improve the code documentation.

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

10: contract Market is ERC1155, Ownable2Step {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

6: contract LinearBondingCurve is IBondingCurve {

```

```solidity
File: asD/src/asD.sol

11: contract asD is ERC20, Ownable2Step {

```


<a name="NC-31"></a> 
### [NC-31] Missing NatSpec `@dev` from event declaration
Some event definitions have an incomplete NatSpec: add a `@dev` notation to improve the code documentation.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: 1155tech-contracts/src/Market.sol

69:     event BondingCurveStateChange(address indexed curve, bool isWhitelisted);

70:     event ShareCreated(uint256 indexed id, string name, address indexed bondingCurve, address indexed creator);

71:     event SharesBought(uint256 indexed id, address indexed buyer, uint256 amount, uint256 price, uint256 fee);

72:     event SharesSold(uint256 indexed id, address indexed seller, uint256 amount, uint256 price, uint256 fee);

73:     event NFTsCreated(uint256 indexed id, address indexed creator, uint256 amount, uint256 fee);

74:     event NFTsBurned(uint256 indexed id, address indexed burner, uint256 amount, uint256 fee);

75:     event PlatformFeeClaimed(address indexed claimer, uint256 amount);

76:     event CreatorFeeClaimed(address indexed claimer, uint256 indexed id, uint256 amount);

77:     event HolderFeeClaimed(address indexed claimer, uint256 indexed id, uint256 amount);

78:     event ShareCreationRestricted(bool isRestricted);

```

```solidity
File: asD/src/asD.sol

20:     event CarryWithdrawal(uint256 amount);

```

</details>


<a name="NC-32"></a> 
### [NC-32] Missing NatSpec `@dev` from function declaration
Some function definitions have an incomplete NatSpec: add a `@dev` notation to improve the code documentation.

<details>
<summary>
There are <b>21</b> instances (click to show):
</summary>

```solidity
File: 1155tech-contracts/src/Market.sol

91:     constructor(string memory _uri, address _paymentToken) ERC1155(_uri) Ownable() {

114:     function createNewShare(

132:     function getBuyPrice(uint256 _id, uint256 _amount) public view returns (uint256 price, uint256 fee) {

141:     function getSellPrice(uint256 _id, uint256 _amount) public view returns (uint256 price, uint256 fee) {

150:     function buy(uint256 _id, uint256 _amount) external {

174:     function sell(uint256 _id, uint256 _amount) external {

194:     function getNFTMintingPrice(uint256 _id, uint256 _amount) public view returns (uint256 fee) {

203:     function mintNFT(uint256 _id, uint256 _amount) external {

226:     function burnNFT(uint256 _id, uint256 _amount) external {

244:     function claimPlatformFee() external onlyOwner {

253:     function claimCreatorFee(uint256 _id) external {

263:     function claimHolderFee(uint256 _id) external {

272:     function _getRewardsSinceLastClaim(uint256 _id) internal view returns (uint256 amount) {

280:     function _splitFees(

300:     function restrictShareCreation(bool _isRestricted) external onlyOwner {

309:     function changeShareCreatorWhitelist(address _address, bool _isWhitelisted) external onlyOwner {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

10:     constructor(uint256 _priceIncrease) {

14:     function getPriceAndFee(uint256 shareCount, uint256 amount)

27:     function getFee(uint256 shareCount) public pure override returns (uint256) {

```

```solidity
File: asD/src/asD.sol

28:     constructor(

60:     function burn(uint256 _amount) external {

```

</details>


<a name="NC-33"></a> 
### [NC-33] Missing NatSpec `@dev` from modifier declaration
Some modifier definitions have an incomplete NatSpec: add a `@dev` notation to improve the code documentation.

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

80:     modifier onlyShareCreator() {

```


<a name="NC-34"></a> 
### [NC-34] Event declarations should have NatSpec descriptions

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: 1155tech-contracts/src/Market.sol

69:     event BondingCurveStateChange(address indexed curve, bool isWhitelisted);

70:     event ShareCreated(uint256 indexed id, string name, address indexed bondingCurve, address indexed creator);

71:     event SharesBought(uint256 indexed id, address indexed buyer, uint256 amount, uint256 price, uint256 fee);

72:     event SharesSold(uint256 indexed id, address indexed seller, uint256 amount, uint256 price, uint256 fee);

73:     event NFTsCreated(uint256 indexed id, address indexed creator, uint256 amount, uint256 fee);

74:     event NFTsBurned(uint256 indexed id, address indexed burner, uint256 amount, uint256 fee);

75:     event PlatformFeeClaimed(address indexed claimer, uint256 amount);

76:     event CreatorFeeClaimed(address indexed claimer, uint256 indexed id, uint256 amount);

77:     event HolderFeeClaimed(address indexed claimer, uint256 indexed id, uint256 amount);

78:     event ShareCreationRestricted(bool isRestricted);

```

```solidity
File: asD/src/asD.sol

20:     event CarryWithdrawal(uint256 amount);

```

</details>


<a name="NC-35"></a> 
### [NC-35] NatSpec documentation for function is missing
It is recommended that Solidity contracts are fully annotated using NatSpec for all public interfaces (everything in the ABI). It is clearly stated in the Solidity official documentation. In complex projects such as DeFi, the interpretation of all functions and their arguments and returns is important for code readability and auditability.

*There are <b>4</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

272:     function _getRewardsSinceLastClaim(uint256 _id) internal view returns (uint256 amount) {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

10:     constructor(uint256 _priceIncrease) {

14:     function getPriceAndFee(uint256 shareCount, uint256 amount)
            external
            view
            override
            returns (uint256 price, uint256 fee)
        {

27:     function getFee(uint256 shareCount) public pure override returns (uint256) {

```


<a name="NC-36"></a> 
### [NC-36] Modifier declarations should have NatSpec descriptions

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

80:     modifier onlyShareCreator() {

```


<a name="NC-37"></a> 
### [NC-37] Public variable declarations should have NatSpec descriptions

*There are <b>5</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

14:     uint256 public constant NFT_FEE_BPS = 1_000; // 10%

15:     uint256 public constant HOLDER_CUT_BPS = 3_300; // 33%

16:     uint256 public constant CREATOR_CUT_BPS = 3_300; // 33%

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

8:     uint256 public immutable priceIncrease;

```

```solidity
File: asD/src/asD.sol

15:     address public immutable cNote; // Reference to the cNOTE token

```


<a name="NC-38"></a> 
### [NC-38] Missing NatSpec `@notice` from contract declaration
Some contract definitions have an incomplete NatSpec: add a `@notice` notation to improve the code documentation.

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

10: contract Market is ERC1155, Ownable2Step {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

6: contract LinearBondingCurve is IBondingCurve {

```

```solidity
File: asD/src/asD.sol

11: contract asD is ERC20, Ownable2Step {

```


<a name="NC-39"></a> 
### [NC-39] Missing NatSpec `@notice` from event declaration
Some event definitions have an incomplete NatSpec: add a `@notice` notation to improve the code documentation.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: 1155tech-contracts/src/Market.sol

69:     event BondingCurveStateChange(address indexed curve, bool isWhitelisted);

70:     event ShareCreated(uint256 indexed id, string name, address indexed bondingCurve, address indexed creator);

71:     event SharesBought(uint256 indexed id, address indexed buyer, uint256 amount, uint256 price, uint256 fee);

72:     event SharesSold(uint256 indexed id, address indexed seller, uint256 amount, uint256 price, uint256 fee);

73:     event NFTsCreated(uint256 indexed id, address indexed creator, uint256 amount, uint256 fee);

74:     event NFTsBurned(uint256 indexed id, address indexed burner, uint256 amount, uint256 fee);

75:     event PlatformFeeClaimed(address indexed claimer, uint256 amount);

76:     event CreatorFeeClaimed(address indexed claimer, uint256 indexed id, uint256 amount);

77:     event HolderFeeClaimed(address indexed claimer, uint256 indexed id, uint256 amount);

78:     event ShareCreationRestricted(bool isRestricted);

```

```solidity
File: asD/src/asD.sol

20:     event CarryWithdrawal(uint256 amount);

```

</details>


<a name="NC-40"></a> 
### [NC-40] Missing NatSpec `@notice` from function declaration
Some function definitions have an incomplete NatSpec: add a `@notice` notation to improve the code documentation.

*There are <b>4</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

272:     function _getRewardsSinceLastClaim(uint256 _id) internal view returns (uint256 amount) {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

10:     constructor(uint256 _priceIncrease) {

14:     function getPriceAndFee(uint256 shareCount, uint256 amount)

27:     function getFee(uint256 shareCount) public pure override returns (uint256) {

```


<a name="NC-41"></a> 
### [NC-41] Missing NatSpec `@notice` from modifier declaration
Some modifier definitions have an incomplete NatSpec: add a `@notice` notation to improve the code documentation.

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

80:     modifier onlyShareCreator() {

```


<a name="NC-42"></a> 
### [NC-42] Missing NatSpec `@param` from event declaration
Some event definitions have an incomplete NatSpec: add a `@param` notation to improve the code documentation.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: 1155tech-contracts/src/Market.sol

69:     event BondingCurveStateChange(address indexed curve, bool isWhitelisted);

70:     event ShareCreated(uint256 indexed id, string name, address indexed bondingCurve, address indexed creator);

71:     event SharesBought(uint256 indexed id, address indexed buyer, uint256 amount, uint256 price, uint256 fee);

72:     event SharesSold(uint256 indexed id, address indexed seller, uint256 amount, uint256 price, uint256 fee);

73:     event NFTsCreated(uint256 indexed id, address indexed creator, uint256 amount, uint256 fee);

74:     event NFTsBurned(uint256 indexed id, address indexed burner, uint256 amount, uint256 fee);

75:     event PlatformFeeClaimed(address indexed claimer, uint256 amount);

76:     event CreatorFeeClaimed(address indexed claimer, uint256 indexed id, uint256 amount);

77:     event HolderFeeClaimed(address indexed claimer, uint256 indexed id, uint256 amount);

78:     event ShareCreationRestricted(bool isRestricted);

```

```solidity
File: asD/src/asD.sol

20:     event CarryWithdrawal(uint256 amount);

```

</details>


<a name="NC-43"></a> 
### [NC-43] Missing NatSpec `@param` from function declaration
Some function definitions have an incomplete NatSpec: add a `@param` notation to improve the code documentation.

*There are <b>6</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

/// @audit missing @param for `_id`
272:     function _getRewardsSinceLastClaim(uint256 _id) internal view returns (uint256 amount) {

/// @audit missing @param for `_id`
/// @audit missing @param for `_fee`
/// @audit missing @param for `_tokenCount`
280:     function _splitFees(
             uint256 _id,
             uint256 _fee,
             uint256 _tokenCount
         ) internal {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

/// @audit missing @param for `_priceIncrease`
10:     constructor(uint256 _priceIncrease) {

/// @audit missing @param for `shareCount`
/// @audit missing @param for `amount`
14:     function getPriceAndFee(uint256 shareCount, uint256 amount)
            external
            view
            override
            returns (uint256 price, uint256 fee)
        {

/// @audit missing @param for `shareCount`
27:     function getFee(uint256 shareCount) public pure override returns (uint256) {

/// @audit missing @param for `x`
42:     function log2(uint256 x) internal pure returns (uint256 r) {

```


<a name="NC-44"></a> 
### [NC-44] Missing NatSpec `@return` from function declaration
Some function definitions have an incomplete NatSpec: add a `@return` notation to improve the code documentation.

*There are <b>8</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

114:     function createNewShare(
             string memory _shareName,
             address _bondingCurve,
             string memory _metadataURI
         ) external onlyShareCreator returns (uint256 id) {

132:     function getBuyPrice(uint256 _id, uint256 _amount) public view returns (uint256 price, uint256 fee) {

141:     function getSellPrice(uint256 _id, uint256 _amount) public view returns (uint256 price, uint256 fee) {

194:     function getNFTMintingPrice(uint256 _id, uint256 _amount) public view returns (uint256 fee) {

272:     function _getRewardsSinceLastClaim(uint256 _id) internal view returns (uint256 amount) {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

14:     function getPriceAndFee(uint256 shareCount, uint256 amount)
            external
            view
            override
            returns (uint256 price, uint256 fee)
        {

27:     function getFee(uint256 shareCount) public pure override returns (uint256) {

42:     function log2(uint256 x) internal pure returns (uint256 r) {

```


<a name="NC-45"></a> 
### [NC-45] Missing NatSpec `@title` from contract declaration
Some contract definitions have an incomplete NatSpec: add a `@title` notation to improve the code documentation.

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

10: contract Market is ERC1155, Ownable2Step {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

6: contract LinearBondingCurve is IBondingCurve {

```

```solidity
File: asD/src/asD.sol

11: contract asD is ERC20, Ownable2Step {

```


<a name="NC-46"></a> 
### [NC-46] Using `>` or `>=` without specifying an upper bound is unsafe
There will be breaking changes in future versions of solidity, and at that point your code will no longer be compatable. While you may have the specific version to use in a configuration file, others that include your source files may not.

*There is one instance of this issue:*
```solidity
File: asD/src/asD.sol

2: pragma solidity >=0.8.0;

```


<a name="NC-47"></a> 
### [NC-47] State variables should include comments
Consider adding some comments on critical state variables to explain what they are supposed to do: this will help for future code reviews.

*There are <b>6</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

14:     uint256 public constant NFT_FEE_BPS = 1_000; // 10%

15:     uint256 public constant HOLDER_CUT_BPS = 3_300; // 33%

16:     uint256 public constant CREATOR_CUT_BPS = 3_300; // 33%

27:     uint256 public shareCount;

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

8:     uint256 public immutable priceIncrease;

```

```solidity
File: asD/src/asD.sol

15:     address public immutable cNote; // Reference to the cNOTE token

```


<a name="NC-48"></a> 
### [NC-48] Lines are too long
The [solidity style guide](https://docs.soliditylang.org/en/v0.8.17/style-guide.html#maximum-line-length) recommends a maximum line length of 120 characters. Lines of code that are longer than 120 should be wrapped.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: 1155tech-contracts/src/Market.sol

4: import {ERC1155} from "/home/myubuntu/Desktop/2023-11-canto/1155tech-contracts/lib/openzeppelin-contracts/contracts/token/ERC1155/ERC1155.sol";

5: import {SafeERC20, IERC20} from "/home/myubuntu/Desktop/2023-11-canto/1155tech-contracts/lib/openzeppelin-contracts/contracts/token/ERC20/utils/SafeERC20.sol";

6: import {Ownable, Ownable2Step} from "/home/myubuntu/Desktop/2023-11-canto/1155tech-contracts/lib/openzeppelin-contracts/contracts/access/Ownable2Step.sol";

34:         uint256 tokensInCirculation; // Number of outstanding tokens - tokens that are minted as NFT, i.e. the number of tokens that receive fees

35:         uint256 shareHolderRewardsPerTokenScaled; // Accrued funds for the share holder per token, multiplied by 1e18 to avoid precision loss

```

```solidity
File: asD/src/asD.sol

7: import {Ownable2Step} from "/home/myubuntu/Desktop/2023-11-canto/asD/lib/openzeppelin-contracts/contracts/access/Ownable2Step.sol";

8: import {IERC20, ERC20} from "/home/myubuntu/Desktop/2023-11-canto/asD/lib/openzeppelin-contracts/contracts/token/ERC20/ERC20.sol";

9: import {SafeERC20} from "/home/myubuntu/Desktop/2023-11-canto/asD/lib/openzeppelin-contracts/contracts/token/ERC20/utils/SafeERC20.sol";

64:         require(returnCode == 0, "Error when redeeming"); // 0 on success: https://docs.compound.finance/v2/ctokens/#redeem-underlying

73:         uint256 exchangeRate = CTokenInterface(cNote).exchangeRateCurrent(); // Scaled by 1 * 10^(18 - 8 + Underlying Token Decimals), i.e. 10^(28) in our case

86:         require(returnCode == 0, "Error when redeeming"); // 0 on success: https://docs.compound.finance/v2/ctokens/#redeem

```

</details>


<a name="NC-49"></a> 
### [NC-49] Unused import
The identifier is imported but never used within the file.

*There is one instance of this issue:*
```solidity
File: asD/src/asD.sol

/// @audit `IasDFactory`
5: import {IasDFactory} from "../interface/IasDFactory.sol";

```


<a name="NC-50"></a> 
### [NC-50] Unused contract variables
The following state variables are defined but not used. It is recommended to check the code for logical omissions that cause them not to be used. If it's determined that they are not needed anywhere, it's best to remove them from the codebase to improve code clarity and minimize confusion.

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

16:     uint256 public constant CREATOR_CUT_BPS = 3_300; // 33%

```


<a name="NC-51"></a> 
### [NC-51] Consider using `delete` rather than assigning zero/false to clear values
The `delete` keyword more closely matches the semantics of what is being done, and draws more attention to the changing of state, which may lead to a more thorough audit of its associated logic.

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

256:         shareData[_id].shareCreatorPool = 0;

```


<a name="NC-52"></a> 
### [NC-52] Solidity compiler version is not fixed
To prevent the actual contracts deployed from behaving differently depending on the compiler version, it is recommended to use a fixed solidity version.

*There is one instance of this issue:*
```solidity
File: asD/src/asD.sol

2: pragma solidity >=0.8.0;

```


<a name="NC-53"></a> 
### [NC-53] Expressions for constant values should use `immutable` rather than `constant`
While it doesn't save any gas because the compiler knows that developers often make this mistake, it's still best to use the right tool for the task at hand. There is a difference between `constant` variables and `immutable` variables, and they should each be used in their appropriate contexts. `constants` should be used for literal values written into the code, and `immutable` variables should be used for expressions, or values calculated in, or passed into the constructor.

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

14:     uint256 public constant NFT_FEE_BPS = 1_000; // 10%

15:     uint256 public constant HOLDER_CUT_BPS = 3_300; // 33%

16:     uint256 public constant CREATOR_CUT_BPS = 3_300; // 33%

```


<a name="NC-54"></a> 
### [NC-54] Use `@inheritdoc` for overridden functions

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

27:     function getFee(uint256 shareCount) public pure override returns (uint256) {

```


<a name="NC-55"></a> 
### [NC-55] Use the latest solidity version for deployment (`0.8.23`)
Upgrading to a newer Solidity release can optimize gas usage, take advantage of new features and improve overall contract efficiency. Where possible, based on compatibility requirements, it is recommended to use newer/latest solidity version to take advantage of the latest optimizations and features.

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

2: pragma solidity 0.8.19;

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

2: pragma solidity 0.8.19;

```

```solidity
File: asD/src/asD.sol

2: pragma solidity >=0.8.0;

```


<a name="NC-56"></a> 
### [NC-56] Use of `override` is unnecessary
Starting with Solidity version [0.8.8](https://docs.soliditylang.org/en/v0.8.20/contracts.html#function-overriding), using the `override` keyword when the function solely overrides an interface function, and the function doesn't exist in multiple base contracts, is unnecessary.

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

27:     function getFee(uint256 shareCount) public pure override returns (uint256) {

```


<a name="NC-57"></a> 
### [NC-57] Whitespace in Expressions
See the [Whitespace in Expressions](https://docs.soliditylang.org/en/latest/style-guide.html#whitespace-in-expressions) section of the Solidity Style Guide.

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

196:         (uint256 priceForOne, ) = IBondingCurve(bondingCurve).getPriceAndFee(shareData[_id].tokenCount, 1);

```


<a name="NC-58"></a> 
### [NC-58] Names of `private`/`internal` functions should be prefixed with an underscore
It is recommended by the [Solidity Style Guide](https://docs.soliditylang.org/en/v0.8.20/style-guide.html#underscore-prefix-for-non-external-functions-and-variables)

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

42:     function log2(uint256 x) internal pure returns (uint256 r) {

```


<a name="NC-59"></a> 
### [NC-59] Event is missing `indexed` fields
Index event fields make the field more quickly accessible to off-chain tools that parse events. However, note that each index field costs extra gas during emission, so it's not necessarily best to index the maximum allowed per event (three fields). Each event should use three indexed fields if there are three or more fields, and gas usage is not particularly of concern for the events in question. If there are fewer than three fields, all of the fields should be indexed.

*There are <b>10</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

69:     event BondingCurveStateChange(address indexed curve, bool isWhitelisted);

71:     event SharesBought(uint256 indexed id, address indexed buyer, uint256 amount, uint256 price, uint256 fee);

72:     event SharesSold(uint256 indexed id, address indexed seller, uint256 amount, uint256 price, uint256 fee);

73:     event NFTsCreated(uint256 indexed id, address indexed creator, uint256 amount, uint256 fee);

74:     event NFTsBurned(uint256 indexed id, address indexed burner, uint256 amount, uint256 fee);

75:     event PlatformFeeClaimed(address indexed claimer, uint256 amount);

76:     event CreatorFeeClaimed(address indexed claimer, uint256 indexed id, uint256 amount);

77:     event HolderFeeClaimed(address indexed claimer, uint256 indexed id, uint256 amount);

78:     event ShareCreationRestricted(bool isRestricted);

```

```solidity
File: asD/src/asD.sol

20:     event CarryWithdrawal(uint256 amount);

```



## Gas Optimizations

<a name="GAS-1"></a> 
### [GAS-1] Optimize Gas by Using Do-While Loops
Using `do-while` loops instead of `for` loops can be more gas-efficient. Even if you add an `if` condition to account for the case where the loop doesn't execute at all, a `do-while` loop can still be cheaper in terms of gas.

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

20:         for (uint256 i = shareCount; i < shareCount + amount; i++) {

```


<a name="GAS-2"></a> 
### [GAS-2] Multiple `address`/ID mappings can be combined into a single `mapping` of an `address`/ID to a `struct`, where appropriate
Saves a storage slot for the mapping. Depending on the circumstances and sizes of types, can avoid a Gsset (20000 gas) per mapping combined. Reads and subsequent writes can also be cheaper when a function requires both values and they both fit in the same storage slot. Finally, if both fields are accessed in the same function, can save ~42 gas per access due to not having to [recalculate the key's keccak256 hash](https://gist.github.com/IllIllI000/ec23a57daa30a8f8ca8b9681c8ccefb0) (Gkeccak256 - 30 gas) and that calculation's associated stack operations.

*There are <b>2</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

52:     mapping(uint256 => mapping(address => uint256)) public tokensByAddress;

55:     mapping(uint256 => mapping(address => uint256)) public rewardsLastClaimedValue;

```


<a name="GAS-3"></a> 
### [GAS-3] Consider activating via-ir for deploying
By using `--via-ir` or `{"viaIR": true}`, the compiler is able to use more advanced [multi-function optimizations](https://docs.soliditylang.org/en/v0.8.17/ir-breaking-changes.html#solidity-ir-based-codegen-changes), for extra gas savings.

*There is one instance of this issue:*
```solidity

Global finding

```


<a name="GAS-4"></a> 
### [GAS-4] Divisions can be `unchecked` to save gas
The expression `type(int).min/(-1)` is the only case where division causes an overflow. Therefore, uncheck can be used to [save gas](https://gist.github.com/DadeKuma/3bc597338ae774b8b3bd43280d55271f) in scenarios where it is certain that such an overflow will not occur.

*There are <b>8</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

197:         fee = (priceForOne * _amount * NFT_FEE_BPS) / 10_000;

275:             ((shareData[_id].shareHolderRewardsPerTokenScaled - lastClaimedValue) * tokensByAddress[_id][msg.sender]) /

285:         uint256 shareHolderFee = (_fee * HOLDER_CUT_BPS) / 10_000;

286:         uint256 shareCreatorFee = (_fee * CREATOR_CUT_BPS) / 10_000;

290:             shareData[_id].shareHolderRewardsPerTokenScaled += (shareHolderFee * 1e18) / _tokenCount;

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

23:             fee += (getFee(i) * tokenPrice) / 1e18;

35:         return 1e17 / divisor;

```

```solidity
File: asD/src/asD.sol

75:         uint256 maximumWithdrawable = (CTokenInterface(cNote).balanceOf(address(this)) * exchangeRate) /

```


<a name="GAS-5"></a> 
### [GAS-5] Operator `+=` costs more gas than `<x> = <x> + <y>` for state variables

<details>
<summary>
There are <b>16</b> instances (click to show):
</summary>

```solidity
File: 1155tech-contracts/src/Market.sol

161:         shareData[_id].tokenCount += _amount;

162:         shareData[_id].tokensInCirculation += _amount;

163:         tokensByAddress[_id][msg.sender] += _amount;

182:         shareData[_id].tokenCount -= _amount;

183:         shareData[_id].tokensInCirculation -= _amount;

184:         tokensByAddress[_id][msg.sender] -= _amount; // Would underflow if user did not have enough tokens

211:         tokensByAddress[_id][msg.sender] -= _amount;

212:         shareData[_id].tokensInCirculation -= _amount;

234:         tokensByAddress[_id][msg.sender] += _amount;

235:         shareData[_id].tokensInCirculation += _amount;

288:         shareData[_id].shareCreatorPool += shareCreatorFee;

290:             shareData[_id].shareHolderRewardsPerTokenScaled += (shareHolderFee * 1e18) / _tokenCount;

293:             platformFee += shareHolderFee;

295:         platformPool += platformFee;

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

22:             price += tokenPrice;

23:             fee += (getFee(i) * tokenPrice) / 1e18;

```

</details>


<a name="GAS-6"></a> 
### [GAS-6] Duplicated `require()`/`revert()` checks should be refactored to a modifier or function to save gas
Saves deployment costs.

*There is one instance of this issue:*
```solidity
File: asD/src/asD.sol

/// @audit duplicated on line 86
64:         require(returnCode == 0, "Error when redeeming"); // 0 on success: https://docs.compound.finance/v2/ctokens/#redeem-underlying

```


<a name="GAS-7"></a> 
### [GAS-7] Increments can be `unchecked` to save gas
Using `unchecked` increments can save gas by bypassing the built-in overflow checks. This can save 30-40 gas per iteration. So it is recommended to use unchecked increments when overflow is not possible.

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

20:         for (uint256 i = shareCount; i < shareCount + amount; i++) {

```


<a name="GAS-8"></a> 
### [GAS-8] Inline `modifier`s that are only used once, to save gas

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

80:     modifier onlyShareCreator() {

```


<a name="GAS-9"></a> 
### [GAS-9] `internal` functions only called once can be inlined to save gas
If an `internal` function is only used once, there is no need to modularize it, unless the function calling it would otherwise be too long and complex. Not inlining costs 20 to 40 gas because of two extra JUMP instructions and additional stack operations needed for function calls.

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

/// @audit `log2` is used only once
42:     function log2(uint256 x) internal pure returns (uint256 r) {

```


<a name="GAS-10"></a> 
### [GAS-10] Multiple accesses of the same mapping/array key/index should be cached
The instances below point to the second+ access of a value inside a mapping/array, within a function. Caching a mapping's value in a local `storage` or `calldata` variable when the value is accessed [multiple times](https://gist.github.com/IllIllI000/ec23a57daa30a8f8ca8b9681c8ccefb0), saves ~42 gas per access due to not having to recalculate the key's keccak256 hash (Gkeccak256 - 30 gas) and that calculation's associated stack operations. Caching an array's struct avoids recalculating the array offsets into memory/calldata

<details>
<summary>
There are <b>19</b> instances (click to show):
</summary>

```solidity
File: 1155tech-contracts/src/Market.sol

/// @audit `whitelistedBondingCurves[_bondingCurve]` is also accessed on line 105
106:         whitelistedBondingCurves[_bondingCurve] = _newState;

/// @audit `whitelistedBondingCurves[_bondingCurve]` is also accessed on line 105
106:         whitelistedBondingCurves[_bondingCurve] = _newState;

/// @audit `shareIDs[_shareName]` is also accessed on line 120
122:         shareIDs[_shareName] = id;

/// @audit `shareData[id]` is also accessed on line 123
124:         shareData[id].creator = msg.sender;

/// @audit `shareData[id]` is also accessed on line 123
125:         shareData[id].metadataURI = _metadataURI;

/// @audit `shareData[_id]` is also accessed on line 134
135:         (price, fee) = IBondingCurve(bondingCurve).getPriceAndFee(shareData[_id].tokenCount + 1, _amount);

/// @audit `shareData[_id]` is also accessed on line 143
144:         (price, fee) = IBondingCurve(bondingCurve).getPriceAndFee(shareData[_id].tokenCount - _amount + 1, _amount);

/// @audit `shareData[_id]` is also accessed on line 151
158:         _splitFees(_id, fee, shareData[_id].tokensInCirculation);

/// @audit `shareData[_id]` is also accessed on line 151
161:         shareData[_id].tokenCount += _amount;

/// @audit `shareData[_id]` is also accessed on line 151
162:         shareData[_id].tokensInCirculation += _amount;

/// @audit `shareData[_id]` is also accessed on line 177
182:         shareData[_id].tokenCount -= _amount;

/// @audit `shareData[_id]` is also accessed on line 177
183:         shareData[_id].tokensInCirculation -= _amount;

/// @audit `shareData[_id]` is also accessed on line 195
196:         (uint256 priceForOne, ) = IBondingCurve(bondingCurve).getPriceAndFee(shareData[_id].tokenCount, 1);

/// @audit `shareData[_id]` is also accessed on line 207
212:         shareData[_id].tokensInCirculation -= _amount;

/// @audit `shareData[_id]` is also accessed on line 230
235:         shareData[_id].tokensInCirculation += _amount;

/// @audit `shareData[_id]` is also accessed on line 254
255:         uint256 amount = shareData[_id].shareCreatorPool;

/// @audit `shareData[_id]` is also accessed on line 254
256:         shareData[_id].shareCreatorPool = 0;

/// @audit `shareData[_id]` is also accessed on line 288
290:             shareData[_id].shareHolderRewardsPerTokenScaled += (shareHolderFee * 1e18) / _tokenCount;

/// @audit `whitelistedShareCreators[_address]` is also accessed on line 310
311:         whitelistedShareCreators[_address] = _isWhitelisted;

```

</details>


<a name="GAS-11"></a> 
### [GAS-11] Newer versions of solidity are more gas efficient
The solidity language continues to pursue more efficient gas optimization schemes. Adopting a newer version of solidity can be more gas efficient.

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

2: pragma solidity 0.8.19;

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

2: pragma solidity 0.8.19;

```

```solidity
File: asD/src/asD.sol

2: pragma solidity >=0.8.0;

```


<a name="GAS-12"></a> 
### [GAS-12] Operator `>=`/`<=` costs less gas than operator `>`/`<`
The compiler uses opcodes `GT` and `ISZERO` for code that uses `>`, but only requires `LT` for `>=`. A similar behavior applies for `>`, which uses opcodes `LT` and `ISZERO`, but only requires `GT` for `<=`. It can save 3 gas for each. It should be converted to the `<=`/`>=` equivalent when comparing against integer literals.

*There are <b>6</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

165:         if (rewardsSinceLastClaim > 0) {

216:         if (rewardsSinceLastClaim > 0) {

266:         if (amount > 0) {

289:         if (_tokenCount > 0) {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

20:         for (uint256 i = shareCount; i < shareCount + amount; i++) {

29:         if (shareCount > 1) {

```


<a name="GAS-13"></a> 
### [GAS-13] Optimize names to save gas
`public`/`external` function names and `public` member variable names can be optimized to save gas. See this [link](https://gist.github.com/IllIllI000/a5d8b486a8259f9f77891a919febd1a9) for an example of how it works. Below are the interfaces/abstract contracts that can be optimized so that the most frequently-called functions use the least amount of gas possible during method lookup. Method IDs that have two leading zero bytes can save 128 gas each during deployment, and renaming functions to have lower method IDs will save 22 gas per call, [per sorted position shifted](https://medium.com/joyso/solidity-how-does-function-name-affect-gas-consumption-in-smart-contract-47d270d8ac92)

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

/// @audit `changeBondingCurveAllowed`, `createNewShare`, `getBuyPrice`, `getSellPrice`, `buy`, `sell`, `getNFTMintingPrice`, `mintNFT`, `burnNFT`, `claimPlatformFee`, `claimCreatorFee`, `claimHolderFee`, `restrictShareCreation`, `changeShareCreatorWhitelist`
10: contract Market is ERC1155, Ownable2Step {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

/// @audit `getPriceAndFee`, `getFee`
6: contract LinearBondingCurve is IBondingCurve {

```

```solidity
File: asD/src/asD.sol

/// @audit `mint`, `burn`, `withdrawCarry`
11: contract asD is ERC20, Ownable2Step {

```


<a name="GAS-14"></a> 
### [GAS-14] Reduce gas usage by moving to Solidity 0.8.19 or later
Solidity version 0.8.19 introduced a number of gas optimizations, refer to the [Solidity 0.8.19 Release Announcement](https://soliditylang.org/blog/2023/02/22/solidity-0.8.19-release-announcement/) for details.

*There is one instance of this issue:*
```solidity
File: asD/src/asD.sol

2: pragma solidity >=0.8.0;

```


<a name="GAS-15"></a> 
### [GAS-15] Remove or replace unused state variables
Saves a storage slot. If the variable is assigned a non-zero value, saves Gsset (20000 gas). If it's assigned a zero value, saves Gsreset (2900 gas). If the variable remains unassigned, there is no gas savings unless the variable is `public`, in which case the compiler-generated non-payable getter deployment cost is saved. If the state variable is overriding an interface's public function, mark the variable as `constant` or `immutable` so that it does not use a storage slot.

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

16:     uint256 public constant CREATOR_CUT_BPS = 3_300; // 33%

```


<a name="GAS-16"></a> 
### [GAS-16] State variables can be packed into fewer storage slots
Each slot saved can avoid an extra Gsset (20000 gas). Reads and writes (if two variables that occupy the same slot are written by the same function) will have a cheaper gas consumption.

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

/// @audit 11 slots -> 10 slots by new order:
/*
 *	  uint256 shareCount               (32 Bytes)
 *	  mapping shareIDs                 (32 Bytes)
 *	  mapping shareData                (32 Bytes)
 *	  mapping shareBondingCurves       (32 Bytes)
 *	  mapping whitelistedBondingCurves (32 Bytes)
 *	  mapping tokensByAddress          (32 Bytes)
 *	  mapping rewardsLastClaimedValue  (32 Bytes)
 *	  uint256 platformPool             (32 Bytes)
 *	  mapping whitelistedShareCreators (32 Bytes)
 *	  IERC20 token                     (20 Bytes)
 *	  bool shareCreationRestricted       (1 Byte)
 */
10: contract Market is ERC1155, Ownable2Step {

```


<a name="GAS-17"></a> 
### [GAS-17] Optimize External Calls with Assembly for Memory Efficiency
Using interfaces to make external contract calls in Solidity is convenient but can be inefficient in terms of memory utilization. Each such call involves creating a new memory location to store the data being passed, thus incurring memory expansion costs.

Inline assembly allows for optimized memory usage by re-using already allocated memory spaces or using the scratch space for smaller datasets. This can result in notable gas savings, especially for contracts that make frequent external calls.

Additionally, using inline assembly enables important safety checks like verifying if the target address has code deployed to it using `extcodesize(addr)` before making the call, mitigating risks associated with contract interactions.

*There are <b>4</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

/// @audit `.register(...)`
96:             turnstile.register(tx.origin);

/// @audit `.register(...)`
96:             turnstile.register(tx.origin);

```

```solidity
File: asD/src/asD.sol

/// @audit `.register(...)`
40:             turnstile.register(_csrRecipient);

/// @audit `.register(...)`
40:             turnstile.register(_csrRecipient);

```


<a name="GAS-18"></a> 
### [GAS-18] Use assembly to emit events
To efficiently emit events, it's possible to utilize assembly by making use of scratch space and the free memory pointer. This approach has the advantage of potentially avoiding the costs associated with memory expansion.

However, it's important to note that in order to safely optimize this process, it is preferable to cache and restore the free memory pointer.

A good example of such practice can be seen in [Solady's](https://github.com/Vectorized/solady/blob/main/src/tokens/ERC1155.sol#L167) codebase.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: 1155tech-contracts/src/Market.sol

107:         emit BondingCurveStateChange(_bondingCurve, _newState);

126:         emit ShareCreated(id, _shareName, _bondingCurve, msg.sender);

168:         emit SharesBought(_id, msg.sender, _amount, price, fee);

188:         emit SharesSold(_id, msg.sender, _amount, price, fee);

220:         emit NFTsCreated(_id, msg.sender, _amount, fee);

240:         emit NFTsBurned(_id, msg.sender, _amount, fee);

248:         emit PlatformFeeClaimed(msg.sender, amount);

258:         emit CreatorFeeClaimed(msg.sender, _id, amount);

269:         emit HolderFeeClaimed(msg.sender, _id, amount);

303:         emit ShareCreationRestricted(_isRestricted);

```

```solidity
File: asD/src/asD.sol

89:         emit CarryWithdrawal(_amount);

```

</details>


<a name="GAS-19"></a> 
### [GAS-19] Use assembly to validate `msg.sender`

*There are <b>2</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

151:         require(shareData[_id].creator != msg.sender, "Creator cannot buy");

254:         require(shareData[_id].creator == msg.sender, "Not creator");

```


<a name="GAS-20"></a> 
### [GAS-20] Use assembly to write address/contract type storage values
Using `assembly { sstore(state.slot, addr)` instead of `state = addr` can save gas.

*There are <b>2</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

92:         token = IERC20(_paymentToken);

```

```solidity
File: asD/src/asD.sol

36:         cNote = _cNote;

```


<a name="GAS-21"></a> 
### [GAS-21] Use a more recent version of solidity
- Use a solidity version of at least 0.8.2 to get simple compiler automatic inlining.
- Use a solidity version of at least 0.8.3 to get better struct packing and cheaper multiple storage reads.
- Use a solidity version of at least 0.8.4 to get custom errors, which are cheaper at deployment than revert()/require() strings.
- Use a solidity version of at least 0.8.10 to have external calls skip contract existence checks if the external call has a return value.

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

2: pragma solidity 0.8.19;

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

2: pragma solidity 0.8.19;

```

```solidity
File: asD/src/asD.sol

2: pragma solidity >=0.8.0;

```


<a name="GAS-22"></a> 
### [GAS-22] Use `uint256(1)`/`uint256(2)` instead of `true`/`false` to save gas for changes
Avoids a Gsset (20000 gas) when changing from false to true, after having been true in the past. Since most of the bools aren't changed twice in one transaction, I've counted the amount of gas as half of the full amount, for each variable.

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

49:     mapping(address => bool) public whitelistedBondingCurves;

61:     bool public shareCreationRestricted = true;

64:     mapping(address => bool) public whitelistedShareCreators;

```


<a name="GAS-23"></a> 
### [GAS-23] Using bitmap to store bool states can save gas
Using a bitmap instead of a bool array or a bool mapping to store boolean states can save gas fees. This is because the bitmap can store 256 boolean values in a single slot instead of 256 slots, which can save gas when writing bool values or when reading multiple bool values from the same slot.

*There are <b>2</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

49:     mapping(address => bool) public whitelistedBondingCurves;

64:     mapping(address => bool) public whitelistedShareCreators;

```


<a name="GAS-24"></a> 
### [GAS-24] Using bools for storage incurs overhead
Use uint256(1) and uint256(2) for true/false to avoid a Gwarmaccess (100 gas), and to avoid Gsset (20000 gas) when changing from false to true, after having been true in the past. See [source](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/58f635312aa21f947cae5f8578638a85aa2519f5/contracts/security/ReentrancyGuard.sol#L23-L27).

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

49:     mapping(address => bool) public whitelistedBondingCurves;

61:     bool public shareCreationRestricted = true;

64:     mapping(address => bool) public whitelistedShareCreators;

```


<a name="GAS-25"></a> 
### [GAS-25] State variables should be cached in stack variables rather than re-reading them from storage
The instances below point to the second+ access of a state variable within a function. Caching of a state variable replaces each Gwarmaccess (100 gas) with a much cheaper stack read. Other less obvious fixes/optimizations include having local memory caches of state variable structs, or having local caches of state variable contracts/addresses.

*There are <b>2</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

/// @audit more than 1 read for `platformPool`, line 246 and 245
246:         platformPool = 0;

/// @audit more than 1 read for `shareCreationRestricted`, line 302 and 301
302:         shareCreationRestricted = _isRestricted;

```


<a name="GAS-26"></a> 
### [GAS-26] Use `calldata` instead of `memory` for function arguments that do not get mutated
Mark data types as `calldata` instead of `memory` where possible. This makes it so that the data is not automatically loaded into memory. If the data passed into the function does not need to be changed (like updating values in an array), it can be passed in as `calldata`. The one exception to this is if the argument must later be passed into another function that takes an argument that specifies `memory` storage.

*There are <b>5</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

91:     constructor(string memory _uri, address _paymentToken) ERC1155(_uri) Ownable() {

115:         string memory _shareName,

117:         string memory _metadataURI

```

```solidity
File: asD/src/asD.sol

29:         string memory _name,

30:         string memory _symbol,

```


<a name="GAS-27"></a> 
### [GAS-27] Use Custom Errors
[Source](https://blog.soliditylang.org/2021/04/21/custom-errors/)
Instead of using error strings, to reduce deployment and runtime cost, you should use Custom Errors. This would save both deployment and runtime cost.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: 1155tech-contracts/src/Market.sol

105:         require(whitelistedBondingCurves[_bondingCurve] != _newState, "State already set");

119:         require(whitelistedBondingCurves[_bondingCurve], "Bonding curve not whitelisted");

120:         require(shareIDs[_shareName] == 0, "Share already exists");

151:         require(shareData[_id].creator != msg.sender, "Creator cannot buy");

254:         require(shareData[_id].creator == msg.sender, "Not creator");

301:         require(shareCreationRestricted != _isRestricted, "State already set");

310:         require(whitelistedShareCreators[_address] != _isWhitelisted, "State already set");

```

```solidity
File: asD/src/asD.sol

54:         require(returnCode == 0, "Error when minting");

64:         require(returnCode == 0, "Error when redeeming"); // 0 on success: https://docs.compound.finance/v2/ctokens/#redeem-underlying

81:             require(_amount <= maximumWithdrawable, "Too many tokens requested");

86:         require(returnCode == 0, "Error when redeeming"); // 0 on success: https://docs.compound.finance/v2/ctokens/#redeem

```

</details>


<a name="GAS-28"></a> 
### [GAS-28] Constructors can be marked as `payable` to save deployment gas
Payable functions cost less gas to execute, because the compiler does not have to add extra checks to ensure that no payment is provided. A constructor can be safely marked as payable, because only the deployer would be able to pass funds, and the project itself would not pass any funds.

*There are <b>2</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

91:     constructor(string memory _uri, address _paymentToken) ERC1155(_uri) Ownable() {

```

```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

10:     constructor(uint256 _priceIncrease) {

```


<a name="GAS-29"></a> 
### [GAS-29] Functions guaranteed to revert when called by normal users can be marked `payable`
If a function modifier such as `onlyOwner` is used, the function will revert if a normal user tries to pay the function. Marking the function as `payable` will lower the gas cost for legitimate callers because the compiler will not include checks for whether a payment was provided.

*There are <b>5</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

104:     function changeBondingCurveAllowed(address _bondingCurve, bool _newState) external onlyOwner {

244:     function claimPlatformFee() external onlyOwner {

300:     function restrictShareCreation(bool _isRestricted) external onlyOwner {

309:     function changeShareCreatorWhitelist(address _address, bool _isWhitelisted) external onlyOwner {

```

```solidity
File: asD/src/asD.sol

72:     function withdrawCarry(uint256 _amount) external onlyOwner {

```


<a name="GAS-30"></a> 
### [GAS-30] `++i` costs less gas than `i++`, especially when it's used in `for`-loops (`--i`/`i--` too)
*Saves 5 gas per loop*

*There is one instance of this issue:*
```solidity
File: 1155tech-contracts/src/bonding_curve/LinearBondingCurve.sol

20:         for (uint256 i = shareCount; i < shareCount + amount; i++) {

```


<a name="GAS-31"></a> 
### [GAS-31] Using `private` rather than `public` for constants, saves gas
If needed, the values can be read from the verified contract source code, or if there are multiple values there can be a single getter function that [returns a tuple](https://github.com/code-423n4/2022-08-frax/blob/90f55a9ce4e25bceed3a74290b854341d8de6afa/src/contracts/FraxlendPair.sol#L156-L178) of the values of all currently-public constants. Saves **3406-3606 gas** in deployment gas due to the compiler not having to create non-payable getter functions for deployment calldata, not having to store the bytes of the value outside of where it's used, and not adding another entry to the method ID table

*There are <b>3</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

14:     uint256 public constant NFT_FEE_BPS = 1_000; // 10%

15:     uint256 public constant HOLDER_CUT_BPS = 3_300; // 33%

16:     uint256 public constant CREATOR_CUT_BPS = 3_300; // 33%

```


<a name="GAS-32"></a> 
### [GAS-32] Use `!= 0` instead of `> 0` for unsigned integer comparison
Using `== 0`, `!= 0` instead of `> 0`, `>= 1`, `< 1`, `<= 0` can save gas.

*There are <b>5</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

165:         if (rewardsSinceLastClaim > 0) {

216:         if (rewardsSinceLastClaim > 0) {

266:         if (amount > 0) {

289:         if (_tokenCount > 0) {

```

```solidity
File: asD/src/asD.sol

2: pragma solidity >=0.8.0;

```


<a name="GAS-33"></a> 
### [GAS-33] Using assembly to check for zero can save gas
Using assembly to check for zero can save gas by allowing more direct access to the evm and reducing some of the overhead associated with high-level operations in solidity.

*There are <b>5</b> instances of this issue:*
```solidity
File: 1155tech-contracts/src/Market.sol

120:         require(shareIDs[_shareName] == 0, "Share already exists");

```

```solidity
File: asD/src/asD.sol

54:         require(returnCode == 0, "Error when minting");

64:         require(returnCode == 0, "Error when redeeming"); // 0 on success: https://docs.compound.finance/v2/ctokens/#redeem-underlying

78:         if (_amount == 0) {

86:         require(returnCode == 0, "Error when redeeming"); // 0 on success: https://docs.compound.finance/v2/ctokens/#redeem

```


