# Report

Audit report for **2024-03-revert-lend** generated by *ubl4nk_bot*.

## Medium Issues


*Total <b>6</b> instances over <b>2</b> issues:*

|ID|Issue|Instances|
|-|:-|:-:|
| [M-1](#M-1) | Usage of `slot0` is extremely easy to manipulate | 5 |
| [M-2](#M-2) | latestRoundData() has no check for round completeness | 1 |

## Low Issues


*Total <b>368</b> instances over <b>33</b> issues:*

|ID|Issue|Instances|
|-|:-|:-:|
| [L-1](#L-1) | Missing zero address check in functions with address parameters | 48 |
| [L-2](#L-2) | Use increase/decrease allowance instead of `approve()`/`safeApprove()` | 15 |
| [L-3](#L-3) | Array is `push()`ed but not `pop()`ed | 1 |
| [L-4](#L-4) | Division by zero not prevented | 17 |
| [L-5](#L-5) | Consider implementing two-step procedure for updating protocol addresses | 3 |
| [L-6](#L-6) | Constructor / initialization function lacks parameter validation | 11 |
| [L-7](#L-7) | Code does not follow the best practice of check-effects-interaction | 25 |
| [L-8](#L-8) | External function calls within loops | 1 |
| [L-9](#L-9) | Functions calling contracts/addresses with transfer hooks are missing reentrancy guards | 17 |
| [L-10](#L-10) | Governance functions should be controlled by time locks | 6 |
| [L-11](#L-11) | Loss of precision in divisions | 5 |
| [L-12](#L-12) | Missing checks for state variable assignments | 35 |
| [L-13](#L-13) | Missing limits when setting min/max amounts | 6 |
| [L-14](#L-14) | Missing zero address check in constructor | 10 |
| [L-15](#L-15) | Consider some checks for `address(0)` when setting address state variables | 14 |
| [L-16](#L-16) | Multiplication on the result of a division | 2 |
| [L-17](#L-17) | Owner can renounce ownership | 4 |
| [L-18](#L-18) | `receive()`/`fallback()` function does not authorize requests | 2 |
| [L-19](#L-19) | Solidity version 0.8.20 or above may not work on other chains due to PUSH0 | 11 |
| [L-20](#L-20) | Some tokens may revert when large transfers are made | 23 |
| [L-21](#L-21) | Some tokens may revert when zero value transfers are made | 23 |
| [L-22](#L-22) | Sending tokens in a for loop | 2 |
| [L-23](#L-23) | Tokens may be minted to `address(0)` | 2 |
| [L-24](#L-24) | Unsafe downcast | 14 |
| [L-25](#L-25) | Use Ownable2Step instead of Ownable | 4 |
| [L-26](#L-26) | Using zero as a parameter | 29 |
| [L-27](#L-27) | Vulnerable version of OZ contarcts is used (`4.8.1`) | 1 |
| [L-28](#L-28) | Centralization Risk for trusted owners | 15 |
| [L-29](#L-29) | `decimals()` is not a part of the ERC-20 standard | 3 |
| [L-30](#L-30) | `safeApprove()` is deprecated | 15 |
| [L-31](#L-31) | Chainlink answer is not compared against min/max values | 1 |
| [L-32](#L-32) | No limits when setting price values | 1 |
| [L-33](#L-33) | The call `abi.encodeWithSelector` is not type safe | 2 |

## Non Critical Issues


*Total <b>1743</b> instances over <b>95</b> issues:*

|ID|Issue|Instances|
|-|:-|:-:|
| [NC-1](#NC-1) | Add inline comments for unnamed variables | 4 |
| [NC-2](#NC-2) | Avoid mutating function parameters | 2 |
| [NC-3](#NC-3) | Avoid the use of sensitive terms | 1 |
| [NC-4](#NC-4) | Multiple `address`/ID mappings can be combined into a single `mapping` of an `address`/ID to a `struct`, for readability | 2 |
| [NC-5](#NC-5) | Complex casting | 2 |
| [NC-6](#NC-6) | Consider adding a block/deny-list | 11 |
| [NC-7](#NC-7) | Consider adding emergency-stop functionality | 9 |
| [NC-8](#NC-8) | Consider adding formal verification proofs | 1 |
| [NC-9](#NC-9) | Consider using descriptive `constant`s when passing zero as a function argument | 17 |
| [NC-10](#NC-10) | Consider using SafeTransferLib.safeTransferETH() or Address.sendValue() for clearer semantic meaning | 3 |
| [NC-11](#NC-11) | Constant redefined elsewhere | 1 |
| [NC-12](#NC-12) | Constants should be put on the left side of comparisons | 27 |
| [NC-13](#NC-13) | `Constructor` should emit an event | 11 |
| [NC-14](#NC-14) | Contract does not follow the Solidity Style Guide's suggested layout ordering | 78 |
| [NC-15](#NC-15) | Contract should expose an `interface` | 77 |
| [NC-16](#NC-16) | Contracts should have full test coverage | 1 |
| [NC-17](#NC-17) | Convert simple `if` statements to ternary expressions | 2 |
| [NC-18](#NC-18) | Events that mark critical parameter changes should contain both the old and the new value | 42 |
| [NC-19](#NC-19) | Custom errors should be used rather than `revert()`/`require()` | 2 |
| [NC-20](#NC-20) | Polymorphic functions make security audits more time-consuming and error-prone | 3 |
| [NC-21](#NC-21) | Duplicated `require()`/`revert()` checks should be refactored | 24 |
| [NC-22](#NC-22) | `else` block not required | 4 |
| [NC-23](#NC-23) | Empty bytes check is missing | 11 |
| [NC-24](#NC-24) | Enable IR-based code generation | 1 |
| [NC-25](#NC-25) | Enum values should be used instead of constant array indexes | 9 |
| [NC-26](#NC-26) | Events are emitted without the sender information | 28 |
| [NC-27](#NC-27) | Events may be emitted out of order due to reentrancy | 24 |
| [NC-28](#NC-28) | Execution at deadlines should be allowed | 2 |
| [NC-29](#NC-29) | External call recipient can consume all remaining gas | 6 |
| [NC-30](#NC-30) |  Function ordering does not follow the Solidity Style Guide | 43 |
| [NC-31](#NC-31) | High cyclomatic complexity | 9 |
| [NC-32](#NC-32) | Variable names for `immutable`s should use CONSTANT_CASE | 18 |
| [NC-33](#NC-33) | Import declarations should import specific identifiers, rather than the whole file | 70 |
| [NC-34](#NC-34) | Imports could be organized more systematically | 27 |
| [NC-35](#NC-35) | Inconsistent spacing in comments | 7 |
| [NC-36](#NC-36) | Incorrect withdraw declaration | 6 |
| [NC-37](#NC-37) | Invalid NatSpec comment style | 1 |
| [NC-38](#NC-38) | It is best practice to use linear inheritance | 8 |
| [NC-39](#NC-39) | Lack of brace spacing | 4 |
| [NC-40](#NC-40) | Large or complicated code bases should implement invariant tests | 1 |
| [NC-41](#NC-41) | Large numeric literals should use underscores for readability | 5 |
| [NC-42](#NC-42) | Long functions should be refactored into multiple, smaller, functions | 12 |
| [NC-43](#NC-43) | Magic numbers should be replaced with constants | 13 |
| [NC-44](#NC-44) | Missing contract existence checks before low-level calls | 6 |
| [NC-45](#NC-45) | Missing disallow list for `ERC721` | 2 |
| [NC-46](#NC-46) | Named mappings are recommended | 13 |
| [NC-47](#NC-47) | Named imports of parent contracts are missing | 11 |
| [NC-48](#NC-48) | Missing NatSpec from contract/error/event/function/modifier declarations | 114 |
| [NC-49](#NC-49) | Missing NatSpec `@author` from contract declaration | 11 |
| [NC-50](#NC-50) | Missing NatSpec `@dev` from contract/event/function/modifier declarations | 192 |
| [NC-51](#NC-51) | Public variable declarations should have NatSpec descriptions | 42 |
| [NC-52](#NC-52) | Missing NatSpec `@notice` from contract/event/function/modifier declarations | 132 |
| [NC-53](#NC-53) | Missing NatSpec `@param` from event/function/modifier declarations | 132 |
| [NC-54](#NC-54) | Missing NatSpec `@return` from function declaration | 63 |
| [NC-55](#NC-55) | Missing NatSpec `@title` from contract declaration | 2 |
| [NC-56](#NC-56) | There is no need to initialize variables with 0 | 13 |
| [NC-57](#NC-57) | Put all system-wide constants in one file | 20 |
| [NC-58](#NC-58) | Redundant `return` statement in a function with named return variables | 5 |
| [NC-59](#NC-59) | The remaining ETH may be locked in the contract after call | 3 |
| [NC-60](#NC-60) | Setters should prevent re-setting the same value | 12 |
| [NC-61](#NC-61) | State variables should include comments | 13 |
| [NC-62](#NC-62) | Lines are too long | 20 |
| [NC-63](#NC-63) | Typos | 6 |
| [NC-64](#NC-64) | Unnecessary cast | 16 |
| [NC-65](#NC-65) | Unsafe conversion from unsigned to signed values | 5 |
| [NC-66](#NC-66) | Unsafe solidity low-level call can cause gas grief attack | 6 |
| [NC-67](#NC-67) | Unused named return | 5 |
| [NC-68](#NC-68) | Unused contract variables | 2 |
| [NC-69](#NC-69) | Use `abi.encodeCall()` instead of `abi.encodeWithSignature()`/`abi.encodeWithSelector()` | 2 |
| [NC-70](#NC-70) | Consider using `delete` rather than assigning zero/false to clear values | 2 |
| [NC-71](#NC-71) | Solidity compiler version is not fixed | 11 |
| [NC-72](#NC-72) | Expressions for constant values should use `immutable` rather than `constant` | 20 |
| [NC-73](#NC-73) | Use `@inheritdoc` for overridden functions | 29 |
| [NC-74](#NC-74) | Upgrade `openzeppelin` to the latest version (`5.0.1`) | 1 |
| [NC-75](#NC-75) | Use the latest solidity version for deployment (`0.8.24`) | 11 |
| [NC-76](#NC-76) | Use the Modern Upgradeable Contract Paradigm | 11 |
| [NC-77](#NC-77) | Consider using modifiers for address control | 20 |
| [NC-78](#NC-78) | Use of `override` is unnecessary | 30 |
| [NC-79](#NC-79) | Returning a struct instead of a bunch of variables is better | 10 |
| [NC-80](#NC-80) | Use a struct to encapsulate multiple function parameters | 4 |
| [NC-81](#NC-81) | Use `type(X).max` instead of constant formulas like `2**n` | 3 |
| [NC-82](#NC-82) | Common functions should be refactored to a common base contract | 4 |
| [NC-83](#NC-83) | Empty body - Consider commenting why | 5 |
| [NC-84](#NC-84) | Names of `private`/`internal` state variables should be prefixed with an underscore | 12 |
| [NC-85](#NC-85) | Internal function calls within for loops | 2 |
| [NC-86](#NC-86) |  `require()` / `revert()` statements should have descriptive reason strings | 1 |
| [NC-87](#NC-87) | Variables should be named in mixedCase style | 2 |
| [NC-88](#NC-88) | Event is missing `indexed` fields | 38 |
| [NC-89](#NC-89) | Functions not used internally could be marked `external` | 8 |
| [NC-90](#NC-90) | Avoid commenting out unused code in production | 1 |
| [NC-91](#NC-91) | Default address(0) can be returned | 3 |
| [NC-92](#NC-92) | Don't assume specific token balance | 3 |
| [NC-93](#NC-93) | Don't only depend on Solidity's arithmetic ordering | 30 |
| [NC-94](#NC-94) | Incorrect comparison against a max value | 2 |
| [NC-95](#NC-95) | Payable functions which do not interact with the native token should not be payable | 3 |

## Gas Optimizations


*Total <b>1183</b> instances over <b>64</b> issues:*

|ID|Issue|Instances|Gas|
|-|:-|:-:|:-:|
| [GAS-1](#GAS-1) | Assigning to structs can be more efficient | 14 | 84 |
| [GAS-2](#GAS-2) | Optimize gas by using do-while loops | 2 | 510 |
| [GAS-3](#GAS-3) | Multiple `address`/ID mappings can be combined into a single `mapping` of an `address`/ID to a `struct`, where appropriate | 2 | - |
| [GAS-4](#GAS-4) | Consider activating via-ir for deploying | 1 | - |
| [GAS-5](#GAS-5) | Divisions can be `unchecked` to save gas | 70 | 1400 |
| [GAS-6](#GAS-6) | Do not calculate constants | 16 | - |
| [GAS-7](#GAS-7) | Operator `+=` costs more gas than `<x> = <x> + <y>` for state variables | 7 | 791 |
| [GAS-8](#GAS-8) | Duplicated `require()`/`revert()` checks should be refactored to a modifier or function to save gas | 24 | - |
| [GAS-9](#GAS-9) | Increments can be `unchecked` to save gas | 2 | 120 |
| [GAS-10](#GAS-10) | `internal` functions only called once can be inlined to save gas | 17 | 510 |
| [GAS-11](#GAS-11) | Low level `call` can be optimized with assembly | 6 | 1488 |
| [GAS-12](#GAS-12) | Multiple accesses of the same mapping/array key/index should be cached | 15 | 630 |
| [GAS-13](#GAS-13) | Operator `>=`/`<=` costs less gas than operator `>`/`<` | 124 | 372 |
| [GAS-14](#GAS-14) | Optimize Gas by splitting `if() revert` statements | 9 | - |
| [GAS-15](#GAS-15) | Optimize names to save gas | 9 | 198 |
| [GAS-16](#GAS-16) | Reduce gas usage by moving to Solidity 0.8.19 or later | 11 | 11000 |
| [GAS-17](#GAS-17) | Redundant state variable getters | 1 | - |
| [GAS-18](#GAS-18) | Remove or replace unused state variables | 2 | - |
| [GAS-19](#GAS-19) | The result of a function call should be cached rather than re-calling the function | 19 | 1900 |
| [GAS-20](#GAS-20) | State variables can be packed into fewer storage slots by new order | 1 | 20000 |
| [GAS-21](#GAS-21) | Use smaller sizes for struct variables if possible | 21 | 52500 |
| [GAS-22](#GAS-22) | Unlimited gas consumption risk due to external call recipients | 6 | - |
| [GAS-23](#GAS-23) | Unused named return variables without optimizer waste gas | 5 | 45 |
| [GAS-24](#GAS-24) | Optimize external calls with assembly for memory efficiency | 67 | 14740 |
| [GAS-25](#GAS-25) | Use assembly in place of `abi.decode` to extract `calldata` values more efficiently | 5 | - |
| [GAS-26](#GAS-26) | Use assembly to emit events | 49 | 1862 |
| [GAS-27](#GAS-27) | Use assembly to validate `msg.sender` | 20 | - |
| [GAS-28](#GAS-28) | Use assembly to write address/contract type storage values | 19 | 950 |
| [GAS-29](#GAS-29) | Using a double `if` statement instead of a logical AND (`&&`) | 38 | 1140 |
| [GAS-30](#GAS-30) | Consider using OZ EnumerateSet in place of nested mappings | 2 | 2000 |
| [GAS-31](#GAS-31) | Use a more recent version of solidity | 11 | - |
| [GAS-32](#GAS-32) | Use != 0 instead of > 0 | 51 | 153 |
| [GAS-33](#GAS-33) | Use += for mappings | 1 | - |
| [GAS-34](#GAS-34) | Use `selfbalance()` instead of `address(this).balance` | 1 | - |
| [GAS-35](#GAS-35) | State variables can be packed into fewer storage slots by truncating timestamp bytes | 8 | 20000 |
| [GAS-36](#GAS-36) | Consider Using Solady's Gas Optimized Lib for Math | 51 | - |
| [GAS-37](#GAS-37) | Use solady library where possible to save gas | 9 | 9000 |
| [GAS-38](#GAS-38) | Use `storage` instead of `memory` for structs/arrays | 4 | 16800 |
| [GAS-39](#GAS-39) | Use `uint256(1)`/`uint256(2)` instead of `true`/`false` to save gas for changes | 4 | 34200 |
| [GAS-40](#GAS-40) | Use `unchecked` block for safe subtractions | 25 | 2125 |
| [GAS-41](#GAS-41) | Using bitmap to store bool states can save gas | 4 | - |
| [GAS-42](#GAS-42) | Using `constant`s directly, rather than caching the value, saves gas | 7 | - |
| [GAS-43](#GAS-43) | Using `this` to access functions results in an external call, wasting gas | 1 | 100 |
| [GAS-44](#GAS-44) | `abi.encodePacked` is more gas efficient than `abi.encode` | 4 | - |
| [GAS-45](#GAS-45) | `array[index] += amount` is cheaper than `array[index] = array[index] + amount` (or related variants) | 2 | - |
| [GAS-46](#GAS-46) | Using bools for storage incurs overhead | 4 | 400 |
| [GAS-47](#GAS-47) | State variables should be cached in stack variables rather than re-reading them from storage | 8 | 776 |
| [GAS-48](#GAS-48) | Use `calldata` instead of `memory` for function arguments that do not get mutated | 4 | - |
| [GAS-49](#GAS-49) | Use Custom Errors | 2 | 100 |
| [GAS-50](#GAS-50) | Don't use `SafeMath` once the solidity version is 0.8.0 or greater | 1 | - |
| [GAS-51](#GAS-51) | Don't initialize variables with default value | 13 | - |
| [GAS-52](#GAS-52) | Usage of `int`s/`uint`s smaller than 32 bytes incurs overhead | 183 | 10065 |
| [GAS-53](#GAS-53) | Functions guaranteed to revert when called by normal users can be marked `payable` | 12 | 252 |
| [GAS-54](#GAS-54) | Using `private` rather than `public` for constants, saves gas | 13 | - |
| [GAS-55](#GAS-55) | Use assembly to check for `address(0)` | 6 | 36 |
| [GAS-56](#GAS-56) | Avoid updating storage when the value hasn't changed | 70 | - |
| [GAS-57](#GAS-57) | Cache address(this) when used more than once | 14 | - |
| [GAS-58](#GAS-58) | Unnecessary casting as variable is already of the same type | 16 | - |
| [GAS-59](#GAS-59) | Where a value is casted more than once, consider caching the result to save gas | 42 | - |
| [GAS-60](#GAS-60) | Constants are cheaper than Enums | 2 | - |
| [GAS-61](#GAS-61) | It is a waste of GAS to emit variable literals | 3 | - |
| [GAS-62](#GAS-62) | Merge events to save gas | 7 | - |
| [GAS-63](#GAS-63) | Only emit event in setter function if the state variable was changed | 14 | - |
| [GAS-64](#GAS-64) | Variable declared within iteration | 2 | - |

## Medium Issues

<a name="M-1"></a> 
### [M-1] Usage of `slot0` is extremely easy to manipulate

*There are <b>5</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

363:             (sqrtPriceX96,,,,,,) = pool.slot0();

422:         (state.sqrtPriceX96, state.tick,,,,,) = state.pool.slot0();

```
*Github:* [[363](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L363), [422](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L422)]


```solidity
File: src/automators/AutoExit.sol

132:         (, state.tick,,,,,) = state.pool.slot0();

```
*Github:* [[132](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L132)]


```solidity
File: src/automators/Automator.sol

148:         (sqrtPriceX96, currentTick,,,,,) = pool.slot0();

```
*Github:* [[148](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L148)]


```solidity
File: src/transformers/AutoCompound.sol

129:                 (state.sqrtPriceX96, state.tick,,,,,) = pool.slot0();

```
*Github:* [[129](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L129)]



<a name="M-2"></a> 
### [M-2] latestRoundData() has no check for round completeness
No check for round completeness could lead to stale prices and wrong price return value, or outdated price. The functions rely on accurate price feed might not work as expected, sometimes can lead to fund loss.

*There is one instance of this issue:*
```solidity
File: src/V3Oracle.sol

337:         (, int256 answer,, uint256 updatedAt,) = feedConfig.feed.latestRoundData();

```
*Github:* [[337](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L337)]




## Low Issues

<a name="L-1"></a> 
### [L-1] Missing zero address check in functions with address parameters
Adding a zero address check for each address type parameter can prevent errors.

<details>
<summary>
There are <b>48</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit missing zero check for `token`
95:     function getValue(uint256 tokenId, address token)
            external
            view
            override
            returns (uint256 value, uint256 feeValue, uint256 price0X96, uint256 price1X96)
        {

/// @audit missing zero check for `token0`
/// @audit missing zero check for `token1`
133:     function _checkPoolPrice(address token0, address token1, uint24 fee, uint256 derivedPoolPriceX96) internal view {

/// @audit missing zero check for `feed`
/// @audit missing zero check for `pool`
201:     function setTokenConfig(
             address token,
             AggregatorV3Interface feed,
             uint32 maxFeedAge,
             IUniswapV3Pool pool,
             uint32 twapSeconds,
             Mode mode,
             uint16 maxDifference
         ) external onlyOwner {

/// @audit missing zero check for `token`
249:     function setOracleMode(address token, Mode mode) external {

/// @audit missing zero check for `token`
329:     function _getChainlinkPriceX96(address token) internal view returns (uint256) {

/// @audit missing zero check for `pool`
359:     function _getReferencePoolPriceX96(IUniswapV3Pool pool, uint32 twapSeconds) internal view returns (uint256) {

/// @audit missing zero check for `pool`
472:     function _getFeeGrowthInside(
             IUniswapV3Pool pool,
             int24 tickLower,
             int24 tickUpper,
             int24 tickCurrent,
             uint256 feeGrowthGlobal0X128,
             uint256 feeGrowthGlobal1X128
         ) internal view returns (uint256 feeGrowthInside0X128, uint256 feeGrowthInside1X128) {

/// @audit missing zero check for `tokenA`
/// @audit missing zero check for `tokenB`
499:     function _getPool(address tokenA, address tokenB, uint24 fee) internal view returns (IUniswapV3Pool) {

```
*Github:* [[95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L95), [133](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L133), [201](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L201), [249](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L249), [329](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L329), [359](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L359), [472](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L472), [499](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L499)]


```solidity
File: src/V3Vault.sol

/// @audit missing zero check for `owner`
264:     function loanCount(address owner) external view override returns (uint256) {

/// @audit missing zero check for `owner`
271:     function loanAtIndex(address owner, uint256 index) external view override returns (uint256) {

/// @audit missing zero check for `receiver`
360:     function deposit(uint256 assets, address receiver) external override returns (uint256) {

/// @audit missing zero check for `receiver`
366:     function mint(uint256 shares, address receiver) external override returns (uint256) {

/// @audit missing zero check for `receiver`
/// @audit missing zero check for `owner`
372:     function withdraw(uint256 assets, address receiver, address owner) external override returns (uint256) {

/// @audit missing zero check for `receiver`
/// @audit missing zero check for `owner`
378:     function redeem(uint256 shares, address receiver, address owner) external override returns (uint256) {

/// @audit missing zero check for `receiver`
384:     function deposit(uint256 assets, address receiver, bytes calldata permitData) external override returns (uint256) {

/// @audit missing zero check for `receiver`
390:     function mint(uint256 shares, address receiver, bytes calldata permitData) external override returns (uint256) {

/// @audit missing zero check for `owner`
410:     function createWithPermit(
             uint256 tokenId,
             address owner,
             address recipient,
             uint256 deadline,
             uint8 v,
             bytes32 r,
             bytes32 s
         ) external override {

/// @audit missing zero check for `target`
483:     function approveTransform(uint256 tokenId, address target, bool isActive) external override {

/// @audit missing zero check for `transformer`
497:     function transform(uint256 tokenId, address transformer, bytes calldata data)
             external
             override
             returns (uint256 newTokenId)
         {

/// @audit missing zero check for `receiver`
765:     function withdrawReserves(uint256 amount, address receiver) external onlyOwner {

/// @audit missing zero check for `token`
856:     function setTokenConfig(address token, uint32 collateralFactorX32, uint32 collateralValueLimitFactorX32)
             external
             onlyOwner
         {

/// @audit missing zero check for `receiver`
877:     function _deposit(address receiver, uint256 amount, bool isShare, bytes memory permitData)
             internal
             returns (uint256 assets, uint256 shares)
         {

/// @audit missing zero check for `receiver`
/// @audit missing zero check for `owner`
920:     function _withdraw(address receiver, address owner, uint256 amount, bool isShare)
             internal
             returns (uint256 assets, uint256 shares)
         {

/// @audit missing zero check for `recipient`
1032:     function _sendPositionValue(
              uint256 tokenId,
              uint256 liquidationValue,
              uint256 fullValue,
              uint256 feeValue,
              address recipient
          ) internal returns (uint256 amount0, uint256 amount1) {

/// @audit missing zero check for `owner`
1077:     function _cleanupLoan(uint256 tokenId, uint256 debtExchangeRateX96, uint256 lendExchangeRateX96, address owner)
              internal
          {

/// @audit missing zero check for `to`
1297:     function _addTokenToOwner(address to, uint256 tokenId) internal {

/// @audit missing zero check for `from`
1303:     function _removeTokenFromOwner(address from, uint256 tokenId) internal {

```
*Github:* [[264](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L264), [271](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L271), [360](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L360), [366](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L366), [372](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L372), [378](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L378), [384](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L384), [390](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L390), [410](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L410), [483](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L483), [497](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L497), [765](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L765), [856](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L856), [877](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L877), [920](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L920), [1032](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1032), [1077](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1077), [1297](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1297), [1303](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1303)]


```solidity
File: src/automators/Automator.sol

/// @audit missing zero check for `_operator`
69:     function setOperator(address _operator, bool _active) public onlyOwner {

/// @audit missing zero check for `_vault`
79:     function setVault(address _vault, bool _active) public onlyOwner {

/// @audit missing zero check for `to`
104:     function withdrawBalances(address[] calldata tokens, address to) external virtual {

/// @audit missing zero check for `to`
123:     function withdrawETH(address to) external {

/// @audit missing zero check for `pool`
139:     function _validateSwap(
             bool swap0For1,
             uint256 amountIn,
             IUniswapV3Pool pool,
             uint32 twapPeriod,
             uint16 maxTickDifference,
             uint64 maxPriceDifferenceX64
         ) internal view returns (uint256 amountOutMin, int24 currentTick, uint160 sqrtPriceX96, uint256 priceX96) {

/// @audit missing zero check for `pool`
166:     function _hasMaxTWAPTickDifference(IUniswapV3Pool pool, uint32 twapPeriod, int24 currentTick, uint16 maxDifference)
             internal
             view
             returns (bool)
         {

/// @audit missing zero check for `pool`
180:     function _getTWAPTick(IUniswapV3Pool pool, uint32 twapPeriod) internal view returns (int24, bool) {

/// @audit missing zero check for `to`
218:     function _transferToken(address to, IERC20 token, uint256 amount, bool unwrap) internal {

```
*Github:* [[69](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L69), [79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L79), [104](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L104), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L123), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L139), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L166), [180](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L180), [218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L218)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit missing zero check for `to`
200:     function withdrawLeftoverBalances(uint256 tokenId, address to) external nonReentrant {

/// @audit missing zero check for `to`
227:     function withdrawBalances(address[] calldata tokens, address to) external override nonReentrant {

/// @audit missing zero check for `token`
249:     function _increaseBalance(uint256 tokenId, address token, uint256 amount) internal {

/// @audit missing zero check for `token`
254:     function _setBalance(uint256 tokenId, address token, uint256 amount) internal {

/// @audit missing zero check for `to`
266:     function _withdrawBalanceInternal(uint256 tokenId, address token, address to, uint256 balance, uint256 amount)
             internal
         {

```
*Github:* [[200](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L200), [227](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L227), [249](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L249), [254](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L254), [266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L266)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit missing zero check for `vault`
276:     function configToken(uint256 tokenId, address vault, PositionConfig calldata config) external {

```
*Github:* [[276](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L276)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit missing zero check for `token0`
/// @audit missing zero check for `token1`
/// @audit missing zero check for `otherToken`
566:     function _prepareAddApproved(
             IERC20 token0,
             IERC20 token1,
             IERC20 otherToken,
             uint256 amount0,
             uint256 amount1,
             uint256 amountOther
         ) internal {

/// @audit missing zero check for `token0`
/// @audit missing zero check for `token1`
/// @audit missing zero check for `otherToken`
598:     function _prepareAddPermit2(
             IERC20 token0,
             IERC20 token1,
             IERC20 otherToken,
             uint256 amount0,
             uint256 amount1,
             uint256 amountOther,
             IPermit2.PermitBatchTransferFrom memory permit,
             bytes memory signature
         ) internal {

/// @audit missing zero check for `token0`
/// @audit missing zero check for `token1`
735:     function _swapAndIncrease(SwapAndIncreaseLiquidityParams memory params, IERC20 token0, IERC20 token1, bool unwrap)
             internal
             returns (uint128 liquidity, uint256 added0, uint256 added1)
         {

/// @audit missing zero check for `to`
/// @audit missing zero check for `token0`
/// @audit missing zero check for `token1`
841:     function _returnLeftoverTokens(
             address to,
             IERC20 token0,
             IERC20 token1,
             uint256 total0,
             uint256 total1,
             uint256 added0,
             uint256 added1,
             bool unwrap
         ) internal {

/// @audit missing zero check for `to`
864:     function _transferToken(address to, IERC20 token, uint256 amount, bool unwrap) internal {

/// @audit missing zero check for `token0`
/// @audit missing zero check for `token1`
892:     function _collectFees(uint256 tokenId, IERC20 token0, IERC20 token1, uint128 collectAmount0, uint128 collectAmount1)
             internal
             returns (uint256 amount0, uint256 amount1)
         {

```
*Github:* [[566](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L566), [598](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L598), [735](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L735), [841](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L841), [864](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L864), [892](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L892)]


```solidity
File: src/utils/Swapper.sol

/// @audit missing zero check for `tokenA`
/// @audit missing zero check for `tokenB`
171:     function _getPool(address tokenA, address tokenB, uint24 fee) internal view returns (IUniswapV3Pool) {

```
*Github:* [[171](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L171)]


</details>


<a name="L-2"></a> 
### [L-2] Use increase/decrease allowance instead of `approve()`/`safeApprove()`
Changing an allowance with approve() brings the risk that someone may use both the old and the new allowance by unfortunate transaction ordering. Refer to [ERC20 API: An Attack Vector on the Approve/TransferFrom Methods](https://docs.google.com/document/d/1YLPtQxZu1UAvO9cZ1O2RPXBbT0mooh4DYKjA_jp-RLM). It is recommended to use the `increaseAllowance()`/`decreaseAllowance()` to avoid this problem.

<details>
<summary>
There are <b>15</b> instances (click to show):
</summary>

```solidity
File: src/transformers/AutoCompound.sol

280:             SafeERC20.safeApprove(IERC20(token0), address(nonfungiblePositionManager), type(uint256).max);

284:             SafeERC20.safeApprove(IERC20(token1), address(nonfungiblePositionManager), type(uint256).max);

```
*Github:* [[280](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L280), [284](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L284)]


```solidity
File: src/transformers/AutoRange.sol

213:             SafeERC20.safeApprove(IERC20(state.token0), address(nonfungiblePositionManager), state.maxAddAmount0);

214:             SafeERC20.safeApprove(IERC20(state.token1), address(nonfungiblePositionManager), state.maxAddAmount1);

220:             SafeERC20.safeApprove(IERC20(state.token0), address(nonfungiblePositionManager), 0);

221:             SafeERC20.safeApprove(IERC20(state.token1), address(nonfungiblePositionManager), 0);

```
*Github:* [[213](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L213), [214](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L214), [220](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L220), [221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L221)]


```solidity
File: src/transformers/LeverageTransformer.sol

165:         SafeERC20.safeApprove(IERC20(token), msg.sender, amount);

```
*Github:* [[165](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L165)]


```solidity
File: src/transformers/V3Utils.sol

831:             SafeERC20.safeApprove(params.token0, address(nonfungiblePositionManager), 0);

832:             SafeERC20.safeApprove(params.token0, address(nonfungiblePositionManager), total0);

835:             SafeERC20.safeApprove(params.token1, address(nonfungiblePositionManager), 0);

836:             SafeERC20.safeApprove(params.token1, address(nonfungiblePositionManager), total1);

```
*Github:* [[831](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L831), [832](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L832), [835](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L835), [836](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L836)]


```solidity
File: src/utils/FlashloanLiquidator.sol

72:         SafeERC20.safeApprove(data.asset, address(data.vault), data.liquidationCost);

78:         SafeERC20.safeApprove(data.asset, address(data.vault), 0);

```
*Github:* [[72](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L72), [78](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L78)]


```solidity
File: src/utils/Swapper.sol

87:                 SafeERC20.safeApprove(params.tokenIn, data.allowanceTarget, params.amountIn);

94:                 SafeERC20.safeApprove(params.tokenIn, data.allowanceTarget, 0);

```
*Github:* [[87](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L87), [94](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L94)]


</details>


<a name="L-3"></a> 
### [L-3] Array is `push()`ed but not `pop()`ed
There is no limit specified on the amount of gas used, so the recipient can use up all of the remaining gas (`gasleft()`), causing it to revert. Therefore, when calling an external contract, it is necessary to specify a limited amount of gas to forward.

*There is one instance of this issue:*
```solidity
File: src/V3Vault.sol

1299:         ownedTokens[to].push(tokenId);

```
*Github:* [[1299](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1299)]



<a name="L-4"></a> 
### [L-4] Division by zero not prevented
The divisions below take an input parameter that has no zero-value checks, which can cause the functions reverting if zero is passed.

<details>
<summary>
There are <b>17</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit `priceX96`
144:             ? (priceX96 - verifyPriceX96) * 10000 / priceX96

/// @audit `verifyPriceX96`
145:             : (verifyPriceX96 - priceX96) * 10000 / verifyPriceX96;

```
*Github:* [[144](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L144), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L145)]


```solidity
File: src/V3Vault.sol

/// @audit `feeValue`
1054:                 fees0 = uint128(liquidationValue * fees0 / feeValue);

/// @audit `feeValue`
1055:                 fees1 = uint128(liquidationValue * fees1 / feeValue);

/// @audit `collateralValue`
1105:             uint256 startLiquidationValue = debt * fullValue / collateralValue;

```
*Github:* [[1054](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1054), [1055](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1055), [1105](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1105)]


```solidity
File: src/automators/AutoExit.sol

/// @audit `Q64`
155:                 state.amount0 -= state.feeAmount0 * params.rewardX64 / Q64;

/// @audit `Q64`
156:                 state.amount1 -= state.feeAmount1 * params.rewardX64 / Q64;

/// @audit `Q64`
187:                     state.amount0 -= state.amount0 * params.rewardX64 / Q64;

/// @audit `Q64`
189:                     state.amount1 -= state.amount1 * params.rewardX64 / Q64;

/// @audit `Q64`
194:             state.amount0 -= (config.onlyFees ? state.feeAmount0 : state.amount0) * params.rewardX64 / Q64;

/// @audit `Q64`
195:             state.amount1 -= (config.onlyFees ? state.feeAmount1 : state.amount1) * params.rewardX64 / Q64;

```
*Github:* [[155](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L155), [156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L156), [187](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L187), [189](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L189), [194](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L194), [195](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L195)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit `Q64`
170:                 state.amount0Fees = state.compounded0 * rewardX64 / Q64;

/// @audit `Q64`
171:                 state.amount1Fees = state.compounded1 * rewardX64 / Q64;

```
*Github:* [[170](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L170), [171](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L171)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `Q64`
143:             state.protocolReward0 = state.feeAmount0 * params.rewardX64 / Q64;

/// @audit `Q64`
144:             state.protocolReward1 = state.feeAmount1 * params.rewardX64 / Q64;

/// @audit `Q64`
236:                 state.protocolReward0 = state.amountAdded0 * params.rewardX64 / Q64;

/// @audit `Q64`
237:                 state.protocolReward1 = state.amountAdded1 * params.rewardX64 / Q64;

```
*Github:* [[143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L143), [144](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L144), [236](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L236), [237](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L237)]


</details>


<a name="L-5"></a> 
### [L-5] Consider implementing two-step procedure for updating protocol addresses
A copy-paste error or a typo may end up bricking protocol functionality, or sending tokens to an address with no known private key. Consider implementing a two-step procedure for updating protocol addresses, where the recipient is set as pending, and must "accept" the assignment by making an affirmative call. A straight forward way of doing this would be to have the target contracts implement [EIP-165](https://eips.ethereum.org/EIPS/eip-165), and to have the "set" functions ensure that the recipient is of the right interface type.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

/// @audit `emergencyAdmin`
265:     function setEmergencyAdmin(address admin) external onlyOwner {

```
*Github:* [[265](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L265)]


```solidity
File: src/V3Vault.sol

/// @audit `emergencyAdmin`
870:     function setEmergencyAdmin(address admin) external onlyOwner {

```
*Github:* [[870](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L870)]


```solidity
File: src/automators/Automator.sol

/// @audit `withdrawer`
59:     function setWithdrawer(address _withdrawer) public onlyOwner {

```
*Github:* [[59](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L59)]



<a name="L-6"></a> 
### [L-6] Constructor / initialization function lacks parameter validation
Constructors and initialization functions play a critical role in contracts by setting important initial states when the contract is first deployed before the system starts. The parameters passed to the constructor and initialization functions directly affect the behavior of the contract / protocol. If incorrect parameters are provided, the system may fail to run, behave abnormally, be unstable, or lack security. Therefore, it's crucial to carefully check each parameter in the constructor and initialization functions. If an exception is found, the transaction should be rolled back.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

/// @audit `baseRatePerYearX96` not validated
/// @audit `multiplierPerYearX96` not validated
/// @audit `jumpMultiplierPerYearX96` not validated
/// @audit `_kinkX96` not validated
33:     constructor(

```
*Github:* [[33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L33)]


```solidity
File: src/V3Oracle.sol

/// @audit `_nonfungiblePositionManager` not validated
/// @audit `_chainlinkReferenceToken` not validated
74:     constructor(

```
*Github:* [[74](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L74)]


```solidity
File: src/V3Vault.sol

/// @audit `name` not validated
/// @audit `symbol` not validated
/// @audit `_nonfungiblePositionManager` not validated
/// @audit `_interestRateModel` not validated
/// @audit `_oracle` not validated
/// @audit `_permit2` not validated
169:     constructor(

```
*Github:* [[169](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L169)]


```solidity
File: src/automators/AutoExit.sol

/// @audit `_npm` not validated
/// @audit `_operator` not validated
/// @audit `_withdrawer` not validated
/// @audit `_TWAPSeconds` not validated
/// @audit `_maxTWAPTickDifference` not validated
/// @audit `_zeroxRouter` not validated
/// @audit `_universalRouter` not validated
33:     constructor(

```
*Github:* [[33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L33)]


```solidity
File: src/automators/Automator.sol

/// @audit `npm` not validated
/// @audit `_operator` not validated
/// @audit `_TWAPSeconds` not validated
/// @audit `_maxTWAPTickDifference` not validated
/// @audit `_zeroxRouter` not validated
/// @audit `_universalRouter` not validated
41:     constructor(

```
*Github:* [[41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L41)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit `_npm` not validated
/// @audit `_operator` not validated
/// @audit `_withdrawer` not validated
/// @audit `_TWAPSeconds` not validated
/// @audit `_maxTWAPTickDifference` not validated
37:     constructor(

```
*Github:* [[37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L37)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `_npm` not validated
/// @audit `_operator` not validated
/// @audit `_withdrawer` not validated
/// @audit `_TWAPSeconds` not validated
/// @audit `_maxTWAPTickDifference` not validated
/// @audit `_zeroxRouter` not validated
/// @audit `_universalRouter` not validated
25:     constructor(

```
*Github:* [[25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L25)]


```solidity
File: src/transformers/LeverageTransformer.sol

/// @audit `_nonfungiblePositionManager` not validated
/// @audit `_zeroxRouter` not validated
/// @audit `_universalRouter` not validated
13:     constructor(INonfungiblePositionManager _nonfungiblePositionManager, address _zeroxRouter, address _universalRouter)

```
*Github:* [[13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L13)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit `_nonfungiblePositionManager` not validated
/// @audit `_zeroxRouter` not validated
/// @audit `_universalRouter` not validated
31:     constructor(

```
*Github:* [[31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L31)]


```solidity
File: src/utils/FlashloanLiquidator.sol

/// @audit `_nonfungiblePositionManager` not validated
/// @audit `_zeroxRouter` not validated
/// @audit `_universalRouter` not validated
24:     constructor(INonfungiblePositionManager _nonfungiblePositionManager, address _zeroxRouter, address _universalRouter)

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L24)]


```solidity
File: src/utils/Swapper.sol

/// @audit `_nonfungiblePositionManager` not validated
/// @audit `_zeroxRouter` not validated
/// @audit `_universalRouter` not validated
37:     constructor(

```
*Github:* [[37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L37)]


</details>


<a name="L-7"></a> 
### [L-7] Code does not follow the best practice of check-effects-interaction
Code should follow the best-practice of [check-effects-interaction](https://blockchain-academy.hs-mittweida.de/courses/solidity-coding-beginners-to-intermediate/lessons/solidity-11-coding-patterns/topic/checks-effects-interactions/), where state variables are updated before any external calls are made. Doing so prevents a large class of reentrancy bugs.

<details>
<summary>
There are <b>25</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit `.factory(...)` is called on line 80
81:         referenceToken = _referenceToken;

/// @audit `.factory(...)` is called on line 80
82:         referenceTokenDecimals = IERC20Metadata(_referenceToken).decimals();

/// @audit `.factory(...)` is called on line 80
/// @audit `.decimals(...)` is called on line 82
83:         chainlinkReferenceToken = _chainlinkReferenceToken;

/// @audit `.decimals(...)` is called on line 215
/// @audit `.decimals(...)` is called on line 216
/// @audit `.token0(...)` is called on line 225
/// @audit `.token1(...)` is called on line 226
240:         feedConfigs[token] = config;

```
*Github:* [[81](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L81), [82](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L82), [83](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L83), [240](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L240)]


```solidity
File: src/V3Vault.sol

/// @audit `.decimals(...)` is called on line 179
180:         nonfungiblePositionManager = _nonfungiblePositionManager;

/// @audit `.decimals(...)` is called on line 179
181:         factory = IUniswapV3Factory(_nonfungiblePositionManager.factory());

/// @audit `.decimals(...)` is called on line 179
/// @audit `.factory(...)` is called on line 181
182:         interestRateModel = _interestRateModel;

/// @audit `.decimals(...)` is called on line 179
/// @audit `.factory(...)` is called on line 181
183:         oracle = _oracle;

/// @audit `.decimals(...)` is called on line 179
/// @audit `.factory(...)` is called on line 181
184:         permit2 = _permit2;

/// @audit `.approve(...)` is called on line 520
/// @audit `.call(...)` is called on line 522
/// @audit `.ownerOf(...)` is called on line 531
/// @audit `.approve(...)` is called on line 537
542:         transformedTokenId = 0;

/// @audit `.safeTransferFrom(...)` is called on line 728
/// @audit `.permitTransferFrom(...)` is called on line 720
731:         debtSharesTotal -= debtShares;

/// @audit `.safeTransferFrom(...)` is called on line 901
/// @audit `.permitTransferFrom(...)` is called on line 896
913:             dailyLendIncreaseLimitLeft -= assets;

/// @audit `.safeTransfer(...)` is called on line 946
949:         dailyLendIncreaseLimitLeft += assets;

/// @audit `.safeTransferFrom(...)` is called on line 986
/// @audit `.permitTransferFrom(...)` is called on line 981
992:         debtSharesTotal -= shares;

/// @audit `.safeTransferFrom(...)` is called on line 986
/// @audit `.permitTransferFrom(...)` is called on line 981
995:         dailyDebtIncreaseLimitLeft += assets;

/// @audit `.positions(...)` is called on line 1213
1217:                 tokenConfigs[token0].totalDebtShares -= SafeCast.toUint192(oldShares - newShares);

/// @audit `.positions(...)` is called on line 1213
1218:                 tokenConfigs[token1].totalDebtShares -= SafeCast.toUint192(oldShares - newShares);

/// @audit `.positions(...)` is called on line 1213
1220:                 tokenConfigs[token0].totalDebtShares += SafeCast.toUint192(newShares - oldShares);

/// @audit `.positions(...)` is called on line 1213
1221:                 tokenConfigs[token1].totalDebtShares += SafeCast.toUint192(newShares - oldShares);

```
*Github:* [[180](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L180), [181](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L181), [182](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L182), [183](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L183), [184](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L184), [542](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L542), [731](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L731), [913](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L913), [949](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L949), [992](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L992), [995](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L995), [1217](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1217), [1218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1218), [1220](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1220), [1221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1221)]


```solidity
File: src/automators/AutoExit.sol

/// @audit `.ownerOf(...)` is called on line 219
230:         positionConfigs[tokenId] = config;

```
*Github:* [[230](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L230)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `.positions(...)` is called on line 131
/// @audit `.safeApprove(...)` is called on line 213
/// @audit `.safeApprove(...)` is called on line 214
/// @audit `.mint(...)` is called on line 217
/// @audit `.safeApprove(...)` is called on line 220
/// @audit `.safeApprove(...)` is called on line 221
/// @audit `.ownerOf(...)` is called on line 223
/// @audit `.ownerOf(...)` is called on line 228
/// @audit `.safeTransferFrom(...)` is called on line 232
251:             positionConfigs[state.newTokenId] = config;

```
*Github:* [[251](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L251)]


```solidity
File: src/utils/Swapper.sol

/// @audit `.WETH9(...)` is called on line 42
43:         factory = _nonfungiblePositionManager.factory();

/// @audit `.WETH9(...)` is called on line 42
/// @audit `.factory(...)` is called on line 43
44:         nonfungiblePositionManager = _nonfungiblePositionManager;

/// @audit `.WETH9(...)` is called on line 42
/// @audit `.factory(...)` is called on line 43
45:         zeroxRouter = _zeroxRouter;

/// @audit `.WETH9(...)` is called on line 42
/// @audit `.factory(...)` is called on line 43
46:         universalRouter = _universalRouter;

```
*Github:* [[43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L43), [44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L44), [45](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L45), [46](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L46)]


</details>


<a name="L-8"></a> 
### [L-8] External function calls within loops
Calling external functions within loops can easily result in insufficient gas. This greatly increases the likelihood of transaction failures, DOS attacks, and other unexpected actions. It is recommended to limit the number of loops within loops that call external functions, and to limit the gas line for each external call.

*There is one instance of this issue:*
```solidity
File: src/automators/Automator.sol

/// @audit `.balanceOf(...)`
112:             uint256 balance = IERC20(tokens[i]).balanceOf(address(this));

```
*Github:* [[112](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L112)]



<a name="L-9"></a> 
### [L-9] Functions calling contracts/addresses with transfer hooks are missing reentrancy guards
While adherence to the check-effects-interaction pattern is commendable, the absence of a reentrancy guard in functions, especially where transfer hooks might be present, can expose the protocol users to risks of read-only reentrancies. Such reentrancy vulnerabilities can be exploited to execute malicious actions even without altering the contract state. Without a reentrancy guard, the only potential mitigation would be to blocklist the entire protocol - an extreme and disruptive measure. Therefore, incorporating a reentrancy guard into these functions is vital to bolster security, as it helps protect against both traditional reentrancy attacks and read-only reentrancies, ensuring robust and safe protocol operations.

<details>
<summary>
There are <b>17</b> instances (click to show):
</summary>

```solidity
File: src/V3Vault.sol

372:     function withdraw(uint256 assets, address receiver, address owner) external override returns (uint256) {
             (, uint256 shares) = _withdraw(receiver, owner, assets, false);

378:     function redeem(uint256 shares, address receiver, address owner) external override returns (uint256) {
             (uint256 assets,) = _withdraw(receiver, owner, shares, true);

400:     function create(uint256 tokenId, address recipient) external override {
             nonfungiblePositionManager.safeTransferFrom(msg.sender, address(this), tokenId, abi.encode(recipient));

410:     function createWithPermit(
             uint256 tokenId,
             address owner,
             address recipient,
             uint256 deadline,
             uint8 v,
             bytes32 r,
             bytes32 s
         ) external override {
             if (msg.sender != owner) {
                 revert Unauthorized();
             }
     
             nonfungiblePositionManager.permit(address(this), tokenId, deadline, v, r, s);
             nonfungiblePositionManager.safeTransferFrom(owner, address(this), tokenId, abi.encode(recipient));

550:     function borrow(uint256 tokenId, uint256 assets) external override {
             bool isTransformMode =
                 transformedTokenId > 0 && transformedTokenId == tokenId && transformerAllowList[msg.sender];
     
             (uint256 newDebtExchangeRateX96, uint256 newLendExchangeRateX96) = _updateGlobalInterest();
     
             _resetDailyDebtIncreaseLimit(newLendExchangeRateX96, false);
     
             Loan storage loan = loans[tokenId];
     
             // if not in transfer mode - must be called from owner or the vault itself
             if (!isTransformMode && tokenOwner[tokenId] != msg.sender && address(this) != msg.sender) {
                 revert Unauthorized();
             }
     
             uint256 shares = _convertToShares(assets, newDebtExchangeRateX96, Math.Rounding.Up);
     
             uint256 loanDebtShares = loan.debtShares + shares;
             loan.debtShares = loanDebtShares;
             debtSharesTotal += shares;
     
             if (debtSharesTotal > _convertToShares(globalDebtLimit, newDebtExchangeRateX96, Math.Rounding.Down)) {
                 revert GlobalDebtLimit();
             }
             if (assets > dailyDebtIncreaseLimitLeft) {
                 revert DailyDebtIncreaseLimit();
             } else {
                 dailyDebtIncreaseLimitLeft -= assets;
             }
     
             _updateAndCheckCollateral(
                 tokenId, newDebtExchangeRateX96, newLendExchangeRateX96, loanDebtShares - shares, loanDebtShares
             );
     
             uint256 debt = _convertToAssets(loanDebtShares, newDebtExchangeRateX96, Math.Rounding.Up);
     
             if (debt < minLoanSize) {
                 revert MinLoanSize();
             }
     
             // only does check health here if not in transform mode
             if (!isTransformMode) {
                 _requireLoanIsHealthy(tokenId, debt);
             }
     
             address owner = tokenOwner[tokenId];
     
             // fails if not enough asset available
             // if called from transform mode - send funds to transformer contract
             SafeERC20.safeTransfer(IERC20(asset), isTransformMode ? msg.sender : owner, assets);

609:     function decreaseLiquidityAndCollect(DecreaseLiquidityAndCollectParams calldata params)
             external
             override
             returns (uint256 amount0, uint256 amount1)
         {
             // this method is not allowed during transform - can be called directly on nftmanager if needed from transform contract
             if (transformedTokenId > 0) {
                 revert TransformNotAllowed();
             }
     
             address owner = tokenOwner[params.tokenId];
     
             if (owner != msg.sender) {
                 revert Unauthorized();
             }
     
             (uint256 newDebtExchangeRateX96,) = _updateGlobalInterest();
     
             (amount0, amount1) = nonfungiblePositionManager.decreaseLiquidity(
                 INonfungiblePositionManager.DecreaseLiquidityParams(
                     params.tokenId, params.liquidity, params.amount0Min, params.amount1Min, params.deadline
                 )
             );
     
             INonfungiblePositionManager.CollectParams memory collectParams = INonfungiblePositionManager.CollectParams(
                 params.tokenId,
                 params.recipient,
                 params.feeAmount0 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount0 + params.feeAmount0),
                 params.feeAmount1 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount1 + params.feeAmount1)
             );
     
             (amount0, amount1) = nonfungiblePositionManager.collect(collectParams);
     
             uint256 debt = _convertToAssets(loans[params.tokenId].debtShares, newDebtExchangeRateX96, Math.Rounding.Up);
             _requireLoanIsHealthy(params.tokenId, debt);
     
             emit WithdrawCollateral(params.tokenId, owner, params.recipient, params.liquidity, amount0, amount1);

685:     function liquidate(LiquidateParams calldata params) external override returns (uint256 amount0, uint256 amount1) {
             // liquidation is not allowed during transformer mode
             if (transformedTokenId > 0) {
                 revert TransformNotAllowed();
             }
     
             LiquidateState memory state;
     
             (state.newDebtExchangeRateX96, state.newLendExchangeRateX96) = _updateGlobalInterest();
     
             uint256 debtShares = loans[params.tokenId].debtShares;
             if (debtShares != params.debtShares) {
                 revert DebtChanged();
             }
     
             state.debt = _convertToAssets(debtShares, state.newDebtExchangeRateX96, Math.Rounding.Up);
     
             (state.isHealthy, state.fullValue, state.collateralValue, state.feeValue) =
                 _checkLoanIsHealthy(params.tokenId, state.debt);
             if (state.isHealthy) {
                 revert NotLiquidatable();
             }
     
             (state.liquidationValue, state.liquidatorCost, state.reserveCost) =
                 _calculateLiquidation(state.debt, state.fullValue, state.collateralValue);
     
             // calculate reserve (before transfering liquidation money - otherwise calculation is off)
             if (state.reserveCost > 0) {
                 state.missing =
                     _handleReserveLiquidation(state.reserveCost, state.newDebtExchangeRateX96, state.newLendExchangeRateX96);
             }
     
             if (params.permitData.length > 0) {
                 (ISignatureTransfer.PermitTransferFrom memory permit, bytes memory signature) =
                     abi.decode(params.permitData, (ISignatureTransfer.PermitTransferFrom, bytes));
                 permit2.permitTransferFrom(
                     permit,
                     ISignatureTransfer.SignatureTransferDetails(address(this), state.liquidatorCost),
                     msg.sender,
                     signature
                 );
             } else {
                 // take value from liquidator
                 SafeERC20.safeTransferFrom(IERC20(asset), msg.sender, address(this), state.liquidatorCost);

```
*Github:* [[372](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L372), [378](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L378), [400](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L400), [410](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L410), [550](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L550), [609](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L609), [685](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L685)]


```solidity
File: src/automators/AutoExit.sol

100:     function execute(ExecuteParams calldata params) external {
             if (!operators[msg.sender]) {
                 revert Unauthorized();
             }
     
             ExecuteState memory state;
             PositionConfig memory config = positionConfigs[params.tokenId];
     
             if (!config.isActive) {
                 revert NotConfigured();
             }
     
             if (
                 config.onlyFees && params.rewardX64 > config.maxRewardX64
                     || !config.onlyFees && params.rewardX64 > config.maxRewardX64
             ) {
                 revert ExceedsMaxReward();
             }
     
             // get position info
             (,, state.token0, state.token1, state.fee, state.tickLower, state.tickUpper, state.liquidity,,,,) =
                 nonfungiblePositionManager.positions(params.tokenId);
     
             // so can be executed only once
             if (state.liquidity == 0) {
                 revert NoLiquidity();
             }
             if (state.liquidity != params.liquidity) {
                 revert LiquidityChanged();
             }
     
             state.pool = _getPool(state.token0, state.token1, state.fee);
             (, state.tick,,,,,) = state.pool.slot0();
     
             // not triggered
             if (config.token0TriggerTick <= state.tick && state.tick < config.token1TriggerTick) {
                 revert NotReady();
             }
     
             state.isAbove = state.tick >= config.token1TriggerTick;
             state.isSwap = !state.isAbove && config.token0Swap || state.isAbove && config.token1Swap;
     
             // decrease full liquidity for given position - and return fees as well
             (state.amount0, state.amount1, state.feeAmount0, state.feeAmount1) = _decreaseFullLiquidityAndCollect(
                 params.tokenId, state.liquidity, params.amountRemoveMin0, params.amountRemoveMin1, params.deadline
             );
     
             // swap to other token
             if (state.isSwap) {
                 if (params.swapData.length == 0) {
                     revert MissingSwapData();
                 }
     
                 // reward is taken before swap - if from fees only
                 if (config.onlyFees) {
                     state.amount0 -= state.feeAmount0 * params.rewardX64 / Q64;
                     state.amount1 -= state.feeAmount1 * params.rewardX64 / Q64;
                 }
     
                 state.swapAmount = state.isAbove ? state.amount1 : state.amount0;
     
                 // checks if price in valid oracle range and calculates amountOutMin
                 (state.amountOutMin,,,) = _validateSwap(
                     !state.isAbove,
                     state.swapAmount,
                     state.pool,
                     TWAPSeconds,
                     maxTWAPTickDifference,
                     state.isAbove ? config.token1SlippageX64 : config.token0SlippageX64
                 );
     
                 (state.amountInDelta, state.amountOutDelta) = _routerSwap(
                     Swapper.RouterSwapParams(
                         state.isAbove ? IERC20(state.token1) : IERC20(state.token0),
                         state.isAbove ? IERC20(state.token0) : IERC20(state.token1),
                         state.swapAmount,
                         state.amountOutMin,
                         params.swapData
                     )
                 );
     
                 state.amount0 = state.isAbove ? state.amount0 + state.amountOutDelta : state.amount0 - state.amountInDelta;
                 state.amount1 = state.isAbove ? state.amount1 - state.amountInDelta : state.amount1 + state.amountOutDelta;
     
                 // when swap and !onlyFees - protocol reward is removed only from target token (to incentivize optimal swap done by operator)
                 if (!config.onlyFees) {
                     if (state.isAbove) {
                         state.amount0 -= state.amount0 * params.rewardX64 / Q64;
                     } else {
                         state.amount1 -= state.amount1 * params.rewardX64 / Q64;
                     }
                 }
             } else {
                 // reward is taken as configured
                 state.amount0 -= (config.onlyFees ? state.feeAmount0 : state.amount0) * params.rewardX64 / Q64;
                 state.amount1 -= (config.onlyFees ? state.feeAmount1 : state.amount1) * params.rewardX64 / Q64;
             }
     
             state.owner = nonfungiblePositionManager.ownerOf(params.tokenId);
             if (state.amount0 > 0) {
                 _transferToken(state.owner, IERC20(state.token0), state.amount0, true);

```
*Github:* [[100](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L100)]


```solidity
File: src/automators/Automator.sol

104:     function withdrawBalances(address[] calldata tokens, address to) external virtual {
             if (msg.sender != withdrawer) {
                 revert Unauthorized();
             }
     
             uint256 i;
             uint256 count = tokens.length;
             for (; i < count; ++i) {
                 uint256 balance = IERC20(tokens[i]).balanceOf(address(this));
                 if (balance > 0) {
                     _transferToken(to, IERC20(tokens[i]), balance, true);

```
*Github:* [[104](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L104)]


```solidity
File: src/transformers/AutoRange.sol

111:     function execute(ExecuteParams calldata params) external {
             if (!operators[msg.sender] && !vaults[msg.sender]) {
                 revert Unauthorized();
             }
             ExecuteState memory state;
             PositionConfig memory config = positionConfigs[params.tokenId];
     
             if (config.lowerTickDelta == config.upperTickDelta) {
                 revert NotConfigured();
             }
     
             if (
                 config.onlyFees && params.rewardX64 > config.maxRewardX64
                     || !config.onlyFees && params.rewardX64 > config.maxRewardX64
             ) {
                 revert ExceedsMaxReward();
             }
     
             // get position info
             (,, state.token0, state.token1, state.fee, state.tickLower, state.tickUpper, state.liquidity,,,,) =
                 nonfungiblePositionManager.positions(params.tokenId);
     
             if (state.liquidity != params.liquidity) {
                 revert LiquidityChanged();
             }
     
             (state.amount0, state.amount1, state.feeAmount0, state.feeAmount1) = _decreaseFullLiquidityAndCollect(
                 params.tokenId, state.liquidity, params.amountRemoveMin0, params.amountRemoveMin1, params.deadline
             );
     
             // if only fees reward is removed before adding
             if (config.onlyFees) {
                 state.protocolReward0 = state.feeAmount0 * params.rewardX64 / Q64;
                 state.protocolReward1 = state.feeAmount1 * params.rewardX64 / Q64;
                 state.amount0 -= state.protocolReward0;
                 state.amount1 -= state.protocolReward1;
             }
     
             if (params.swap0To1 && params.amountIn > state.amount0 || !params.swap0To1 && params.amountIn > state.amount1) {
                 revert SwapAmountTooLarge();
             }
     
             // get pool info
             state.pool = _getPool(state.token0, state.token1, state.fee);
     
             // check oracle for swap
             (state.amountOutMin, state.currentTick,,) = _validateSwap(
                 params.swap0To1,
                 params.amountIn,
                 state.pool,
                 TWAPSeconds,
                 maxTWAPTickDifference,
                 params.swap0To1 ? config.token0SlippageX64 : config.token1SlippageX64
             );
     
             if (
                 state.currentTick < state.tickLower - config.lowerTickLimit
                     || state.currentTick >= state.tickUpper + config.upperTickLimit
             ) {
                 int24 tickSpacing = _getTickSpacing(state.fee);
                 int24 baseTick = state.currentTick - (((state.currentTick % tickSpacing) + tickSpacing) % tickSpacing);
     
                 // check if new range same as old range
                 if (
                     baseTick + config.lowerTickDelta == state.tickLower
                         && baseTick + config.upperTickDelta == state.tickUpper
                 ) {
                     revert SameRange();
                 }
     
                 (state.amountInDelta, state.amountOutDelta) = _routerSwap(
                     Swapper.RouterSwapParams(
                         params.swap0To1 ? IERC20(state.token0) : IERC20(state.token1),
                         params.swap0To1 ? IERC20(state.token1) : IERC20(state.token0),
                         params.amountIn,
                         state.amountOutMin,
                         params.swapData
                     )
                 );
     
                 state.amount0 = params.swap0To1 ? state.amount0 - state.amountInDelta : state.amount0 + state.amountOutDelta;
                 state.amount1 = params.swap0To1 ? state.amount1 + state.amountOutDelta : state.amount1 - state.amountInDelta;
     
                 // max amount to add - removing max potential fees (if config.onlyFees - the have been removed already)
                 state.maxAddAmount0 = config.onlyFees ? state.amount0 : state.amount0 * Q64 / (params.rewardX64 + Q64);
                 state.maxAddAmount1 = config.onlyFees ? state.amount1 : state.amount1 * Q64 / (params.rewardX64 + Q64);
     
                 INonfungiblePositionManager.MintParams memory mintParams = INonfungiblePositionManager.MintParams(
                     address(state.token0),
                     address(state.token1),
                     state.fee,
                     SafeCast.toInt24(baseTick + config.lowerTickDelta), // reverts if out of valid range
                     SafeCast.toInt24(baseTick + config.upperTickDelta), // reverts if out of valid range
                     state.maxAddAmount0,
                     state.maxAddAmount1,
                     0,
                     0,
                     address(this), // is sent to real recipient aftwards
                     params.deadline
                 );
     
                 // approve npm
                 SafeERC20.safeApprove(IERC20(state.token0), address(nonfungiblePositionManager), state.maxAddAmount0);
                 SafeERC20.safeApprove(IERC20(state.token1), address(nonfungiblePositionManager), state.maxAddAmount1);
     
                 // mint is done to address(this) first - its not a safemint
                 (state.newTokenId,, state.amountAdded0, state.amountAdded1) = nonfungiblePositionManager.mint(mintParams);
     
                 // remove remaining approval
                 SafeERC20.safeApprove(IERC20(state.token0), address(nonfungiblePositionManager), 0);
                 SafeERC20.safeApprove(IERC20(state.token1), address(nonfungiblePositionManager), 0);
     
                 state.owner = nonfungiblePositionManager.ownerOf(params.tokenId);
     
                 // get the real owner - if owner is vault - for sending leftover tokens
                 state.realOwner = state.owner;
                 if (vaults[state.owner]) {
                     state.realOwner = IVault(state.owner).ownerOf(params.tokenId);
                 }
     
                 // send the new nft to the owner / vault
                 nonfungiblePositionManager.safeTransferFrom(address(this), state.owner, state.newTokenId);

```
*Github:* [[111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L111)]


```solidity
File: src/transformers/LeverageTransformer.sol

40:     function leverageUp(LeverageUpParams calldata params) external {
            uint256 amount = params.borrowAmount;
    
            address token = IVault(msg.sender).asset();
    
            IVault(msg.sender).borrow(params.tokenId, amount);
    
            (,, address token0, address token1,,,,,,,,) = nonfungiblePositionManager.positions(params.tokenId);
    
            uint256 amount0 = token == token0 ? amount : 0;
            uint256 amount1 = token == token1 ? amount : 0;
    
            if (params.amountIn0 > 0) {
                (uint256 amountIn, uint256 amountOut) = _routerSwap(
                    Swapper.RouterSwapParams(
                        IERC20(token), IERC20(token0), params.amountIn0, params.amountOut0Min, params.swapData0
                    )
                );
                if (token == token1) {
                    amount1 -= amountIn;
                }
                amount -= amountIn;
                amount0 += amountOut;
            }
            if (params.amountIn1 > 0) {
                (uint256 amountIn, uint256 amountOut) = _routerSwap(
                    Swapper.RouterSwapParams(
                        IERC20(token), IERC20(token1), params.amountIn1, params.amountOut1Min, params.swapData1
                    )
                );
                if (token == token0) {
                    amount0 -= amountIn;
                }
                amount -= amountIn;
                amount1 += amountOut;
            }
    
            SafeERC20.safeIncreaseAllowance(IERC20(token0), address(nonfungiblePositionManager), amount0);
            SafeERC20.safeIncreaseAllowance(IERC20(token1), address(nonfungiblePositionManager), amount1);
    
            INonfungiblePositionManager.IncreaseLiquidityParams memory increaseLiquidityParams = INonfungiblePositionManager
                .IncreaseLiquidityParams(
                params.tokenId, amount0, amount1, params.amountAddMin0, params.amountAddMin1, params.deadline
            );
            (, uint256 added0, uint256 added1) = nonfungiblePositionManager.increaseLiquidity(increaseLiquidityParams);
    
            // send leftover tokens
            if (amount0 > added0) {
                SafeERC20.safeTransfer(IERC20(token0), params.recipient, amount0 - added0);

123:     function leverageDown(LeverageDownParams calldata params) external {
             address token = IVault(msg.sender).asset();
             (,, address token0, address token1,,,,,,,,) = nonfungiblePositionManager.positions(params.tokenId);
     
             uint256 amount0;
             uint256 amount1;
     
             INonfungiblePositionManager.DecreaseLiquidityParams memory decreaseLiquidityParams = INonfungiblePositionManager
                 .DecreaseLiquidityParams(
                 params.tokenId, params.liquidity, params.amountRemoveMin0, params.amountRemoveMin1, params.deadline
             );
             (amount0, amount1) = nonfungiblePositionManager.decreaseLiquidity(decreaseLiquidityParams);
     
             INonfungiblePositionManager.CollectParams memory collectParams = INonfungiblePositionManager.CollectParams(
                 params.tokenId,
                 address(this),
                 params.feeAmount0 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount0 + params.feeAmount0),
                 params.feeAmount1 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount1 + params.feeAmount1)
             );
             (amount0, amount1) = nonfungiblePositionManager.collect(collectParams);
     
             uint256 amount = token == token0 ? amount0 : (token == token1 ? amount1 : 0);
     
             if (params.amountIn0 > 0 && token != token0) {
                 (uint256 amountIn, uint256 amountOut) = _routerSwap(
                     Swapper.RouterSwapParams(
                         IERC20(token0), IERC20(token), params.amountIn0, params.amountOut0Min, params.swapData0
                     )
                 );
                 amount0 -= amountIn;
                 amount += amountOut;
             }
             if (params.amountIn1 > 0 && token != token1) {
                 (uint256 amountIn, uint256 amountOut) = _routerSwap(
                     Swapper.RouterSwapParams(
                         IERC20(token1), IERC20(token), params.amountIn1, params.amountOut1Min, params.swapData1
                     )
                 );
                 amount1 -= amountIn;
                 amount += amountOut;
             }
     
             SafeERC20.safeApprove(IERC20(token), msg.sender, amount);
             IVault(msg.sender).repay(params.tokenId, amount, false);
     
             // send leftover tokens
             if (amount0 > 0 && token != token0) {
                 SafeERC20.safeTransfer(IERC20(token0), params.recipient, amount0);

```
*Github:* [[40](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L40), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L123)]


```solidity
File: src/transformers/V3Utils.sol

115:     function execute(uint256 tokenId, Instructions memory instructions) public returns (uint256 newTokenId) {
             (,, address token0, address token1,,,, uint128 liquidity,,,,) = nonfungiblePositionManager.positions(tokenId);
     
             uint256 amount0;
             uint256 amount1;
             if (instructions.liquidity != 0) {
                 (amount0, amount1) = _decreaseLiquidity(
                     tokenId,
                     instructions.liquidity,
                     instructions.deadline,
                     instructions.amountRemoveMin0,
                     instructions.amountRemoveMin1
                 );
             }
             (amount0, amount1) = _collectFees(
                 tokenId,
                 IERC20(token0),
                 IERC20(token1),
                 instructions.feeAmount0 == type(uint128).max
                     ? type(uint128).max
                     : (amount0 + instructions.feeAmount0).toUint128(),
                 instructions.feeAmount1 == type(uint128).max
                     ? type(uint128).max
                     : (amount1 + instructions.feeAmount1).toUint128()
             );
     
             // check if enough tokens are available for swaps
             if (amount0 < instructions.amountIn0 || amount1 < instructions.amountIn1) {
                 revert AmountError();
             }
     
             if (instructions.whatToDo == WhatToDo.COMPOUND_FEES) {
                 if (instructions.targetToken == token0) {
                     (liquidity, amount0, amount1) = _swapAndIncrease(
                         SwapAndIncreaseLiquidityParams(
                             tokenId,
                             amount0,
                             amount1,
                             instructions.recipient,
                             instructions.deadline,
                             IERC20(token1),
                             instructions.amountIn1,
                             instructions.amountOut1Min,
                             instructions.swapData1,
                             0,
                             0,
                             "",
                             instructions.amountAddMin0,
                             instructions.amountAddMin1,
                             ""
                         ),
                         IERC20(token0),
                         IERC20(token1),
                         instructions.unwrap
                     );
                 } else if (instructions.targetToken == token1) {
                     (liquidity, amount0, amount1) = _swapAndIncrease(
                         SwapAndIncreaseLiquidityParams(
                             tokenId,
                             amount0,
                             amount1,
                             instructions.recipient,
                             instructions.deadline,
                             IERC20(token0),
                             0,
                             0,
                             "",
                             instructions.amountIn0,
                             instructions.amountOut0Min,
                             instructions.swapData0,
                             instructions.amountAddMin0,
                             instructions.amountAddMin1,
                             ""
                         ),
                         IERC20(token0),
                         IERC20(token1),
                         instructions.unwrap
                     );
                 } else {
                     // no swap is done here
                     (liquidity, amount0, amount1) = _swapAndIncrease(
                         SwapAndIncreaseLiquidityParams(
                             tokenId,
                             amount0,
                             amount1,
                             instructions.recipient,
                             instructions.deadline,
                             IERC20(address(0)),
                             0,
                             0,
                             "",
                             0,
                             0,
                             "",
                             instructions.amountAddMin0,
                             instructions.amountAddMin1,
                             ""
                         ),
                         IERC20(token0),
                         IERC20(token1),
                         instructions.unwrap
                     );
                 }
                 emit CompoundFees(tokenId, liquidity, amount0, amount1);
             } else if (instructions.whatToDo == WhatToDo.CHANGE_RANGE) {
                 if (instructions.targetToken == token0) {
                     (newTokenId,,,) = _swapAndMint(
                         SwapAndMintParams(
                             IERC20(token0),
                             IERC20(token1),
                             instructions.fee,
                             instructions.tickLower,
                             instructions.tickUpper,
                             amount0,
                             amount1,
                             instructions.recipient,
                             instructions.recipientNFT,
                             instructions.deadline,
                             IERC20(token1),
                             instructions.amountIn1,
                             instructions.amountOut1Min,
                             instructions.swapData1,
                             0,
                             0,
                             "",
                             instructions.amountAddMin0,
                             instructions.amountAddMin1,
                             instructions.swapAndMintReturnData,
                             ""
                         ),
                         instructions.unwrap
                     );
                 } else if (instructions.targetToken == token1) {
                     (newTokenId,,,) = _swapAndMint(
                         SwapAndMintParams(
                             IERC20(token0),
                             IERC20(token1),
                             instructions.fee,
                             instructions.tickLower,
                             instructions.tickUpper,
                             amount0,
                             amount1,
                             instructions.recipient,
                             instructions.recipientNFT,
                             instructions.deadline,
                             IERC20(token0),
                             0,
                             0,
                             "",
                             instructions.amountIn0,
                             instructions.amountOut0Min,
                             instructions.swapData0,
                             instructions.amountAddMin0,
                             instructions.amountAddMin1,
                             instructions.swapAndMintReturnData,
                             ""
                         ),
                         instructions.unwrap
                     );
                 } else {
                     // no swap is done here
                     (newTokenId,,,) = _swapAndMint(
                         SwapAndMintParams(
                             IERC20(token0),
                             IERC20(token1),
                             instructions.fee,
                             instructions.tickLower,
                             instructions.tickUpper,
                             amount0,
                             amount1,
                             instructions.recipient,
                             instructions.recipientNFT,
                             instructions.deadline,
                             IERC20(address(0)),
                             0,
                             0,
                             "",
                             0,
                             0,
                             "",
                             instructions.amountAddMin0,
                             instructions.amountAddMin1,
                             instructions.swapAndMintReturnData,
                             ""
                         ),
                         instructions.unwrap
                     );
                 }
                 emit ChangeRange(tokenId, newTokenId);
             } else if (instructions.whatToDo == WhatToDo.WITHDRAW_AND_COLLECT_AND_SWAP) {
                 uint256 targetAmount;
                 if (token0 != instructions.targetToken) {
                     (uint256 amountInDelta, uint256 amountOutDelta) = _routerSwap(
                         Swapper.RouterSwapParams(
                             IERC20(token0),
                             IERC20(instructions.targetToken),
                             amount0,
                             instructions.amountOut0Min,
                             instructions.swapData0
                         )
                     );
                     if (amountInDelta < amount0) {
                         _transferToken(instructions.recipient, IERC20(token0), amount0 - amountInDelta, instructions.unwrap);

356:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)
             external
             override
             returns (bytes4)
         {
             // only Uniswap v3 NFTs allowed
             if (msg.sender != address(nonfungiblePositionManager)) {
                 revert WrongContract();
             }
     
             // not allowed to send to itself
             if (from == address(this)) {
                 revert SelfSend();
             }
     
             Instructions memory instructions = abi.decode(data, (Instructions));
     
             execute(tokenId, instructions);
     
             // return token to owner (this line guarantees that token is returned to originating owner)
             nonfungiblePositionManager.safeTransferFrom(address(this), from, tokenId, instructions.returnData);

397:     function swap(SwapParams calldata params) external payable returns (uint256 amountOut) {
             if (params.tokenIn == params.tokenOut) {
                 revert SameToken();
             }
     
             if (params.permitData.length > 0) {
                 (ISignatureTransfer.PermitBatchTransferFrom memory pbtf, bytes memory signature) =
                     abi.decode(params.permitData, (ISignatureTransfer.PermitBatchTransferFrom, bytes));
                 _prepareAddPermit2(
                     params.tokenIn, IERC20(address(0)), IERC20(address(0)), params.amountIn, 0, 0, pbtf, signature
                 );
             } else {
                 _prepareAddApproved(params.tokenIn, IERC20(address(0)), IERC20(address(0)), params.amountIn, 0, 0);
             }
     
             uint256 amountInDelta;
             (amountInDelta, amountOut) = _routerSwap(
                 Swapper.RouterSwapParams(
                     params.tokenIn, params.tokenOut, params.amountIn, params.minAmountOut, params.swapData
                 )
             );
     
             // send swapped amount of tokenOut
             if (amountOut != 0) {
                 _transferToken(params.recipient, params.tokenOut, amountOut, params.unwrap);

```
*Github:* [[115](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L115), [356](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L356), [397](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L397)]


```solidity
File: src/utils/FlashloanLiquidator.sol

67:     function uniswapV3FlashCallback(uint256 fee0, uint256 fee1, bytes calldata callbackData) external {
            // no origin check is needed - because the contract doesn't hold any funds - there is no benefit in calling uniswapV3FlashCallback() from another context
    
            FlashCallbackData memory data = abi.decode(callbackData, (FlashCallbackData));
    
            SafeERC20.safeApprove(data.asset, address(data.vault), data.liquidationCost);
            data.vault.liquidate(
                IVault.LiquidateParams(
                    data.tokenId, data.debtShares, data.swap0.amountIn, data.swap1.amountIn, address(this), ""
                )
            );
            SafeERC20.safeApprove(data.asset, address(data.vault), 0);
    
            // do swaps
            _routerSwap(data.swap0);
            _routerSwap(data.swap1);
    
            // transfer lent amount + fee (only one token can have fee) - back to pool
            SafeERC20.safeTransfer(data.asset, msg.sender, data.liquidationCost + (fee0 + fee1));

```
*Github:* [[67](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L67)]


```solidity
File: src/utils/Swapper.sol

156:     function uniswapV3SwapCallback(int256 amount0Delta, int256 amount1Delta, bytes calldata data) external override {
             require(amount0Delta > 0 || amount1Delta > 0); // swaps entirely within 0-liquidity regions are not supported
     
             // check if really called from pool
             (address tokenIn, address tokenOut, uint24 fee) = abi.decode(data, (address, address, uint24));
             if (address(_getPool(tokenIn, tokenOut, fee)) != msg.sender) {
                 revert Unauthorized();
             }
     
             // transfer needed amount of tokenIn
             uint256 amountToPay = amount0Delta > 0 ? uint256(amount0Delta) : uint256(amount1Delta);
             SafeERC20.safeTransfer(IERC20(tokenIn), msg.sender, amountToPay);

```
*Github:* [[156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L156)]


</details>


<a name="L-10"></a> 
### [L-10] Governance functions should be controlled by time locks
Governance functions (such as upgrading contracts, setting critical parameters) should be controlled using time locks to introduce a delay between a proposal and its execution. This gives users time to exit before a potentially dangerous or malicious operation is applied.

*There are <b>6</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

185:     function setMaxPoolPriceDifference(uint16 _maxPoolPriceDifference) external onlyOwner {

265:     function setEmergencyAdmin(address admin) external onlyOwner {

```
*Github:* [[185](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L185), [265](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L265)]


```solidity
File: src/V3Vault.sol

837:     function setReserveFactor(uint32 _reserveFactorX32) external onlyOwner {

844:     function setReserveProtectionFactor(uint32 _reserveProtectionFactorX32) external onlyOwner {

870:     function setEmergencyAdmin(address admin) external onlyOwner {

```
*Github:* [[837](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L837), [844](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L844), [870](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L870)]


```solidity
File: src/transformers/AutoCompound.sol

243:     function setReward(uint64 _totalRewardX64) external onlyOwner {

```
*Github:* [[243](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L243)]



<a name="L-11"></a> 
### [L-11] Loss of precision in divisions
Division by large numbers may result in the result being zero, due to solidity not supporting fractions. Consider requiring a minimum amount for the numerator to ensure that it is always larger than the denominator.

*There are <b>5</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

1060:                 liquidity = uint128((liquidationValue - feeValue) * liquidity / (fullValue - feeValue));

1107:                 (Q96 - ((fullValue - maxPenaltyValue) * Q96 / (startLiquidationValue - maxPenaltyValue)));

1137:             newLendExchangeRateX96 = (totalLent - missing) * newLendExchangeRateX96 / totalLent;

```
*Github:* [[1060](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1060), [1107](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1107), [1137](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1137)]


```solidity
File: src/automators/Automator.sol

158:             amountOutMin = FullMath.mulDiv(amountIn * (Q64 - maxPriceDifferenceX64), priceX96, Q96 * Q64);

160:             amountOutMin = FullMath.mulDiv(amountIn * (Q64 - maxPriceDifferenceX64), Q96, priceX96 * Q64);

```
*Github:* [[158](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L158), [160](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L160)]



<a name="L-12"></a> 
### [L-12] Missing checks for state variable assignments
There are some missing checks in these functions, and this could lead to unexpected scenarios. Consider always adding a sanity check for state variables.

<details>
<summary>
There are <b>35</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

/// @audit `_kinkX96`
98:         kinkX96 = _kinkX96;

```
*Github:* [[98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L98)]


```solidity
File: src/V3Oracle.sol

/// @audit `_nonfungiblePositionManager`
79:         nonfungiblePositionManager = _nonfungiblePositionManager;

/// @audit `_referenceToken`
81:         referenceToken = _referenceToken;

/// @audit `_chainlinkReferenceToken`
83:         chainlinkReferenceToken = _chainlinkReferenceToken;

/// @audit `_maxPoolPriceDifference`
189:         maxPoolPriceDifference = _maxPoolPriceDifference;

/// @audit `admin`
266:         emergencyAdmin = admin;

```
*Github:* [[79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L79), [81](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L81), [83](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L83), [189](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L189), [266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L266)]


```solidity
File: src/V3Vault.sol

/// @audit `_asset`
178:         asset = _asset;

/// @audit `_nonfungiblePositionManager`
180:         nonfungiblePositionManager = _nonfungiblePositionManager;

/// @audit `_interestRateModel`
182:         interestRateModel = _interestRateModel;

/// @audit `_oracle`
183:         oracle = _oracle;

/// @audit `_permit2`
184:         permit2 = _permit2;

/// @audit `tokenId`
458:                 transformedTokenId = tokenId;

/// @audit `tokenId`
508:         transformedTokenId = tokenId;

/// @audit `active`
797:         transformerAllowList[transformer] = active;

/// @audit `_minLoanSize`
818:         minLoanSize = _minLoanSize;

/// @audit `_globalLendLimit`
819:         globalLendLimit = _globalLendLimit;

/// @audit `_globalDebtLimit`
820:         globalDebtLimit = _globalDebtLimit;

/// @audit `_dailyLendIncreaseLimitMin`
821:         dailyLendIncreaseLimitMin = _dailyLendIncreaseLimitMin;

/// @audit `_dailyDebtIncreaseLimitMin`
822:         dailyDebtIncreaseLimitMin = _dailyDebtIncreaseLimitMin;

/// @audit `_reserveFactorX32`
838:         reserveFactorX32 = _reserveFactorX32;

/// @audit `_reserveProtectionFactorX32`
848:         reserveProtectionFactorX32 = _reserveProtectionFactorX32;

/// @audit `admin`
871:         emergencyAdmin = admin;

/// @audit `newLendExchangeRateX96`
1138:             lastLendExchangeRateX96 = newLendExchangeRateX96;

/// @audit `to`
1300:         tokenOwner[tokenId] = to;

```
*Github:* [[178](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L178), [180](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L180), [182](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L182), [183](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L183), [184](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L184), [458](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L458), [508](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L508), [797](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L797), [818](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L818), [819](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L819), [820](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L820), [821](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L821), [822](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L822), [838](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L838), [848](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L848), [871](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L871), [1138](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1138), [1300](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1300)]


```solidity
File: src/automators/AutoExit.sol

/// @audit `config`
230:         positionConfigs[tokenId] = config;

```
*Github:* [[230](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L230)]


```solidity
File: src/automators/Automator.sol

/// @audit `_withdrawer`
61:         withdrawer = _withdrawer;

/// @audit `_active`
71:         operators[_operator] = _active;

/// @audit `_active`
81:         vaults[_vault] = _active;

/// @audit `_TWAPSeconds`
95:         TWAPSeconds = _TWAPSeconds;

/// @audit `_maxTWAPTickDifference`
96:         maxTWAPTickDifference = _maxTWAPTickDifference;

```
*Github:* [[61](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L61), [71](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L71), [81](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L81), [95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L95), [96](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L96)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit `_totalRewardX64`
245:         totalRewardX64 = _totalRewardX64;

```
*Github:* [[245](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L245)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `config`
284:         positionConfigs[tokenId] = config;

```
*Github:* [[284](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L284)]


```solidity
File: src/utils/Swapper.sol

/// @audit `_nonfungiblePositionManager`
44:         nonfungiblePositionManager = _nonfungiblePositionManager;

/// @audit `_zeroxRouter`
45:         zeroxRouter = _zeroxRouter;

/// @audit `_universalRouter`
46:         universalRouter = _universalRouter;

```
*Github:* [[44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L44), [45](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L45), [46](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L46)]


</details>


<a name="L-13"></a> 
### [L-13] Missing limits when setting min/max amounts
There are some missing limits in these functions, and this could lead to unexpected scenarios. Consider adding a min/max limit for the following values, when appropriate.

*There are <b>6</b> instances of this issue:*
```solidity
File: src/InterestRateModel.sol

/// @audit `_kinkX96`
82:     function setValues(
            uint256 baseRatePerYearX96,
            uint256 multiplierPerYearX96,
            uint256 jumpMultiplierPerYearX96,
            uint256 _kinkX96
        ) public onlyOwner {

```
*Github:* [[82](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L82)]


```solidity
File: src/V3Vault.sol

/// @audit `tokenId`
429:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)
             external
             override
             returns (bytes4)
         {

/// @audit `tokenId`
497:     function transform(uint256 tokenId, address transformer, bytes calldata data)
             external
             override
             returns (uint256 newTokenId)
         {

/// @audit `_minLoanSize`
/// @audit `_globalLendLimit`
/// @audit `_globalDebtLimit`
/// @audit `_dailyLendIncreaseLimitMin`
/// @audit `_dailyDebtIncreaseLimitMin`
807:     function setLimits(
             uint256 _minLoanSize,
             uint256 _globalLendLimit,
             uint256 _globalDebtLimit,
             uint256 _dailyLendIncreaseLimitMin,
             uint256 _dailyDebtIncreaseLimitMin
         ) external {

/// @audit `_reserveFactorX32`
837:     function setReserveFactor(uint32 _reserveFactorX32) external onlyOwner {

/// @audit `newLendExchangeRateX96`
1123:     function _handleReserveLiquidation(
              uint256 reserveCost,
              uint256 newDebtExchangeRateX96,
              uint256 newLendExchangeRateX96
          ) internal returns (uint256 missing) {

```
*Github:* [[429](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L429), [497](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L497), [807](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L807), [837](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L837), [1123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1123)]



<a name="L-14"></a> 
### [L-14] Missing zero address check in constructor
Constructors often take address parameters to initialize important components of a contract, such as owner or linked contracts. However, without a checking, there's a risk that an address parameter could be mistakenly set to the zero address (0x0). This could be due to an error or oversight during contract deployment. A zero address in a crucial role can cause serious issues, as it cannot perform actions like a normal address, and any funds sent to it will be irretrievable. It's therefore crucial to include a zero address check in constructors to prevent such potential problems. If a zero address is detected, the constructor should revert the transaction.

*There are <b>10</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

/// @audit missing zero check for `_nonfungiblePositionManager`
/// @audit missing zero check for `_chainlinkReferenceToken`
74:     constructor(
            INonfungiblePositionManager _nonfungiblePositionManager,
            address _referenceToken,
            address _chainlinkReferenceToken
        ) {

```
*Github:* [[74](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L74)]


```solidity
File: src/V3Vault.sol

/// @audit missing zero check for `_nonfungiblePositionManager`
/// @audit missing zero check for `_interestRateModel`
/// @audit missing zero check for `_oracle`
/// @audit missing zero check for `_permit2`
169:     constructor(
             string memory name,
             string memory symbol,
             address _asset,
             INonfungiblePositionManager _nonfungiblePositionManager,
             IInterestRateModel _interestRateModel,
             IV3Oracle _oracle,
             IPermit2 _permit2
         ) ERC20(name, symbol) {

```
*Github:* [[169](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L169)]


```solidity
File: src/automators/AutoExit.sol

/// @audit missing zero check for `_npm`
/// @audit missing zero check for `_operator`
/// @audit missing zero check for `_withdrawer`
/// @audit missing zero check for `_zeroxRouter`
/// @audit missing zero check for `_universalRouter`
33:     constructor(
            INonfungiblePositionManager _npm,
            address _operator,
            address _withdrawer,
            uint32 _TWAPSeconds,
            uint16 _maxTWAPTickDifference,
            address _zeroxRouter,
            address _universalRouter
        ) Automator(_npm, _operator, _withdrawer, _TWAPSeconds, _maxTWAPTickDifference, _zeroxRouter, _universalRouter) {}

```
*Github:* [[33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L33)]


```solidity
File: src/automators/Automator.sol

/// @audit missing zero check for `npm`
/// @audit missing zero check for `_operator`
/// @audit missing zero check for `_zeroxRouter`
/// @audit missing zero check for `_universalRouter`
41:     constructor(
            INonfungiblePositionManager npm,
            address _operator,
            address _withdrawer,
            uint32 _TWAPSeconds,
            uint16 _maxTWAPTickDifference,
            address _zeroxRouter,
            address _universalRouter
        ) Swapper(npm, _zeroxRouter, _universalRouter) {

```
*Github:* [[41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L41)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit missing zero check for `_npm`
/// @audit missing zero check for `_operator`
/// @audit missing zero check for `_withdrawer`
37:     constructor(
            INonfungiblePositionManager _npm,
            address _operator,
            address _withdrawer,
            uint32 _TWAPSeconds,
            uint16 _maxTWAPTickDifference
        ) Automator(_npm, _operator, _withdrawer, _TWAPSeconds, _maxTWAPTickDifference, address(0), address(0)) {}

```
*Github:* [[37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L37)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit missing zero check for `_npm`
/// @audit missing zero check for `_operator`
/// @audit missing zero check for `_withdrawer`
/// @audit missing zero check for `_zeroxRouter`
/// @audit missing zero check for `_universalRouter`
25:     constructor(
            INonfungiblePositionManager _npm,
            address _operator,
            address _withdrawer,
            uint32 _TWAPSeconds,
            uint16 _maxTWAPTickDifference,
            address _zeroxRouter,
            address _universalRouter
        ) Automator(_npm, _operator, _withdrawer, _TWAPSeconds, _maxTWAPTickDifference, _zeroxRouter, _universalRouter) {}

```
*Github:* [[25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L25)]


```solidity
File: src/transformers/LeverageTransformer.sol

/// @audit missing zero check for `_nonfungiblePositionManager`
/// @audit missing zero check for `_zeroxRouter`
/// @audit missing zero check for `_universalRouter`
13:     constructor(INonfungiblePositionManager _nonfungiblePositionManager, address _zeroxRouter, address _universalRouter)
            Swapper(_nonfungiblePositionManager, _zeroxRouter, _universalRouter)
        {}

```
*Github:* [[13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L13)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit missing zero check for `_nonfungiblePositionManager`
/// @audit missing zero check for `_zeroxRouter`
/// @audit missing zero check for `_universalRouter`
31:     constructor(
            INonfungiblePositionManager _nonfungiblePositionManager,
            address _zeroxRouter,
            address _universalRouter,
            address _permit2
        ) Swapper(_nonfungiblePositionManager, _zeroxRouter, _universalRouter) {

```
*Github:* [[31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L31)]


```solidity
File: src/utils/FlashloanLiquidator.sol

/// @audit missing zero check for `_nonfungiblePositionManager`
/// @audit missing zero check for `_zeroxRouter`
/// @audit missing zero check for `_universalRouter`
24:     constructor(INonfungiblePositionManager _nonfungiblePositionManager, address _zeroxRouter, address _universalRouter)
            Swapper(_nonfungiblePositionManager, _zeroxRouter, _universalRouter)
        {}

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L24)]


```solidity
File: src/utils/Swapper.sol

/// @audit missing zero check for `_nonfungiblePositionManager`
/// @audit missing zero check for `_zeroxRouter`
/// @audit missing zero check for `_universalRouter`
37:     constructor(
            INonfungiblePositionManager _nonfungiblePositionManager,
            address _zeroxRouter,
            address _universalRouter
        ) {

```
*Github:* [[37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L37)]



<a name="L-15"></a> 
### [L-15] Consider some checks for `address(0)` when setting address state variables
Check for zero-address to avoid the risk of setting `address(0)` for state variables after an update.

<details>
<summary>
There are <b>14</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit `_nonfungiblePositionManager`
79:         nonfungiblePositionManager = _nonfungiblePositionManager;

/// @audit `_referenceToken`
81:         referenceToken = _referenceToken;

/// @audit `_chainlinkReferenceToken`
83:         chainlinkReferenceToken = _chainlinkReferenceToken;

/// @audit `admin`
266:         emergencyAdmin = admin;

```
*Github:* [[79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L79), [81](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L81), [83](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L83), [266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L266)]


```solidity
File: src/V3Vault.sol

/// @audit `_asset`
178:         asset = _asset;

/// @audit `_nonfungiblePositionManager`
180:         nonfungiblePositionManager = _nonfungiblePositionManager;

/// @audit `_interestRateModel`
182:         interestRateModel = _interestRateModel;

/// @audit `_oracle`
183:         oracle = _oracle;

/// @audit `_permit2`
184:         permit2 = _permit2;

/// @audit `admin`
871:         emergencyAdmin = admin;

```
*Github:* [[178](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L178), [180](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L180), [182](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L182), [183](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L183), [184](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L184), [871](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L871)]


```solidity
File: src/automators/Automator.sol

/// @audit `_withdrawer`
61:         withdrawer = _withdrawer;

```
*Github:* [[61](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L61)]


```solidity
File: src/utils/Swapper.sol

/// @audit `_nonfungiblePositionManager`
44:         nonfungiblePositionManager = _nonfungiblePositionManager;

/// @audit `_zeroxRouter`
45:         zeroxRouter = _zeroxRouter;

/// @audit `_universalRouter`
46:         universalRouter = _universalRouter;

```
*Github:* [[44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L44), [45](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L45), [46](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L46)]


</details>


<a name="L-16"></a> 
### [L-16] Multiplication on the result of a division
Dividing an integer by another integer will often result in loss of precision. When the result is multiplied by another number, the loss of precision is magnified, often to material magnitudes. `(X / Z) * Y` should be re-written as `(X * Y) / Z`

*There are <b>2</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

120:         value = (price0X96 * (amount0 + fees0) / Q96 + price1X96 * (amount1 + fees1) / Q96) * Q96 / priceTokenX96;

121:         feeValue = (price0X96 * fees0 / Q96 + price1X96 * fees1 / Q96) * Q96 / priceTokenX96;

```
*Github:* [[120](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L120), [121](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L121)]



<a name="L-17"></a> 
### [L-17] Owner can renounce ownership
Each of the following contracts implements or inherits the `renounceOwnership()` function. This can represent a certain risk if the ownership is renounced for any other reason than by design. Renouncing ownership will leave the contract without an owner, thereby removing any functionality that is only available to the owner.

*There are <b>4</b> instances of this issue:*
```solidity
File: src/InterestRateModel.sol

11: contract InterestRateModel is Ownable, IInterestRateModel, IErrors {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L11)]


```solidity
File: src/V3Oracle.sol

24: contract V3Oracle is IV3Oracle, Ownable, IErrors {

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L24)]


```solidity
File: src/V3Vault.sol

30: contract V3Vault is ERC20, Multicall, Ownable, IVault, IERC721Receiver, IErrors {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L30)]


```solidity
File: src/automators/Automator.sol

19: abstract contract Automator is Swapper, Ownable {

```
*Github:* [[19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L19)]



<a name="L-18"></a> 
### [L-18] `receive()`/`fallback()` function does not authorize requests
Having no access control on the function (e.g. `require(msg.sender == address(weth))`) means that someone may send Ether to the contract, and have no way to get anything back out, which is a loss of funds. If the concern is having to spend a small amount of gas to check the sender against an immutable address, the code should at least have a function to rescue mistakenly-sent Ether.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/automators/Automator.sol

251:     receive() external payable {

```
*Github:* [[251](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L251)]


```solidity
File: src/transformers/V3Utils.sol

914:     receive() external payable {

```
*Github:* [[914](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L914)]



<a name="L-19"></a> 
### [L-19] Solidity version 0.8.20 or above may not work on other chains due to PUSH0
Solidity version 0.8.20 or above uses the new [Shanghai EVM](https://blog.soliditylang.org/2023/05/10/solidity-0.8.20-release-announcement/#important-note) which introduces the PUSH0 opcode. This op code may not yet be implemented on all evm-chains or Layer2s, so deployment on these chains will fail. Consider using an earlier solidity version.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L2)]


```solidity
File: src/V3Oracle.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L2)]


```solidity
File: src/V3Vault.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L2)]


```solidity
File: src/automators/AutoExit.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L2)]


```solidity
File: src/automators/Automator.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L2)]


```solidity
File: src/transformers/AutoCompound.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L2)]


```solidity
File: src/transformers/AutoRange.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L2)]


```solidity
File: src/transformers/LeverageTransformer.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L2)]


```solidity
File: src/transformers/V3Utils.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L2)]


```solidity
File: src/utils/FlashloanLiquidator.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L2)]


```solidity
File: src/utils/Swapper.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L2)]


</details>


<a name="L-20"></a> 
### [L-20] Some tokens may revert when large transfers are made
Tokens such as COMP or UNI will revert when an address' balance reaches `type(uint96).max`. Ensure that the calls below can be broken up into smaller batches if necessary.

<details>
<summary>
There are <b>23</b> instances (click to show):
</summary>

```solidity
File: src/V3Vault.sol

599:         SafeERC20.safeTransfer(IERC20(asset), isTransformMode ? msg.sender : owner, assets);

728:             SafeERC20.safeTransferFrom(IERC20(asset), msg.sender, address(this), state.liquidatorCost);

779:             SafeERC20.safeTransfer(IERC20(asset), receiver, amount);

901:             SafeERC20.safeTransferFrom(IERC20(asset), msg.sender, address(this), assets);

946:         SafeERC20.safeTransfer(IERC20(asset), receiver, assets);

986:                 SafeERC20.safeTransferFrom(IERC20(asset), msg.sender, address(this), assets);

```
*Github:* [[599](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L599), [728](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L728), [779](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L779), [901](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L901), [946](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L946), [986](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L986)]


```solidity
File: src/automators/Automator.sol

226:             SafeERC20.safeTransfer(token, to, amount);

```
*Github:* [[226](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L226)]


```solidity
File: src/transformers/AutoCompound.sol

272:         SafeERC20.safeTransfer(IERC20(token), to, amount);

```
*Github:* [[272](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L272)]


```solidity
File: src/transformers/LeverageTransformer.sol

88:             SafeERC20.safeTransfer(IERC20(token0), params.recipient, amount0 - added0);

91:             SafeERC20.safeTransfer(IERC20(token1), params.recipient, amount1 - added1);

94:             SafeERC20.safeTransfer(IERC20(token), params.recipient, amount);

170:             SafeERC20.safeTransfer(IERC20(token0), params.recipient, amount0);

173:             SafeERC20.safeTransfer(IERC20(token1), params.recipient, amount1);

```
*Github:* [[88](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L88), [91](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L91), [94](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L94), [170](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L170), [173](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L173)]


```solidity
File: src/transformers/V3Utils.sol

578:             SafeERC20.safeTransferFrom(token0, msg.sender, address(this), needed0);

581:             SafeERC20.safeTransferFrom(token1, msg.sender, address(this), needed1);

584:             SafeERC20.safeTransferFrom(otherToken, msg.sender, address(this), neededOther);

872:             SafeERC20.safeTransfer(token, to, amount);

```
*Github:* [[578](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L578), [581](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L581), [584](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L584), [872](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L872)]


```solidity
File: src/utils/FlashloanLiquidator.sol

85:         SafeERC20.safeTransfer(data.asset, msg.sender, data.liquidationCost + (fee0 + fee1));

91:                 SafeERC20.safeTransfer(data.swap0.tokenIn, data.liquidator, balance);

97:                 SafeERC20.safeTransfer(data.swap1.tokenIn, data.liquidator, balance);

106:                 SafeERC20.safeTransfer(data.asset, data.liquidator, balance);

```
*Github:* [[85](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L85), [91](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L91), [97](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L97), [106](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L106)]


```solidity
File: src/utils/Swapper.sol

98:                 SafeERC20.safeTransfer(params.tokenIn, universalRouter, params.amountIn);

167:         SafeERC20.safeTransfer(IERC20(tokenIn), msg.sender, amountToPay);

```
*Github:* [[98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L98), [167](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L167)]


</details>


<a name="L-21"></a> 
### [L-21] Some tokens may revert when zero value transfers are made
Despite the fact that [EIP-20 states](https://github.com/ethereum/EIPs/blob/7500ac4fc1bbdfaf684e7ef851f798f6b667b2fe/EIPS/eip-20.md?plain=1#L116) that zero-value transfers must be accepted, some tokens, such as LEND, will revert if this is attempted, which may cause transactions that involve other tokens (such as batch operations) to fully revert. Consider skipping the transfer if the amount is zero, which will also save gas.

<details>
<summary>
There are <b>23</b> instances (click to show):
</summary>

```solidity
File: src/V3Vault.sol

599:         SafeERC20.safeTransfer(IERC20(asset), isTransformMode ? msg.sender : owner, assets);

728:             SafeERC20.safeTransferFrom(IERC20(asset), msg.sender, address(this), state.liquidatorCost);

779:             SafeERC20.safeTransfer(IERC20(asset), receiver, amount);

901:             SafeERC20.safeTransferFrom(IERC20(asset), msg.sender, address(this), assets);

946:         SafeERC20.safeTransfer(IERC20(asset), receiver, assets);

986:                 SafeERC20.safeTransferFrom(IERC20(asset), msg.sender, address(this), assets);

```
*Github:* [[599](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L599), [728](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L728), [779](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L779), [901](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L901), [946](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L946), [986](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L986)]


```solidity
File: src/automators/Automator.sol

226:             SafeERC20.safeTransfer(token, to, amount);

```
*Github:* [[226](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L226)]


```solidity
File: src/transformers/AutoCompound.sol

272:         SafeERC20.safeTransfer(IERC20(token), to, amount);

```
*Github:* [[272](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L272)]


```solidity
File: src/transformers/LeverageTransformer.sol

88:             SafeERC20.safeTransfer(IERC20(token0), params.recipient, amount0 - added0);

91:             SafeERC20.safeTransfer(IERC20(token1), params.recipient, amount1 - added1);

94:             SafeERC20.safeTransfer(IERC20(token), params.recipient, amount);

170:             SafeERC20.safeTransfer(IERC20(token0), params.recipient, amount0);

173:             SafeERC20.safeTransfer(IERC20(token1), params.recipient, amount1);

```
*Github:* [[88](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L88), [91](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L91), [94](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L94), [170](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L170), [173](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L173)]


```solidity
File: src/transformers/V3Utils.sol

578:             SafeERC20.safeTransferFrom(token0, msg.sender, address(this), needed0);

581:             SafeERC20.safeTransferFrom(token1, msg.sender, address(this), needed1);

584:             SafeERC20.safeTransferFrom(otherToken, msg.sender, address(this), neededOther);

872:             SafeERC20.safeTransfer(token, to, amount);

```
*Github:* [[578](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L578), [581](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L581), [584](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L584), [872](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L872)]


```solidity
File: src/utils/FlashloanLiquidator.sol

85:         SafeERC20.safeTransfer(data.asset, msg.sender, data.liquidationCost + (fee0 + fee1));

91:                 SafeERC20.safeTransfer(data.swap0.tokenIn, data.liquidator, balance);

97:                 SafeERC20.safeTransfer(data.swap1.tokenIn, data.liquidator, balance);

106:                 SafeERC20.safeTransfer(data.asset, data.liquidator, balance);

```
*Github:* [[85](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L85), [91](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L91), [97](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L97), [106](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L106)]


```solidity
File: src/utils/Swapper.sol

98:                 SafeERC20.safeTransfer(params.tokenIn, universalRouter, params.amountIn);

167:         SafeERC20.safeTransfer(IERC20(tokenIn), msg.sender, amountToPay);

```
*Github:* [[98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L98), [167](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L167)]


</details>


<a name="L-22"></a> 
### [L-22] Sending tokens in a for loop
Performing token transfers in a loop in a Solidity contract is generally not recommended due to various reasons. One of these reasons is the "Fail-Silently" issue.

In a Solidity loop, if one transfer operation fails, it causes the entire transaction to fail. This issue can be particularly troublesome when you're dealing with multiple transfers in one transaction. For instance, if you're looping through an array of recipients to distribute dividends or rewards, a single failed transfer will prevent all the subsequent recipients from receiving their transfers. This could be due to the recipient contract throwing an exception or due to other issues like a gas limit being exceeded.

Moreover, such a design could also inadvertently lead to a situation where a malicious contract intentionally causes a failure when receiving Ether to prevent other participants from getting their rightful transfers. This could open up avenues for griefing attacks in the system.

Resolution: To mitigate this problem, it's typically recommended to follow the "withdraw pattern" in your contracts instead of pushing payments. In this model, each recipient would be responsible for triggering their own payment. This separates each transfer operation, so a failure in one doesn't impact the others. Additionally, it greatly reduces the chance of malicious interference as the control over fund withdrawal lies with the intended recipient and not with an external loop operation.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/automators/Automator.sol

/// @audit `_transferToken`
111:         for (; i < count; ++i) {
                 uint256 balance = IERC20(tokens[i]).balanceOf(address(this));
                 if (balance > 0) {
                     _transferToken(to, IERC20(tokens[i]), balance, true);

```
*Github:* [[111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L111)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit `_withdrawBalanceInternal`
233:         for (; i < count; ++i) {
                 uint256 balance = positionBalances[0][tokens[i]];
                 _withdrawBalanceInternal(0, tokens[i], to, balance, balance);

```
*Github:* [[233](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L233)]



<a name="L-23"></a> 
### [L-23] Tokens may be minted to `address(0)`

*There are <b>2</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

366:     function mint(uint256 shares, address receiver) external override returns (uint256) {
             (uint256 assets,) = _deposit(receiver, shares, true, "");
             return assets;
         }

366:     function mint(uint256 shares, address receiver) external override returns (uint256) {
             (uint256 assets,) = _deposit(receiver, shares, true, "");
             return assets;
         }

```
*Github:* [[366](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L366), [366](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L366)]



<a name="L-24"></a> 
### [L-24] Unsafe downcast
When a type is downcast to a smaller type, the higher order bits are truncated, effectively applying a modulo to the original value. Without any other checks, this wrapping will lead to unexpected behavior and bugs.

<details>
<summary>
There are <b>14</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit int56 -> int24
369:             int24 tick = int24((tickCumulatives[0] - tickCumulatives[1]) / int56(uint56(twapSeconds)));

/// @audit uint256 -> uint128
467:         fees0 = uint128(FullMath.mulDiv(feeGrowth0, position.liquidity, Q128));

/// @audit uint256 -> uint128
468:         fees1 = uint128(FullMath.mulDiv(feeGrowth1, position.liquidity, Q128));

```
*Github:* [[369](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L369), [467](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L467), [468](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L468)]


```solidity
File: src/V3Vault.sol

/// @audit uint256 -> uint32
36:     uint32 public constant MAX_COLLATERAL_FACTOR_X32 = uint32(Q32 * 90 / 100); // 90%

/// @audit uint256 -> uint32
38:     uint32 public constant MIN_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 2 / 100); // 2%

/// @audit uint256 -> uint32
39:     uint32 public constant MAX_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 10 / 100); // 10%

/// @audit uint256 -> uint32
41:     uint32 public constant MIN_RESERVE_PROTECTION_FACTOR_X32 = uint32(Q32 / 100); //1%

/// @audit uint256 -> uint32
43:     uint32 public constant MAX_DAILY_LEND_INCREASE_X32 = uint32(Q32 / 10); //10%

/// @audit uint256 -> uint32
44:     uint32 public constant MAX_DAILY_DEBT_INCREASE_X32 = uint32(Q32 / 10); //10%

/// @audit uint256 -> uint128
1054:                 fees0 = uint128(liquidationValue * fees0 / feeValue);

/// @audit uint256 -> uint128
1055:                 fees1 = uint128(liquidationValue * fees1 / feeValue);

/// @audit uint256 -> uint128
1060:                 liquidity = uint128((liquidationValue - feeValue) * liquidity / (fullValue - feeValue));

```
*Github:* [[36](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L36), [38](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L38), [39](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L39), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L41), [43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L43), [44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L44), [1054](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1054), [1055](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1055), [1060](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1060)]


```solidity
File: src/automators/Automator.sol

/// @audit int56 -> int24
187:             return (int24((tickCumulatives[0] - tickCumulatives[1]) / int56(uint56(twapPeriod))), true);

```
*Github:* [[187](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L187)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit uint256 -> uint64
47:     uint64 public constant MAX_REWARD_X64 = uint64(Q64 / 50); // 2%

```
*Github:* [[47](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L47)]


</details>


<a name="L-25"></a> 
### [L-25] Use Ownable2Step instead of Ownable
`Ownable2Step` and `Ownable2StepUpgradeable` prevent the contract ownership from mistakenly being transferred to an address that cannot handle it (e.g. due to a typo in the address), by requiring that the recipient of the owner permissions actively accept via a contract call of its own.

*There are <b>4</b> instances of this issue:*
```solidity
File: src/InterestRateModel.sol

11: contract InterestRateModel is Ownable, IInterestRateModel, IErrors {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L11)]


```solidity
File: src/V3Oracle.sol

24: contract V3Oracle is IV3Oracle, Ownable, IErrors {

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L24)]


```solidity
File: src/V3Vault.sol

30: contract V3Vault is ERC20, Multicall, Ownable, IVault, IERC721Receiver, IErrors {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L30)]


```solidity
File: src/automators/Automator.sol

19: abstract contract Automator is Swapper, Ownable {

```
*Github:* [[19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L19)]



<a name="L-26"></a> 
### [L-26] Using zero as a parameter
Taking `0` as a valid argument in Solidity without checks can lead to severe security issues. A historical example is the infamous `0x0` address bug where numerous tokens were lost. This happens because 0 can be interpreted as an uninitialized `address`, leading to transfers to the 0x0 address, effectively burning tokens. Moreover, `0` as a denominator in division operations would cause a runtime exception. It's also often indicative of a logical error in the caller's code. It's important to always validate input and handle edge cases like `0` appropriately. Use `require()` statements to enforce conditions and provide clear error messages to facilitate debugging and safer code.

<details>
<summary>
There are <b>29</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

135:         uint256 priceX96 = _getReferencePoolPriceX96(pool, 0);

235:             config = TokenConfig(

236:                 feed, maxFeedAge, feedDecimals, tokenDecimals, IUniswapV3Pool(address(0)), false, 0, Mode.CHAINLINK, 0

```
*Github:* [[135](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L135), [235](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L235), [236](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L236)]


```solidity
File: src/V3Vault.sol

446:             loans[tokenId] = Loan(0);

449:             emit Add(tokenId, owner, 0);

470:                 _updateAndCheckCollateral(

1081:         _updateAndCheckCollateral(tokenId, debtExchangeRateX96, lendExchangeRateX96, loans[tokenId].debtShares, 0);

```
*Github:* [[446](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L446), [449](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L449), [470](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L470), [1081](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1081)]


```solidity
File: src/automators/AutoExit.sol

208:         emit PositionConfigured(params.tokenId, false, false, false, 0, 0, 0, 0, false, 0);

```
*Github:* [[208](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L208)]


```solidity
File: src/transformers/AutoCompound.sol

179:             _increaseBalance(0, state.token0, state.amount0Fees);

180:             _increaseBalance(0, state.token1, state.amount1Fees);

235:             _withdrawBalanceInternal(0, tokens[i], to, balance, balance);

```
*Github:* [[179](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L179), [180](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L180), [235](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L235)]


```solidity
File: src/transformers/AutoRange.sol

266:             emit PositionConfigured(params.tokenId, 0, 0, 0, 0, 0, 0, false, 0);

```
*Github:* [[266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L266)]


```solidity
File: src/transformers/V3Utils.sol

149:                     SwapAndIncreaseLiquidityParams(

172:                     SwapAndIncreaseLiquidityParams(

196:                     SwapAndIncreaseLiquidityParams(

202:                         IERC20(address(0)),

222:                     SwapAndMintParams(

249:                     SwapAndMintParams(

277:                     SwapAndMintParams(

288:                         IERC20(address(0)),

405:             _prepareAddPermit2(

406:                 params.tokenIn, IERC20(address(0)), IERC20(address(0)), params.amountIn, 0, 0, pbtf, signature

406:                 params.tokenIn, IERC20(address(0)), IERC20(address(0)), params.amountIn, 0, 0, pbtf, signature

409:             _prepareAddApproved(params.tokenIn, IERC20(address(0)), IERC20(address(0)), params.amountIn, 0, 0);

409:             _prepareAddApproved(params.tokenIn, IERC20(address(0)), IERC20(address(0)), params.amountIn, 0, 0);

409:             _prepareAddApproved(params.tokenIn, IERC20(address(0)), IERC20(address(0)), params.amountIn, 0, 0);

740:             SwapAndMintParams(

```
*Github:* [[149](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L149), [172](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L172), [196](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L196), [202](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L202), [222](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L222), [249](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L249), [277](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L277), [288](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L288), [405](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L405), [406](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L406), [406](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L406), [409](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L409), [409](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L409), [409](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L409), [740](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L740)]


```solidity
File: src/utils/FlashloanLiquidator.sol

58:                 RouterSwapParams(IERC20(token0), IERC20(asset), params.amount0In, 0, params.swapData0),

59:                 RouterSwapParams(IERC20(token1), IERC20(asset), params.amount1In, 0, params.swapData1),

```
*Github:* [[58](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L58), [59](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L59)]


</details>


<a name="L-27"></a> 
### [L-27] Vulnerable version of OZ contarcts is used (`4.8.1`)
The project is using a vulnerable version.
See the list of OZ vulnerabilities [here](https://security.snyk.io/package/npm/@openzeppelin%2Fcontracts).

*There is one instance of this issue:*
```solidity

Global finding

```
*Github:* [[Global](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/)]



<a name="L-28"></a> 
### [L-28] Centralization Risk for trusted owners
Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

<details>
<summary>
There are <b>15</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

82:     function setValues(
            uint256 baseRatePerYearX96,
            uint256 multiplierPerYearX96,
            uint256 jumpMultiplierPerYearX96,
            uint256 _kinkX96
        ) public onlyOwner {

```
*Github:* [[82](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L82)]


```solidity
File: src/V3Oracle.sol

185:     function setMaxPoolPriceDifference(uint16 _maxPoolPriceDifference) external onlyOwner {

201:     function setTokenConfig(
             address token,
             AggregatorV3Interface feed,
             uint32 maxFeedAge,
             IUniswapV3Pool pool,
             uint32 twapSeconds,
             Mode mode,
             uint16 maxDifference
         ) external onlyOwner {

265:     function setEmergencyAdmin(address admin) external onlyOwner {

```
*Github:* [[185](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L185), [201](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L201), [265](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L265)]


```solidity
File: src/V3Vault.sol

765:     function withdrawReserves(uint256 amount, address receiver) external onlyOwner {

788:     function setTransformer(address transformer, bool active) external onlyOwner {

837:     function setReserveFactor(uint32 _reserveFactorX32) external onlyOwner {

844:     function setReserveProtectionFactor(uint32 _reserveProtectionFactorX32) external onlyOwner {

856:     function setTokenConfig(address token, uint32 collateralFactorX32, uint32 collateralValueLimitFactorX32)
             external
             onlyOwner

870:     function setEmergencyAdmin(address admin) external onlyOwner {

```
*Github:* [[765](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L765), [788](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L788), [837](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L837), [844](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L844), [856](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L856), [870](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L870)]


```solidity
File: src/automators/Automator.sol

59:     function setWithdrawer(address _withdrawer) public onlyOwner {

69:     function setOperator(address _operator, bool _active) public onlyOwner {

79:     function setVault(address _vault, bool _active) public onlyOwner {

87:     function setTWAPConfig(uint16 _maxTWAPTickDifference, uint32 _TWAPSeconds) public onlyOwner {

```
*Github:* [[59](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L59), [69](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L69), [79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L79), [87](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L87)]


```solidity
File: src/transformers/AutoCompound.sol

243:     function setReward(uint64 _totalRewardX64) external onlyOwner {

```
*Github:* [[243](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L243)]


</details>


<a name="L-29"></a> 
### [L-29] `decimals()` is not a part of the ERC-20 standard
The `decimals()` function is not a part of the ERC-20 standard, and was added later as an optional extension. As such, some valid ERC20 tokens do not support this interface, so it is unsafe to blindly cast all tokens to this interface, and then call this function.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

82:         referenceTokenDecimals = IERC20Metadata(_referenceToken).decimals();

216:         uint8 tokenDecimals = IERC20Metadata(token).decimals();

```
*Github:* [[82](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L82), [216](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L216)]


```solidity
File: src/V3Vault.sol

179:         assetDecimals = IERC20Metadata(_asset).decimals();

```
*Github:* [[179](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L179)]



<a name="L-30"></a> 
### [L-30] `safeApprove()` is deprecated
[Deprecated](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/bfff03c0d2a59bcd8e2ead1da9aed9edf0080d05/contracts/token/ERC20/utils/SafeERC20.sol#L38-L45) in favor of `safeIncreaseAllowance()` and `safeDecreaseAllowance()`. If only setting the initial allowance to the value that means infinite, `safeIncreaseAllowance()` can be used instead. The function may currently work, but if a bug is found in this version of OpenZeppelin, and the version that you're forced to upgrade to no longer has this function, you'll encounter unnecessary delays in porting and testing replacement contracts.

<details>
<summary>
There are <b>15</b> instances (click to show):
</summary>

```solidity
File: src/transformers/AutoCompound.sol

280:             SafeERC20.safeApprove(IERC20(token0), address(nonfungiblePositionManager), type(uint256).max);

284:             SafeERC20.safeApprove(IERC20(token1), address(nonfungiblePositionManager), type(uint256).max);

```
*Github:* [[280](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L280), [284](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L284)]


```solidity
File: src/transformers/AutoRange.sol

213:             SafeERC20.safeApprove(IERC20(state.token0), address(nonfungiblePositionManager), state.maxAddAmount0);

214:             SafeERC20.safeApprove(IERC20(state.token1), address(nonfungiblePositionManager), state.maxAddAmount1);

220:             SafeERC20.safeApprove(IERC20(state.token0), address(nonfungiblePositionManager), 0);

221:             SafeERC20.safeApprove(IERC20(state.token1), address(nonfungiblePositionManager), 0);

```
*Github:* [[213](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L213), [214](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L214), [220](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L220), [221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L221)]


```solidity
File: src/transformers/LeverageTransformer.sol

165:         SafeERC20.safeApprove(IERC20(token), msg.sender, amount);

```
*Github:* [[165](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L165)]


```solidity
File: src/transformers/V3Utils.sol

831:             SafeERC20.safeApprove(params.token0, address(nonfungiblePositionManager), 0);

832:             SafeERC20.safeApprove(params.token0, address(nonfungiblePositionManager), total0);

835:             SafeERC20.safeApprove(params.token1, address(nonfungiblePositionManager), 0);

836:             SafeERC20.safeApprove(params.token1, address(nonfungiblePositionManager), total1);

```
*Github:* [[831](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L831), [832](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L832), [835](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L835), [836](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L836)]


```solidity
File: src/utils/FlashloanLiquidator.sol

72:         SafeERC20.safeApprove(data.asset, address(data.vault), data.liquidationCost);

78:         SafeERC20.safeApprove(data.asset, address(data.vault), 0);

```
*Github:* [[72](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L72), [78](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L78)]


```solidity
File: src/utils/Swapper.sol

87:                 SafeERC20.safeApprove(params.tokenIn, data.allowanceTarget, params.amountIn);

94:                 SafeERC20.safeApprove(params.tokenIn, data.allowanceTarget, 0);

```
*Github:* [[87](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L87), [94](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L94)]


</details>


<a name="L-31"></a> 
### [L-31] Chainlink answer is not compared against min/max values
Some check like this can be added to avoid returning of the min price or the max price in case of the price crashes:
```solidity
	require(answer < _maxPrice, "Upper price bound breached");
	require(answer > _minPrice, "Lower price bound breached");
```

*There is one instance of this issue:*
```solidity
File: src/V3Oracle.sol

337:         (, int256 answer,, uint256 updatedAt,) = feedConfig.feed.latestRoundData();

```
*Github:* [[337](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L337)]



<a name="L-32"></a> 
### [L-32] No limits when setting price values
When setting price values without defined upper or lower bounds, it can lead to unpredictable behavior or potential vulnerabilities. For instance, overly high or low prices could be set maliciously or accidentally, disrupting platform functionality or enabling manipulative profit schemes. It's crucial to enforce constraints on price values to ensure they remain within a reasonable range. As a solution, implement checks to cap the minimum and maximum permissible price values. Additionally, consider implementing a governance mechanism or multi-signature approval process for significant price adjustments, ensuring an added layer of security and oversight.

*There is one instance of this issue:*
```solidity
File: src/V3Oracle.sol

185:     function setMaxPoolPriceDifference(uint16 _maxPoolPriceDifference) external onlyOwner {
             if (_maxPoolPriceDifference < MIN_PRICE_DIFFERENCE) {
                 revert InvalidConfig();
             }
             maxPoolPriceDifference = _maxPoolPriceDifference;
             emit SetMaxPoolPriceDifference(_maxPoolPriceDifference);

```
*Github:* [[185](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L185)]



<a name="L-33"></a> 
### [L-33] The call `abi.encodeWithSelector` is not type safe
In Solidity, `abi.encodeWithSelector` is a function used for encoding data along with a function selector, but it is not type-safe. This means it does not enforce type checking at compile time, potentially leading to errors if arguments do not match the expected types. Starting from version 0.8.13, Solidity introduced `abi.encodeCall`, which offers a safer alternative. `abi.encodeCall` ensures type safety by performing a full type check, aligning the types of the arguments with the function signature. This reduces the risk of bugs caused by typographical errors or mismatched types. Using `abi.encodeCall` enhances the reliability and security of the code by ensuring that the encoded data strictly conforms to the specified types, making it a preferable choice in Solidity versions 0.8.13 and above.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/transformers/AutoCompound.sol

92:             params.tokenId, address(this), abi.encodeWithSelector(AutoCompound.execute.selector, params)

```
*Github:* [[92](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L92)]


```solidity
File: src/transformers/AutoRange.sol

102:             params.tokenId, address(this), abi.encodeWithSelector(AutoRange.execute.selector, params)

```
*Github:* [[102](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L102)]




## Non Critical Issues

<a name="NC-1"></a> 
### [NC-1] Add inline comments for unnamed variables
`function foo(address x, address)` -> `function foo(address x, address /* y */)`

*There are <b>4</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

301:     function maxDeposit(address) external view override returns (uint256) {

312:     function maxMint(address) external view override returns (uint256) {

429:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)
             external
             override
             returns (bytes4)
         {

```
*Github:* [[301](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L301), [312](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L312), [429](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L429)]


```solidity
File: src/transformers/V3Utils.sol

356:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)
             external
             override
             returns (bytes4)
         {

```
*Github:* [[356](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L356)]



<a name="NC-2"></a> 
### [NC-2] Avoid mutating function parameters
Function parameters in Solidity are passed by value, meaning they are essentially local copies. Mutating them can lead to confusion and errors because the changes don't persist outside the function. By keeping function parameters immutable, you ensure clarity in code behavior, preventing unintended side-effects. If you need to modify a value based on a parameter, use a local variable inside the function, leaving the original parameter unaltered. By adhering to this practice, you maintain a clear distinction between input data and the internal processing logic, improving code readability and reducing the potential for bugs.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

/// @audit `tokenId`
497:     function transform(uint256 tokenId, address transformer, bytes calldata data)
             external
             override
             returns (uint256 newTokenId)
         {
             if (tokenId == 0 || !transformerAllowList[transformer]) {
                 revert TransformNotAllowed();
             }
             if (transformedTokenId > 0) {
                 revert Reentrancy();
             }
             transformedTokenId = tokenId;
     
             (uint256 newDebtExchangeRateX96,) = _updateGlobalInterest();
     
             address loanOwner = tokenOwner[tokenId];
     
             // only the owner of the loan, the vault itself or any approved caller can call this
             if (loanOwner != msg.sender && !transformApprovals[loanOwner][tokenId][msg.sender]) {
                 revert Unauthorized();
             }
     
             // give access to transformer
             nonfungiblePositionManager.approve(transformer, tokenId);
     
             (bool success,) = transformer.call(data);
             if (!success) {
                 revert TransformFailed();
             }
     
             // may have changed in the meantime
             tokenId = transformedTokenId;

/// @audit `newLendExchangeRateX96`
1123:     function _handleReserveLiquidation(
              uint256 reserveCost,
              uint256 newDebtExchangeRateX96,
              uint256 newLendExchangeRateX96
          ) internal returns (uint256 missing) {
              (,, uint256 reserves) = _getAvailableBalance(newDebtExchangeRateX96, newLendExchangeRateX96);
      
              // if not enough - democratize debt
              if (reserveCost > reserves) {
                  missing = reserveCost - reserves;
      
                  uint256 totalLent = _convertToAssets(totalSupply(), newLendExchangeRateX96, Math.Rounding.Up);
      
                  // this lines distribute missing amount and remove it from all lent amount proportionally
                  newLendExchangeRateX96 = (totalLent - missing) * newLendExchangeRateX96 / totalLent;

```
*Github:* [[497](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L497), [1123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1123)]



<a name="NC-3"></a> 
### [NC-3] Avoid the use of sensitive terms
Use [alternative variants](https://www.zdnet.com/article/mysql-drops-master-slave-and-blacklist-whitelist-terminology/), e.g. allowlist/denylist instead of whitelist/blacklist

*There is one instance of this issue:*
```solidity
File: src/V3Vault.sol

494:     /// @param transformer The address of a whitelisted transformer contract

```
*Github:* [[494](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L494)]



<a name="NC-4"></a> 
### [NC-4] Multiple `address`/ID mappings can be combined into a single `mapping` of an `address`/ID to a `struct`, for readability
Well-organized data structures make code reviews easier, which may lead to fewer bugs. Consider combining related mappings into mappings to structs, so it's clear what data is related

*There are <b>2</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

164:     mapping(address => mapping(uint256 => mapping(address => bool))) public transformApprovals; // owners permissions for other addresses to call transform on owners behalf (e.g. AutoRange contract)

```
*Github:* [[164](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L164)]


```solidity
File: src/transformers/AutoCompound.sol

45:     mapping(uint256 => mapping(address => uint256)) public positionBalances;

```
*Github:* [[45](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L45)]



<a name="NC-5"></a> 
### [NC-5] Complex casting
Consider whether the number of casts is really necessary, or whether using a different type would be more appropriate. Alternatively, add comments to explain in detail why the casts are necessary, and any implicit reasons why the cast does not introduce an overflow.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

369:             int24 tick = int24((tickCumulatives[0] - tickCumulatives[1]) / int56(uint56(twapSeconds)));

```
*Github:* [[369](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L369)]


```solidity
File: src/automators/Automator.sol

187:             return (int24((tickCumulatives[0] - tickCumulatives[1]) / int56(uint56(twapPeriod))), true);

```
*Github:* [[187](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L187)]



<a name="NC-6"></a> 
### [NC-6] Consider adding a block/deny-list
Doing so will significantly increase centralization, but will help to prevent hackers from using stolen tokens.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

11: contract InterestRateModel is Ownable, IInterestRateModel, IErrors {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L11)]


```solidity
File: src/V3Oracle.sol

24: contract V3Oracle is IV3Oracle, Ownable, IErrors {

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L24)]


```solidity
File: src/V3Vault.sol

30: contract V3Vault is ERC20, Multicall, Ownable, IVault, IERC721Receiver, IErrors {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L30)]


```solidity
File: src/automators/AutoExit.sol

10: contract AutoExit is Automator {

```
*Github:* [[10](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L10)]


```solidity
File: src/automators/Automator.sol

19: abstract contract Automator is Swapper, Ownable {

```
*Github:* [[19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L19)]


```solidity
File: src/transformers/AutoCompound.sol

16: contract AutoCompound is Automator, Multicall, ReentrancyGuard {

```
*Github:* [[16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L16)]


```solidity
File: src/transformers/AutoRange.sol

11: contract AutoRange is Automator {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L11)]


```solidity
File: src/transformers/LeverageTransformer.sol

12: contract LeverageTransformer is Swapper {

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L12)]


```solidity
File: src/transformers/V3Utils.sol

15: contract V3Utils is Swapper, IERC721Receiver {

```
*Github:* [[15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L15)]


```solidity
File: src/utils/FlashloanLiquidator.sol

11: contract FlashloanLiquidator is Swapper, IUniswapV3FlashCallback {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L11)]


```solidity
File: src/utils/Swapper.sol

17: abstract contract Swapper is IUniswapV3SwapCallback, IErrors {

```
*Github:* [[17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L17)]


</details>


<a name="NC-7"></a> 
### [NC-7] Consider adding emergency-stop functionality
Consider adding `Pausable` to the following contracts so it's possible to stop them in case of an emergency.

*There are <b>9</b> instances of this issue:*
```solidity
File: src/InterestRateModel.sol

11: contract InterestRateModel is Ownable, IInterestRateModel, IErrors {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L11)]


```solidity
File: src/V3Oracle.sol

24: contract V3Oracle is IV3Oracle, Ownable, IErrors {

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L24)]


```solidity
File: src/V3Vault.sol

30: contract V3Vault is ERC20, Multicall, Ownable, IVault, IERC721Receiver, IErrors {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L30)]


```solidity
File: src/automators/AutoExit.sol

10: contract AutoExit is Automator {

```
*Github:* [[10](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L10)]


```solidity
File: src/transformers/AutoCompound.sol

16: contract AutoCompound is Automator, Multicall, ReentrancyGuard {

```
*Github:* [[16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L16)]


```solidity
File: src/transformers/AutoRange.sol

11: contract AutoRange is Automator {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L11)]


```solidity
File: src/transformers/LeverageTransformer.sol

12: contract LeverageTransformer is Swapper {

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L12)]


```solidity
File: src/transformers/V3Utils.sol

15: contract V3Utils is Swapper, IERC721Receiver {

```
*Github:* [[15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L15)]


```solidity
File: src/utils/FlashloanLiquidator.sol

11: contract FlashloanLiquidator is Swapper, IUniswapV3FlashCallback {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L11)]



<a name="NC-8"></a> 
### [NC-8] Consider adding formal verification proofs
Formal verification is the act of proving or disproving the correctness of intended algorithms underlying a system with respect to a certain formal specification/property/invariant, using formal methods of mathematics.

Some tools that are currently available to perform these tests on smart contracts are [SMTChecker](https://docs.soliditylang.org/en/latest/smtchecker.html) and [Certora Prover](https://www.certora.com/).

*There is one instance of this issue:*
```solidity

Global finding

```
*Github:* [[Global](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/)]



<a name="NC-9"></a> 
### [NC-9] Consider using descriptive `constant`s when passing zero as a function argument
Passing zero as a function argument can sometimes result in a security issue (e.g. passing zero as the slippage parameter). Consider using a `constant` variable with a descriptive name, so it's clear that the argument is intentionally being used, and for the right reasons.

<details>
<summary>
There are <b>17</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

135:         uint256 priceX96 = _getReferencePoolPriceX96(pool, 0);

```
*Github:* [[135](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L135)]


```solidity
File: src/V3Vault.sol

449:             emit Add(tokenId, owner, 0);

470:                 _updateAndCheckCollateral(
                         tokenId, debtExchangeRateX96, lendExchangeRateX96, 0, loans[tokenId].debtShares

1081:         _updateAndCheckCollateral(tokenId, debtExchangeRateX96, lendExchangeRateX96, loans[tokenId].debtShares, 0);

```
*Github:* [[449](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L449), [470](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L470), [1081](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1081)]


```solidity
File: src/automators/AutoExit.sol

208:         emit PositionConfigured(params.tokenId, false, false, false, 0, 0, 0, 0, false, 0);

```
*Github:* [[208](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L208)]


```solidity
File: src/transformers/AutoCompound.sol

179:             _increaseBalance(0, state.token0, state.amount0Fees);

180:             _increaseBalance(0, state.token1, state.amount1Fees);

235:             _withdrawBalanceInternal(0, tokens[i], to, balance, balance);

```
*Github:* [[179](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L179), [180](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L180), [235](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L235)]


```solidity
File: src/transformers/AutoRange.sol

220:             SafeERC20.safeApprove(IERC20(state.token0), address(nonfungiblePositionManager), 0);

221:             SafeERC20.safeApprove(IERC20(state.token1), address(nonfungiblePositionManager), 0);

266:             emit PositionConfigured(params.tokenId, 0, 0, 0, 0, 0, 0, false, 0);

```
*Github:* [[220](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L220), [221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L221), [266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L266)]


```solidity
File: src/transformers/V3Utils.sol

405:             _prepareAddPermit2(
                     params.tokenIn, IERC20(address(0)), IERC20(address(0)), params.amountIn, 0, 0, pbtf, signature

409:             _prepareAddApproved(params.tokenIn, IERC20(address(0)), IERC20(address(0)), params.amountIn, 0, 0);

831:             SafeERC20.safeApprove(params.token0, address(nonfungiblePositionManager), 0);

835:             SafeERC20.safeApprove(params.token1, address(nonfungiblePositionManager), 0);

```
*Github:* [[405](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L405), [409](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L409), [831](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L831), [835](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L835)]


```solidity
File: src/utils/FlashloanLiquidator.sol

78:         SafeERC20.safeApprove(data.asset, address(data.vault), 0);

```
*Github:* [[78](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L78)]


```solidity
File: src/utils/Swapper.sol

94:                 SafeERC20.safeApprove(params.tokenIn, data.allowanceTarget, 0);

```
*Github:* [[94](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L94)]


</details>


<a name="NC-10"></a> 
### [NC-10] Consider using SafeTransferLib.safeTransferETH() or Address.sendValue() for clearer semantic meaning
For improved code readability and better semantic understanding, it's recommended to use OpenZeppelin's SafeTransferLib.safeTransferETH() or Address.sendValue(). These functions explicitly describe their operation with their naming convention, increasing the comprehensibility of the code. Their usage over lower-level calls enhances the maintainability of your smart contract code by clearly indicating the purpose of the function.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/automators/Automator.sol

130:             (bool sent,) = to.call{value: balance}("");

221:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[130](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L130), [221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L221)]


```solidity
File: src/transformers/V3Utils.sol

867:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[867](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L867)]



<a name="NC-11"></a> 
### [NC-11] Constant redefined elsewhere
Consider defining in only one contract so that values cannot become out of sync when only one location is updated. A [cheap way](https://medium.com/coinmonks/gas-cost-of-solidity-library-functions-dbe0cedd4678) to store constants in a single location is to create an `internal constant` in a `library`. If the variable is a local cache of another contract's value, consider making the cache variable internal or private, which will require external users to query the contract with the source of truth, so that callers don't get out of sync.

*There is one instance of this issue:*
```solidity
File: src/V3Vault.sol

/// @audit also seen in src/V3Oracle.sol, src/InterestRateModel.sol, src/automators/Automator.sol
34:     uint256 private constant Q96 = 2 ** 96;

```
*Github:* [[34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L34)]



<a name="NC-12"></a> 
### [NC-12] Constants should be put on the left side of comparisons
Putting constants on the left side of comparison statements is a best practice known as [Yoda conditions](https://en.wikipedia.org/wiki/Yoda_conditions). Although solidity's static typing system prevents accidental assignments within conditionals, adopting this practice can improve code readability and consistency, especially when working across multiple languages.

<details>
<summary>
There are <b>27</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

47:         if (debt == 0) {

```
*Github:* [[47](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L47)]


```solidity
File: src/V3Oracle.sol

362:         if (twapSeconds == 0) {

```
*Github:* [[362](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L362)]


```solidity
File: src/V3Vault.sol

441:         if (transformedTokenId == 0) {

502:         if (tokenId == 0 || !transformerAllowList[transformer]) {

```
*Github:* [[441](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L441), [502](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L502)]


```solidity
File: src/automators/AutoExit.sol

124:         if (state.liquidity == 0) {

149:             if (params.swapData.length == 0) {

```
*Github:* [[124](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L124), [149](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L149)]


```solidity
File: src/automators/Automator.sol

236:         if (vault != address(0)) {

```
*Github:* [[236](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L236)]


```solidity
File: src/transformers/AutoCompound.sol

279:         if (allowance0 == 0) {

283:         if (allowance1 == 0) {

```
*Github:* [[279](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L279), [283](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L283)]


```solidity
File: src/transformers/AutoRange.sol

309:             if (spacing <= 0) {

```
*Github:* [[309](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L309)]


```solidity
File: src/transformers/V3Utils.sol

120:         if (instructions.liquidity != 0) {

342:             if (targetAmount != 0 && instructions.targetToken != address(0)) {

420:         if (amountOut != 0) {

426:         if (leftOver != 0) {

500:         (tokenId, liquidity, amount0, amount1) = _swapAndMint(params, msg.value != 0);

563:         (liquidity, amount0, amount1) = _swapAndIncrease(params, IERC20(token0), IERC20(token1), msg.value != 0);

666:         if (msg.value != 0) {

697:             amountOther > amountAddedOther && address(otherToken) != address(0) && token0 != otherToken

805:         } else if (address(params.swapSourceToken) != address(0)) {

822:             if (leftOver != 0) {

830:         if (total0 != 0) {

834:         if (total1 != 0) {

855:         if (left0 != 0) {

858:         if (left1 != 0) {

884:         if (liquidity != 0) {

```
*Github:* [[120](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L120), [342](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L342), [420](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L420), [426](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L426), [500](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L500), [563](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L563), [666](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L666), [697](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L697), [805](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L805), [822](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L822), [830](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L830), [834](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L834), [855](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L855), [858](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L858), [884](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L884)]


```solidity
File: src/utils/FlashloanLiquidator.sol

43:         if (liquidationCost == 0) {

```
*Github:* [[43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L43)]


```solidity
File: src/utils/Swapper.sol

77:         if (params.amountIn != 0 && params.swapData.length != 0 && address(params.tokenOut) != address(0)) {

```
*Github:* [[77](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L77)]


</details>


<a name="NC-13"></a> 
### [NC-13] `Constructor` should emit an event
Use events to signal significant changes to off-chain monitoring tools.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

33:     constructor(

```
*Github:* [[33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L33)]


```solidity
File: src/V3Oracle.sol

74:     constructor(

```
*Github:* [[74](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L74)]


```solidity
File: src/V3Vault.sol

169:     constructor(

```
*Github:* [[169](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L169)]


```solidity
File: src/automators/AutoExit.sol

33:     constructor(

```
*Github:* [[33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L33)]


```solidity
File: src/automators/Automator.sol

41:     constructor(

```
*Github:* [[41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L41)]


```solidity
File: src/transformers/AutoCompound.sol

37:     constructor(

```
*Github:* [[37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L37)]


```solidity
File: src/transformers/AutoRange.sol

25:     constructor(

```
*Github:* [[25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L25)]


```solidity
File: src/transformers/LeverageTransformer.sol

13:     constructor(INonfungiblePositionManager _nonfungiblePositionManager, address _zeroxRouter, address _universalRouter)

```
*Github:* [[13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L13)]


```solidity
File: src/transformers/V3Utils.sol

31:     constructor(

```
*Github:* [[31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L31)]


```solidity
File: src/utils/FlashloanLiquidator.sol

24:     constructor(INonfungiblePositionManager _nonfungiblePositionManager, address _zeroxRouter, address _universalRouter)

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L24)]


```solidity
File: src/utils/Swapper.sol

37:     constructor(

```
*Github:* [[37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L37)]


</details>


<a name="NC-14"></a> 
### [NC-14] Contract does not follow the Solidity Style Guide's suggested layout ordering
The [style guide](https://docs.soliditylang.org/en/v0.8.16/style-guide.html#order-of-layout) says that, within a contract, the ordering should be `1) Type declarations`, `2) State variables`, `3) Events`, `4) Modifiers`, and `5) Functions`, but the contract(s) below do not follow this ordering

<details>
<summary>
There are <b>78</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

/// @audit event/error `SetValues` came earlier
23:     uint256 public multiplierPerSecondX96;

/// @audit event/error `SetValues` came earlier
24:     uint256 public baseRatePerSecondX96;

/// @audit event/error `SetValues` came earlier
25:     uint256 public jumpMultiplierPerSecondX96;

/// @audit event/error `SetValues` came earlier
26:     uint256 public kinkX96;

```
*Github:* [[23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L23), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L24), [25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L25), [26](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L26)]


```solidity
File: src/V3Oracle.sol

/// @audit state variable `MIN_PRICE_DIFFERENCE` came earlier
/// @audit state variable `Q96` came earlier
/// @audit state variable `Q128` came earlier
/// @audit event/error `TokenConfigUpdated` came earlier
/// @audit event/error `OracleModeUpdated` came earlier
/// @audit event/error `SetMaxPoolPriceDifference` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
35:     enum Mode {

/// @audit state variable `MIN_PRICE_DIFFERENCE` came earlier
/// @audit state variable `Q96` came earlier
/// @audit state variable `Q128` came earlier
/// @audit event/error `TokenConfigUpdated` came earlier
/// @audit event/error `OracleModeUpdated` came earlier
/// @audit event/error `SetMaxPoolPriceDifference` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
43:     struct TokenConfig {

/// @audit event/error `TokenConfigUpdated` came earlier
/// @audit event/error `OracleModeUpdated` came earlier
/// @audit event/error `SetMaxPoolPriceDifference` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
56:     mapping(address => TokenConfig) public feedConfigs;

/// @audit event/error `TokenConfigUpdated` came earlier
/// @audit event/error `OracleModeUpdated` came earlier
/// @audit event/error `SetMaxPoolPriceDifference` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
58:     address public immutable factory;

/// @audit event/error `TokenConfigUpdated` came earlier
/// @audit event/error `OracleModeUpdated` came earlier
/// @audit event/error `SetMaxPoolPriceDifference` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
59:     INonfungiblePositionManager public immutable nonfungiblePositionManager;

/// @audit event/error `TokenConfigUpdated` came earlier
/// @audit event/error `OracleModeUpdated` came earlier
/// @audit event/error `SetMaxPoolPriceDifference` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
62:     address public immutable referenceToken;

/// @audit event/error `TokenConfigUpdated` came earlier
/// @audit event/error `OracleModeUpdated` came earlier
/// @audit event/error `SetMaxPoolPriceDifference` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
63:     uint8 public immutable referenceTokenDecimals;

/// @audit event/error `TokenConfigUpdated` came earlier
/// @audit event/error `OracleModeUpdated` came earlier
/// @audit event/error `SetMaxPoolPriceDifference` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
65:     uint16 public maxPoolPriceDifference = MIN_PRICE_DIFFERENCE; // max price difference between oracle derived price and pool price x10000

/// @audit event/error `TokenConfigUpdated` came earlier
/// @audit event/error `OracleModeUpdated` came earlier
/// @audit event/error `SetMaxPoolPriceDifference` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
68:     address public immutable chainlinkReferenceToken;

/// @audit event/error `TokenConfigUpdated` came earlier
/// @audit event/error `OracleModeUpdated` came earlier
/// @audit event/error `SetMaxPoolPriceDifference` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
71:     address public emergencyAdmin;

/// @audit state variable `MIN_PRICE_DIFFERENCE` came earlier
/// @audit state variable `Q96` came earlier
/// @audit state variable `Q128` came earlier
/// @audit state variable `feedConfigs` came earlier
/// @audit state variable `factory` came earlier
/// @audit state variable `nonfungiblePositionManager` came earlier
/// @audit state variable `referenceToken` came earlier
/// @audit state variable `referenceTokenDecimals` came earlier
/// @audit state variable `maxPoolPriceDifference` came earlier
/// @audit state variable `chainlinkReferenceToken` came earlier
/// @audit state variable `emergencyAdmin` came earlier
/// @audit event/error `TokenConfigUpdated` came earlier
/// @audit event/error `OracleModeUpdated` came earlier
/// @audit event/error `SetMaxPoolPriceDifference` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
/// @audit function `constructor` came earlier
/// @audit function `getValue` came earlier
/// @audit function `_checkPoolPrice` came earlier
/// @audit function `_requireMaxDifference` came earlier
/// @audit function `getPositionBreakdown` came earlier
/// @audit function `setMaxPoolPriceDifference` came earlier
/// @audit function `setTokenConfig` came earlier
/// @audit function `setOracleMode` came earlier
/// @audit function `setEmergencyAdmin` came earlier
/// @audit function `_getReferenceTokenPriceX96` came earlier
/// @audit function `_getChainlinkPriceX96` came earlier
/// @audit function `_getTWAPPriceX96` came earlier
/// @audit function `_getReferencePoolPriceX96` came earlier
376:     struct PositionState {

```
*Github:* [[35](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L35), [43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L43), [56](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L56), [58](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L58), [59](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L59), [62](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L62), [63](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L63), [65](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L65), [68](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L68), [71](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L71), [376](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L376)]


```solidity
File: src/V3Vault.sol

/// @audit state variable `Q32` came earlier
/// @audit state variable `Q96` came earlier
/// @audit state variable `MAX_COLLATERAL_FACTOR_X32` came earlier
/// @audit state variable `MIN_LIQUIDATION_PENALTY_X32` came earlier
/// @audit state variable `MAX_LIQUIDATION_PENALTY_X32` came earlier
/// @audit state variable `MIN_RESERVE_PROTECTION_FACTOR_X32` came earlier
/// @audit state variable `MAX_DAILY_LEND_INCREASE_X32` came earlier
/// @audit state variable `MAX_DAILY_DEBT_INCREASE_X32` came earlier
/// @audit state variable `nonfungiblePositionManager` came earlier
/// @audit state variable `factory` came earlier
/// @audit state variable `interestRateModel` came earlier
/// @audit state variable `oracle` came earlier
/// @audit state variable `permit2` came earlier
/// @audit state variable `asset` came earlier
/// @audit state variable `assetDecimals` came earlier
/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
109:     struct TokenConfig {

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
115:     mapping(address => TokenConfig) public tokenConfigs;

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
118:     uint32 public reserveFactorX32 = 0;

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
121:     uint32 public reserveProtectionFactorX32 = MIN_RESERVE_PROTECTION_FACTOR_X32;

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
124:     uint256 public debtSharesTotal = 0;

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
127:     uint256 public lastExchangeRateUpdate = 0;

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
128:     uint256 public lastDebtExchangeRateX96 = Q96;

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
129:     uint256 public lastLendExchangeRateX96 = Q96;

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
131:     uint256 public globalDebtLimit = 0;

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
132:     uint256 public globalLendLimit = 0;

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
135:     uint256 public minLoanSize = 0;

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
138:     uint256 public dailyLendIncreaseLimitMin = 0;

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
139:     uint256 public dailyLendIncreaseLimitLeft = 0;

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
140:     uint256 public dailyLendIncreaseLimitLastReset = 0;

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
143:     uint256 public dailyDebtIncreaseLimitMin = 0;

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
144:     uint256 public dailyDebtIncreaseLimitLeft = 0;

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
145:     uint256 public dailyDebtIncreaseLimitLastReset = 0;

/// @audit state variable `Q32` came earlier
/// @audit state variable `Q96` came earlier
/// @audit state variable `MAX_COLLATERAL_FACTOR_X32` came earlier
/// @audit state variable `MIN_LIQUIDATION_PENALTY_X32` came earlier
/// @audit state variable `MAX_LIQUIDATION_PENALTY_X32` came earlier
/// @audit state variable `MIN_RESERVE_PROTECTION_FACTOR_X32` came earlier
/// @audit state variable `MAX_DAILY_LEND_INCREASE_X32` came earlier
/// @audit state variable `MAX_DAILY_DEBT_INCREASE_X32` came earlier
/// @audit state variable `nonfungiblePositionManager` came earlier
/// @audit state variable `factory` came earlier
/// @audit state variable `interestRateModel` came earlier
/// @audit state variable `oracle` came earlier
/// @audit state variable `permit2` came earlier
/// @audit state variable `asset` came earlier
/// @audit state variable `assetDecimals` came earlier
/// @audit state variable `tokenConfigs` came earlier
/// @audit state variable `reserveFactorX32` came earlier
/// @audit state variable `reserveProtectionFactorX32` came earlier
/// @audit state variable `debtSharesTotal` came earlier
/// @audit state variable `lastExchangeRateUpdate` came earlier
/// @audit state variable `lastDebtExchangeRateX96` came earlier
/// @audit state variable `lastLendExchangeRateX96` came earlier
/// @audit state variable `globalDebtLimit` came earlier
/// @audit state variable `globalLendLimit` came earlier
/// @audit state variable `minLoanSize` came earlier
/// @audit state variable `dailyLendIncreaseLimitMin` came earlier
/// @audit state variable `dailyLendIncreaseLimitLeft` came earlier
/// @audit state variable `dailyLendIncreaseLimitLastReset` came earlier
/// @audit state variable `dailyDebtIncreaseLimitMin` came earlier
/// @audit state variable `dailyDebtIncreaseLimitLeft` came earlier
/// @audit state variable `dailyDebtIncreaseLimitLastReset` came earlier
/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
150:     struct Loan {

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
154:     mapping(uint256 => Loan) public loans; // tokenID -> loan mapping

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
157:     mapping(address => uint256[]) private ownedTokens; // Mapping from owner address to list of owned token IDs

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
158:     mapping(uint256 => uint256) private ownedTokensIndex; // Mapping from token ID to index of the owner tokens list (for removal without loop)

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
159:     mapping(uint256 => address) private tokenOwner; // Mapping from token ID to owner

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
161:     uint256 private transformedTokenId = 0; // transient storage (when available in dencun)

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
163:     mapping(address => bool) public transformerAllowList; // contracts allowed to transform positions (selected audited contracts e.g. V3Utils)

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
164:     mapping(address => mapping(uint256 => mapping(address => bool))) public transformApprovals; // owners permissions for other addresses to call transform on owners behalf (e.g. AutoRange contract)

/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
167:     address public emergencyAdmin;

/// @audit state variable `Q32` came earlier
/// @audit state variable `Q96` came earlier
/// @audit state variable `MAX_COLLATERAL_FACTOR_X32` came earlier
/// @audit state variable `MIN_LIQUIDATION_PENALTY_X32` came earlier
/// @audit state variable `MAX_LIQUIDATION_PENALTY_X32` came earlier
/// @audit state variable `MIN_RESERVE_PROTECTION_FACTOR_X32` came earlier
/// @audit state variable `MAX_DAILY_LEND_INCREASE_X32` came earlier
/// @audit state variable `MAX_DAILY_DEBT_INCREASE_X32` came earlier
/// @audit state variable `nonfungiblePositionManager` came earlier
/// @audit state variable `factory` came earlier
/// @audit state variable `interestRateModel` came earlier
/// @audit state variable `oracle` came earlier
/// @audit state variable `permit2` came earlier
/// @audit state variable `asset` came earlier
/// @audit state variable `assetDecimals` came earlier
/// @audit state variable `tokenConfigs` came earlier
/// @audit state variable `reserveFactorX32` came earlier
/// @audit state variable `reserveProtectionFactorX32` came earlier
/// @audit state variable `debtSharesTotal` came earlier
/// @audit state variable `lastExchangeRateUpdate` came earlier
/// @audit state variable `lastDebtExchangeRateX96` came earlier
/// @audit state variable `lastLendExchangeRateX96` came earlier
/// @audit state variable `globalDebtLimit` came earlier
/// @audit state variable `globalLendLimit` came earlier
/// @audit state variable `minLoanSize` came earlier
/// @audit state variable `dailyLendIncreaseLimitMin` came earlier
/// @audit state variable `dailyLendIncreaseLimitLeft` came earlier
/// @audit state variable `dailyLendIncreaseLimitLastReset` came earlier
/// @audit state variable `dailyDebtIncreaseLimitMin` came earlier
/// @audit state variable `dailyDebtIncreaseLimitLeft` came earlier
/// @audit state variable `dailyDebtIncreaseLimitLastReset` came earlier
/// @audit state variable `loans` came earlier
/// @audit state variable `ownedTokens` came earlier
/// @audit state variable `ownedTokensIndex` came earlier
/// @audit state variable `tokenOwner` came earlier
/// @audit state variable `transformedTokenId` came earlier
/// @audit state variable `transformerAllowList` came earlier
/// @audit state variable `transformApprovals` came earlier
/// @audit state variable `emergencyAdmin` came earlier
/// @audit event/error `ApprovedTransform` came earlier
/// @audit event/error `Add` came earlier
/// @audit event/error `Remove` came earlier
/// @audit event/error `ExchangeRateUpdate` came earlier
/// @audit event/error `WithdrawCollateral` came earlier
/// @audit event/error `Borrow` came earlier
/// @audit event/error `Repay` came earlier
/// @audit event/error `Liquidate` came earlier
/// @audit event/error `WithdrawReserves` came earlier
/// @audit event/error `SetTransformer` came earlier
/// @audit event/error `SetLimits` came earlier
/// @audit event/error `SetReserveFactor` came earlier
/// @audit event/error `SetReserveProtectionFactor` came earlier
/// @audit event/error `SetTokenConfig` came earlier
/// @audit event/error `SetEmergencyAdmin` came earlier
/// @audit function `constructor` came earlier
/// @audit function `vaultInfo` came earlier
/// @audit function `lendInfo` came earlier
/// @audit function `loanInfo` came earlier
/// @audit function `ownerOf` came earlier
/// @audit function `loanCount` came earlier
/// @audit function `loanAtIndex` came earlier
/// @audit function `decimals` came earlier
/// @audit function `totalAssets` came earlier
/// @audit function `convertToShares` came earlier
/// @audit function `convertToAssets` came earlier
/// @audit function `maxDeposit` came earlier
/// @audit function `maxMint` came earlier
/// @audit function `maxWithdraw` came earlier
/// @audit function `maxRedeem` came earlier
/// @audit function `previewDeposit` came earlier
/// @audit function `previewMint` came earlier
/// @audit function `previewWithdraw` came earlier
/// @audit function `previewRedeem` came earlier
/// @audit function `deposit` came earlier
/// @audit function `mint` came earlier
/// @audit function `withdraw` came earlier
/// @audit function `redeem` came earlier
/// @audit function `deposit` came earlier
/// @audit function `mint` came earlier
/// @audit function `create` came earlier
/// @audit function `createWithPermit` came earlier
/// @audit function `onERC721Received` came earlier
/// @audit function `approveTransform` came earlier
/// @audit function `transform` came earlier
/// @audit function `borrow` came earlier
/// @audit function `decreaseLiquidityAndCollect` came earlier
/// @audit function `repay` came earlier
/// @audit function `repay` came earlier
666:     struct LiquidateState {

```
*Github:* [[109](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L109), [115](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L115), [118](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L118), [121](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L121), [124](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L124), [127](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L127), [128](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L128), [129](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L129), [131](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L131), [132](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L132), [135](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L135), [138](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L138), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L139), [140](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L140), [143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L143), [144](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L144), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L145), [150](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L150), [154](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L154), [157](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L157), [158](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L158), [159](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L159), [161](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L161), [163](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L163), [164](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L164), [167](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L167), [666](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L666)]


```solidity
File: src/automators/AutoExit.sol

/// @audit event/error `Executed` came earlier
/// @audit event/error `PositionConfigured` came earlier
/// @audit function `constructor` came earlier
44:     struct PositionConfig {

/// @audit event/error `Executed` came earlier
/// @audit event/error `PositionConfigured` came earlier
/// @audit function `constructor` came earlier
60:     mapping(uint256 => PositionConfig) public positionConfigs;

/// @audit state variable `positionConfigs` came earlier
/// @audit event/error `Executed` came earlier
/// @audit event/error `PositionConfigured` came earlier
/// @audit function `constructor` came earlier
63:     struct ExecuteParams {

/// @audit state variable `positionConfigs` came earlier
/// @audit event/error `Executed` came earlier
/// @audit event/error `PositionConfigured` came earlier
/// @audit function `constructor` came earlier
73:     struct ExecuteState {

```
*Github:* [[44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L44), [60](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L60), [63](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L63), [73](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L73)]


```solidity
File: src/automators/Automator.sol

/// @audit event/error `OperatorChanged` came earlier
/// @audit event/error `VaultChanged` came earlier
/// @audit event/error `WithdrawerChanged` came earlier
/// @audit event/error `TWAPConfigChanged` came earlier
34:     mapping(address => bool) public operators;

/// @audit event/error `OperatorChanged` came earlier
/// @audit event/error `VaultChanged` came earlier
/// @audit event/error `WithdrawerChanged` came earlier
/// @audit event/error `TWAPConfigChanged` came earlier
35:     mapping(address => bool) public vaults;

/// @audit event/error `OperatorChanged` came earlier
/// @audit event/error `VaultChanged` came earlier
/// @audit event/error `WithdrawerChanged` came earlier
/// @audit event/error `TWAPConfigChanged` came earlier
37:     address public withdrawer;

/// @audit event/error `OperatorChanged` came earlier
/// @audit event/error `VaultChanged` came earlier
/// @audit event/error `WithdrawerChanged` came earlier
/// @audit event/error `TWAPConfigChanged` came earlier
38:     uint32 public TWAPSeconds;

/// @audit event/error `OperatorChanged` came earlier
/// @audit event/error `VaultChanged` came earlier
/// @audit event/error `WithdrawerChanged` came earlier
/// @audit event/error `TWAPConfigChanged` came earlier
39:     uint16 public maxTWAPTickDifference;

```
*Github:* [[34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L34), [35](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L35), [37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L37), [38](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L38), [39](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L39)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit event/error `AutoCompounded` came earlier
/// @audit event/error `RewardUpdated` came earlier
/// @audit event/error `BalanceAdded` came earlier
/// @audit event/error `BalanceRemoved` came earlier
/// @audit event/error `BalanceWithdrawn` came earlier
/// @audit function `constructor` came earlier
45:     mapping(uint256 => mapping(address => uint256)) public positionBalances;

/// @audit event/error `AutoCompounded` came earlier
/// @audit event/error `RewardUpdated` came earlier
/// @audit event/error `BalanceAdded` came earlier
/// @audit event/error `BalanceRemoved` came earlier
/// @audit event/error `BalanceWithdrawn` came earlier
/// @audit function `constructor` came earlier
47:     uint64 public constant MAX_REWARD_X64 = uint64(Q64 / 50); // 2%

/// @audit event/error `AutoCompounded` came earlier
/// @audit event/error `RewardUpdated` came earlier
/// @audit event/error `BalanceAdded` came earlier
/// @audit event/error `BalanceRemoved` came earlier
/// @audit event/error `BalanceWithdrawn` came earlier
/// @audit function `constructor` came earlier
48:     uint64 public totalRewardX64 = MAX_REWARD_X64; // 2%

/// @audit state variable `positionBalances` came earlier
/// @audit state variable `MAX_REWARD_X64` came earlier
/// @audit state variable `totalRewardX64` came earlier
/// @audit event/error `AutoCompounded` came earlier
/// @audit event/error `RewardUpdated` came earlier
/// @audit event/error `BalanceAdded` came earlier
/// @audit event/error `BalanceRemoved` came earlier
/// @audit event/error `BalanceWithdrawn` came earlier
/// @audit function `constructor` came earlier
51:     struct ExecuteParams {

/// @audit state variable `positionBalances` came earlier
/// @audit state variable `MAX_REWARD_X64` came earlier
/// @audit state variable `totalRewardX64` came earlier
/// @audit event/error `AutoCompounded` came earlier
/// @audit event/error `RewardUpdated` came earlier
/// @audit event/error `BalanceAdded` came earlier
/// @audit event/error `BalanceRemoved` came earlier
/// @audit event/error `BalanceWithdrawn` came earlier
/// @audit function `constructor` came earlier
61:     struct ExecuteState {

```
*Github:* [[45](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L45), [47](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L47), [48](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L48), [51](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L51), [61](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L61)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit event/error `RangeChanged` came earlier
/// @audit event/error `PositionConfigured` came earlier
/// @audit function `constructor` came earlier
37:     struct PositionConfig {

/// @audit event/error `RangeChanged` came earlier
/// @audit event/error `PositionConfigured` came earlier
/// @audit function `constructor` came earlier
50:     mapping(uint256 => PositionConfig) public positionConfigs;

/// @audit state variable `positionConfigs` came earlier
/// @audit event/error `RangeChanged` came earlier
/// @audit event/error `PositionConfigured` came earlier
/// @audit function `constructor` came earlier
53:     struct ExecuteParams {

/// @audit state variable `positionConfigs` came earlier
/// @audit event/error `RangeChanged` came earlier
/// @audit event/error `PositionConfigured` came earlier
/// @audit function `constructor` came earlier
65:     struct ExecuteState {

```
*Github:* [[37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L37), [50](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L50), [53](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L53), [65](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L65)]


```solidity
File: src/transformers/LeverageTransformer.sol

/// @audit function `constructor` came earlier
17:     struct LeverageUpParams {

/// @audit function `constructor` came earlier
/// @audit function `leverageUp` came earlier
98:     struct LeverageDownParams {

```
*Github:* [[17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L17), [98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L98)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit state variable `permit2` came earlier
/// @audit event/error `CompoundFees` came earlier
/// @audit event/error `ChangeRange` came earlier
/// @audit event/error `WithdrawAndCollectAndSwap` came earlier
/// @audit event/error `SwapAndMint` came earlier
/// @audit event/error `SwapAndIncreaseLiquidity` came earlier
/// @audit function `constructor` came earlier
41:     enum WhatToDo {

/// @audit state variable `permit2` came earlier
/// @audit event/error `CompoundFees` came earlier
/// @audit event/error `ChangeRange` came earlier
/// @audit event/error `WithdrawAndCollectAndSwap` came earlier
/// @audit event/error `SwapAndMint` came earlier
/// @audit event/error `SwapAndIncreaseLiquidity` came earlier
/// @audit function `constructor` came earlier
48:     struct Instructions {

/// @audit state variable `permit2` came earlier
/// @audit event/error `CompoundFees` came earlier
/// @audit event/error `ChangeRange` came earlier
/// @audit event/error `WithdrawAndCollectAndSwap` came earlier
/// @audit event/error `SwapAndMint` came earlier
/// @audit event/error `SwapAndIncreaseLiquidity` came earlier
/// @audit function `constructor` came earlier
/// @audit function `executeWithPermit` came earlier
/// @audit function `execute` came earlier
/// @audit function `onERC721Received` came earlier
382:     struct SwapParams {

/// @audit state variable `permit2` came earlier
/// @audit event/error `CompoundFees` came earlier
/// @audit event/error `ChangeRange` came earlier
/// @audit event/error `WithdrawAndCollectAndSwap` came earlier
/// @audit event/error `SwapAndMint` came earlier
/// @audit event/error `SwapAndIncreaseLiquidity` came earlier
/// @audit function `constructor` came earlier
/// @audit function `executeWithPermit` came earlier
/// @audit function `execute` came earlier
/// @audit function `onERC721Received` came earlier
/// @audit function `swap` came earlier
432:     struct SwapAndMintParams {

/// @audit state variable `permit2` came earlier
/// @audit event/error `CompoundFees` came earlier
/// @audit event/error `ChangeRange` came earlier
/// @audit event/error `WithdrawAndCollectAndSwap` came earlier
/// @audit event/error `SwapAndMint` came earlier
/// @audit event/error `SwapAndIncreaseLiquidity` came earlier
/// @audit function `constructor` came earlier
/// @audit function `executeWithPermit` came earlier
/// @audit function `execute` came earlier
/// @audit function `onERC721Received` came earlier
/// @audit function `swap` came earlier
/// @audit function `swapAndMint` came earlier
504:     struct SwapAndIncreaseLiquidityParams {

/// @audit state variable `permit2` came earlier
/// @audit event/error `CompoundFees` came earlier
/// @audit event/error `ChangeRange` came earlier
/// @audit event/error `WithdrawAndCollectAndSwap` came earlier
/// @audit event/error `SwapAndMint` came earlier
/// @audit event/error `SwapAndIncreaseLiquidity` came earlier
/// @audit function `constructor` came earlier
/// @audit function `executeWithPermit` came earlier
/// @audit function `execute` came earlier
/// @audit function `onERC721Received` came earlier
/// @audit function `swap` came earlier
/// @audit function `swapAndMint` came earlier
/// @audit function `swapAndIncreaseLiquidity` came earlier
/// @audit function `_prepareAddApproved` came earlier
588:     struct PrepareAddPermit2State {

```
*Github:* [[41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L41), [48](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L48), [382](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L382), [432](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L432), [504](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L504), [588](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L588)]


```solidity
File: src/utils/FlashloanLiquidator.sol

/// @audit function `constructor` came earlier
28:     struct LiquidateParams {

```
*Github:* [[28](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L28)]


```solidity
File: src/utils/Swapper.sol

/// @audit event/error `Swap` came earlier
21:     IWETH9 public immutable weth;

/// @audit event/error `Swap` came earlier
23:     address public immutable factory;

/// @audit event/error `Swap` came earlier
26:     INonfungiblePositionManager public immutable nonfungiblePositionManager;

/// @audit event/error `Swap` came earlier
29:     address public immutable zeroxRouter;

/// @audit event/error `Swap` came earlier
32:     address public immutable universalRouter;

/// @audit state variable `weth` came earlier
/// @audit state variable `factory` came earlier
/// @audit state variable `nonfungiblePositionManager` came earlier
/// @audit state variable `zeroxRouter` came earlier
/// @audit state variable `universalRouter` came earlier
/// @audit event/error `Swap` came earlier
/// @audit function `constructor` came earlier
50:     struct ZeroxRouterData {

/// @audit state variable `weth` came earlier
/// @audit state variable `factory` came earlier
/// @audit state variable `nonfungiblePositionManager` came earlier
/// @audit state variable `zeroxRouter` came earlier
/// @audit state variable `universalRouter` came earlier
/// @audit event/error `Swap` came earlier
/// @audit function `constructor` came earlier
56:     struct UniversalRouterData {

/// @audit state variable `weth` came earlier
/// @audit state variable `factory` came earlier
/// @audit state variable `nonfungiblePositionManager` came earlier
/// @audit state variable `zeroxRouter` came earlier
/// @audit state variable `universalRouter` came earlier
/// @audit event/error `Swap` came earlier
/// @audit function `constructor` came earlier
62:     struct RouterSwapParams {

/// @audit state variable `weth` came earlier
/// @audit state variable `factory` came earlier
/// @audit state variable `nonfungiblePositionManager` came earlier
/// @audit state variable `zeroxRouter` came earlier
/// @audit state variable `universalRouter` came earlier
/// @audit event/error `Swap` came earlier
/// @audit function `constructor` came earlier
/// @audit function `_routerSwap` came earlier
120:     struct PoolSwapParams {

```
*Github:* [[21](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L21), [23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L23), [26](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L26), [29](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L29), [32](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L32), [50](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L50), [56](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L56), [62](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L62), [120](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L120)]


</details>


<a name="NC-15"></a> 
### [NC-15] Contract should expose an `interface`
All `external`/`public` functions should extend an `interface`. This is useful to make sure that the whole API is extracted.

*Note:* It is possible that the interface is out-of-scope and has not been seen by the bot.

<details>
<summary>
There are <b>77</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

46:     function getUtilizationRateX96(uint256 cash, uint256 debt) public pure returns (uint256) {

58:     function getRatesPerSecondX96(uint256 cash, uint256 debt)

82:     function setValues(

```
*Github:* [[46](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L46), [58](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L58), [82](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L82)]


```solidity
File: src/V3Oracle.sol

95:     function getValue(uint256 tokenId, address token)

162:     function getPositionBreakdown(uint256 tokenId)

185:     function setMaxPoolPriceDifference(uint16 _maxPoolPriceDifference) external onlyOwner {

201:     function setTokenConfig(

249:     function setOracleMode(address token, Mode mode) external {

265:     function setEmergencyAdmin(address admin) external onlyOwner {

```
*Github:* [[95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L95), [162](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L162), [185](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L185), [201](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L201), [249](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L249), [265](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L265)]


```solidity
File: src/V3Vault.sol

195:     function vaultInfo()

219:     function lendInfo(address account) external view override returns (uint256 amount) {

231:     function loanInfo(uint256 tokenId)

258:     function ownerOf(uint256 tokenId) external view override returns (address owner) {

264:     function loanCount(address owner) external view override returns (uint256) {

271:     function loanAtIndex(address owner, uint256 index) external view override returns (uint256) {

277:     function decimals() public view override(IERC20Metadata, ERC20) returns (uint8) {

284:     function totalAssets() public view override returns (uint256) {

289:     function convertToShares(uint256 assets) external view override returns (uint256 shares) {

295:     function convertToAssets(uint256 shares) external view override returns (uint256 assets) {

301:     function maxDeposit(address) external view override returns (uint256) {

312:     function maxMint(address) external view override returns (uint256) {

323:     function maxWithdraw(address owner) external view override returns (uint256) {

329:     function maxRedeem(address owner) external view override returns (uint256) {

334:     function previewDeposit(uint256 assets) public view override returns (uint256) {

340:     function previewMint(uint256 shares) public view override returns (uint256) {

346:     function previewWithdraw(uint256 assets) public view override returns (uint256) {

352:     function previewRedeem(uint256 shares) public view override returns (uint256) {

360:     function deposit(uint256 assets, address receiver) external override returns (uint256) {

366:     function mint(uint256 shares, address receiver) external override returns (uint256) {

372:     function withdraw(uint256 assets, address receiver, address owner) external override returns (uint256) {

378:     function redeem(uint256 shares, address receiver, address owner) external override returns (uint256) {

384:     function deposit(uint256 assets, address receiver, bytes calldata permitData) external override returns (uint256) {

390:     function mint(uint256 shares, address receiver, bytes calldata permitData) external override returns (uint256) {

400:     function create(uint256 tokenId, address recipient) external override {

410:     function createWithPermit(

429:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)

483:     function approveTransform(uint256 tokenId, address target, bool isActive) external override {

497:     function transform(uint256 tokenId, address transformer, bytes calldata data)

550:     function borrow(uint256 tokenId, uint256 assets) external override {

609:     function decreaseLiquidityAndCollect(DecreaseLiquidityAndCollectParams calldata params)

652:     function repay(uint256 tokenId, uint256 amount, bool isShare) external override {

661:     function repay(uint256 tokenId, uint256 amount, bool isShare, bytes calldata permitData) external override {

685:     function liquidate(LiquidateParams calldata params) external override returns (uint256 amount0, uint256 amount1) {

765:     function withdrawReserves(uint256 amount, address receiver) external onlyOwner {

788:     function setTransformer(address transformer, bool active) external onlyOwner {

807:     function setLimits(

837:     function setReserveFactor(uint32 _reserveFactorX32) external onlyOwner {

844:     function setReserveProtectionFactor(uint32 _reserveProtectionFactorX32) external onlyOwner {

856:     function setTokenConfig(address token, uint32 collateralFactorX32, uint32 collateralValueLimitFactorX32)

870:     function setEmergencyAdmin(address admin) external onlyOwner {

```
*Github:* [[195](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L195), [219](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L219), [231](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L231), [258](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L258), [264](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L264), [271](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L271), [277](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L277), [284](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L284), [289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L289), [295](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L295), [301](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L301), [312](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L312), [323](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L323), [329](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L329), [334](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L334), [340](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L340), [346](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L346), [352](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L352), [360](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L360), [366](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L366), [372](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L372), [378](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L378), [384](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L384), [390](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L390), [400](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L400), [410](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L410), [429](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L429), [483](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L483), [497](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L497), [550](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L550), [609](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L609), [652](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L652), [661](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L661), [685](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L685), [765](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L765), [788](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L788), [807](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L807), [837](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L837), [844](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L844), [856](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L856), [870](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L870)]


```solidity
File: src/automators/AutoExit.sol

100:     function execute(ExecuteParams calldata params) external {

218:     function configToken(uint256 tokenId, PositionConfig calldata config) external {

```
*Github:* [[100](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L100), [218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L218)]


```solidity
File: src/automators/Automator.sol

59:     function setWithdrawer(address _withdrawer) public onlyOwner {

69:     function setOperator(address _operator, bool _active) public onlyOwner {

79:     function setVault(address _vault, bool _active) public onlyOwner {

87:     function setTWAPConfig(uint16 _maxTWAPTickDifference, uint32 _TWAPSeconds) public onlyOwner {

104:     function withdrawBalances(address[] calldata tokens, address to) external virtual {

123:     function withdrawETH(address to) external {

```
*Github:* [[59](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L59), [69](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L69), [79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L79), [87](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L87), [104](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L104), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L123)]


```solidity
File: src/transformers/AutoCompound.sol

87:     function executeWithVault(ExecuteParams calldata params, address vault) external {

101:     function execute(ExecuteParams calldata params) external nonReentrant {

200:     function withdrawLeftoverBalances(uint256 tokenId, address to) external nonReentrant {

227:     function withdrawBalances(address[] calldata tokens, address to) external override nonReentrant {

243:     function setReward(uint64 _totalRewardX64) external onlyOwner {

```
*Github:* [[87](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L87), [101](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L101), [200](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L200), [227](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L227), [243](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L243)]


```solidity
File: src/transformers/AutoRange.sol

97:     function executeWithVault(ExecuteParams calldata params, address vault) external {

111:     function execute(ExecuteParams calldata params) external {

276:     function configToken(uint256 tokenId, address vault, PositionConfig calldata config) external {

```
*Github:* [[97](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L97), [111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L111), [276](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L276)]


```solidity
File: src/transformers/LeverageTransformer.sol

40:     function leverageUp(LeverageUpParams calldata params) external {

123:     function leverageDown(LeverageDownParams calldata params) external {

```
*Github:* [[40](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L40), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L123)]


```solidity
File: src/transformers/V3Utils.sol

98:     function executeWithPermit(uint256 tokenId, Instructions memory instructions, uint8 v, bytes32 r, bytes32 s)

115:     function execute(uint256 tokenId, Instructions memory instructions) public returns (uint256 newTokenId) {

356:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)

397:     function swap(SwapParams calldata params) external payable returns (uint256 amountOut) {

467:     function swapAndMint(SwapAndMintParams calldata params)

532:     function swapAndIncreaseLiquidity(SwapAndIncreaseLiquidityParams calldata params)

```
*Github:* [[98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L98), [115](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L115), [356](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L356), [397](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L397), [467](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L467), [532](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L532)]


```solidity
File: src/utils/FlashloanLiquidator.sol

41:     function liquidate(LiquidateParams calldata params) external {

67:     function uniswapV3FlashCallback(uint256 fee0, uint256 fee1, bytes calldata callbackData) external {

```
*Github:* [[41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L41), [67](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L67)]


```solidity
File: src/utils/Swapper.sol

156:     function uniswapV3SwapCallback(int256 amount0Delta, int256 amount1Delta, bytes calldata data) external override {

```
*Github:* [[156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L156)]


</details>


<a name="NC-16"></a> 
### [NC-16] Contracts should have full test coverage
While 100% code coverage does not guarantee that there are no bugs, it often will catch easy-to-find bugs, and will ensure that there are fewer regressions when the code invariably has to be modified. Furthermore, in order to get full coverage, code authors will often have to re-organize their code so that it is more modular, so that each component can be tested separately, which reduces interdependencies between modules and layers, and makes for code that is easier to reason about and audit.

*There is one instance of this issue:*
```solidity

Global finding

```
*Github:* [[Global](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/)]



<a name="NC-17"></a> 
### [NC-17] Convert simple `if` statements to ternary expressions
Converting some if statements to ternaries (such as `z = (a < b) ? x : y`) can make the code more concise and easier to read.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

350:         if (feedConfig.isToken0) {
                 poolTWAPPriceX96 = priceX96;
             } else {
                 poolTWAPPriceX96 = Q96 * Q96 / priceX96;

```
*Github:* [[350](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L350)]


```solidity
File: src/automators/Automator.sol

157:         if (swap0For1) {
                 amountOutMin = FullMath.mulDiv(amountIn * (Q64 - maxPriceDifferenceX64), priceX96, Q96 * Q64);
             } else {
                 amountOutMin = FullMath.mulDiv(amountIn * (Q64 - maxPriceDifferenceX64), Q96, priceX96 * Q64);

```
*Github:* [[157](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L157)]



<a name="NC-18"></a> 
### [NC-18] Events that mark critical parameter changes should contain both the old and the new value
This should especially be done if the new value is not required to be different from the old value.

<details>
<summary>
There are <b>42</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

100:         emit SetValues(baseRatePerYearX96, multiplierPerYearX96, jumpMultiplierPerYearX96, _kinkX96);

```
*Github:* [[100](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L100)]


```solidity
File: src/V3Oracle.sol

190:         emit SetMaxPoolPriceDifference(_maxPoolPriceDifference);

242:         emit TokenConfigUpdated(token, config);

243:         emit OracleModeUpdated(token, mode);

260:         emit OracleModeUpdated(token, mode);

267:         emit SetEmergencyAdmin(admin);

```
*Github:* [[190](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L190), [242](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L242), [243](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L243), [260](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L260), [267](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L267)]


```solidity
File: src/V3Vault.sol

449:             emit Add(tokenId, owner, 0);

464:                 emit Add(tokenId, owner, oldTokenId);

489:         emit ApprovedTransform(tokenId, msg.sender, target, isActive);

601:         emit Borrow(tokenId, owner, assets, shares);

645:         emit WithdrawCollateral(params.tokenId, owner, params.recipient, params.liquidity, amount0, amount1);

782:         emit WithdrawReserves(amount, receiver);

798:         emit SetTransformer(transformer, active);

839:         emit SetReserveFactor(_reserveFactorX32);

849:         emit SetReserveProtectionFactor(_reserveProtectionFactorX32);

865:         emit SetTokenConfig(token, collateralFactorX32, collateralValueLimitFactorX32);

872:         emit SetEmergencyAdmin(admin);

916:         emit Deposit(msg.sender, receiver, assets, shares);

951:         emit Withdraw(msg.sender, receiver, owner, assets, shares);

1013:         emit Repay(tokenId, msg.sender, owner, assets, shares);

1084:         emit Remove(tokenId, owner);

1139:             emit ExchangeRateUpdate(newDebtExchangeRateX96, newLendExchangeRateX96);

1160:             emit ExchangeRateUpdate(newDebtExchangeRateX96, newLendExchangeRateX96);

```
*Github:* [[449](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L449), [464](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L464), [489](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L489), [601](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L601), [645](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L645), [782](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L782), [798](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L798), [839](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L839), [849](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L849), [865](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L865), [872](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L872), [916](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L916), [951](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L951), [1013](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1013), [1084](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1084), [1139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1139), [1160](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1160)]


```solidity
File: src/automators/AutoExit.sol

208:         emit PositionConfigured(params.tokenId, false, false, false, 0, 0, 0, 0, false, 0);

```
*Github:* [[208](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L208)]


```solidity
File: src/automators/Automator.sol

60:         emit WithdrawerChanged(_withdrawer);

70:         emit OperatorChanged(_operator, _active);

80:         emit VaultChanged(_vault, _active);

94:         emit TWAPConfigChanged(_TWAPSeconds, _maxTWAPTickDifference);

```
*Github:* [[60](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L60), [70](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L70), [80](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L80), [94](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L94)]


```solidity
File: src/transformers/AutoCompound.sol

246:         emit RewardUpdated(msg.sender, _totalRewardX64);

251:         emit BalanceAdded(tokenId, token, amount);

259:                 emit BalanceAdded(tokenId, token, amount - currentBalance);

261:                 emit BalanceRemoved(tokenId, token, currentBalance - amount);

271:         emit BalanceRemoved(tokenId, token, amount);

273:         emit BalanceWithdrawn(tokenId, token, to, amount);

```
*Github:* [[246](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L246), [251](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L251), [259](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L259), [261](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L261), [271](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L271), [273](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L273)]


```solidity
File: src/transformers/AutoRange.sol

266:             emit PositionConfigured(params.tokenId, 0, 0, 0, 0, 0, 0, false, 0);

268:             emit RangeChanged(params.tokenId, state.newTokenId);

```
*Github:* [[266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L266), [268](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L268)]


```solidity
File: src/transformers/V3Utils.sol

218:             emit CompoundFees(tokenId, liquidity, amount0, amount1);

303:             emit ChangeRange(tokenId, newTokenId);

348:             emit WithdrawAndCollectAndSwap(tokenId, instructions.targetToken, targetAmount);

729:         emit SwapAndMint(tokenId, liquidity, added0, added1);

773:         emit SwapAndIncreaseLiquidity(params.tokenId, liquidity, added0, added1);

```
*Github:* [[218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L218), [303](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L303), [348](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L348), [729](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L729), [773](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L773)]


```solidity
File: src/utils/Swapper.sol

116:             emit Swap(address(params.tokenIn), address(params.tokenOut), amountInDelta, amountOutDelta);

```
*Github:* [[116](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L116)]


</details>


<a name="NC-19"></a> 
### [NC-19] Custom errors should be used rather than `revert()`/`require()`
Custom errors are available from solidity version 0.8.4. Custom errors are more easily processed in try-catch blocks, and are easier to re-use and maintain.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/transformers/AutoCompound.sol

244:         require(_totalRewardX64 <= totalRewardX64, ">totalRewardX64");

269:         require(amount <= balance, "amount>balance");

```
*Github:* [[244](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L244), [269](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L269)]



<a name="NC-20"></a> 
### [NC-20] Polymorphic functions make security audits more time-consuming and error-prone
The instances below point to one of two functions with the same name. Consider naming each function differently, in order to make code navigation and analysis easier.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

/// @audit also found on line 384
360:     function deposit(uint256 assets, address receiver) external override returns (uint256) {

/// @audit also found on line 390
366:     function mint(uint256 shares, address receiver) external override returns (uint256) {

/// @audit also found on line 661
652:     function repay(uint256 tokenId, uint256 amount, bool isShare) external override {

```
*Github:* [[360](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L360), [366](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L366), [652](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L652)]



<a name="NC-21"></a> 
### [NC-21] Duplicated `require()`/`revert()` checks should be refactored
Refactoring duplicate `require()`/`revert()` checks into a modifier or function can make the code more concise, readable and maintainable, and less likely to make errors or omissions when modifying the `require()` or `revert()`.

<details>
<summary>
There are <b>24</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit duplicated on line 212
187:             revert InvalidConfig();

/// @audit duplicated on line 222
256:             revert InvalidConfig();

```
*Github:* [[187](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L187), [256](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L256)]


```solidity
File: src/V3Vault.sol

/// @audit duplicated on line 485
420:             revert Unauthorized();

/// @audit duplicated on line 616
503:             revert TransformNotAllowed();

/// @audit duplicated on line 533
516:             revert Unauthorized();

/// @audit duplicated on line 622
562:             revert Unauthorized();

/// @audit duplicated on line 1009
587:             revert MinLoanSize();

/// @audit duplicated on line 941
775:             revert InsufficientLiquidity();

/// @audit duplicated on line 846
794:             revert InvalidConfig();

/// @audit duplicated on line 1240
1232:                     revert CollateralValueLimit();

```
*Github:* [[420](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L420), [503](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L503), [516](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L516), [562](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L562), [587](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L587), [775](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L775), [794](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L794), [1232](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1232)]


```solidity
File: src/automators/AutoExit.sol

/// @audit duplicated on line 221
102:             revert Unauthorized();

```
*Github:* [[102](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L102)]


```solidity
File: src/automators/Automator.sol

/// @audit duplicated on line 92
89:             revert InvalidConfig();

/// @audit duplicated on line 125
106:             revert Unauthorized();

/// @audit duplicated on line 223
132:                 revert EtherSendFailed();

/// @audit duplicated on line 238
233:             revert Unauthorized();

```
*Github:* [[89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L89), [106](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L106), [132](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L132), [233](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L233)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit duplicated on line 103
89:             revert Unauthorized();

/// @audit duplicated on line 229
206:             revert Unauthorized();

```
*Github:* [[89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L89), [206](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L206)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit duplicated on line 113
99:             revert Unauthorized();

```
*Github:* [[99](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L99)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit duplicated on line 785
143:             revert AmountError();

/// @audit duplicated on line 473
399:             revert SameToken();

/// @audit duplicated on line 641
636:                 revert TransferError(); // reverts for fee-on-transfer tokens

/// @audit duplicated on line 677
672:                     revert TooMuchEtherSent();

/// @audit duplicated on line 909
906:             revert CollectError();

```
*Github:* [[143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L143), [399](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L399), [636](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L636), [672](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L672), [906](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L906)]


```solidity
File: src/utils/Swapper.sol

/// @audit duplicated on line 150
112:                 revert SlippageError();

```
*Github:* [[112](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L112)]


</details>


<a name="NC-22"></a> 
### [NC-22] `else` block not required
One level of nesting can be removed by not having an `else` block when the `if`-block always jumps at the end. For example:
```solidity
if (condition) {
	body1...
	return x;
} else {
	body2...
}
```
can be changed to:
```solidity
if (condition) {
	body1...
	return x;
}
body2...
```

*There are <b>4</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

304:         if (value >= globalLendLimit) {
                 return 0;
             } else {

315:         if (value >= globalLendLimit) {
                 return 0;
             } else {

```
*Github:* [[304](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L304), [315](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L315)]


```solidity
File: src/automators/Automator.sol

172:         if (twapOk) {
                 return twapTick - currentTick >= -int16(maxDifference) && twapTick - currentTick <= int16(maxDifference);
             } else {

```
*Github:* [[172](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L172)]


```solidity
File: src/transformers/AutoRange.sol

305:         } else if (fee == 500) {
                 return 10;
             } else {

```
*Github:* [[305](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L305)]



<a name="NC-23"></a> 
### [NC-23] Empty bytes check is missing
Passing empty bytes to a function can cause unexpected behavior, such as certain operations failing, producing incorrect results, or wasting gas. It is recommended to check that all byte parameters are not empty.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: src/V3Vault.sol

/// @audit missing empty check for `permitData`
384:     function deposit(uint256 assets, address receiver, bytes calldata permitData) external override returns (uint256) {

/// @audit missing empty check for `permitData`
390:     function mint(uint256 shares, address receiver, bytes calldata permitData) external override returns (uint256) {

/// @audit missing empty check for `data`
429:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)
             external
             override
             returns (bytes4)
         {

/// @audit missing empty check for `data`
497:     function transform(uint256 tokenId, address transformer, bytes calldata data)
             external
             override
             returns (uint256 newTokenId)
         {

/// @audit missing empty check for `permitData`
661:     function repay(uint256 tokenId, uint256 amount, bool isShare, bytes calldata permitData) external override {

/// @audit missing empty check for `permitData`
877:     function _deposit(address receiver, uint256 amount, bool isShare, bytes memory permitData)
             internal
             returns (uint256 assets, uint256 shares)
         {

/// @audit missing empty check for `permitData`
954:     function _repay(uint256 tokenId, uint256 amount, bool isShare, bytes memory permitData) internal {

```
*Github:* [[384](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L384), [390](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L390), [429](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L429), [497](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L497), [661](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L661), [877](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L877), [954](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L954)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit missing empty check for `data`
356:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)
             external
             override
             returns (bytes4)
         {

/// @audit missing empty check for `signature`
598:     function _prepareAddPermit2(
             IERC20 token0,
             IERC20 token1,
             IERC20 otherToken,
             uint256 amount0,
             uint256 amount1,
             uint256 amountOther,
             IPermit2.PermitBatchTransferFrom memory permit,
             bytes memory signature
         ) internal {

```
*Github:* [[356](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L356), [598](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L598)]


```solidity
File: src/utils/FlashloanLiquidator.sol

/// @audit missing empty check for `callbackData`
67:     function uniswapV3FlashCallback(uint256 fee0, uint256 fee1, bytes calldata callbackData) external {

```
*Github:* [[67](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L67)]


```solidity
File: src/utils/Swapper.sol

/// @audit missing empty check for `data`
156:     function uniswapV3SwapCallback(int256 amount0Delta, int256 amount1Delta, bytes calldata data) external override {

```
*Github:* [[156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L156)]


</details>


<a name="NC-24"></a> 
### [NC-24] Enable IR-based code generation
The IR-based code generator was introduced with an aim to not only allow code generation to be more transparent and auditable but also to enable more powerful optimization passes that span across functions. You can enable it on the command line using `--via-ir` or with the option `{"viaIR": true}`. This will take longer to compile, but you can just simple test it before deploying and if you got a better benchmark then you can add --via-ir to your deploy command More on: https://docs.soliditylang.org/en/v0.8.17/ir-breaking-changes.html

*There is one instance of this issue:*
```solidity

Global finding

```
*Github:* [[Global](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/)]



<a name="NC-25"></a> 
### [NC-25] Enum values should be used instead of constant array indexes
Create a commented enum value to use instead of constant array indexes, this makes the code far easier to understand.

*There are <b>9</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

366:             secondsAgos[0] = 0; // from (before)

367:             secondsAgos[1] = twapSeconds; // from (before)

369:             int24 tick = int24((tickCumulatives[0] - tickCumulatives[1]) / int56(uint56(twapSeconds)));

369:             int24 tick = int24((tickCumulatives[0] - tickCumulatives[1]) / int56(uint56(twapSeconds)));

```
*Github:* [[366](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L366), [367](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L367), [369](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L369), [369](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L369)]


```solidity
File: src/automators/Automator.sol

182:         secondsAgos[0] = 0; // from (before)

183:         secondsAgos[1] = twapPeriod; // from (before)

187:             return (int24((tickCumulatives[0] - tickCumulatives[1]) / int56(uint56(twapPeriod))), true);

187:             return (int24((tickCumulatives[0] - tickCumulatives[1]) / int56(uint56(twapPeriod))), true);

```
*Github:* [[182](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L182), [183](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L183), [187](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L187), [187](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L187)]


```solidity
File: src/transformers/AutoCompound.sol

234:             uint256 balance = positionBalances[0][tokens[i]];

```
*Github:* [[234](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L234)]



<a name="NC-26"></a> 
### [NC-26] Events are emitted without the sender information
When an action is triggered based on a user's action, not being able to filter based on who triggered the action makes event processing a lot more cumbersome. Including the `msg.sender` the events of these types of action will make events much more useful to end users, especially when `msg.sender` is not `tx.origin`.

<details>
<summary>
There are <b>28</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

100:         emit SetValues(baseRatePerYearX96, multiplierPerYearX96, jumpMultiplierPerYearX96, _kinkX96);

```
*Github:* [[100](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L100)]


```solidity
File: src/V3Oracle.sol

190:         emit SetMaxPoolPriceDifference(_maxPoolPriceDifference);

242:         emit TokenConfigUpdated(token, config);

243:         emit OracleModeUpdated(token, mode);

260:         emit OracleModeUpdated(token, mode);

267:         emit SetEmergencyAdmin(admin);

```
*Github:* [[190](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L190), [242](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L242), [243](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L243), [260](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L260), [267](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L267)]


```solidity
File: src/V3Vault.sol

601:         emit Borrow(tokenId, owner, assets, shares);

645:         emit WithdrawCollateral(params.tokenId, owner, params.recipient, params.liquidity, amount0, amount1);

782:         emit WithdrawReserves(amount, receiver);

798:         emit SetTransformer(transformer, active);

830:         emit SetLimits(

839:         emit SetReserveFactor(_reserveFactorX32);

849:         emit SetReserveProtectionFactor(_reserveProtectionFactorX32);

865:         emit SetTokenConfig(token, collateralFactorX32, collateralValueLimitFactorX32);

872:         emit SetEmergencyAdmin(admin);

1084:         emit Remove(tokenId, owner);

```
*Github:* [[601](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L601), [645](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L645), [782](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L782), [798](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L798), [830](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L830), [839](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L839), [849](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L849), [865](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L865), [872](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L872), [1084](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1084)]


```solidity
File: src/automators/AutoExit.sol

208:         emit PositionConfigured(params.tokenId, false, false, false, 0, 0, 0, 0, false, 0);

232:         emit PositionConfigured(

```
*Github:* [[208](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L208), [232](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L232)]


```solidity
File: src/automators/Automator.sol

60:         emit WithdrawerChanged(_withdrawer);

70:         emit OperatorChanged(_operator, _active);

80:         emit VaultChanged(_vault, _active);

94:         emit TWAPConfigChanged(_TWAPSeconds, _maxTWAPTickDifference);

```
*Github:* [[60](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L60), [70](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L70), [80](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L80), [94](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L94)]


```solidity
File: src/transformers/AutoCompound.sol

251:         emit BalanceAdded(tokenId, token, amount);

271:         emit BalanceRemoved(tokenId, token, amount);

273:         emit BalanceWithdrawn(tokenId, token, to, amount);

```
*Github:* [[251](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L251), [271](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L271), [273](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L273)]


```solidity
File: src/transformers/AutoRange.sol

286:         emit PositionConfigured(

```
*Github:* [[286](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L286)]


```solidity
File: src/transformers/V3Utils.sol

729:         emit SwapAndMint(tokenId, liquidity, added0, added1);

773:         emit SwapAndIncreaseLiquidity(params.tokenId, liquidity, added0, added1);

```
*Github:* [[729](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L729), [773](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L773)]


</details>


<a name="NC-27"></a> 
### [NC-27] Events may be emitted out of order due to reentrancy
Ensure that events follow the best practice of check-effects-interaction, and are emitted before external calls.

<details>
<summary>
There are <b>24</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit `.decimals(...)` is called on line 215
/// @audit `.decimals(...)` is called on line 216
/// @audit `.token0(...)` is called on line 225
/// @audit `.token1(...)` is called on line 226
242:         emit TokenConfigUpdated(token, config);

/// @audit `.decimals(...)` is called on line 215
/// @audit `.decimals(...)` is called on line 216
/// @audit `.token0(...)` is called on line 225
/// @audit `.token1(...)` is called on line 226
243:         emit OracleModeUpdated(token, mode);

```
*Github:* [[242](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L242), [243](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L243)]


```solidity
File: src/V3Vault.sol

/// @audit `.safeTransfer(...)` is called on line 599
601:         emit Borrow(tokenId, owner, assets, shares);

/// @audit `.decreaseLiquidity(...)` is called on line 627
/// @audit `.collect(...)` is called on line 640
645:         emit WithdrawCollateral(params.tokenId, owner, params.recipient, params.liquidity, amount0, amount1);

/// @audit `.safeTransferFrom(...)` is called on line 728
/// @audit `.permitTransferFrom(...)` is called on line 720
746:         emit Liquidate(

/// @audit `.safeTransfer(...)` is called on line 779
782:         emit WithdrawReserves(amount, receiver);

/// @audit `.safeTransferFrom(...)` is called on line 901
/// @audit `.permitTransferFrom(...)` is called on line 896
916:         emit Deposit(msg.sender, receiver, assets, shares);

/// @audit `.safeTransfer(...)` is called on line 946
951:         emit Withdraw(msg.sender, receiver, owner, assets, shares);

/// @audit `.safeTransferFrom(...)` is called on line 986
/// @audit `.permitTransferFrom(...)` is called on line 981
1013:         emit Repay(tokenId, msg.sender, owner, assets, shares);

/// @audit `.safeTransferFrom(...)` is called on line 1083
1084:         emit Remove(tokenId, owner);

```
*Github:* [[601](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L601), [645](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L645), [746](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L746), [782](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L782), [916](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L916), [951](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L951), [1013](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1013), [1084](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1084)]


```solidity
File: src/automators/AutoExit.sol

/// @audit `.positions(...)` is called on line 121
/// @audit `.slot0(...)` is called on line 132
/// @audit `.ownerOf(...)` is called on line 198
208:         emit PositionConfigured(params.tokenId, false, false, false, 0, 0, 0, 0, false, 0);

/// @audit `.positions(...)` is called on line 121
/// @audit `.slot0(...)` is called on line 132
/// @audit `.ownerOf(...)` is called on line 198
211:         emit Executed(

/// @audit `.ownerOf(...)` is called on line 219
232:         emit PositionConfigured(

```
*Github:* [[208](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L208), [211](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L211), [232](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L232)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit `.collect(...)` is called on line 108
/// @audit `.positions(...)` is called on line 116
/// @audit `.slot0(...)` is called on line 129
/// @audit `.increaseLiquidity(...)` is called on line 163
183:         emit AutoCompounded(

/// @audit `.safeTransfer(...)` is called on line 272
273:         emit BalanceWithdrawn(tokenId, token, to, amount);

```
*Github:* [[183](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L183), [273](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L273)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `.positions(...)` is called on line 131
/// @audit `.safeApprove(...)` is called on line 213
/// @audit `.safeApprove(...)` is called on line 214
/// @audit `.mint(...)` is called on line 217
/// @audit `.safeApprove(...)` is called on line 220
/// @audit `.safeApprove(...)` is called on line 221
/// @audit `.ownerOf(...)` is called on line 223
/// @audit `.ownerOf(...)` is called on line 228
/// @audit `.safeTransferFrom(...)` is called on line 232
252:             emit PositionConfigured(

/// @audit `.positions(...)` is called on line 131
/// @audit `.safeApprove(...)` is called on line 213
/// @audit `.safeApprove(...)` is called on line 214
/// @audit `.mint(...)` is called on line 217
/// @audit `.safeApprove(...)` is called on line 220
/// @audit `.safeApprove(...)` is called on line 221
/// @audit `.ownerOf(...)` is called on line 223
/// @audit `.ownerOf(...)` is called on line 228
/// @audit `.safeTransferFrom(...)` is called on line 232
266:             emit PositionConfigured(params.tokenId, 0, 0, 0, 0, 0, 0, false, 0);

/// @audit `.positions(...)` is called on line 131
/// @audit `.safeApprove(...)` is called on line 213
/// @audit `.safeApprove(...)` is called on line 214
/// @audit `.mint(...)` is called on line 217
/// @audit `.safeApprove(...)` is called on line 220
/// @audit `.safeApprove(...)` is called on line 221
/// @audit `.ownerOf(...)` is called on line 223
/// @audit `.ownerOf(...)` is called on line 228
/// @audit `.safeTransferFrom(...)` is called on line 232
268:             emit RangeChanged(params.tokenId, state.newTokenId);

```
*Github:* [[252](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L252), [266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L266), [268](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L268)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit `.positions(...)` is called on line 116
218:             emit CompoundFees(tokenId, liquidity, amount0, amount1);

/// @audit `.positions(...)` is called on line 116
303:             emit ChangeRange(tokenId, newTokenId);

/// @audit `.positions(...)` is called on line 116
348:             emit WithdrawAndCollectAndSwap(tokenId, instructions.targetToken, targetAmount);

/// @audit `.mint(...)` is called on line 726
/// @audit `.safeTransferFrom(...)` is called on line 727
729:         emit SwapAndMint(tokenId, liquidity, added0, added1);

/// @audit `.increaseLiquidity(...)` is called on line 771
773:         emit SwapAndIncreaseLiquidity(params.tokenId, liquidity, added0, added1);

```
*Github:* [[218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L218), [303](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L303), [348](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L348), [729](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L729), [773](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L773)]


```solidity
File: src/utils/Swapper.sol

/// @audit `.balanceOf(...)` is called on line 78
/// @audit `.balanceOf(...)` is called on line 79
/// @audit `.safeTransfer(...)` is called on line 98
/// @audit `.execute(...)` is called on line 99
/// @audit `.safeApprove(...)` is called on line 87
/// @audit `.call(...)` is called on line 89
/// @audit `.safeApprove(...)` is called on line 94
/// @audit `.balanceOf(...)` is called on line 104
/// @audit `.balanceOf(...)` is called on line 105
116:             emit Swap(address(params.tokenIn), address(params.tokenOut), amountInDelta, amountOutDelta);

```
*Github:* [[116](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L116)]


</details>


<a name="NC-28"></a> 
### [NC-28] Execution at deadlines should be allowed
The condition may be wrong in these cases, as when `block.timestamp` is equal to the compared `>` or `<` variable these blocks will not be executed.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

338:         if (updatedAt + feedConfig.maxFeedAge < block.timestamp || answer < 0) {

```
*Github:* [[338](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L338)]


```solidity
File: src/V3Vault.sol

1155:         if (block.timestamp > lastExchangeRateUpdate) {

```
*Github:* [[1155](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1155)]



<a name="NC-29"></a> 
### [NC-29] External call recipient can consume all remaining gas
There is no limit specified on the amount of gas used, so the recipient can use up all of the remaining gas (`gasleft()`), causing it to revert. Therefore, when calling an external contract, it is necessary to specify a limited amount of gas to forward.

*There are <b>6</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

522:         (bool success,) = transformer.call(data);

```
*Github:* [[522](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L522)]


```solidity
File: src/automators/Automator.sol

130:             (bool sent,) = to.call{value: balance}("");

221:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[130](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L130), [221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L221)]


```solidity
File: src/transformers/V3Utils.sol

867:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[867](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L867)]


```solidity
File: src/utils/Swapper.sol

89:                 (bool success,) = zeroxRouter.call(data.data);

89:                 (bool success,) = zeroxRouter.call(data.data);

```
*Github:* [[89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L89), [89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L89)]



<a name="NC-30"></a> 
### [NC-30]  Function ordering does not follow the Solidity Style Guide
According to the [solidity style guide](https://docs.soliditylang.org/en/v0.8.17/style-guide.html#order-of-functions), functions should be laid out in the following order: `constructor()`, `receive()`, `fallback()`, `external`, `public`, `internal`, `private`, but the cases below do not follow this pattern

<details>
<summary>
There are <b>43</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit internal function `_checkPoolPrice` came earlier from this public function
/// @audit internal function `_requireMaxDifference` came earlier from this public function
162:     function getPositionBreakdown(uint256 tokenId)

/// @audit internal function `_checkPoolPrice` came earlier from this external function
/// @audit internal function `_requireMaxDifference` came earlier from this external function
/// @audit public function `getPositionBreakdown` came earlier from this external function
185:     function setMaxPoolPriceDifference(uint16 _maxPoolPriceDifference) external onlyOwner {

/// @audit internal function `_checkPoolPrice` came earlier from this external function
/// @audit internal function `_requireMaxDifference` came earlier from this external function
/// @audit public function `getPositionBreakdown` came earlier from this external function
201:     function setTokenConfig(

/// @audit internal function `_checkPoolPrice` came earlier from this external function
/// @audit internal function `_requireMaxDifference` came earlier from this external function
/// @audit public function `getPositionBreakdown` came earlier from this external function
249:     function setOracleMode(address token, Mode mode) external {

/// @audit internal function `_checkPoolPrice` came earlier from this external function
/// @audit internal function `_requireMaxDifference` came earlier from this external function
/// @audit public function `getPositionBreakdown` came earlier from this external function
265:     function setEmergencyAdmin(address admin) external onlyOwner {

```
*Github:* [[162](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L162), [185](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L185), [201](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L201), [249](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L249), [265](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L265)]


```solidity
File: src/V3Vault.sol

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
289:     function convertToShares(uint256 assets) external view override returns (uint256 shares) {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
295:     function convertToAssets(uint256 shares) external view override returns (uint256 assets) {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
301:     function maxDeposit(address) external view override returns (uint256) {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
312:     function maxMint(address) external view override returns (uint256) {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
323:     function maxWithdraw(address owner) external view override returns (uint256) {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
329:     function maxRedeem(address owner) external view override returns (uint256) {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
360:     function deposit(uint256 assets, address receiver) external override returns (uint256) {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
366:     function mint(uint256 shares, address receiver) external override returns (uint256) {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
372:     function withdraw(uint256 assets, address receiver, address owner) external override returns (uint256) {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
378:     function redeem(uint256 shares, address receiver, address owner) external override returns (uint256) {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
384:     function deposit(uint256 assets, address receiver, bytes calldata permitData) external override returns (uint256) {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
390:     function mint(uint256 shares, address receiver, bytes calldata permitData) external override returns (uint256) {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
400:     function create(uint256 tokenId, address recipient) external override {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
410:     function createWithPermit(

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
429:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
483:     function approveTransform(uint256 tokenId, address target, bool isActive) external override {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
497:     function transform(uint256 tokenId, address transformer, bytes calldata data)

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
550:     function borrow(uint256 tokenId, uint256 assets) external override {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
609:     function decreaseLiquidityAndCollect(DecreaseLiquidityAndCollectParams calldata params)

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
652:     function repay(uint256 tokenId, uint256 amount, bool isShare) external override {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
661:     function repay(uint256 tokenId, uint256 amount, bool isShare, bytes calldata permitData) external override {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
685:     function liquidate(LiquidateParams calldata params) external override returns (uint256 amount0, uint256 amount1) {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
765:     function withdrawReserves(uint256 amount, address receiver) external onlyOwner {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
788:     function setTransformer(address transformer, bool active) external onlyOwner {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
807:     function setLimits(

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
837:     function setReserveFactor(uint32 _reserveFactorX32) external onlyOwner {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
844:     function setReserveProtectionFactor(uint32 _reserveProtectionFactorX32) external onlyOwner {

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
856:     function setTokenConfig(address token, uint32 collateralFactorX32, uint32 collateralValueLimitFactorX32)

/// @audit public function `decimals` came earlier from this external function
/// @audit public function `totalAssets` came earlier from this external function
/// @audit public function `previewDeposit` came earlier from this external function
/// @audit public function `previewMint` came earlier from this external function
/// @audit public function `previewWithdraw` came earlier from this external function
/// @audit public function `previewRedeem` came earlier from this external function
870:     function setEmergencyAdmin(address admin) external onlyOwner {

```
*Github:* [[289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L289), [295](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L295), [301](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L301), [312](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L312), [323](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L323), [329](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L329), [360](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L360), [366](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L366), [372](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L372), [378](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L378), [384](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L384), [390](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L390), [400](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L400), [410](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L410), [429](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L429), [483](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L483), [497](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L497), [550](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L550), [609](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L609), [652](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L652), [661](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L661), [685](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L685), [765](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L765), [788](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L788), [807](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L807), [837](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L837), [844](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L844), [856](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L856), [870](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L870)]


```solidity
File: src/automators/Automator.sol

/// @audit public function `setWithdrawer` came earlier from this external function
/// @audit public function `setOperator` came earlier from this external function
/// @audit public function `setVault` came earlier from this external function
/// @audit public function `setTWAPConfig` came earlier from this external function
104:     function withdrawBalances(address[] calldata tokens, address to) external virtual {

/// @audit public function `setWithdrawer` came earlier from this external function
/// @audit public function `setOperator` came earlier from this external function
/// @audit public function `setVault` came earlier from this external function
/// @audit public function `setTWAPConfig` came earlier from this external function
123:     function withdrawETH(address to) external {

/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
251:     receive() external payable {

```
*Github:* [[104](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L104), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L123), [251](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L251)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit public function `executeWithPermit` came earlier from this external function
/// @audit public function `execute` came earlier from this external function
356:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)

/// @audit public function `executeWithPermit` came earlier from this external function
/// @audit public function `execute` came earlier from this external function
397:     function swap(SwapParams calldata params) external payable returns (uint256 amountOut) {

/// @audit public function `executeWithPermit` came earlier from this external function
/// @audit public function `execute` came earlier from this external function
467:     function swapAndMint(SwapAndMintParams calldata params)

/// @audit public function `executeWithPermit` came earlier from this external function
/// @audit public function `execute` came earlier from this external function
532:     function swapAndIncreaseLiquidity(SwapAndIncreaseLiquidityParams calldata params)

/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
/// @audit a function was seen before receive()
914:     receive() external payable {

```
*Github:* [[356](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L356), [397](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L397), [467](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L467), [532](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L532), [914](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L914)]


```solidity
File: src/utils/Swapper.sol

/// @audit internal function `_routerSwap` came earlier from this external function
/// @audit internal function `_poolSwap` came earlier from this external function
156:     function uniswapV3SwapCallback(int256 amount0Delta, int256 amount1Delta, bytes calldata data) external override {

```
*Github:* [[156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L156)]


</details>


<a name="NC-31"></a> 
### [NC-31] High cyclomatic complexity
Consider breaking down these blocks into more manageable units, by splitting things into utility functions, by reducing nesting, and by using early returns

*There are <b>9</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

/// @audit Number of blocks: 10
272:     function _getReferenceTokenPriceX96(address token, uint256 cachedChainlinkReferencePriceX96)

```
*Github:* [[272](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L272)]


```solidity
File: src/V3Vault.sol

/// @audit Number of blocks: 10
954:     function _repay(uint256 tokenId, uint256 amount, bool isShare, bytes memory permitData) internal {

```
*Github:* [[954](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L954)]


```solidity
File: src/automators/AutoExit.sol

/// @audit Number of blocks: 16
33:     constructor(

/// @audit Number of blocks: 16
100:     function execute(ExecuteParams calldata params) external {

```
*Github:* [[33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L33), [100](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L100)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit Number of blocks: 14
111:     function execute(ExecuteParams calldata params) external {

```
*Github:* [[111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L111)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit Number of blocks: 20
115:     function execute(uint256 tokenId, Instructions memory instructions) public returns (uint256 newTokenId) {

/// @audit Number of blocks: 10
598:     function _prepareAddPermit2(

/// @audit Number of blocks: 13
653:     function _prepareAdd(

/// @audit Number of blocks: 10
779:     function _swapAndPrepareAmounts(SwapAndMintParams memory params, bool unwrap)

```
*Github:* [[115](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L115), [598](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L598), [653](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L653), [779](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L779)]



<a name="NC-32"></a> 
### [NC-32] Variable names for `immutable`s should use CONSTANT_CASE
For `immutable` variable names, each word should use all capital letters, with underscores separating each word (CONSTANT_CASE)

<details>
<summary>
There are <b>18</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

58:     address public immutable factory;

59:     INonfungiblePositionManager public immutable nonfungiblePositionManager;

62:     address public immutable referenceToken;

63:     uint8 public immutable referenceTokenDecimals;

68:     address public immutable chainlinkReferenceToken;

```
*Github:* [[58](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L58), [59](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L59), [62](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L62), [63](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L63), [68](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L68)]


```solidity
File: src/V3Vault.sol

47:     INonfungiblePositionManager public immutable nonfungiblePositionManager;

50:     IUniswapV3Factory public immutable factory;

53:     IInterestRateModel public immutable interestRateModel;

56:     IV3Oracle public immutable oracle;

59:     IPermit2 public immutable permit2;

62:     address public immutable override asset;

65:     uint8 private immutable assetDecimals;

```
*Github:* [[47](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L47), [50](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L50), [53](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L53), [56](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L56), [59](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L59), [62](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L62), [65](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L65)]


```solidity
File: src/transformers/V3Utils.sol

19:     IPermit2 public immutable permit2;

```
*Github:* [[19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L19)]


```solidity
File: src/utils/Swapper.sol

21:     IWETH9 public immutable weth;

23:     address public immutable factory;

26:     INonfungiblePositionManager public immutable nonfungiblePositionManager;

29:     address public immutable zeroxRouter;

32:     address public immutable universalRouter;

```
*Github:* [[21](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L21), [23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L23), [26](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L26), [29](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L29), [32](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L32)]


</details>


<a name="NC-33"></a> 
### [NC-33] Import declarations should import specific identifiers, rather than the whole file
Using import declarations of the form `import {<identifier_name>} from "some/file.sol"` avoids polluting the symbol namespace making flattened files smaller, and speeds up compilation (but does not save any gas).

<details>
<summary>
There are <b>70</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

4: import "@openzeppelin/contracts/access/Ownable.sol";

6: import "./interfaces/IInterestRateModel.sol";

7: import "./interfaces/IErrors.sol";

```
*Github:* [[4](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L4), [6](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L6), [7](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L7)]


```solidity
File: src/V3Oracle.sol

4: import "v3-core/interfaces/IUniswapV3Factory.sol";

5: import "v3-core/interfaces/IUniswapV3Pool.sol";

7: import "v3-core/libraries/TickMath.sol";

9: import "v3-periphery/libraries/PoolAddress.sol";

10: import "v3-periphery/libraries/LiquidityAmounts.sol";

12: import "v3-periphery/interfaces/INonfungiblePositionManager.sol";

14: import "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol";

15: import "@openzeppelin/contracts/access/Ownable.sol";

17: import "../lib/AggregatorV3Interface.sol";

19: import "./interfaces/IV3Oracle.sol";

20: import "./interfaces/IErrors.sol";

```
*Github:* [[4](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L4), [5](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L5), [7](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L7), [9](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L9), [10](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L10), [12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L12), [14](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L14), [15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L15), [17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L17), [19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L19), [20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L20)]


```solidity
File: src/V3Vault.sol

4: import "v3-core/interfaces/IUniswapV3Factory.sol";

5: import "v3-core/interfaces/IUniswapV3Pool.sol";

6: import "v3-core/libraries/TickMath.sol";

7: import "v3-core/libraries/FixedPoint128.sol";

9: import "v3-periphery/libraries/LiquidityAmounts.sol";

10: import "v3-periphery/interfaces/INonfungiblePositionManager.sol";

12: import "@openzeppelin/contracts/utils/math/Math.sol";

13: import "@openzeppelin/contracts/token/ERC20/ERC20.sol";

14: import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";

15: import "@openzeppelin/contracts/token/ERC721/IERC721Receiver.sol";

16: import "@openzeppelin/contracts/access/Ownable.sol";

17: import "@openzeppelin/contracts/utils/math/SafeCast.sol";

18: import "@openzeppelin/contracts/utils/Multicall.sol";

20: import "permit2/interfaces/IPermit2.sol";

22: import "./interfaces/IVault.sol";

23: import "./interfaces/IV3Oracle.sol";

24: import "./interfaces/IInterestRateModel.sol";

25: import "./interfaces/IErrors.sol";

```
*Github:* [[4](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L4), [5](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L5), [6](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L6), [7](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L7), [9](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L9), [10](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L10), [12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L12), [13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L13), [14](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L14), [15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L15), [16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L16), [17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L17), [18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L18), [20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L20), [22](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L22), [23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L23), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L24), [25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L25)]


```solidity
File: src/automators/AutoExit.sol

4: import "./Automator.sol";

```
*Github:* [[4](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L4)]


```solidity
File: src/automators/Automator.sol

4: import "@openzeppelin/contracts/access/Ownable.sol";

5: import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";

6: import "@openzeppelin/contracts/utils/math/SafeCast.sol";

8: import "v3-core/interfaces/IUniswapV3Factory.sol";

9: import "v3-core/interfaces/IUniswapV3Pool.sol";

10: import "v3-core/libraries/TickMath.sol";

11: import "v3-core/libraries/FullMath.sol";

13: import "v3-periphery/interfaces/INonfungiblePositionManager.sol";

15: import "../../lib/IWETH9.sol";

16: import "../utils/Swapper.sol";

17: import "../interfaces/IVault.sol";

```
*Github:* [[4](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L4), [5](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L5), [6](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L6), [8](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L8), [9](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L9), [10](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L10), [11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L11), [13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L13), [15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L15), [16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L16), [17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L17)]


```solidity
File: src/transformers/AutoCompound.sol

4: import "@openzeppelin/contracts/security/ReentrancyGuard.sol";

5: import "@openzeppelin/contracts/utils/Multicall.sol";

6: import "@openzeppelin/contracts/utils/math/SafeMath.sol";

8: import "v3-periphery/interfaces/INonfungiblePositionManager.sol";

10: import "../automators/Automator.sol";

```
*Github:* [[4](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L4), [5](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L5), [6](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L6), [8](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L8), [10](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L10)]


```solidity
File: src/transformers/AutoRange.sol

4: import "../automators/Automator.sol";

```
*Github:* [[4](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L4)]


```solidity
File: src/transformers/LeverageTransformer.sol

4: import "@openzeppelin/contracts/utils/math/SafeCast.sol";

5: import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";

7: import "../utils/Swapper.sol";

8: import "../interfaces/IVault.sol";

```
*Github:* [[4](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L4), [5](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L5), [7](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L7), [8](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L8)]


```solidity
File: src/transformers/V3Utils.sol

4: import "@openzeppelin/contracts/token/ERC721/IERC721Receiver.sol";

5: import "@openzeppelin/contracts/utils/math/SafeCast.sol";

7: import "permit2/interfaces/IPermit2.sol";

9: import "../utils/Swapper.sol";

```
*Github:* [[4](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L4), [5](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L5), [7](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L7), [9](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L9)]


```solidity
File: src/utils/FlashloanLiquidator.sol

4: import "v3-core/interfaces/IUniswapV3Pool.sol";

5: import "v3-core/interfaces/callback/IUniswapV3FlashCallback.sol";

7: import "../interfaces/IVault.sol";

8: import "./Swapper.sol";

```
*Github:* [[4](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L4), [5](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L5), [7](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L7), [8](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L8)]


```solidity
File: src/utils/Swapper.sol

4: import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";

6: import "v3-core/interfaces/callback/IUniswapV3SwapCallback.sol";

7: import "v3-core/interfaces/IUniswapV3Pool.sol";

8: import "v3-core/libraries/TickMath.sol";

10: import "v3-periphery/interfaces/INonfungiblePositionManager.sol";

12: import "../../lib/IWETH9.sol";

13: import "../../lib/IUniversalRouter.sol";

14: import "../interfaces/IErrors.sol";

```
*Github:* [[4](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L4), [6](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L6), [7](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L7), [8](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L8), [10](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L10), [12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L12), [13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L13), [14](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L14)]


</details>


<a name="NC-34"></a> 
### [NC-34] Imports could be organized more systematically
The contract's interface should be imported first, followed by each of the interfaces it uses, followed by all other files. The examples below do not follow this layout.

<details>
<summary>
There are <b>27</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

6: import "./interfaces/IInterestRateModel.sol";

7: import "./interfaces/IErrors.sol";

```
*Github:* [[6](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L6), [7](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L7)]


```solidity
File: src/V3Oracle.sol

12: import "v3-periphery/interfaces/INonfungiblePositionManager.sol";

14: import "@openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol";

19: import "./interfaces/IV3Oracle.sol";

20: import "./interfaces/IErrors.sol";

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L12), [14](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L14), [19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L19), [20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L20)]


```solidity
File: src/V3Vault.sol

10: import "v3-periphery/interfaces/INonfungiblePositionManager.sol";

15: import "@openzeppelin/contracts/token/ERC721/IERC721Receiver.sol";

20: import "permit2/interfaces/IPermit2.sol";

22: import "./interfaces/IVault.sol";

23: import "./interfaces/IV3Oracle.sol";

24: import "./interfaces/IInterestRateModel.sol";

25: import "./interfaces/IErrors.sol";

```
*Github:* [[10](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L10), [15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L15), [20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L20), [22](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L22), [23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L23), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L24), [25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L25)]


```solidity
File: src/automators/Automator.sol

8: import "v3-core/interfaces/IUniswapV3Factory.sol";

9: import "v3-core/interfaces/IUniswapV3Pool.sol";

13: import "v3-periphery/interfaces/INonfungiblePositionManager.sol";

15: import "../../lib/IWETH9.sol";

17: import "../interfaces/IVault.sol";

```
*Github:* [[8](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L8), [9](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L9), [13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L13), [15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L15), [17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L17)]


```solidity
File: src/transformers/AutoCompound.sol

8: import "v3-periphery/interfaces/INonfungiblePositionManager.sol";

```
*Github:* [[8](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L8)]


```solidity
File: src/transformers/LeverageTransformer.sol

8: import "../interfaces/IVault.sol";

```
*Github:* [[8](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L8)]


```solidity
File: src/transformers/V3Utils.sol

7: import "permit2/interfaces/IPermit2.sol";

```
*Github:* [[7](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L7)]


```solidity
File: src/utils/Swapper.sol

6: import "v3-core/interfaces/callback/IUniswapV3SwapCallback.sol";

7: import "v3-core/interfaces/IUniswapV3Pool.sol";

10: import "v3-periphery/interfaces/INonfungiblePositionManager.sol";

12: import "../../lib/IWETH9.sol";

13: import "../../lib/IUniversalRouter.sol";

14: import "../interfaces/IErrors.sol";

```
*Github:* [[6](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L6), [7](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L7), [10](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L10), [12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L12), [13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L13), [14](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L14)]


</details>


<a name="NC-35"></a> 
### [NC-35] Inconsistent spacing in comments
Some lines use `// x` and some use `//x`. The instances below point out the usages that don't follow the majority, within each file

*There are <b>7</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

187:     ////////////////// EXTERNAL VIEW FUNCTIONS

275:     ////////////////// OVERRIDDEN EXTERNAL VIEW FUNCTIONS FROM ERC20

281:     ////////////////// OVERRIDDEN EXTERNAL VIEW FUNCTIONS FROM ERC4626

357:     ////////////////// OVERRIDDEN EXTERNAL FUNCTIONS FROM ERC4626

395:     ////////////////// EXTERNAL FUNCTIONS

759:     ////////////////// ADMIN FUNCTIONS only callable by owner

875:     ////////////////// INTERNAL FUNCTIONS

```
*Github:* [[187](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L187), [275](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L275), [281](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L281), [357](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L357), [395](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L395), [759](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L759), [875](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L875)]



<a name="NC-36"></a> 
### [NC-36] Incorrect withdraw declaration
In Solidity, it's essential for clarity and interoperability to correctly specify return types in function declarations. If the `withdraw` function is expected to return a `bool` to indicate success or failure, its omission could lead to ambiguity or unexpected behavior when interacting with or calling this function from other contracts or off-chain systems. Missing return values can mislead developers and potentially lead to contract integrations built on incorrect assumptions. To resolve this, the function declaration for withdraw should be modified to explicitly include the `bool` return type, ensuring clarity and correctness in contract interactions.

*There are <b>6</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

765:     function withdrawReserves(uint256 amount, address receiver) external onlyOwner {

```
*Github:* [[765](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L765)]


```solidity
File: src/automators/Automator.sol

104:     function withdrawBalances(address[] calldata tokens, address to) external virtual {

123:     function withdrawETH(address to) external {

```
*Github:* [[104](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L104), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L123)]


```solidity
File: src/transformers/AutoCompound.sol

200:     function withdrawLeftoverBalances(uint256 tokenId, address to) external nonReentrant {

227:     function withdrawBalances(address[] calldata tokens, address to) external override nonReentrant {

266:     function _withdrawBalanceInternal(uint256 tokenId, address token, address to, uint256 balance, uint256 amount)
             internal
         {

```
*Github:* [[200](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L200), [227](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L227), [266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L266)]



<a name="NC-37"></a> 
### [NC-37] Invalid NatSpec comment style
NatSpec must begin with `///` or use `/* ... */` syntax

*There is one instance of this issue:*
```solidity
File: src/transformers/V3Utils.sol

18:     // @notice Permit2 contract

```
*Github:* [[18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L18)]



<a name="NC-38"></a> 
### [NC-38] It is best practice to use linear inheritance
In Solidity, complex inheritance structures can obfuscate code understanding, introducing potential security risks. Multiple inheritance, especially with overlapping function names or state variables, can cause unintentional overrides or ambiguous behavior. 

Resolution: Strive for linear and simple inheritance chains. Avoid diamond or circular inheritance patterns. Clearly document the purpose and relationships of base contracts, ensuring that overrides are intentional. Tools like Remix or Hardhat can visualize inheritance chains, assisting in verification. Keeping inheritance streamlined aids in better code readability, reduces potential errors, and ensures smoother audits and upgrades.

*There are <b>8</b> instances of this issue:*
```solidity
File: src/InterestRateModel.sol

11: contract InterestRateModel is Ownable, IInterestRateModel, IErrors {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L11)]


```solidity
File: src/V3Oracle.sol

24: contract V3Oracle is IV3Oracle, Ownable, IErrors {

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L24)]


```solidity
File: src/V3Vault.sol

30: contract V3Vault is ERC20, Multicall, Ownable, IVault, IERC721Receiver, IErrors {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L30)]


```solidity
File: src/automators/Automator.sol

19: abstract contract Automator is Swapper, Ownable {

```
*Github:* [[19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L19)]


```solidity
File: src/transformers/AutoCompound.sol

16: contract AutoCompound is Automator, Multicall, ReentrancyGuard {

```
*Github:* [[16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L16)]


```solidity
File: src/transformers/V3Utils.sol

15: contract V3Utils is Swapper, IERC721Receiver {

```
*Github:* [[15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L15)]


```solidity
File: src/utils/FlashloanLiquidator.sol

11: contract FlashloanLiquidator is Swapper, IUniswapV3FlashCallback {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L11)]


```solidity
File: src/utils/Swapper.sol

17: abstract contract Swapper is IUniswapV3SwapCallback, IErrors {

```
*Github:* [[17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L17)]



<a name="NC-39"></a> 
### [NC-39] Lack of brace spacing
Lack of brace spacing in coding refers to the absence of spaces around braces, which can hinder code readability. In Solidity, as in many programming languages, spacing can enhance the visual distinction between different parts of the code, making it easier to follow. A lack of spacing can lead to a dense, confusing appearance. The resolution to this issue is to follow a consistent style guide that defines rules for brace spacing. By including spaces around braces, such as `{ statement }` instead of `{statement}`, developers can ensure that the code is more legible and maintainable, especially in larger codebases.

*There are <b>4</b> instances of this issue:*
```solidity
File: src/automators/Automator.sol

130:             (bool sent,) = to.call{value: balance}("");

221:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[130](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L130), [221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L221)]


```solidity
File: src/transformers/V3Utils.sol

667:             weth.deposit{value: msg.value}();

867:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[667](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L667), [867](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L867)]



<a name="NC-40"></a> 
### [NC-40] Large or complicated code bases should implement invariant tests
This includes: large code bases, or code with lots of inline-assembly, complicated math, or complicated interactions between multiple contracts. Invariant fuzzers such as Echidna require the test writer to come up with invariants which should not be violated under any circumstances, and the fuzzer tests various inputs and function calls to ensure that the invariants always hold. Even code with 100% code coverage can still have bugs due to the order of the operations a user performs, and invariant fuzzers may help significantly.

*There is one instance of this issue:*
```solidity

Global finding

```
*Github:* [[Global](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/)]



<a name="NC-41"></a> 
### [NC-41] Large numeric literals should use underscores for readability
Large hardcoded numbers in code can be difficult to read. Consider using underscores for number literals to improve readability (e.g `1234567` -> `1_234_567`). Consider using an underscore for every third digit from the right.

*There are <b>5</b> instances of this issue:*
```solidity
File: src/InterestRateModel.sol

13:     uint256 public constant YEAR_SECS = 31557600; // taking into account leap years

```
*Github:* [[13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L13)]


```solidity
File: src/V3Oracle.sol

144:             ? (priceX96 - verifyPriceX96) * 10000 / priceX96

145:             : (verifyPriceX96 - priceX96) * 10000 / verifyPriceX96;

```
*Github:* [[144](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L144), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L145)]


```solidity
File: src/transformers/AutoRange.sol

301:         if (fee == 10000) {

303:         } else if (fee == 3000) {

```
*Github:* [[301](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L301), [303](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L303)]



<a name="NC-42"></a> 
### [NC-42] Long functions should be refactored into multiple, smaller, functions

<details>
<summary>
There are <b>12</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit 54 lines
272:     function _getReferenceTokenPriceX96(address token, uint256 cachedChainlinkReferencePriceX96)
             internal
             view
             returns (uint256 priceX96, uint256 chainlinkReferencePriceX96)
         {

```
*Github:* [[272](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L272)]


```solidity
File: src/V3Vault.sol

/// @audit 52 lines
550:     function borrow(uint256 tokenId, uint256 assets) external override {

/// @audit 72 lines
685:     function liquidate(LiquidateParams calldata params) external override returns (uint256 amount0, uint256 amount1) {

/// @audit 60 lines
954:     function _repay(uint256 tokenId, uint256 amount, bool isShare, bytes memory permitData) internal {

```
*Github:* [[550](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L550), [685](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L685), [954](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L954)]


```solidity
File: src/automators/AutoExit.sol

/// @audit 114 lines
100:     function execute(ExecuteParams calldata params) external {

```
*Github:* [[100](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L100)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit 92 lines
101:     function execute(ExecuteParams calldata params) external nonReentrant {

```
*Github:* [[101](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L101)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit 161 lines
111:     function execute(ExecuteParams calldata params) external {

```
*Github:* [[111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L111)]


```solidity
File: src/transformers/LeverageTransformer.sol

/// @audit 56 lines
40:     function leverageUp(LeverageUpParams calldata params) external {

/// @audit 52 lines
123:     function leverageDown(LeverageDownParams calldata params) external {

```
*Github:* [[40](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L40), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L123)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit 237 lines
115:     function execute(uint256 tokenId, Instructions memory instructions) public returns (uint256 newTokenId) {

/// @audit 51 lines
598:     function _prepareAddPermit2(
             IERC20 token0,
             IERC20 token1,
             IERC20 otherToken,
             uint256 amount0,
             uint256 amount1,
             uint256 amountOther,
             IPermit2.PermitBatchTransferFrom memory permit,
             bytes memory signature
         ) internal {

/// @audit 59 lines
779:     function _swapAndPrepareAmounts(SwapAndMintParams memory params, bool unwrap)
             internal
             returns (uint256 total0, uint256 total1)
         {

```
*Github:* [[115](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L115), [598](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L598), [779](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L779)]


</details>


<a name="NC-43"></a> 
### [NC-43] Magic numbers should be replaced with constants
Magic numbers are hard-coded values in code that can make it difficult for developers and maintainers to understand the code, and can also cause confusion or errors. To improve the readability and maintainability of code, it is recommended to replace magic numbers with constants that have good readability.

<details>
<summary>
There are <b>13</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

// @audit `10000`
144:             ? (priceX96 - verifyPriceX96) * 10000 / priceX96

// @audit `10000`
145:             : (verifyPriceX96 - priceX96) * 10000 / verifyPriceX96;

// @audit `10`
304:             chainlinkPriceX96 = (10 ** referenceTokenDecimals) * chainlinkPriceX96 * Q96 / chainlinkReferencePriceX96

// @audit `10`
305:                 / (10 ** feedConfig.tokenDecimals);

// @audit `10`
342:         return uint256(answer) * Q96 / (10 ** feedConfig.feedDecimals);

// @audit `2`
365:             uint32[] memory secondsAgos = new uint32[](2);

```
*Github:* [[144](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L144), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L145), [304](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L304), [305](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L305), [342](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L342), [365](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L365)]


```solidity
File: src/automators/Automator.sol

// @audit `2`
181:         uint32[] memory secondsAgos = new uint32[](2);

```
*Github:* [[181](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L181)]


```solidity
File: src/transformers/AutoRange.sol

// @audit `10000`
301:         if (fee == 10000) {

// @audit `200`
302:             return 200;

// @audit `3000`
303:         } else if (fee == 3000) {

// @audit `60`
304:             return 60;

// @audit `500`
305:         } else if (fee == 500) {

// @audit `10`
306:             return 10;

```
*Github:* [[301](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L301), [302](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L302), [303](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L303), [304](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L304), [305](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L305), [306](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L306)]


</details>


<a name="NC-44"></a> 
### [NC-44] Missing contract existence checks before low-level calls
Low-level calls return success if there is no code present at the specified address. In addition to the zero-address checks, add a check to verify that `<address>.code.length > 0`

*There are <b>6</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

522:         (bool success,) = transformer.call(data);

```
*Github:* [[522](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L522)]


```solidity
File: src/automators/Automator.sol

130:             (bool sent,) = to.call{value: balance}("");

221:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[130](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L130), [221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L221)]


```solidity
File: src/transformers/V3Utils.sol

867:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[867](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L867)]


```solidity
File: src/utils/Swapper.sol

89:                 (bool success,) = zeroxRouter.call(data.data);

89:                 (bool success,) = zeroxRouter.call(data.data);

```
*Github:* [[89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L89), [89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L89)]



<a name="NC-45"></a> 
### [NC-45] Missing disallow list for `ERC721`
Recently, there has been an increase in the theft of NFTs. These stolen NFTs are then added to platforms where they can be easily converted into liquidity.

Some popular marketplaces(e.g. Opensea), have already taken steps to combat this problem by introducing a disallow list feature. This means that if an NFT is reported as stolen, it won't be listed or sold on their platform. This may increase the centralization of the project, but it can help solve this problem if it is a concern.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

30: contract V3Vault is ERC20, Multicall, Ownable, IVault, IERC721Receiver, IErrors {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L30)]


```solidity
File: src/transformers/V3Utils.sol

15: contract V3Utils is Swapper, IERC721Receiver {

```
*Github:* [[15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L15)]



<a name="NC-46"></a> 
### [NC-46] Named mappings are recommended
[Named mappings](https://docs.soliditylang.org/en/v0.8.18/types.html#mapping-types) (with syntax `mapping(KeyType KeyName? => ValueType ValueName?)`) are recommended.It can make the mapping variables clearer, more readable and easier to maintain.

<details>
<summary>
There are <b>13</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

56:     mapping(address => TokenConfig) public feedConfigs;

```
*Github:* [[56](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L56)]


```solidity
File: src/V3Vault.sol

115:     mapping(address => TokenConfig) public tokenConfigs;

154:     mapping(uint256 => Loan) public loans; // tokenID -> loan mapping

157:     mapping(address => uint256[]) private ownedTokens; // Mapping from owner address to list of owned token IDs

158:     mapping(uint256 => uint256) private ownedTokensIndex; // Mapping from token ID to index of the owner tokens list (for removal without loop)

159:     mapping(uint256 => address) private tokenOwner; // Mapping from token ID to owner

163:     mapping(address => bool) public transformerAllowList; // contracts allowed to transform positions (selected audited contracts e.g. V3Utils)

164:     mapping(address => mapping(uint256 => mapping(address => bool))) public transformApprovals; // owners permissions for other addresses to call transform on owners behalf (e.g. AutoRange contract)

```
*Github:* [[115](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L115), [154](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L154), [157](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L157), [158](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L158), [159](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L159), [163](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L163), [164](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L164)]


```solidity
File: src/automators/AutoExit.sol

60:     mapping(uint256 => PositionConfig) public positionConfigs;

```
*Github:* [[60](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L60)]


```solidity
File: src/automators/Automator.sol

34:     mapping(address => bool) public operators;

35:     mapping(address => bool) public vaults;

```
*Github:* [[34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L34), [35](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L35)]


```solidity
File: src/transformers/AutoCompound.sol

45:     mapping(uint256 => mapping(address => uint256)) public positionBalances;

```
*Github:* [[45](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L45)]


```solidity
File: src/transformers/AutoRange.sol

50:     mapping(uint256 => PositionConfig) public positionConfigs;

```
*Github:* [[50](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L50)]


</details>


<a name="NC-47"></a> 
### [NC-47] Named imports of parent contracts are missing

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

/// @audit `Ownable`
/// @audit `IInterestRateModel`
/// @audit `IErrors`
11: contract InterestRateModel is Ownable, IInterestRateModel, IErrors {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L11)]


```solidity
File: src/V3Oracle.sol

/// @audit `IV3Oracle`
/// @audit `Ownable`
/// @audit `IErrors`
24: contract V3Oracle is IV3Oracle, Ownable, IErrors {

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L24)]


```solidity
File: src/V3Vault.sol

/// @audit `ERC20`
/// @audit `Multicall`
/// @audit `Ownable`
/// @audit `IVault`
/// @audit `IERC721Receiver`
/// @audit `IErrors`
30: contract V3Vault is ERC20, Multicall, Ownable, IVault, IERC721Receiver, IErrors {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L30)]


```solidity
File: src/automators/AutoExit.sol

/// @audit `Automator`
10: contract AutoExit is Automator {

```
*Github:* [[10](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L10)]


```solidity
File: src/automators/Automator.sol

/// @audit `Swapper`
/// @audit `Ownable`
19: abstract contract Automator is Swapper, Ownable {

```
*Github:* [[19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L19)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit `Automator`
/// @audit `Multicall`
/// @audit `ReentrancyGuard`
16: contract AutoCompound is Automator, Multicall, ReentrancyGuard {

```
*Github:* [[16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L16)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `Automator`
11: contract AutoRange is Automator {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L11)]


```solidity
File: src/transformers/LeverageTransformer.sol

/// @audit `Swapper`
12: contract LeverageTransformer is Swapper {

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L12)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit `Swapper`
/// @audit `IERC721Receiver`
15: contract V3Utils is Swapper, IERC721Receiver {

```
*Github:* [[15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L15)]


```solidity
File: src/utils/FlashloanLiquidator.sol

/// @audit `Swapper`
/// @audit `IUniswapV3FlashCallback`
11: contract FlashloanLiquidator is Swapper, IUniswapV3FlashCallback {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L11)]


```solidity
File: src/utils/Swapper.sol

/// @audit `IUniswapV3SwapCallback`
/// @audit `IErrors`
17: abstract contract Swapper is IUniswapV3SwapCallback, IErrors {

```
*Github:* [[17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L17)]


</details>


<a name="NC-48"></a> 
### [NC-48] Missing NatSpec from contract/error/event/function/modifier declarations
e.g. `@dev` or `@notice`, and it must appear above the contract definition braces in order to be identified by the compiler as NatSpec.

<details>
<summary>
There are <b>114</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

18:     event SetValues(

```
*Github:* [[18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L18)]


```solidity
File: src/V3Oracle.sol

30:     event TokenConfigUpdated(address indexed token, TokenConfig config);

31:     event OracleModeUpdated(address indexed token, Mode mode);

32:     event SetMaxPoolPriceDifference(uint16 maxPoolPriceDifference);

33:     event SetEmergencyAdmin(address emergencyAdmin);

74:     constructor(
            INonfungiblePositionManager _nonfungiblePositionManager,
            address _referenceToken,
            address _chainlinkReferenceToken
        ) {

133:     function _checkPoolPrice(address token0, address token1, uint24 fee, uint256 derivedPoolPriceX96) internal view {

139:     function _requireMaxDifference(uint256 priceX96, uint256 verifyPriceX96, uint256 maxDifferenceX10000)
             internal
             pure
         {

272:     function _getReferenceTokenPriceX96(address token, uint256 cachedChainlinkReferencePriceX96)
             internal
             view
             returns (uint256 priceX96, uint256 chainlinkReferencePriceX96)
         {

329:     function _getChainlinkPriceX96(address token) internal view returns (uint256) {

346:     function _getTWAPPriceX96(TokenConfig memory feedConfig) internal view returns (uint256 poolTWAPPriceX96) {

359:     function _getReferencePoolPriceX96(IUniswapV3Pool pool, uint32 twapSeconds) internal view returns (uint256) {

395:     function _initializeState(uint256 tokenId) internal view returns (PositionState memory state) {

426:     function _getAmounts(PositionState memory state)
             internal
             view
             returns (uint256 amount0, uint256 amount1, uint128 fees0, uint128 fees1)
         {

445:     function _getUncollectedFees(PositionState memory position, int24 tick)
             internal
             view
             returns (uint128 fees0, uint128 fees1)
         {

472:     function _getFeeGrowthInside(
             IUniswapV3Pool pool,
             int24 tickLower,
             int24 tickUpper,
             int24 tickCurrent,
             uint256 feeGrowthGlobal0X128,
             uint256 feeGrowthGlobal1X128
         ) internal view returns (uint256 feeGrowthInside0X128, uint256 feeGrowthInside1X128) {

499:     function _getPool(address tokenA, address tokenB, uint24 fee) internal view returns (IUniswapV3Pool) {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L30), [31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L31), [32](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L32), [33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L33), [74](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L74), [133](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L133), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L139), [272](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L272), [329](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L329), [346](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L346), [359](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L359), [395](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L395), [426](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L426), [445](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L445), [472](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L472), [499](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L499)]


```solidity
File: src/V3Vault.sol

68:     event ApprovedTransform(uint256 indexed tokenId, address owner, address target, bool isActive);

70:     event Add(uint256 indexed tokenId, address owner, uint256 oldTokenId); // when a token is added replacing another token - oldTokenId > 0

71:     event Remove(uint256 indexed tokenId, address recipient);

73:     event ExchangeRateUpdate(uint256 debtExchangeRateX96, uint256 lendExchangeRateX96);

75:     event WithdrawCollateral(

78:     event Borrow(uint256 indexed tokenId, address owner, uint256 assets, uint256 shares);

79:     event Repay(uint256 indexed tokenId, address repayer, address owner, uint256 assets, uint256 shares);

80:     event Liquidate(

93:     event WithdrawReserves(uint256 amount, address receiver);

94:     event SetTransformer(address transformer, bool active);

95:     event SetLimits(

102:     event SetReserveFactor(uint32 reserveFactorX32);

103:     event SetReserveProtectionFactor(uint32 reserveProtectionFactorX32);

104:     event SetTokenConfig(address token, uint32 collateralFactorX32, uint32 collateralValueLimitFactorX32);

106:     event SetEmergencyAdmin(address emergencyAdmin);

169:     constructor(
             string memory name,
             string memory symbol,
             address _asset,
             INonfungiblePositionManager _nonfungiblePositionManager,
             IInterestRateModel _interestRateModel,
             IV3Oracle _oracle,
             IPermit2 _permit2
         ) ERC20(name, symbol) {

384:     function deposit(uint256 assets, address receiver, bytes calldata permitData) external override returns (uint256) {

390:     function mint(uint256 shares, address receiver, bytes calldata permitData) external override returns (uint256) {

877:     function _deposit(address receiver, uint256 amount, bool isShare, bytes memory permitData)
             internal
             returns (uint256 assets, uint256 shares)
         {

920:     function _withdraw(address receiver, address owner, uint256 amount, bool isShare)
             internal
             returns (uint256 assets, uint256 shares)
         {

954:     function _repay(uint256 tokenId, uint256 amount, bool isShare, bytes memory permitData) internal {

1017:     function _getAvailableBalance(uint256 debtExchangeRateX96, uint256 lendExchangeRateX96)
              internal
              view
              returns (uint256 balance, uint256 available, uint256 reserves)
          {

1032:     function _sendPositionValue(
              uint256 tokenId,
              uint256 liquidationValue,
              uint256 fullValue,
              uint256 feeValue,
              address recipient
          ) internal returns (uint256 amount0, uint256 amount1) {

1077:     function _cleanupLoan(uint256 tokenId, uint256 debtExchangeRateX96, uint256 lendExchangeRateX96, address owner)
              internal
          {

1090:     function _calculateLiquidation(uint256 debt, uint256 fullValue, uint256 collateralValue)
              internal
              pure
              returns (uint256 liquidationValue, uint256 liquidatorCost, uint256 reserveCost)
          {

1123:     function _handleReserveLiquidation(
              uint256 reserveCost,
              uint256 newDebtExchangeRateX96,
              uint256 newLendExchangeRateX96
          ) internal returns (uint256 missing) {

1143:     function _calculateTokenCollateralFactorX32(uint256 tokenId) internal view returns (uint32) {

1150:     function _updateGlobalInterest()
              internal
              returns (uint256 newDebtExchangeRateX96, uint256 newLendExchangeRateX96)
          {

1167:     function _calculateGlobalInterest()
              internal
              view
              returns (uint256 newDebtExchangeRateX96, uint256 newLendExchangeRateX96)
          {

1197:     function _requireLoanIsHealthy(uint256 tokenId, uint256 debt) internal view {

1205:     function _updateAndCheckCollateral(
              uint256 tokenId,
              uint256 debtExchangeRateX96,
              uint256 lendExchangeRateX96,
              uint256 oldShares,
              uint256 newShares
          ) internal {

1246:     function _resetDailyLendIncreaseLimit(uint256 newLendExchangeRateX96, bool force) internal {

1258:     function _resetDailyDebtIncreaseLimit(uint256 newLendExchangeRateX96, bool force) internal {

1270:     function _checkLoanIsHealthy(uint256 tokenId, uint256 debt)
              internal
              view
              returns (bool isHealthy, uint256 fullValue, uint256 collateralValue, uint256 feeValue)
          {

1281:     function _convertToShares(uint256 amount, uint256 exchangeRateX96, Math.Rounding rounding)
              internal
              pure
              returns (uint256)
          {

1289:     function _convertToAssets(uint256 shares, uint256 exchangeRateX96, Math.Rounding rounding)
              internal
              pure
              returns (uint256)
          {

1297:     function _addTokenToOwner(address to, uint256 tokenId) internal {

1303:     function _removeTokenFromOwner(address from, uint256 tokenId) internal {

```
*Github:* [[68](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L68), [70](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L70), [71](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L71), [73](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L73), [75](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L75), [78](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L78), [79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L79), [80](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L80), [93](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L93), [94](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L94), [95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L95), [102](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L102), [103](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L103), [104](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L104), [106](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L106), [169](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L169), [384](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L384), [390](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L390), [877](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L877), [920](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L920), [954](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L954), [1017](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1017), [1032](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1032), [1077](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1077), [1090](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1090), [1123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1123), [1143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1143), [1150](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1150), [1167](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1167), [1197](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1197), [1205](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1205), [1246](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1246), [1258](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1258), [1270](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1270), [1281](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1281), [1289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1289), [1297](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1297), [1303](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1303)]


```solidity
File: src/automators/AutoExit.sol

11:     event Executed(

20:     event PositionConfigured(

33:     constructor(
            INonfungiblePositionManager _npm,
            address _operator,
            address _withdrawer,
            uint32 _TWAPSeconds,
            uint16 _maxTWAPTickDifference,
            address _zeroxRouter,
            address _universalRouter
        ) Automator(_npm, _operator, _withdrawer, _TWAPSeconds, _maxTWAPTickDifference, _zeroxRouter, _universalRouter) {}

218:     function configToken(uint256 tokenId, PositionConfig calldata config) external {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L11), [20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L20), [33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L33), [218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L218)]


```solidity
File: src/automators/Automator.sol

19: abstract contract Automator is Swapper, Ownable {

27:     event OperatorChanged(address newOperator, bool active);

28:     event VaultChanged(address newVault, bool active);

30:     event WithdrawerChanged(address newWithdrawer);

31:     event TWAPConfigChanged(uint32 TWAPSeconds, uint16 maxTWAPTickDifference);

41:     constructor(
            INonfungiblePositionManager npm,
            address _operator,
            address _withdrawer,
            uint32 _TWAPSeconds,
            uint16 _maxTWAPTickDifference,
            address _zeroxRouter,
            address _universalRouter
        ) Swapper(npm, _zeroxRouter, _universalRouter) {

139:     function _validateSwap(
             bool swap0For1,
             uint256 amountIn,
             IUniswapV3Pool pool,
             uint32 twapPeriod,
             uint16 maxTickDifference,
             uint64 maxPriceDifferenceX64
         ) internal view returns (uint256 amountOutMin, int24 currentTick, uint160 sqrtPriceX96, uint256 priceX96) {

166:     function _hasMaxTWAPTickDifference(IUniswapV3Pool pool, uint32 twapPeriod, int24 currentTick, uint16 maxDifference)
             internal
             view
             returns (bool)
         {

180:     function _getTWAPTick(IUniswapV3Pool pool, uint32 twapPeriod) internal view returns (int24, bool) {

193:     function _decreaseFullLiquidityAndCollect(
             uint256 tokenId,
             uint128 liquidity,
             uint256 amountRemoveMin0,
             uint256 amountRemoveMin1,
             uint256 deadline
         ) internal returns (uint256 amount0, uint256 amount1, uint256 feeAmount0, uint256 feeAmount1) {

218:     function _transferToken(address to, IERC20 token, uint256 amount, bool unwrap) internal {

230:     function _validateOwner(uint256 tokenId, address vault) internal returns (address owner) {

251:     receive() external payable {

```
*Github:* [[19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L19), [27](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L27), [28](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L28), [30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L30), [31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L31), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L41), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L139), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L166), [180](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L180), [193](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L193), [218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L218), [230](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L230), [251](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L251)]


```solidity
File: src/transformers/AutoCompound.sol

18:     event AutoCompounded(

30:     event RewardUpdated(address account, uint64 totalRewardX64);

33:     event BalanceAdded(uint256 tokenId, address token, uint256 amount);

34:     event BalanceRemoved(uint256 tokenId, address token, uint256 amount);

35:     event BalanceWithdrawn(uint256 tokenId, address token, address to, uint256 amount);

37:     constructor(
            INonfungiblePositionManager _npm,
            address _operator,
            address _withdrawer,
            uint32 _TWAPSeconds,
            uint16 _maxTWAPTickDifference
        ) Automator(_npm, _operator, _withdrawer, _TWAPSeconds, _maxTWAPTickDifference, address(0), address(0)) {}

249:     function _increaseBalance(uint256 tokenId, address token, uint256 amount) internal {

254:     function _setBalance(uint256 tokenId, address token, uint256 amount) internal {

266:     function _withdrawBalanceInternal(uint256 tokenId, address token, address to, uint256 balance, uint256 amount)
             internal
         {

276:     function _checkApprovals(address token0, address token1) internal {

```
*Github:* [[18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L18), [30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L30), [33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L33), [34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L34), [35](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L35), [37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L37), [249](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L249), [254](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L254), [266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L266), [276](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L276)]


```solidity
File: src/transformers/AutoRange.sol

12:     event RangeChanged(uint256 indexed oldTokenId, uint256 indexed newTokenId);

13:     event PositionConfigured(

25:     constructor(
            INonfungiblePositionManager _npm,
            address _operator,
            address _withdrawer,
            uint32 _TWAPSeconds,
            uint16 _maxTWAPTickDifference,
            address _zeroxRouter,
            address _universalRouter
        ) Automator(_npm, _operator, _withdrawer, _TWAPSeconds, _maxTWAPTickDifference, _zeroxRouter, _universalRouter) {}

276:     function configToken(uint256 tokenId, address vault, PositionConfig calldata config) external {

300:     function _getTickSpacing(uint24 fee) internal view returns (int24) {

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L12), [13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L13), [25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L25), [276](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L276), [300](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L300)]


```solidity
File: src/transformers/LeverageTransformer.sol

13:     constructor(INonfungiblePositionManager _nonfungiblePositionManager, address _zeroxRouter, address _universalRouter)
            Swapper(_nonfungiblePositionManager, _zeroxRouter, _universalRouter)
        {}

40:     function leverageUp(LeverageUpParams calldata params) external {

123:     function leverageDown(LeverageDownParams calldata params) external {

```
*Github:* [[13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L13), [40](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L40), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L123)]


```solidity
File: src/transformers/V3Utils.sol

22:     event CompoundFees(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

23:     event ChangeRange(uint256 indexed tokenId, uint256 newTokenId);

24:     event WithdrawAndCollectAndSwap(uint256 indexed tokenId, address token, uint256 amount);

25:     event SwapAndMint(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

26:     event SwapAndIncreaseLiquidity(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

566:     function _prepareAddApproved(
             IERC20 token0,
             IERC20 token1,
             IERC20 otherToken,
             uint256 amount0,
             uint256 amount1,
             uint256 amountOther
         ) internal {

598:     function _prepareAddPermit2(
             IERC20 token0,
             IERC20 token1,
             IERC20 otherToken,
             uint256 amount0,
             uint256 amount1,
             uint256 amountOther,
             IPermit2.PermitBatchTransferFrom memory permit,
             bytes memory signature
         ) internal {

653:     function _prepareAdd(
             IERC20 token0,
             IERC20 token1,
             IERC20 otherToken,
             uint256 amount0,
             uint256 amount1,
             uint256 amountOther
         ) internal returns (uint256 needed0, uint256 needed1, uint256 neededOther) {

705:     function _swapAndMint(SwapAndMintParams memory params, bool unwrap)
             internal
             returns (uint256 tokenId, uint128 liquidity, uint256 added0, uint256 added1)
         {

735:     function _swapAndIncrease(SwapAndIncreaseLiquidityParams memory params, IERC20 token0, IERC20 token1, bool unwrap)
             internal
             returns (uint128 liquidity, uint256 added0, uint256 added1)
         {

779:     function _swapAndPrepareAmounts(SwapAndMintParams memory params, bool unwrap)
             internal
             returns (uint256 total0, uint256 total1)
         {

841:     function _returnLeftoverTokens(
             address to,
             IERC20 token0,
             IERC20 token1,
             uint256 total0,
             uint256 total1,
             uint256 added0,
             uint256 added1,
             bool unwrap
         ) internal {

864:     function _transferToken(address to, IERC20 token, uint256 amount, bool unwrap) internal {

877:     function _decreaseLiquidity(
             uint256 tokenId,
             uint128 liquidity,
             uint256 deadline,
             uint256 token0Min,
             uint256 token1Min
         ) internal returns (uint256 amount0, uint256 amount1) {

892:     function _collectFees(uint256 tokenId, IERC20 token0, IERC20 token1, uint128 collectAmount0, uint128 collectAmount1)
             internal
             returns (uint256 amount0, uint256 amount1)
         {

914:     receive() external payable {

```
*Github:* [[22](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L22), [23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L23), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L24), [25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L25), [26](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L26), [566](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L566), [598](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L598), [653](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L653), [705](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L705), [735](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L735), [779](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L779), [841](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L841), [864](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L864), [877](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L877), [892](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L892), [914](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L914)]


```solidity
File: src/utils/FlashloanLiquidator.sol

24:     constructor(INonfungiblePositionManager _nonfungiblePositionManager, address _zeroxRouter, address _universalRouter)
            Swapper(_nonfungiblePositionManager, _zeroxRouter, _universalRouter)
        {}

67:     function uniswapV3FlashCallback(uint256 fee0, uint256 fee1, bytes calldata callbackData) external {

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L24), [67](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L67)]


```solidity
File: src/utils/Swapper.sol

17: abstract contract Swapper is IUniswapV3SwapCallback, IErrors {

18:     event Swap(address indexed tokenIn, address indexed tokenOut, uint256 amountIn, uint256 amountOut);

73:     function _routerSwap(RouterSwapParams memory params)
            internal
            returns (uint256 amountInDelta, uint256 amountOutDelta)
        {

132:     function _poolSwap(PoolSwapParams memory params) internal returns (uint256 amountInDelta, uint256 amountOutDelta) {

156:     function uniswapV3SwapCallback(int256 amount0Delta, int256 amount1Delta, bytes calldata data) external override {

171:     function _getPool(address tokenA, address tokenB, uint24 fee) internal view returns (IUniswapV3Pool) {

```
*Github:* [[17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L17), [18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L18), [73](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L73), [132](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L132), [156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L156), [171](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L171)]


</details>


<a name="NC-49"></a> 
### [NC-49] Missing NatSpec `@author` from contract declaration
Some contract definitions have an incomplete NatSpec: add a `@author` notation to improve the code documentation.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

11: contract InterestRateModel is Ownable, IInterestRateModel, IErrors {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L11)]


```solidity
File: src/V3Oracle.sol

24: contract V3Oracle is IV3Oracle, Ownable, IErrors {

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L24)]


```solidity
File: src/V3Vault.sol

30: contract V3Vault is ERC20, Multicall, Ownable, IVault, IERC721Receiver, IErrors {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L30)]


```solidity
File: src/automators/AutoExit.sol

10: contract AutoExit is Automator {

```
*Github:* [[10](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L10)]


```solidity
File: src/automators/Automator.sol

19: abstract contract Automator is Swapper, Ownable {

```
*Github:* [[19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L19)]


```solidity
File: src/transformers/AutoCompound.sol

16: contract AutoCompound is Automator, Multicall, ReentrancyGuard {

```
*Github:* [[16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L16)]


```solidity
File: src/transformers/AutoRange.sol

11: contract AutoRange is Automator {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L11)]


```solidity
File: src/transformers/LeverageTransformer.sol

12: contract LeverageTransformer is Swapper {

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L12)]


```solidity
File: src/transformers/V3Utils.sol

15: contract V3Utils is Swapper, IERC721Receiver {

```
*Github:* [[15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L15)]


```solidity
File: src/utils/FlashloanLiquidator.sol

11: contract FlashloanLiquidator is Swapper, IUniswapV3FlashCallback {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L11)]


```solidity
File: src/utils/Swapper.sol

17: abstract contract Swapper is IUniswapV3SwapCallback, IErrors {

```
*Github:* [[17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L17)]


</details>


<a name="NC-50"></a> 
### [NC-50] Missing NatSpec `@dev` from contract/event/function/modifier declarations
Some contract definitions have an incomplete NatSpec: add a `@dev` notation to improve the code documentation.

<details>
<summary>
There are <b>192</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

11: contract InterestRateModel is Ownable, IInterestRateModel, IErrors {

18:     event SetValues(

33:     constructor(

46:     function getUtilizationRateX96(uint256 cash, uint256 debt) public pure returns (uint256) {

58:     function getRatesPerSecondX96(uint256 cash, uint256 debt)

82:     function setValues(

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L11), [18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L18), [33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L33), [46](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L46), [58](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L58), [82](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L82)]


```solidity
File: src/V3Oracle.sol

24: contract V3Oracle is IV3Oracle, Ownable, IErrors {

30:     event TokenConfigUpdated(address indexed token, TokenConfig config);

31:     event OracleModeUpdated(address indexed token, Mode mode);

32:     event SetMaxPoolPriceDifference(uint16 maxPoolPriceDifference);

33:     event SetEmergencyAdmin(address emergencyAdmin);

74:     constructor(

133:     function _checkPoolPrice(address token0, address token1, uint24 fee, uint256 derivedPoolPriceX96) internal view {

139:     function _requireMaxDifference(uint256 priceX96, uint256 verifyPriceX96, uint256 maxDifferenceX10000)

162:     function getPositionBreakdown(uint256 tokenId)

185:     function setMaxPoolPriceDifference(uint16 _maxPoolPriceDifference) external onlyOwner {

201:     function setTokenConfig(

249:     function setOracleMode(address token, Mode mode) external {

265:     function setEmergencyAdmin(address admin) external onlyOwner {

272:     function _getReferenceTokenPriceX96(address token, uint256 cachedChainlinkReferencePriceX96)

329:     function _getChainlinkPriceX96(address token) internal view returns (uint256) {

346:     function _getTWAPPriceX96(TokenConfig memory feedConfig) internal view returns (uint256 poolTWAPPriceX96) {

359:     function _getReferencePoolPriceX96(IUniswapV3Pool pool, uint32 twapSeconds) internal view returns (uint256) {

395:     function _initializeState(uint256 tokenId) internal view returns (PositionState memory state) {

426:     function _getAmounts(PositionState memory state)

445:     function _getUncollectedFees(PositionState memory position, int24 tick)

472:     function _getFeeGrowthInside(

499:     function _getPool(address tokenA, address tokenB, uint24 fee) internal view returns (IUniswapV3Pool) {

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L24), [30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L30), [31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L31), [32](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L32), [33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L33), [74](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L74), [133](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L133), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L139), [162](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L162), [185](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L185), [201](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L201), [249](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L249), [265](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L265), [272](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L272), [329](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L329), [346](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L346), [359](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L359), [395](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L395), [426](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L426), [445](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L445), [472](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L472), [499](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L499)]


```solidity
File: src/V3Vault.sol

30: contract V3Vault is ERC20, Multicall, Ownable, IVault, IERC721Receiver, IErrors {

68:     event ApprovedTransform(uint256 indexed tokenId, address owner, address target, bool isActive);

70:     event Add(uint256 indexed tokenId, address owner, uint256 oldTokenId); // when a token is added replacing another token - oldTokenId > 0

71:     event Remove(uint256 indexed tokenId, address recipient);

73:     event ExchangeRateUpdate(uint256 debtExchangeRateX96, uint256 lendExchangeRateX96);

75:     event WithdrawCollateral(

78:     event Borrow(uint256 indexed tokenId, address owner, uint256 assets, uint256 shares);

79:     event Repay(uint256 indexed tokenId, address repayer, address owner, uint256 assets, uint256 shares);

80:     event Liquidate(

93:     event WithdrawReserves(uint256 amount, address receiver);

94:     event SetTransformer(address transformer, bool active);

95:     event SetLimits(

102:     event SetReserveFactor(uint32 reserveFactorX32);

103:     event SetReserveProtectionFactor(uint32 reserveProtectionFactorX32);

104:     event SetTokenConfig(address token, uint32 collateralFactorX32, uint32 collateralValueLimitFactorX32);

106:     event SetEmergencyAdmin(address emergencyAdmin);

169:     constructor(

195:     function vaultInfo()

219:     function lendInfo(address account) external view override returns (uint256 amount) {

231:     function loanInfo(uint256 tokenId)

258:     function ownerOf(uint256 tokenId) external view override returns (address owner) {

264:     function loanCount(address owner) external view override returns (uint256) {

271:     function loanAtIndex(address owner, uint256 index) external view override returns (uint256) {

277:     function decimals() public view override(IERC20Metadata, ERC20) returns (uint8) {

284:     function totalAssets() public view override returns (uint256) {

289:     function convertToShares(uint256 assets) external view override returns (uint256 shares) {

295:     function convertToAssets(uint256 shares) external view override returns (uint256 assets) {

301:     function maxDeposit(address) external view override returns (uint256) {

312:     function maxMint(address) external view override returns (uint256) {

323:     function maxWithdraw(address owner) external view override returns (uint256) {

329:     function maxRedeem(address owner) external view override returns (uint256) {

334:     function previewDeposit(uint256 assets) public view override returns (uint256) {

340:     function previewMint(uint256 shares) public view override returns (uint256) {

346:     function previewWithdraw(uint256 assets) public view override returns (uint256) {

352:     function previewRedeem(uint256 shares) public view override returns (uint256) {

360:     function deposit(uint256 assets, address receiver) external override returns (uint256) {

366:     function mint(uint256 shares, address receiver) external override returns (uint256) {

372:     function withdraw(uint256 assets, address receiver, address owner) external override returns (uint256) {

378:     function redeem(uint256 shares, address receiver, address owner) external override returns (uint256) {

384:     function deposit(uint256 assets, address receiver, bytes calldata permitData) external override returns (uint256) {

390:     function mint(uint256 shares, address receiver, bytes calldata permitData) external override returns (uint256) {

400:     function create(uint256 tokenId, address recipient) external override {

410:     function createWithPermit(

429:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)

483:     function approveTransform(uint256 tokenId, address target, bool isActive) external override {

497:     function transform(uint256 tokenId, address transformer, bytes calldata data)

550:     function borrow(uint256 tokenId, uint256 assets) external override {

652:     function repay(uint256 tokenId, uint256 amount, bool isShare) external override {

661:     function repay(uint256 tokenId, uint256 amount, bool isShare, bytes calldata permitData) external override {

685:     function liquidate(LiquidateParams calldata params) external override returns (uint256 amount0, uint256 amount1) {

765:     function withdrawReserves(uint256 amount, address receiver) external onlyOwner {

788:     function setTransformer(address transformer, bool active) external onlyOwner {

807:     function setLimits(

837:     function setReserveFactor(uint32 _reserveFactorX32) external onlyOwner {

844:     function setReserveProtectionFactor(uint32 _reserveProtectionFactorX32) external onlyOwner {

856:     function setTokenConfig(address token, uint32 collateralFactorX32, uint32 collateralValueLimitFactorX32)

870:     function setEmergencyAdmin(address admin) external onlyOwner {

877:     function _deposit(address receiver, uint256 amount, bool isShare, bytes memory permitData)

920:     function _withdraw(address receiver, address owner, uint256 amount, bool isShare)

954:     function _repay(uint256 tokenId, uint256 amount, bool isShare, bytes memory permitData) internal {

1017:     function _getAvailableBalance(uint256 debtExchangeRateX96, uint256 lendExchangeRateX96)

1032:     function _sendPositionValue(

1077:     function _cleanupLoan(uint256 tokenId, uint256 debtExchangeRateX96, uint256 lendExchangeRateX96, address owner)

1090:     function _calculateLiquidation(uint256 debt, uint256 fullValue, uint256 collateralValue)

1123:     function _handleReserveLiquidation(

1143:     function _calculateTokenCollateralFactorX32(uint256 tokenId) internal view returns (uint32) {

1150:     function _updateGlobalInterest()

1167:     function _calculateGlobalInterest()

1197:     function _requireLoanIsHealthy(uint256 tokenId, uint256 debt) internal view {

1205:     function _updateAndCheckCollateral(

1246:     function _resetDailyLendIncreaseLimit(uint256 newLendExchangeRateX96, bool force) internal {

1258:     function _resetDailyDebtIncreaseLimit(uint256 newLendExchangeRateX96, bool force) internal {

1270:     function _checkLoanIsHealthy(uint256 tokenId, uint256 debt)

1281:     function _convertToShares(uint256 amount, uint256 exchangeRateX96, Math.Rounding rounding)

1289:     function _convertToAssets(uint256 shares, uint256 exchangeRateX96, Math.Rounding rounding)

1297:     function _addTokenToOwner(address to, uint256 tokenId) internal {

1303:     function _removeTokenFromOwner(address from, uint256 tokenId) internal {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L30), [68](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L68), [70](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L70), [71](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L71), [73](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L73), [75](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L75), [78](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L78), [79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L79), [80](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L80), [93](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L93), [94](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L94), [95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L95), [102](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L102), [103](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L103), [104](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L104), [106](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L106), [169](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L169), [195](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L195), [219](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L219), [231](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L231), [258](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L258), [264](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L264), [271](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L271), [277](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L277), [284](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L284), [289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L289), [295](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L295), [301](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L301), [312](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L312), [323](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L323), [329](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L329), [334](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L334), [340](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L340), [346](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L346), [352](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L352), [360](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L360), [366](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L366), [372](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L372), [378](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L378), [384](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L384), [390](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L390), [400](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L400), [410](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L410), [429](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L429), [483](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L483), [497](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L497), [550](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L550), [652](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L652), [661](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L661), [685](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L685), [765](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L765), [788](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L788), [807](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L807), [837](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L837), [844](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L844), [856](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L856), [870](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L870), [877](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L877), [920](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L920), [954](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L954), [1017](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1017), [1032](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1032), [1077](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1077), [1090](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1090), [1123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1123), [1143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1143), [1150](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1150), [1167](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1167), [1197](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1197), [1205](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1205), [1246](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1246), [1258](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1258), [1270](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1270), [1281](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1281), [1289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1289), [1297](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1297), [1303](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1303)]


```solidity
File: src/automators/AutoExit.sol

10: contract AutoExit is Automator {

11:     event Executed(

20:     event PositionConfigured(

33:     constructor(

100:     function execute(ExecuteParams calldata params) external {

218:     function configToken(uint256 tokenId, PositionConfig calldata config) external {

```
*Github:* [[10](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L10), [11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L11), [20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L20), [33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L33), [100](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L100), [218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L218)]


```solidity
File: src/automators/Automator.sol

19: abstract contract Automator is Swapper, Ownable {

27:     event OperatorChanged(address newOperator, bool active);

28:     event VaultChanged(address newVault, bool active);

30:     event WithdrawerChanged(address newWithdrawer);

31:     event TWAPConfigChanged(uint32 TWAPSeconds, uint16 maxTWAPTickDifference);

41:     constructor(

59:     function setWithdrawer(address _withdrawer) public onlyOwner {

69:     function setOperator(address _operator, bool _active) public onlyOwner {

79:     function setVault(address _vault, bool _active) public onlyOwner {

87:     function setTWAPConfig(uint16 _maxTWAPTickDifference, uint32 _TWAPSeconds) public onlyOwner {

104:     function withdrawBalances(address[] calldata tokens, address to) external virtual {

123:     function withdrawETH(address to) external {

139:     function _validateSwap(

166:     function _hasMaxTWAPTickDifference(IUniswapV3Pool pool, uint32 twapPeriod, int24 currentTick, uint16 maxDifference)

180:     function _getTWAPTick(IUniswapV3Pool pool, uint32 twapPeriod) internal view returns (int24, bool) {

193:     function _decreaseFullLiquidityAndCollect(

218:     function _transferToken(address to, IERC20 token, uint256 amount, bool unwrap) internal {

230:     function _validateOwner(uint256 tokenId, address vault) internal returns (address owner) {

251:     receive() external payable {

```
*Github:* [[19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L19), [27](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L27), [28](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L28), [30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L30), [31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L31), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L41), [59](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L59), [69](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L69), [79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L79), [87](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L87), [104](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L104), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L123), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L139), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L166), [180](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L180), [193](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L193), [218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L218), [230](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L230), [251](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L251)]


```solidity
File: src/transformers/AutoCompound.sol

16: contract AutoCompound is Automator, Multicall, ReentrancyGuard {

18:     event AutoCompounded(

30:     event RewardUpdated(address account, uint64 totalRewardX64);

33:     event BalanceAdded(uint256 tokenId, address token, uint256 amount);

34:     event BalanceRemoved(uint256 tokenId, address token, uint256 amount);

35:     event BalanceWithdrawn(uint256 tokenId, address token, address to, uint256 amount);

37:     constructor(

87:     function executeWithVault(ExecuteParams calldata params, address vault) external {

101:     function execute(ExecuteParams calldata params) external nonReentrant {

200:     function withdrawLeftoverBalances(uint256 tokenId, address to) external nonReentrant {

243:     function setReward(uint64 _totalRewardX64) external onlyOwner {

249:     function _increaseBalance(uint256 tokenId, address token, uint256 amount) internal {

254:     function _setBalance(uint256 tokenId, address token, uint256 amount) internal {

266:     function _withdrawBalanceInternal(uint256 tokenId, address token, address to, uint256 balance, uint256 amount)

276:     function _checkApprovals(address token0, address token1) internal {

```
*Github:* [[16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L16), [18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L18), [30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L30), [33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L33), [34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L34), [35](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L35), [37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L37), [87](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L87), [101](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L101), [200](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L200), [243](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L243), [249](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L249), [254](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L254), [266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L266), [276](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L276)]


```solidity
File: src/transformers/AutoRange.sol

11: contract AutoRange is Automator {

12:     event RangeChanged(uint256 indexed oldTokenId, uint256 indexed newTokenId);

13:     event PositionConfigured(

25:     constructor(

97:     function executeWithVault(ExecuteParams calldata params, address vault) external {

111:     function execute(ExecuteParams calldata params) external {

276:     function configToken(uint256 tokenId, address vault, PositionConfig calldata config) external {

300:     function _getTickSpacing(uint24 fee) internal view returns (int24) {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L11), [12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L12), [13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L13), [25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L25), [97](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L97), [111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L111), [276](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L276), [300](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L300)]


```solidity
File: src/transformers/LeverageTransformer.sol

12: contract LeverageTransformer is Swapper {

13:     constructor(INonfungiblePositionManager _nonfungiblePositionManager, address _zeroxRouter, address _universalRouter)

40:     function leverageUp(LeverageUpParams calldata params) external {

123:     function leverageDown(LeverageDownParams calldata params) external {

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L12), [13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L13), [40](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L40), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L123)]


```solidity
File: src/transformers/V3Utils.sol

15: contract V3Utils is Swapper, IERC721Receiver {

22:     event CompoundFees(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

23:     event ChangeRange(uint256 indexed tokenId, uint256 newTokenId);

24:     event WithdrawAndCollectAndSwap(uint256 indexed tokenId, address token, uint256 amount);

25:     event SwapAndMint(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

26:     event SwapAndIncreaseLiquidity(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

31:     constructor(

98:     function executeWithPermit(uint256 tokenId, Instructions memory instructions, uint8 v, bytes32 r, bytes32 s)

115:     function execute(uint256 tokenId, Instructions memory instructions) public returns (uint256 newTokenId) {

356:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)

397:     function swap(SwapParams calldata params) external payable returns (uint256 amountOut) {

467:     function swapAndMint(SwapAndMintParams calldata params)

532:     function swapAndIncreaseLiquidity(SwapAndIncreaseLiquidityParams calldata params)

566:     function _prepareAddApproved(

598:     function _prepareAddPermit2(

653:     function _prepareAdd(

705:     function _swapAndMint(SwapAndMintParams memory params, bool unwrap)

735:     function _swapAndIncrease(SwapAndIncreaseLiquidityParams memory params, IERC20 token0, IERC20 token1, bool unwrap)

779:     function _swapAndPrepareAmounts(SwapAndMintParams memory params, bool unwrap)

841:     function _returnLeftoverTokens(

864:     function _transferToken(address to, IERC20 token, uint256 amount, bool unwrap) internal {

877:     function _decreaseLiquidity(

892:     function _collectFees(uint256 tokenId, IERC20 token0, IERC20 token1, uint128 collectAmount0, uint128 collectAmount1)

914:     receive() external payable {

```
*Github:* [[15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L15), [22](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L22), [23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L23), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L24), [25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L25), [26](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L26), [31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L31), [98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L98), [115](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L115), [356](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L356), [397](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L397), [467](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L467), [532](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L532), [566](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L566), [598](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L598), [653](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L653), [705](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L705), [735](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L735), [779](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L779), [841](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L841), [864](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L864), [877](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L877), [892](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L892), [914](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L914)]


```solidity
File: src/utils/FlashloanLiquidator.sol

11: contract FlashloanLiquidator is Swapper, IUniswapV3FlashCallback {

24:     constructor(INonfungiblePositionManager _nonfungiblePositionManager, address _zeroxRouter, address _universalRouter)

41:     function liquidate(LiquidateParams calldata params) external {

67:     function uniswapV3FlashCallback(uint256 fee0, uint256 fee1, bytes calldata callbackData) external {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L11), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L24), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L41), [67](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L67)]


```solidity
File: src/utils/Swapper.sol

17: abstract contract Swapper is IUniswapV3SwapCallback, IErrors {

18:     event Swap(address indexed tokenIn, address indexed tokenOut, uint256 amountIn, uint256 amountOut);

37:     constructor(

73:     function _routerSwap(RouterSwapParams memory params)

132:     function _poolSwap(PoolSwapParams memory params) internal returns (uint256 amountInDelta, uint256 amountOutDelta) {

156:     function uniswapV3SwapCallback(int256 amount0Delta, int256 amount1Delta, bytes calldata data) external override {

171:     function _getPool(address tokenA, address tokenB, uint24 fee) internal view returns (IUniswapV3Pool) {

```
*Github:* [[17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L17), [18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L18), [37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L37), [73](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L73), [132](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L132), [156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L156), [171](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L171)]


</details>


<a name="NC-51"></a> 
### [NC-51] Public variable declarations should have NatSpec descriptions

<details>
<summary>
There are <b>42</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

13:     uint256 public constant YEAR_SECS = 31557600; // taking into account leap years

15:     uint256 public constant MAX_BASE_RATE_X96 = Q96 / 10; // 10%

16:     uint256 public constant MAX_MULTIPLIER_X96 = Q96 * 2; // 200%

23:     uint256 public multiplierPerSecondX96;

24:     uint256 public baseRatePerSecondX96;

25:     uint256 public jumpMultiplierPerSecondX96;

```
*Github:* [[13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L13), [15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L15), [16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L16), [23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L23), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L24), [25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L25)]


```solidity
File: src/V3Oracle.sol

25:     uint16 public constant MIN_PRICE_DIFFERENCE = 200; //2%

56:     mapping(address => TokenConfig) public feedConfigs;

58:     address public immutable factory;

59:     INonfungiblePositionManager public immutable nonfungiblePositionManager;

62:     address public immutable referenceToken;

63:     uint8 public immutable referenceTokenDecimals;

68:     address public immutable chainlinkReferenceToken;

```
*Github:* [[25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L25), [56](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L56), [58](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L58), [59](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L59), [62](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L62), [63](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L63), [68](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L68)]


```solidity
File: src/V3Vault.sol

36:     uint32 public constant MAX_COLLATERAL_FACTOR_X32 = uint32(Q32 * 90 / 100); // 90%

38:     uint32 public constant MIN_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 2 / 100); // 2%

39:     uint32 public constant MAX_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 10 / 100); // 10%

41:     uint32 public constant MIN_RESERVE_PROTECTION_FACTOR_X32 = uint32(Q32 / 100); //1%

43:     uint32 public constant MAX_DAILY_LEND_INCREASE_X32 = uint32(Q32 / 10); //10%

44:     uint32 public constant MAX_DAILY_DEBT_INCREASE_X32 = uint32(Q32 / 10); //10%

115:     mapping(address => TokenConfig) public tokenConfigs;

124:     uint256 public debtSharesTotal = 0;

127:     uint256 public lastExchangeRateUpdate = 0;

128:     uint256 public lastDebtExchangeRateX96 = Q96;

129:     uint256 public lastLendExchangeRateX96 = Q96;

139:     uint256 public dailyLendIncreaseLimitLeft = 0;

140:     uint256 public dailyLendIncreaseLimitLastReset = 0;

144:     uint256 public dailyDebtIncreaseLimitLeft = 0;

145:     uint256 public dailyDebtIncreaseLimitLastReset = 0;

154:     mapping(uint256 => Loan) public loans; // tokenID -> loan mapping

163:     mapping(address => bool) public transformerAllowList; // contracts allowed to transform positions (selected audited contracts e.g. V3Utils)

164:     mapping(address => mapping(uint256 => mapping(address => bool))) public transformApprovals; // owners permissions for other addresses to call transform on owners behalf (e.g. AutoRange contract)

```
*Github:* [[36](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L36), [38](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L38), [39](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L39), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L41), [43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L43), [44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L44), [115](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L115), [124](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L124), [127](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L127), [128](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L128), [129](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L129), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L139), [140](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L140), [144](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L144), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L145), [154](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L154), [163](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L163), [164](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L164)]


```solidity
File: src/automators/AutoExit.sol

60:     mapping(uint256 => PositionConfig) public positionConfigs;

```
*Github:* [[60](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L60)]


```solidity
File: src/automators/Automator.sol

23:     uint32 public constant MIN_TWAP_SECONDS = 60; // 1 minute

24:     uint32 public constant MAX_TWAP_TICK_DIFFERENCE = 200; // 2%

34:     mapping(address => bool) public operators;

35:     mapping(address => bool) public vaults;

37:     address public withdrawer;

```
*Github:* [[23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L23), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L24), [34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L34), [35](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L35), [37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L37)]


```solidity
File: src/transformers/AutoCompound.sol

45:     mapping(uint256 => mapping(address => uint256)) public positionBalances;

47:     uint64 public constant MAX_REWARD_X64 = uint64(Q64 / 50); // 2%

```
*Github:* [[45](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L45), [47](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L47)]


```solidity
File: src/transformers/AutoRange.sol

50:     mapping(uint256 => PositionConfig) public positionConfigs;

```
*Github:* [[50](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L50)]


```solidity
File: src/transformers/V3Utils.sol

19:     IPermit2 public immutable permit2;

```
*Github:* [[19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L19)]


```solidity
File: src/utils/Swapper.sol

23:     address public immutable factory;

```
*Github:* [[23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L23)]


</details>


<a name="NC-52"></a> 
### [NC-52] Missing NatSpec `@notice` from contract/event/function/modifier declarations
Some contract definitions have an incomplete NatSpec: add a `@notice` notation to improve the code documentation.

<details>
<summary>
There are <b>132</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

18:     event SetValues(

```
*Github:* [[18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L18)]


```solidity
File: src/V3Oracle.sol

30:     event TokenConfigUpdated(address indexed token, TokenConfig config);

31:     event OracleModeUpdated(address indexed token, Mode mode);

32:     event SetMaxPoolPriceDifference(uint16 maxPoolPriceDifference);

33:     event SetEmergencyAdmin(address emergencyAdmin);

74:     constructor(

133:     function _checkPoolPrice(address token0, address token1, uint24 fee, uint256 derivedPoolPriceX96) internal view {

139:     function _requireMaxDifference(uint256 priceX96, uint256 verifyPriceX96, uint256 maxDifferenceX10000)

272:     function _getReferenceTokenPriceX96(address token, uint256 cachedChainlinkReferencePriceX96)

329:     function _getChainlinkPriceX96(address token) internal view returns (uint256) {

346:     function _getTWAPPriceX96(TokenConfig memory feedConfig) internal view returns (uint256 poolTWAPPriceX96) {

359:     function _getReferencePoolPriceX96(IUniswapV3Pool pool, uint32 twapSeconds) internal view returns (uint256) {

395:     function _initializeState(uint256 tokenId) internal view returns (PositionState memory state) {

426:     function _getAmounts(PositionState memory state)

445:     function _getUncollectedFees(PositionState memory position, int24 tick)

472:     function _getFeeGrowthInside(

499:     function _getPool(address tokenA, address tokenB, uint24 fee) internal view returns (IUniswapV3Pool) {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L30), [31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L31), [32](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L32), [33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L33), [74](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L74), [133](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L133), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L139), [272](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L272), [329](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L329), [346](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L346), [359](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L359), [395](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L395), [426](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L426), [445](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L445), [472](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L472), [499](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L499)]


```solidity
File: src/V3Vault.sol

68:     event ApprovedTransform(uint256 indexed tokenId, address owner, address target, bool isActive);

70:     event Add(uint256 indexed tokenId, address owner, uint256 oldTokenId); // when a token is added replacing another token - oldTokenId > 0

71:     event Remove(uint256 indexed tokenId, address recipient);

73:     event ExchangeRateUpdate(uint256 debtExchangeRateX96, uint256 lendExchangeRateX96);

75:     event WithdrawCollateral(

78:     event Borrow(uint256 indexed tokenId, address owner, uint256 assets, uint256 shares);

79:     event Repay(uint256 indexed tokenId, address repayer, address owner, uint256 assets, uint256 shares);

80:     event Liquidate(

93:     event WithdrawReserves(uint256 amount, address receiver);

94:     event SetTransformer(address transformer, bool active);

95:     event SetLimits(

102:     event SetReserveFactor(uint32 reserveFactorX32);

103:     event SetReserveProtectionFactor(uint32 reserveProtectionFactorX32);

104:     event SetTokenConfig(address token, uint32 collateralFactorX32, uint32 collateralValueLimitFactorX32);

106:     event SetEmergencyAdmin(address emergencyAdmin);

169:     constructor(

277:     function decimals() public view override(IERC20Metadata, ERC20) returns (uint8) {

284:     function totalAssets() public view override returns (uint256) {

289:     function convertToShares(uint256 assets) external view override returns (uint256 shares) {

295:     function convertToAssets(uint256 shares) external view override returns (uint256 assets) {

301:     function maxDeposit(address) external view override returns (uint256) {

312:     function maxMint(address) external view override returns (uint256) {

323:     function maxWithdraw(address owner) external view override returns (uint256) {

329:     function maxRedeem(address owner) external view override returns (uint256) {

334:     function previewDeposit(uint256 assets) public view override returns (uint256) {

340:     function previewMint(uint256 shares) public view override returns (uint256) {

346:     function previewWithdraw(uint256 assets) public view override returns (uint256) {

352:     function previewRedeem(uint256 shares) public view override returns (uint256) {

360:     function deposit(uint256 assets, address receiver) external override returns (uint256) {

366:     function mint(uint256 shares, address receiver) external override returns (uint256) {

372:     function withdraw(uint256 assets, address receiver, address owner) external override returns (uint256) {

378:     function redeem(uint256 shares, address receiver, address owner) external override returns (uint256) {

384:     function deposit(uint256 assets, address receiver, bytes calldata permitData) external override returns (uint256) {

390:     function mint(uint256 shares, address receiver, bytes calldata permitData) external override returns (uint256) {

609:     function decreaseLiquidityAndCollect(DecreaseLiquidityAndCollectParams calldata params)

877:     function _deposit(address receiver, uint256 amount, bool isShare, bytes memory permitData)

920:     function _withdraw(address receiver, address owner, uint256 amount, bool isShare)

954:     function _repay(uint256 tokenId, uint256 amount, bool isShare, bytes memory permitData) internal {

1017:     function _getAvailableBalance(uint256 debtExchangeRateX96, uint256 lendExchangeRateX96)

1032:     function _sendPositionValue(

1077:     function _cleanupLoan(uint256 tokenId, uint256 debtExchangeRateX96, uint256 lendExchangeRateX96, address owner)

1090:     function _calculateLiquidation(uint256 debt, uint256 fullValue, uint256 collateralValue)

1123:     function _handleReserveLiquidation(

1143:     function _calculateTokenCollateralFactorX32(uint256 tokenId) internal view returns (uint32) {

1150:     function _updateGlobalInterest()

1167:     function _calculateGlobalInterest()

1197:     function _requireLoanIsHealthy(uint256 tokenId, uint256 debt) internal view {

1205:     function _updateAndCheckCollateral(

1246:     function _resetDailyLendIncreaseLimit(uint256 newLendExchangeRateX96, bool force) internal {

1258:     function _resetDailyDebtIncreaseLimit(uint256 newLendExchangeRateX96, bool force) internal {

1270:     function _checkLoanIsHealthy(uint256 tokenId, uint256 debt)

1281:     function _convertToShares(uint256 amount, uint256 exchangeRateX96, Math.Rounding rounding)

1289:     function _convertToAssets(uint256 shares, uint256 exchangeRateX96, Math.Rounding rounding)

1297:     function _addTokenToOwner(address to, uint256 tokenId) internal {

1303:     function _removeTokenFromOwner(address from, uint256 tokenId) internal {

```
*Github:* [[68](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L68), [70](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L70), [71](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L71), [73](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L73), [75](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L75), [78](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L78), [79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L79), [80](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L80), [93](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L93), [94](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L94), [95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L95), [102](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L102), [103](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L103), [104](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L104), [106](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L106), [169](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L169), [277](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L277), [284](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L284), [289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L289), [295](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L295), [301](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L301), [312](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L312), [323](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L323), [329](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L329), [334](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L334), [340](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L340), [346](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L346), [352](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L352), [360](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L360), [366](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L366), [372](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L372), [378](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L378), [384](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L384), [390](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L390), [609](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L609), [877](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L877), [920](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L920), [954](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L954), [1017](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1017), [1032](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1032), [1077](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1077), [1090](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1090), [1123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1123), [1143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1143), [1150](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1150), [1167](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1167), [1197](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1197), [1205](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1205), [1246](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1246), [1258](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1258), [1270](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1270), [1281](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1281), [1289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1289), [1297](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1297), [1303](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1303)]


```solidity
File: src/automators/AutoExit.sol

11:     event Executed(

20:     event PositionConfigured(

33:     constructor(

218:     function configToken(uint256 tokenId, PositionConfig calldata config) external {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L11), [20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L20), [33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L33), [218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L218)]


```solidity
File: src/automators/Automator.sol

19: abstract contract Automator is Swapper, Ownable {

27:     event OperatorChanged(address newOperator, bool active);

28:     event VaultChanged(address newVault, bool active);

30:     event WithdrawerChanged(address newWithdrawer);

31:     event TWAPConfigChanged(uint32 TWAPSeconds, uint16 maxTWAPTickDifference);

41:     constructor(

139:     function _validateSwap(

166:     function _hasMaxTWAPTickDifference(IUniswapV3Pool pool, uint32 twapPeriod, int24 currentTick, uint16 maxDifference)

180:     function _getTWAPTick(IUniswapV3Pool pool, uint32 twapPeriod) internal view returns (int24, bool) {

193:     function _decreaseFullLiquidityAndCollect(

218:     function _transferToken(address to, IERC20 token, uint256 amount, bool unwrap) internal {

230:     function _validateOwner(uint256 tokenId, address vault) internal returns (address owner) {

251:     receive() external payable {

```
*Github:* [[19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L19), [27](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L27), [28](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L28), [30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L30), [31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L31), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L41), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L139), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L166), [180](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L180), [193](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L193), [218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L218), [230](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L230), [251](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L251)]


```solidity
File: src/transformers/AutoCompound.sol

18:     event AutoCompounded(

30:     event RewardUpdated(address account, uint64 totalRewardX64);

33:     event BalanceAdded(uint256 tokenId, address token, uint256 amount);

34:     event BalanceRemoved(uint256 tokenId, address token, uint256 amount);

35:     event BalanceWithdrawn(uint256 tokenId, address token, address to, uint256 amount);

37:     constructor(

249:     function _increaseBalance(uint256 tokenId, address token, uint256 amount) internal {

254:     function _setBalance(uint256 tokenId, address token, uint256 amount) internal {

266:     function _withdrawBalanceInternal(uint256 tokenId, address token, address to, uint256 balance, uint256 amount)

276:     function _checkApprovals(address token0, address token1) internal {

```
*Github:* [[18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L18), [30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L30), [33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L33), [34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L34), [35](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L35), [37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L37), [249](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L249), [254](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L254), [266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L266), [276](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L276)]


```solidity
File: src/transformers/AutoRange.sol

12:     event RangeChanged(uint256 indexed oldTokenId, uint256 indexed newTokenId);

13:     event PositionConfigured(

25:     constructor(

276:     function configToken(uint256 tokenId, address vault, PositionConfig calldata config) external {

300:     function _getTickSpacing(uint24 fee) internal view returns (int24) {

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L12), [13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L13), [25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L25), [276](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L276), [300](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L300)]


```solidity
File: src/transformers/LeverageTransformer.sol

13:     constructor(INonfungiblePositionManager _nonfungiblePositionManager, address _zeroxRouter, address _universalRouter)

40:     function leverageUp(LeverageUpParams calldata params) external {

123:     function leverageDown(LeverageDownParams calldata params) external {

```
*Github:* [[13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L13), [40](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L40), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L123)]


```solidity
File: src/transformers/V3Utils.sol

22:     event CompoundFees(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

23:     event ChangeRange(uint256 indexed tokenId, uint256 newTokenId);

24:     event WithdrawAndCollectAndSwap(uint256 indexed tokenId, address token, uint256 amount);

25:     event SwapAndMint(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

26:     event SwapAndIncreaseLiquidity(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

566:     function _prepareAddApproved(

598:     function _prepareAddPermit2(

653:     function _prepareAdd(

705:     function _swapAndMint(SwapAndMintParams memory params, bool unwrap)

735:     function _swapAndIncrease(SwapAndIncreaseLiquidityParams memory params, IERC20 token0, IERC20 token1, bool unwrap)

779:     function _swapAndPrepareAmounts(SwapAndMintParams memory params, bool unwrap)

841:     function _returnLeftoverTokens(

864:     function _transferToken(address to, IERC20 token, uint256 amount, bool unwrap) internal {

877:     function _decreaseLiquidity(

892:     function _collectFees(uint256 tokenId, IERC20 token0, IERC20 token1, uint128 collectAmount0, uint128 collectAmount1)

914:     receive() external payable {

```
*Github:* [[22](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L22), [23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L23), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L24), [25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L25), [26](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L26), [566](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L566), [598](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L598), [653](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L653), [705](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L705), [735](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L735), [779](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L779), [841](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L841), [864](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L864), [877](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L877), [892](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L892), [914](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L914)]


```solidity
File: src/utils/FlashloanLiquidator.sol

11: contract FlashloanLiquidator is Swapper, IUniswapV3FlashCallback {

24:     constructor(INonfungiblePositionManager _nonfungiblePositionManager, address _zeroxRouter, address _universalRouter)

67:     function uniswapV3FlashCallback(uint256 fee0, uint256 fee1, bytes calldata callbackData) external {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L11), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L24), [67](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L67)]


```solidity
File: src/utils/Swapper.sol

17: abstract contract Swapper is IUniswapV3SwapCallback, IErrors {

18:     event Swap(address indexed tokenIn, address indexed tokenOut, uint256 amountIn, uint256 amountOut);

73:     function _routerSwap(RouterSwapParams memory params)

132:     function _poolSwap(PoolSwapParams memory params) internal returns (uint256 amountInDelta, uint256 amountOutDelta) {

156:     function uniswapV3SwapCallback(int256 amount0Delta, int256 amount1Delta, bytes calldata data) external override {

171:     function _getPool(address tokenA, address tokenB, uint24 fee) internal view returns (IUniswapV3Pool) {

```
*Github:* [[17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L17), [18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L18), [73](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L73), [132](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L132), [156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L156), [171](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L171)]


</details>


<a name="NC-53"></a> 
### [NC-53] Missing NatSpec `@param` from event/function/modifier declarations
Some event definitions have an incomplete NatSpec: add a `@param` notation to improve the code documentation.

<details>
<summary>
There are <b>132</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

18:     event SetValues(

```
*Github:* [[18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L18)]


```solidity
File: src/V3Oracle.sol

30:     event TokenConfigUpdated(address indexed token, TokenConfig config);

31:     event OracleModeUpdated(address indexed token, Mode mode);

32:     event SetMaxPoolPriceDifference(uint16 maxPoolPriceDifference);

33:     event SetEmergencyAdmin(address emergencyAdmin);

/// @audit missing @param for `_nonfungiblePositionManager`
/// @audit missing @param for `_referenceToken`
/// @audit missing @param for `_chainlinkReferenceToken`
74:     constructor(
            INonfungiblePositionManager _nonfungiblePositionManager,
            address _referenceToken,
            address _chainlinkReferenceToken
        ) {

/// @audit missing @param for `token0`
/// @audit missing @param for `token1`
/// @audit missing @param for `fee`
/// @audit missing @param for `derivedPoolPriceX96`
133:     function _checkPoolPrice(address token0, address token1, uint24 fee, uint256 derivedPoolPriceX96) internal view {

/// @audit missing @param for `priceX96`
/// @audit missing @param for `verifyPriceX96`
/// @audit missing @param for `maxDifferenceX10000`
139:     function _requireMaxDifference(uint256 priceX96, uint256 verifyPriceX96, uint256 maxDifferenceX10000)
             internal
             pure
         {

/// @audit missing @param for `token`
/// @audit missing @param for `cachedChainlinkReferencePriceX96`
272:     function _getReferenceTokenPriceX96(address token, uint256 cachedChainlinkReferencePriceX96)
             internal
             view
             returns (uint256 priceX96, uint256 chainlinkReferencePriceX96)
         {

/// @audit missing @param for `token`
329:     function _getChainlinkPriceX96(address token) internal view returns (uint256) {

/// @audit missing @param for `feedConfig`
346:     function _getTWAPPriceX96(TokenConfig memory feedConfig) internal view returns (uint256 poolTWAPPriceX96) {

/// @audit missing @param for `pool`
/// @audit missing @param for `twapSeconds`
359:     function _getReferencePoolPriceX96(IUniswapV3Pool pool, uint32 twapSeconds) internal view returns (uint256) {

/// @audit missing @param for `tokenId`
395:     function _initializeState(uint256 tokenId) internal view returns (PositionState memory state) {

/// @audit missing @param for `state`
426:     function _getAmounts(PositionState memory state)
             internal
             view
             returns (uint256 amount0, uint256 amount1, uint128 fees0, uint128 fees1)
         {

/// @audit missing @param for `position`
/// @audit missing @param for `tick`
445:     function _getUncollectedFees(PositionState memory position, int24 tick)
             internal
             view
             returns (uint128 fees0, uint128 fees1)
         {

/// @audit missing @param for `pool`
/// @audit missing @param for `tickLower`
/// @audit missing @param for `tickUpper`
/// @audit missing @param for `tickCurrent`
/// @audit missing @param for `feeGrowthGlobal0X128`
/// @audit missing @param for `feeGrowthGlobal1X128`
472:     function _getFeeGrowthInside(
             IUniswapV3Pool pool,
             int24 tickLower,
             int24 tickUpper,
             int24 tickCurrent,
             uint256 feeGrowthGlobal0X128,
             uint256 feeGrowthGlobal1X128
         ) internal view returns (uint256 feeGrowthInside0X128, uint256 feeGrowthInside1X128) {

/// @audit missing @param for `tokenA`
/// @audit missing @param for `tokenB`
/// @audit missing @param for `fee`
499:     function _getPool(address tokenA, address tokenB, uint24 fee) internal view returns (IUniswapV3Pool) {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L30), [31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L31), [32](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L32), [33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L33), [74](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L74), [133](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L133), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L139), [272](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L272), [329](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L329), [346](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L346), [359](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L359), [395](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L395), [426](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L426), [445](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L445), [472](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L472), [499](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L499)]


```solidity
File: src/V3Vault.sol

68:     event ApprovedTransform(uint256 indexed tokenId, address owner, address target, bool isActive);

70:     event Add(uint256 indexed tokenId, address owner, uint256 oldTokenId); // when a token is added replacing another token - oldTokenId > 0

71:     event Remove(uint256 indexed tokenId, address recipient);

73:     event ExchangeRateUpdate(uint256 debtExchangeRateX96, uint256 lendExchangeRateX96);

75:     event WithdrawCollateral(

78:     event Borrow(uint256 indexed tokenId, address owner, uint256 assets, uint256 shares);

79:     event Repay(uint256 indexed tokenId, address repayer, address owner, uint256 assets, uint256 shares);

80:     event Liquidate(

93:     event WithdrawReserves(uint256 amount, address receiver);

94:     event SetTransformer(address transformer, bool active);

95:     event SetLimits(

102:     event SetReserveFactor(uint32 reserveFactorX32);

103:     event SetReserveProtectionFactor(uint32 reserveProtectionFactorX32);

104:     event SetTokenConfig(address token, uint32 collateralFactorX32, uint32 collateralValueLimitFactorX32);

106:     event SetEmergencyAdmin(address emergencyAdmin);

/// @audit missing @param for `name`
/// @audit missing @param for `symbol`
/// @audit missing @param for `_asset`
/// @audit missing @param for `_nonfungiblePositionManager`
/// @audit missing @param for `_interestRateModel`
/// @audit missing @param for `_oracle`
/// @audit missing @param for `_permit2`
169:     constructor(
             string memory name,
             string memory symbol,
             address _asset,
             INonfungiblePositionManager _nonfungiblePositionManager,
             IInterestRateModel _interestRateModel,
             IV3Oracle _oracle,
             IPermit2 _permit2
         ) ERC20(name, symbol) {

/// @audit missing @param for `assets`
289:     function convertToShares(uint256 assets) external view override returns (uint256 shares) {

/// @audit missing @param for `shares`
295:     function convertToAssets(uint256 shares) external view override returns (uint256 assets) {

/// @audit missing @param for `owner`
323:     function maxWithdraw(address owner) external view override returns (uint256) {

/// @audit missing @param for `owner`
329:     function maxRedeem(address owner) external view override returns (uint256) {

/// @audit missing @param for `assets`
334:     function previewDeposit(uint256 assets) public view override returns (uint256) {

/// @audit missing @param for `shares`
340:     function previewMint(uint256 shares) public view override returns (uint256) {

/// @audit missing @param for `assets`
346:     function previewWithdraw(uint256 assets) public view override returns (uint256) {

/// @audit missing @param for `shares`
352:     function previewRedeem(uint256 shares) public view override returns (uint256) {

/// @audit missing @param for `assets`
/// @audit missing @param for `receiver`
360:     function deposit(uint256 assets, address receiver) external override returns (uint256) {

/// @audit missing @param for `shares`
/// @audit missing @param for `receiver`
366:     function mint(uint256 shares, address receiver) external override returns (uint256) {

/// @audit missing @param for `assets`
/// @audit missing @param for `receiver`
/// @audit missing @param for `owner`
372:     function withdraw(uint256 assets, address receiver, address owner) external override returns (uint256) {

/// @audit missing @param for `shares`
/// @audit missing @param for `receiver`
/// @audit missing @param for `owner`
378:     function redeem(uint256 shares, address receiver, address owner) external override returns (uint256) {

/// @audit missing @param for `assets`
/// @audit missing @param for `receiver`
/// @audit missing @param for `permitData`
384:     function deposit(uint256 assets, address receiver, bytes calldata permitData) external override returns (uint256) {

/// @audit missing @param for `shares`
/// @audit missing @param for `receiver`
/// @audit missing @param for `permitData`
390:     function mint(uint256 shares, address receiver, bytes calldata permitData) external override returns (uint256) {

/// @audit missing @param for `s`
410:     function createWithPermit(
             uint256 tokenId,
             address owner,
             address recipient,
             uint256 deadline,
             uint8 v,
             bytes32 r,
             bytes32 s
         ) external override {

/// @audit missing @param for `from`
/// @audit missing @param for `tokenId`
/// @audit missing @param for `data`
429:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)
             external
             override
             returns (bytes4)
         {

/// @audit missing @param for `receiver`
/// @audit missing @param for `amount`
/// @audit missing @param for `isShare`
/// @audit missing @param for `permitData`
877:     function _deposit(address receiver, uint256 amount, bool isShare, bytes memory permitData)
             internal
             returns (uint256 assets, uint256 shares)
         {

/// @audit missing @param for `receiver`
/// @audit missing @param for `owner`
/// @audit missing @param for `amount`
/// @audit missing @param for `isShare`
920:     function _withdraw(address receiver, address owner, uint256 amount, bool isShare)
             internal
             returns (uint256 assets, uint256 shares)
         {

/// @audit missing @param for `tokenId`
/// @audit missing @param for `amount`
/// @audit missing @param for `isShare`
/// @audit missing @param for `permitData`
954:     function _repay(uint256 tokenId, uint256 amount, bool isShare, bytes memory permitData) internal {

/// @audit missing @param for `debtExchangeRateX96`
/// @audit missing @param for `lendExchangeRateX96`
1017:     function _getAvailableBalance(uint256 debtExchangeRateX96, uint256 lendExchangeRateX96)
              internal
              view
              returns (uint256 balance, uint256 available, uint256 reserves)
          {

/// @audit missing @param for `tokenId`
/// @audit missing @param for `liquidationValue`
/// @audit missing @param for `fullValue`
/// @audit missing @param for `feeValue`
/// @audit missing @param for `recipient`
1032:     function _sendPositionValue(
              uint256 tokenId,
              uint256 liquidationValue,
              uint256 fullValue,
              uint256 feeValue,
              address recipient
          ) internal returns (uint256 amount0, uint256 amount1) {

/// @audit missing @param for `tokenId`
/// @audit missing @param for `debtExchangeRateX96`
/// @audit missing @param for `lendExchangeRateX96`
/// @audit missing @param for `owner`
1077:     function _cleanupLoan(uint256 tokenId, uint256 debtExchangeRateX96, uint256 lendExchangeRateX96, address owner)
              internal
          {

/// @audit missing @param for `debt`
/// @audit missing @param for `fullValue`
/// @audit missing @param for `collateralValue`
1090:     function _calculateLiquidation(uint256 debt, uint256 fullValue, uint256 collateralValue)
              internal
              pure
              returns (uint256 liquidationValue, uint256 liquidatorCost, uint256 reserveCost)
          {

/// @audit missing @param for `reserveCost`
/// @audit missing @param for `newDebtExchangeRateX96`
/// @audit missing @param for `newLendExchangeRateX96`
1123:     function _handleReserveLiquidation(
              uint256 reserveCost,
              uint256 newDebtExchangeRateX96,
              uint256 newLendExchangeRateX96
          ) internal returns (uint256 missing) {

/// @audit missing @param for `tokenId`
1143:     function _calculateTokenCollateralFactorX32(uint256 tokenId) internal view returns (uint32) {

/// @audit missing @param for `tokenId`
/// @audit missing @param for `debt`
1197:     function _requireLoanIsHealthy(uint256 tokenId, uint256 debt) internal view {

/// @audit missing @param for `tokenId`
/// @audit missing @param for `debtExchangeRateX96`
/// @audit missing @param for `lendExchangeRateX96`
/// @audit missing @param for `oldShares`
/// @audit missing @param for `newShares`
1205:     function _updateAndCheckCollateral(
              uint256 tokenId,
              uint256 debtExchangeRateX96,
              uint256 lendExchangeRateX96,
              uint256 oldShares,
              uint256 newShares
          ) internal {

/// @audit missing @param for `newLendExchangeRateX96`
/// @audit missing @param for `force`
1246:     function _resetDailyLendIncreaseLimit(uint256 newLendExchangeRateX96, bool force) internal {

/// @audit missing @param for `newLendExchangeRateX96`
/// @audit missing @param for `force`
1258:     function _resetDailyDebtIncreaseLimit(uint256 newLendExchangeRateX96, bool force) internal {

/// @audit missing @param for `tokenId`
/// @audit missing @param for `debt`
1270:     function _checkLoanIsHealthy(uint256 tokenId, uint256 debt)
              internal
              view
              returns (bool isHealthy, uint256 fullValue, uint256 collateralValue, uint256 feeValue)
          {

/// @audit missing @param for `amount`
/// @audit missing @param for `exchangeRateX96`
/// @audit missing @param for `rounding`
1281:     function _convertToShares(uint256 amount, uint256 exchangeRateX96, Math.Rounding rounding)
              internal
              pure
              returns (uint256)
          {

/// @audit missing @param for `shares`
/// @audit missing @param for `exchangeRateX96`
/// @audit missing @param for `rounding`
1289:     function _convertToAssets(uint256 shares, uint256 exchangeRateX96, Math.Rounding rounding)
              internal
              pure
              returns (uint256)
          {

/// @audit missing @param for `to`
/// @audit missing @param for `tokenId`
1297:     function _addTokenToOwner(address to, uint256 tokenId) internal {

/// @audit missing @param for `from`
/// @audit missing @param for `tokenId`
1303:     function _removeTokenFromOwner(address from, uint256 tokenId) internal {

```
*Github:* [[68](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L68), [70](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L70), [71](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L71), [73](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L73), [75](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L75), [78](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L78), [79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L79), [80](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L80), [93](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L93), [94](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L94), [95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L95), [102](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L102), [103](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L103), [104](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L104), [106](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L106), [169](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L169), [289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L289), [295](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L295), [323](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L323), [329](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L329), [334](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L334), [340](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L340), [346](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L346), [352](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L352), [360](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L360), [366](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L366), [372](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L372), [378](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L378), [384](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L384), [390](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L390), [410](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L410), [429](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L429), [877](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L877), [920](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L920), [954](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L954), [1017](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1017), [1032](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1032), [1077](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1077), [1090](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1090), [1123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1123), [1143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1143), [1197](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1197), [1205](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1205), [1246](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1246), [1258](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1258), [1270](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1270), [1281](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1281), [1289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1289), [1297](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1297), [1303](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1303)]


```solidity
File: src/automators/AutoExit.sol

11:     event Executed(

20:     event PositionConfigured(

/// @audit missing @param for `_npm`
/// @audit missing @param for `_operator`
/// @audit missing @param for `_withdrawer`
/// @audit missing @param for `_TWAPSeconds`
/// @audit missing @param for `_maxTWAPTickDifference`
/// @audit missing @param for `_zeroxRouter`
/// @audit missing @param for `_universalRouter`
33:     constructor(
            INonfungiblePositionManager _npm,
            address _operator,
            address _withdrawer,
            uint32 _TWAPSeconds,
            uint16 _maxTWAPTickDifference,
            address _zeroxRouter,
            address _universalRouter
        ) Automator(_npm, _operator, _withdrawer, _TWAPSeconds, _maxTWAPTickDifference, _zeroxRouter, _universalRouter) {}

/// @audit missing @param for `params`
100:     function execute(ExecuteParams calldata params) external {

/// @audit missing @param for `tokenId`
/// @audit missing @param for `config`
218:     function configToken(uint256 tokenId, PositionConfig calldata config) external {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L11), [20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L20), [33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L33), [100](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L100), [218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L218)]


```solidity
File: src/automators/Automator.sol

27:     event OperatorChanged(address newOperator, bool active);

28:     event VaultChanged(address newVault, bool active);

30:     event WithdrawerChanged(address newWithdrawer);

31:     event TWAPConfigChanged(uint32 TWAPSeconds, uint16 maxTWAPTickDifference);

/// @audit missing @param for `npm`
/// @audit missing @param for `_operator`
/// @audit missing @param for `_withdrawer`
/// @audit missing @param for `_TWAPSeconds`
/// @audit missing @param for `_maxTWAPTickDifference`
/// @audit missing @param for `_zeroxRouter`
/// @audit missing @param for `_universalRouter`
41:     constructor(
            INonfungiblePositionManager npm,
            address _operator,
            address _withdrawer,
            uint32 _TWAPSeconds,
            uint16 _maxTWAPTickDifference,
            address _zeroxRouter,
            address _universalRouter
        ) Swapper(npm, _zeroxRouter, _universalRouter) {

/// @audit missing @param for `_maxTWAPTickDifference`
/// @audit missing @param for `_TWAPSeconds`
87:     function setTWAPConfig(uint16 _maxTWAPTickDifference, uint32 _TWAPSeconds) public onlyOwner {

/// @audit missing @param for `swap0For1`
/// @audit missing @param for `amountIn`
/// @audit missing @param for `pool`
/// @audit missing @param for `twapPeriod`
/// @audit missing @param for `maxTickDifference`
/// @audit missing @param for `maxPriceDifferenceX64`
139:     function _validateSwap(
             bool swap0For1,
             uint256 amountIn,
             IUniswapV3Pool pool,
             uint32 twapPeriod,
             uint16 maxTickDifference,
             uint64 maxPriceDifferenceX64
         ) internal view returns (uint256 amountOutMin, int24 currentTick, uint160 sqrtPriceX96, uint256 priceX96) {

/// @audit missing @param for `pool`
/// @audit missing @param for `twapPeriod`
/// @audit missing @param for `currentTick`
/// @audit missing @param for `maxDifference`
166:     function _hasMaxTWAPTickDifference(IUniswapV3Pool pool, uint32 twapPeriod, int24 currentTick, uint16 maxDifference)
             internal
             view
             returns (bool)
         {

/// @audit missing @param for `pool`
/// @audit missing @param for `twapPeriod`
180:     function _getTWAPTick(IUniswapV3Pool pool, uint32 twapPeriod) internal view returns (int24, bool) {

/// @audit missing @param for `tokenId`
/// @audit missing @param for `liquidity`
/// @audit missing @param for `amountRemoveMin0`
/// @audit missing @param for `amountRemoveMin1`
/// @audit missing @param for `deadline`
193:     function _decreaseFullLiquidityAndCollect(
             uint256 tokenId,
             uint128 liquidity,
             uint256 amountRemoveMin0,
             uint256 amountRemoveMin1,
             uint256 deadline
         ) internal returns (uint256 amount0, uint256 amount1, uint256 feeAmount0, uint256 feeAmount1) {

/// @audit missing @param for `to`
/// @audit missing @param for `token`
/// @audit missing @param for `amount`
/// @audit missing @param for `unwrap`
218:     function _transferToken(address to, IERC20 token, uint256 amount, bool unwrap) internal {

/// @audit missing @param for `tokenId`
/// @audit missing @param for `vault`
230:     function _validateOwner(uint256 tokenId, address vault) internal returns (address owner) {

```
*Github:* [[27](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L27), [28](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L28), [30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L30), [31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L31), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L41), [87](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L87), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L139), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L166), [180](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L180), [193](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L193), [218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L218), [230](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L230)]


```solidity
File: src/transformers/AutoCompound.sol

18:     event AutoCompounded(

30:     event RewardUpdated(address account, uint64 totalRewardX64);

33:     event BalanceAdded(uint256 tokenId, address token, uint256 amount);

34:     event BalanceRemoved(uint256 tokenId, address token, uint256 amount);

35:     event BalanceWithdrawn(uint256 tokenId, address token, address to, uint256 amount);

/// @audit missing @param for `_npm`
/// @audit missing @param for `_operator`
/// @audit missing @param for `_withdrawer`
/// @audit missing @param for `_TWAPSeconds`
/// @audit missing @param for `_maxTWAPTickDifference`
37:     constructor(
            INonfungiblePositionManager _npm,
            address _operator,
            address _withdrawer,
            uint32 _TWAPSeconds,
            uint16 _maxTWAPTickDifference
        ) Automator(_npm, _operator, _withdrawer, _TWAPSeconds, _maxTWAPTickDifference, address(0), address(0)) {}

/// @audit missing @param for `params`
/// @audit missing @param for `vault`
87:     function executeWithVault(ExecuteParams calldata params, address vault) external {

/// @audit missing @param for `params`
101:     function execute(ExecuteParams calldata params) external nonReentrant {

/// @audit missing @param for `tokenId`
/// @audit missing @param for `token`
/// @audit missing @param for `amount`
249:     function _increaseBalance(uint256 tokenId, address token, uint256 amount) internal {

/// @audit missing @param for `tokenId`
/// @audit missing @param for `token`
/// @audit missing @param for `amount`
254:     function _setBalance(uint256 tokenId, address token, uint256 amount) internal {

/// @audit missing @param for `tokenId`
/// @audit missing @param for `token`
/// @audit missing @param for `to`
/// @audit missing @param for `balance`
/// @audit missing @param for `amount`
266:     function _withdrawBalanceInternal(uint256 tokenId, address token, address to, uint256 balance, uint256 amount)
             internal
         {

/// @audit missing @param for `token0`
/// @audit missing @param for `token1`
276:     function _checkApprovals(address token0, address token1) internal {

```
*Github:* [[18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L18), [30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L30), [33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L33), [34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L34), [35](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L35), [37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L37), [87](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L87), [101](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L101), [249](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L249), [254](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L254), [266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L266), [276](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L276)]


```solidity
File: src/transformers/AutoRange.sol

12:     event RangeChanged(uint256 indexed oldTokenId, uint256 indexed newTokenId);

13:     event PositionConfigured(

/// @audit missing @param for `_npm`
/// @audit missing @param for `_operator`
/// @audit missing @param for `_withdrawer`
/// @audit missing @param for `_TWAPSeconds`
/// @audit missing @param for `_maxTWAPTickDifference`
/// @audit missing @param for `_zeroxRouter`
/// @audit missing @param for `_universalRouter`
25:     constructor(
            INonfungiblePositionManager _npm,
            address _operator,
            address _withdrawer,
            uint32 _TWAPSeconds,
            uint16 _maxTWAPTickDifference,
            address _zeroxRouter,
            address _universalRouter
        ) Automator(_npm, _operator, _withdrawer, _TWAPSeconds, _maxTWAPTickDifference, _zeroxRouter, _universalRouter) {}

/// @audit missing @param for `params`
/// @audit missing @param for `vault`
97:     function executeWithVault(ExecuteParams calldata params, address vault) external {

/// @audit missing @param for `params`
111:     function execute(ExecuteParams calldata params) external {

/// @audit missing @param for `tokenId`
/// @audit missing @param for `vault`
/// @audit missing @param for `config`
276:     function configToken(uint256 tokenId, address vault, PositionConfig calldata config) external {

/// @audit missing @param for `fee`
300:     function _getTickSpacing(uint24 fee) internal view returns (int24) {

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L12), [13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L13), [25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L25), [97](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L97), [111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L111), [276](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L276), [300](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L300)]


```solidity
File: src/transformers/LeverageTransformer.sol

/// @audit missing @param for `_nonfungiblePositionManager`
/// @audit missing @param for `_zeroxRouter`
/// @audit missing @param for `_universalRouter`
13:     constructor(INonfungiblePositionManager _nonfungiblePositionManager, address _zeroxRouter, address _universalRouter)
            Swapper(_nonfungiblePositionManager, _zeroxRouter, _universalRouter)
        {}

/// @audit missing @param for `params`
40:     function leverageUp(LeverageUpParams calldata params) external {

/// @audit missing @param for `params`
123:     function leverageDown(LeverageDownParams calldata params) external {

```
*Github:* [[13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L13), [40](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L40), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L123)]


```solidity
File: src/transformers/V3Utils.sol

22:     event CompoundFees(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

23:     event ChangeRange(uint256 indexed tokenId, uint256 newTokenId);

24:     event WithdrawAndCollectAndSwap(uint256 indexed tokenId, address token, uint256 amount);

25:     event SwapAndMint(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

26:     event SwapAndIncreaseLiquidity(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

/// @audit missing @param for `_universalRouter`
/// @audit missing @param for `_permit2`
31:     constructor(
            INonfungiblePositionManager _nonfungiblePositionManager,
            address _zeroxRouter,
            address _universalRouter,
            address _permit2
        ) Swapper(_nonfungiblePositionManager, _zeroxRouter, _universalRouter) {

/// @audit missing @param for `from`
/// @audit missing @param for `tokenId`
/// @audit missing @param for `data`
356:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)
             external
             override
             returns (bytes4)
         {

/// @audit missing @param for `token0`
/// @audit missing @param for `token1`
/// @audit missing @param for `otherToken`
/// @audit missing @param for `amount0`
/// @audit missing @param for `amount1`
/// @audit missing @param for `amountOther`
566:     function _prepareAddApproved(
             IERC20 token0,
             IERC20 token1,
             IERC20 otherToken,
             uint256 amount0,
             uint256 amount1,
             uint256 amountOther
         ) internal {

/// @audit missing @param for `token0`
/// @audit missing @param for `token1`
/// @audit missing @param for `otherToken`
/// @audit missing @param for `amount0`
/// @audit missing @param for `amount1`
/// @audit missing @param for `amountOther`
/// @audit missing @param for `permit`
/// @audit missing @param for `signature`
598:     function _prepareAddPermit2(
             IERC20 token0,
             IERC20 token1,
             IERC20 otherToken,
             uint256 amount0,
             uint256 amount1,
             uint256 amountOther,
             IPermit2.PermitBatchTransferFrom memory permit,
             bytes memory signature
         ) internal {

/// @audit missing @param for `token0`
/// @audit missing @param for `token1`
/// @audit missing @param for `otherToken`
/// @audit missing @param for `amount0`
/// @audit missing @param for `amount1`
/// @audit missing @param for `amountOther`
653:     function _prepareAdd(
             IERC20 token0,
             IERC20 token1,
             IERC20 otherToken,
             uint256 amount0,
             uint256 amount1,
             uint256 amountOther
         ) internal returns (uint256 needed0, uint256 needed1, uint256 neededOther) {

/// @audit missing @param for `params`
/// @audit missing @param for `unwrap`
705:     function _swapAndMint(SwapAndMintParams memory params, bool unwrap)
             internal
             returns (uint256 tokenId, uint128 liquidity, uint256 added0, uint256 added1)
         {

/// @audit missing @param for `params`
/// @audit missing @param for `token0`
/// @audit missing @param for `token1`
/// @audit missing @param for `unwrap`
735:     function _swapAndIncrease(SwapAndIncreaseLiquidityParams memory params, IERC20 token0, IERC20 token1, bool unwrap)
             internal
             returns (uint128 liquidity, uint256 added0, uint256 added1)
         {

/// @audit missing @param for `params`
/// @audit missing @param for `unwrap`
779:     function _swapAndPrepareAmounts(SwapAndMintParams memory params, bool unwrap)
             internal
             returns (uint256 total0, uint256 total1)
         {

/// @audit missing @param for `to`
/// @audit missing @param for `token0`
/// @audit missing @param for `token1`
/// @audit missing @param for `total0`
/// @audit missing @param for `total1`
/// @audit missing @param for `added0`
/// @audit missing @param for `added1`
/// @audit missing @param for `unwrap`
841:     function _returnLeftoverTokens(
             address to,
             IERC20 token0,
             IERC20 token1,
             uint256 total0,
             uint256 total1,
             uint256 added0,
             uint256 added1,
             bool unwrap
         ) internal {

/// @audit missing @param for `to`
/// @audit missing @param for `token`
/// @audit missing @param for `amount`
/// @audit missing @param for `unwrap`
864:     function _transferToken(address to, IERC20 token, uint256 amount, bool unwrap) internal {

/// @audit missing @param for `tokenId`
/// @audit missing @param for `liquidity`
/// @audit missing @param for `deadline`
/// @audit missing @param for `token0Min`
/// @audit missing @param for `token1Min`
877:     function _decreaseLiquidity(
             uint256 tokenId,
             uint128 liquidity,
             uint256 deadline,
             uint256 token0Min,
             uint256 token1Min
         ) internal returns (uint256 amount0, uint256 amount1) {

/// @audit missing @param for `tokenId`
/// @audit missing @param for `token0`
/// @audit missing @param for `token1`
/// @audit missing @param for `collectAmount0`
/// @audit missing @param for `collectAmount1`
892:     function _collectFees(uint256 tokenId, IERC20 token0, IERC20 token1, uint128 collectAmount0, uint128 collectAmount1)
             internal
             returns (uint256 amount0, uint256 amount1)
         {

```
*Github:* [[22](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L22), [23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L23), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L24), [25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L25), [26](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L26), [31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L31), [356](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L356), [566](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L566), [598](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L598), [653](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L653), [705](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L705), [735](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L735), [779](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L779), [841](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L841), [864](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L864), [877](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L877), [892](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L892)]


```solidity
File: src/utils/FlashloanLiquidator.sol

/// @audit missing @param for `_nonfungiblePositionManager`
/// @audit missing @param for `_zeroxRouter`
/// @audit missing @param for `_universalRouter`
24:     constructor(INonfungiblePositionManager _nonfungiblePositionManager, address _zeroxRouter, address _universalRouter)
            Swapper(_nonfungiblePositionManager, _zeroxRouter, _universalRouter)
        {}

/// @audit missing @param for `params`
41:     function liquidate(LiquidateParams calldata params) external {

/// @audit missing @param for `fee0`
/// @audit missing @param for `fee1`
/// @audit missing @param for `callbackData`
67:     function uniswapV3FlashCallback(uint256 fee0, uint256 fee1, bytes calldata callbackData) external {

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L24), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L41), [67](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L67)]


```solidity
File: src/utils/Swapper.sol

18:     event Swap(address indexed tokenIn, address indexed tokenOut, uint256 amountIn, uint256 amountOut);

/// @audit missing @param for `_universalRouter`
37:     constructor(
            INonfungiblePositionManager _nonfungiblePositionManager,
            address _zeroxRouter,
            address _universalRouter
        ) {

/// @audit missing @param for `params`
73:     function _routerSwap(RouterSwapParams memory params)
            internal
            returns (uint256 amountInDelta, uint256 amountOutDelta)
        {

/// @audit missing @param for `params`
132:     function _poolSwap(PoolSwapParams memory params) internal returns (uint256 amountInDelta, uint256 amountOutDelta) {

/// @audit missing @param for `amount0Delta`
/// @audit missing @param for `amount1Delta`
/// @audit missing @param for `data`
156:     function uniswapV3SwapCallback(int256 amount0Delta, int256 amount1Delta, bytes calldata data) external override {

/// @audit missing @param for `tokenA`
/// @audit missing @param for `tokenB`
/// @audit missing @param for `fee`
171:     function _getPool(address tokenA, address tokenB, uint24 fee) internal view returns (IUniswapV3Pool) {

```
*Github:* [[18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L18), [37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L37), [73](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L73), [132](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L132), [156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L156), [171](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L171)]


</details>


<a name="NC-54"></a> 
### [NC-54] Missing NatSpec `@return` from function declaration
Some function definitions have an incomplete NatSpec: add a `@return` notation to improve the code documentation.

<details>
<summary>
There are <b>63</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

272:     function _getReferenceTokenPriceX96(address token, uint256 cachedChainlinkReferencePriceX96)
             internal
             view
             returns (uint256 priceX96, uint256 chainlinkReferencePriceX96)
         {

329:     function _getChainlinkPriceX96(address token) internal view returns (uint256) {

346:     function _getTWAPPriceX96(TokenConfig memory feedConfig) internal view returns (uint256 poolTWAPPriceX96) {

359:     function _getReferencePoolPriceX96(IUniswapV3Pool pool, uint32 twapSeconds) internal view returns (uint256) {

395:     function _initializeState(uint256 tokenId) internal view returns (PositionState memory state) {

426:     function _getAmounts(PositionState memory state)
             internal
             view
             returns (uint256 amount0, uint256 amount1, uint128 fees0, uint128 fees1)
         {

445:     function _getUncollectedFees(PositionState memory position, int24 tick)
             internal
             view
             returns (uint128 fees0, uint128 fees1)
         {

472:     function _getFeeGrowthInside(
             IUniswapV3Pool pool,
             int24 tickLower,
             int24 tickUpper,
             int24 tickCurrent,
             uint256 feeGrowthGlobal0X128,
             uint256 feeGrowthGlobal1X128
         ) internal view returns (uint256 feeGrowthInside0X128, uint256 feeGrowthInside1X128) {

499:     function _getPool(address tokenA, address tokenB, uint24 fee) internal view returns (IUniswapV3Pool) {

```
*Github:* [[272](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L272), [329](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L329), [346](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L346), [359](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L359), [395](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L395), [426](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L426), [445](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L445), [472](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L472), [499](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L499)]


```solidity
File: src/V3Vault.sol

264:     function loanCount(address owner) external view override returns (uint256) {

271:     function loanAtIndex(address owner, uint256 index) external view override returns (uint256) {

277:     function decimals() public view override(IERC20Metadata, ERC20) returns (uint8) {

284:     function totalAssets() public view override returns (uint256) {

289:     function convertToShares(uint256 assets) external view override returns (uint256 shares) {

295:     function convertToAssets(uint256 shares) external view override returns (uint256 assets) {

301:     function maxDeposit(address) external view override returns (uint256) {

312:     function maxMint(address) external view override returns (uint256) {

323:     function maxWithdraw(address owner) external view override returns (uint256) {

329:     function maxRedeem(address owner) external view override returns (uint256) {

334:     function previewDeposit(uint256 assets) public view override returns (uint256) {

340:     function previewMint(uint256 shares) public view override returns (uint256) {

346:     function previewWithdraw(uint256 assets) public view override returns (uint256) {

352:     function previewRedeem(uint256 shares) public view override returns (uint256) {

360:     function deposit(uint256 assets, address receiver) external override returns (uint256) {

366:     function mint(uint256 shares, address receiver) external override returns (uint256) {

372:     function withdraw(uint256 assets, address receiver, address owner) external override returns (uint256) {

378:     function redeem(uint256 shares, address receiver, address owner) external override returns (uint256) {

384:     function deposit(uint256 assets, address receiver, bytes calldata permitData) external override returns (uint256) {

390:     function mint(uint256 shares, address receiver, bytes calldata permitData) external override returns (uint256) {

429:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)
             external
             override
             returns (bytes4)
         {

877:     function _deposit(address receiver, uint256 amount, bool isShare, bytes memory permitData)
             internal
             returns (uint256 assets, uint256 shares)
         {

920:     function _withdraw(address receiver, address owner, uint256 amount, bool isShare)
             internal
             returns (uint256 assets, uint256 shares)
         {

1017:     function _getAvailableBalance(uint256 debtExchangeRateX96, uint256 lendExchangeRateX96)
              internal
              view
              returns (uint256 balance, uint256 available, uint256 reserves)
          {

1032:     function _sendPositionValue(
              uint256 tokenId,
              uint256 liquidationValue,
              uint256 fullValue,
              uint256 feeValue,
              address recipient
          ) internal returns (uint256 amount0, uint256 amount1) {

1090:     function _calculateLiquidation(uint256 debt, uint256 fullValue, uint256 collateralValue)
              internal
              pure
              returns (uint256 liquidationValue, uint256 liquidatorCost, uint256 reserveCost)
          {

1123:     function _handleReserveLiquidation(
              uint256 reserveCost,
              uint256 newDebtExchangeRateX96,
              uint256 newLendExchangeRateX96
          ) internal returns (uint256 missing) {

1143:     function _calculateTokenCollateralFactorX32(uint256 tokenId) internal view returns (uint32) {

1150:     function _updateGlobalInterest()
              internal
              returns (uint256 newDebtExchangeRateX96, uint256 newLendExchangeRateX96)
          {

1167:     function _calculateGlobalInterest()
              internal
              view
              returns (uint256 newDebtExchangeRateX96, uint256 newLendExchangeRateX96)
          {

1270:     function _checkLoanIsHealthy(uint256 tokenId, uint256 debt)
              internal
              view
              returns (bool isHealthy, uint256 fullValue, uint256 collateralValue, uint256 feeValue)
          {

1281:     function _convertToShares(uint256 amount, uint256 exchangeRateX96, Math.Rounding rounding)
              internal
              pure
              returns (uint256)
          {

1289:     function _convertToAssets(uint256 shares, uint256 exchangeRateX96, Math.Rounding rounding)
              internal
              pure
              returns (uint256)
          {

```
*Github:* [[264](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L264), [271](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L271), [277](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L277), [284](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L284), [289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L289), [295](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L295), [301](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L301), [312](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L312), [323](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L323), [329](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L329), [334](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L334), [340](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L340), [346](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L346), [352](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L352), [360](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L360), [366](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L366), [372](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L372), [378](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L378), [384](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L384), [390](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L390), [429](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L429), [877](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L877), [920](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L920), [1017](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1017), [1032](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1032), [1090](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1090), [1123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1123), [1143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1143), [1150](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1150), [1167](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1167), [1270](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1270), [1281](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1281), [1289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1289)]


```solidity
File: src/automators/Automator.sol

139:     function _validateSwap(
             bool swap0For1,
             uint256 amountIn,
             IUniswapV3Pool pool,
             uint32 twapPeriod,
             uint16 maxTickDifference,
             uint64 maxPriceDifferenceX64
         ) internal view returns (uint256 amountOutMin, int24 currentTick, uint160 sqrtPriceX96, uint256 priceX96) {

166:     function _hasMaxTWAPTickDifference(IUniswapV3Pool pool, uint32 twapPeriod, int24 currentTick, uint16 maxDifference)
             internal
             view
             returns (bool)
         {

180:     function _getTWAPTick(IUniswapV3Pool pool, uint32 twapPeriod) internal view returns (int24, bool) {

193:     function _decreaseFullLiquidityAndCollect(
             uint256 tokenId,
             uint128 liquidity,
             uint256 amountRemoveMin0,
             uint256 amountRemoveMin1,
             uint256 deadline
         ) internal returns (uint256 amount0, uint256 amount1, uint256 feeAmount0, uint256 feeAmount1) {

230:     function _validateOwner(uint256 tokenId, address vault) internal returns (address owner) {

```
*Github:* [[139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L139), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L166), [180](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L180), [193](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L193), [230](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L230)]


```solidity
File: src/transformers/AutoRange.sol

300:     function _getTickSpacing(uint24 fee) internal view returns (int24) {

```
*Github:* [[300](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L300)]


```solidity
File: src/transformers/V3Utils.sol

98:     function executeWithPermit(uint256 tokenId, Instructions memory instructions, uint8 v, bytes32 r, bytes32 s)
            public
            returns (uint256 newTokenId)
        {

115:     function execute(uint256 tokenId, Instructions memory instructions) public returns (uint256 newTokenId) {

356:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)
             external
             override
             returns (bytes4)
         {

397:     function swap(SwapParams calldata params) external payable returns (uint256 amountOut) {

467:     function swapAndMint(SwapAndMintParams calldata params)
             external
             payable
             returns (uint256 tokenId, uint128 liquidity, uint256 amount0, uint256 amount1)
         {

532:     function swapAndIncreaseLiquidity(SwapAndIncreaseLiquidityParams calldata params)
             external
             payable
             returns (uint128 liquidity, uint256 amount0, uint256 amount1)
         {

653:     function _prepareAdd(
             IERC20 token0,
             IERC20 token1,
             IERC20 otherToken,
             uint256 amount0,
             uint256 amount1,
             uint256 amountOther
         ) internal returns (uint256 needed0, uint256 needed1, uint256 neededOther) {

705:     function _swapAndMint(SwapAndMintParams memory params, bool unwrap)
             internal
             returns (uint256 tokenId, uint128 liquidity, uint256 added0, uint256 added1)
         {

735:     function _swapAndIncrease(SwapAndIncreaseLiquidityParams memory params, IERC20 token0, IERC20 token1, bool unwrap)
             internal
             returns (uint128 liquidity, uint256 added0, uint256 added1)
         {

779:     function _swapAndPrepareAmounts(SwapAndMintParams memory params, bool unwrap)
             internal
             returns (uint256 total0, uint256 total1)
         {

877:     function _decreaseLiquidity(
             uint256 tokenId,
             uint128 liquidity,
             uint256 deadline,
             uint256 token0Min,
             uint256 token1Min
         ) internal returns (uint256 amount0, uint256 amount1) {

892:     function _collectFees(uint256 tokenId, IERC20 token0, IERC20 token1, uint128 collectAmount0, uint128 collectAmount1)
             internal
             returns (uint256 amount0, uint256 amount1)
         {

```
*Github:* [[98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L98), [115](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L115), [356](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L356), [397](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L397), [467](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L467), [532](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L532), [653](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L653), [705](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L705), [735](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L735), [779](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L779), [877](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L877), [892](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L892)]


```solidity
File: src/utils/Swapper.sol

73:     function _routerSwap(RouterSwapParams memory params)
            internal
            returns (uint256 amountInDelta, uint256 amountOutDelta)
        {

132:     function _poolSwap(PoolSwapParams memory params) internal returns (uint256 amountInDelta, uint256 amountOutDelta) {

171:     function _getPool(address tokenA, address tokenB, uint24 fee) internal view returns (IUniswapV3Pool) {

```
*Github:* [[73](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L73), [132](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L132), [171](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L171)]


</details>


<a name="NC-55"></a> 
### [NC-55] Missing NatSpec `@title` from contract declaration
Some contract definitions have an incomplete NatSpec: add a `@title` notation to improve the code documentation.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/automators/Automator.sol

19: abstract contract Automator is Swapper, Ownable {

```
*Github:* [[19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L19)]


```solidity
File: src/utils/Swapper.sol

17: abstract contract Swapper is IUniswapV3SwapCallback, IErrors {

```
*Github:* [[17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L17)]



<a name="NC-56"></a> 
### [NC-56] There is no need to initialize variables with 0
Since the variables are automatically set to 0 when created, it is redundant to initialize it with 0 again.

<details>
<summary>
There are <b>13</b> instances (click to show):
</summary>

```solidity
File: src/V3Vault.sol

118:     uint32 public reserveFactorX32 = 0;

124:     uint256 public debtSharesTotal = 0;

127:     uint256 public lastExchangeRateUpdate = 0;

131:     uint256 public globalDebtLimit = 0;

132:     uint256 public globalLendLimit = 0;

135:     uint256 public minLoanSize = 0;

138:     uint256 public dailyLendIncreaseLimitMin = 0;

139:     uint256 public dailyLendIncreaseLimitLeft = 0;

140:     uint256 public dailyLendIncreaseLimitLastReset = 0;

143:     uint256 public dailyDebtIncreaseLimitMin = 0;

144:     uint256 public dailyDebtIncreaseLimitLeft = 0;

145:     uint256 public dailyDebtIncreaseLimitLastReset = 0;

161:     uint256 private transformedTokenId = 0; // transient storage (when available in dencun)

```
*Github:* [[118](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L118), [124](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L124), [127](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L127), [131](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L131), [132](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L132), [135](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L135), [138](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L138), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L139), [140](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L140), [143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L143), [144](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L144), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L145), [161](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L161)]


</details>


<a name="NC-57"></a> 
### [NC-57] Put all system-wide constants in one file
Putting all the system-wide constants in a single file improves code readability, makes it easier to understand the basic configuration and limitations of the system, and makes maintenance easier.

<details>
<summary>
There are <b>20</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

12:     uint256 private constant Q96 = 2 ** 96;

13:     uint256 public constant YEAR_SECS = 31557600; // taking into account leap years

15:     uint256 public constant MAX_BASE_RATE_X96 = Q96 / 10; // 10%

16:     uint256 public constant MAX_MULTIPLIER_X96 = Q96 * 2; // 200%

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L12), [13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L13), [15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L15), [16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L16)]


```solidity
File: src/V3Oracle.sol

25:     uint16 public constant MIN_PRICE_DIFFERENCE = 200; //2%

27:     uint256 private constant Q96 = 2 ** 96;

28:     uint256 private constant Q128 = 2 ** 128;

```
*Github:* [[25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L25), [27](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L27), [28](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L28)]


```solidity
File: src/V3Vault.sol

33:     uint256 private constant Q32 = 2 ** 32;

34:     uint256 private constant Q96 = 2 ** 96;

36:     uint32 public constant MAX_COLLATERAL_FACTOR_X32 = uint32(Q32 * 90 / 100); // 90%

38:     uint32 public constant MIN_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 2 / 100); // 2%

39:     uint32 public constant MAX_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 10 / 100); // 10%

41:     uint32 public constant MIN_RESERVE_PROTECTION_FACTOR_X32 = uint32(Q32 / 100); //1%

43:     uint32 public constant MAX_DAILY_LEND_INCREASE_X32 = uint32(Q32 / 10); //10%

44:     uint32 public constant MAX_DAILY_DEBT_INCREASE_X32 = uint32(Q32 / 10); //10%

```
*Github:* [[33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L33), [34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L34), [36](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L36), [38](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L38), [39](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L39), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L41), [43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L43), [44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L44)]


```solidity
File: src/automators/Automator.sol

20:     uint256 internal constant Q64 = 2 ** 64;

21:     uint256 internal constant Q96 = 2 ** 96;

23:     uint32 public constant MIN_TWAP_SECONDS = 60; // 1 minute

24:     uint32 public constant MAX_TWAP_TICK_DIFFERENCE = 200; // 2%

```
*Github:* [[20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L20), [21](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L21), [23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L23), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L24)]


```solidity
File: src/transformers/AutoCompound.sol

47:     uint64 public constant MAX_REWARD_X64 = uint64(Q64 / 50); // 2%

```
*Github:* [[47](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L47)]


</details>


<a name="NC-58"></a> 
### [NC-58] Redundant `return` statement in a function with named return variables
Because the return variable (or its default value) has been assigned, explicit return at the end of the function is unnecessary, as it is returned automatically.

*There are <b>5</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

258:     function ownerOf(uint256 tokenId) external view override returns (address owner) {

289:     function convertToShares(uint256 assets) external view override returns (uint256 shares) {

295:     function convertToAssets(uint256 shares) external view override returns (uint256 assets) {

497:     function transform(uint256 tokenId, address transformer, bytes calldata data)

```
*Github:* [[258](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L258), [289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L289), [295](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L295), [497](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L497)]


```solidity
File: src/transformers/V3Utils.sol

98:     function executeWithPermit(uint256 tokenId, Instructions memory instructions, uint8 v, bytes32 r, bytes32 s)

```
*Github:* [[98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L98)]



<a name="NC-59"></a> 
### [NC-59] The remaining ETH may be locked in the contract after call
After calling an external contract and forwards some ETH value, the contract balance should be checked. If there is excess eth left over due to a failed call, or more eth being delivered than needed, or any other reason, this eth must be refunded to the user or handled appropriately, otherwise the eth may be frozen in the contract forever.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/automators/Automator.sol

130:             (bool sent,) = to.call{value: balance}("");

221:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[130](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L130), [221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L221)]


```solidity
File: src/transformers/V3Utils.sol

867:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[867](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L867)]



<a name="NC-60"></a> 
### [NC-60] Setters should prevent re-setting the same value
Not only is wasteful in terms of gas, but this is especially problematic when an event is emitted and the old and new values set are the same, as listeners might not expect this kind of scenario.

<details>
<summary>
There are <b>12</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

189:         maxPoolPriceDifference = _maxPoolPriceDifference;

266:         emergencyAdmin = admin;

```
*Github:* [[189](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L189), [266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L266)]


```solidity
File: src/V3Vault.sol

797:         transformerAllowList[transformer] = active;

838:         reserveFactorX32 = _reserveFactorX32;

848:         reserveProtectionFactorX32 = _reserveProtectionFactorX32;

871:         emergencyAdmin = admin;

```
*Github:* [[797](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L797), [838](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L838), [848](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L848), [871](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L871)]


```solidity
File: src/automators/Automator.sol

61:         withdrawer = _withdrawer;

71:         operators[_operator] = _active;

81:         vaults[_vault] = _active;

95:         TWAPSeconds = _TWAPSeconds;

96:         maxTWAPTickDifference = _maxTWAPTickDifference;

```
*Github:* [[61](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L61), [71](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L71), [81](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L81), [95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L95), [96](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L96)]


```solidity
File: src/transformers/AutoCompound.sol

245:         totalRewardX64 = _totalRewardX64;

```
*Github:* [[245](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L245)]


</details>


<a name="NC-61"></a> 
### [NC-61] State variables should include comments
Consider adding some comments on critical state variables to explain what they are supposed to do: this will help for future code reviews.

<details>
<summary>
There are <b>13</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

12:     uint256 private constant Q96 = 2 ** 96;

13:     uint256 public constant YEAR_SECS = 31557600; // taking into account leap years

15:     uint256 public constant MAX_BASE_RATE_X96 = Q96 / 10; // 10%

16:     uint256 public constant MAX_MULTIPLIER_X96 = Q96 * 2; // 200%

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L12), [13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L13), [15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L15), [16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L16)]


```solidity
File: src/V3Oracle.sol

25:     uint16 public constant MIN_PRICE_DIFFERENCE = 200; //2%

27:     uint256 private constant Q96 = 2 ** 96;

28:     uint256 private constant Q128 = 2 ** 128;

```
*Github:* [[25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L25), [27](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L27), [28](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L28)]


```solidity
File: src/V3Vault.sol

33:     uint256 private constant Q32 = 2 ** 32;

34:     uint256 private constant Q96 = 2 ** 96;

```
*Github:* [[33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L33), [34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L34)]


```solidity
File: src/automators/Automator.sol

20:     uint256 internal constant Q64 = 2 ** 64;

21:     uint256 internal constant Q96 = 2 ** 96;

23:     uint32 public constant MIN_TWAP_SECONDS = 60; // 1 minute

24:     uint32 public constant MAX_TWAP_TICK_DIFFERENCE = 200; // 2%

```
*Github:* [[20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L20), [21](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L21), [23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L23), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L24)]


</details>


<a name="NC-62"></a> 
### [NC-62] Lines are too long
The [solidity style guide](https://docs.soliditylang.org/en/v0.8.17/style-guide.html#maximum-line-length) recommends a maximum line length of 120 characters. Lines of code that are longer than 120 should be wrapped.

<details>
<summary>
There are <b>20</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

65:     uint16 public maxPoolPriceDifference = MIN_PRICE_DIFFERENCE; // max price difference between oracle derived price and pool price x10000

368:             (int56[] memory tickCumulatives,) = pool.observe(secondsAgos); // pool observe may fail when there is not enough history available (only use pool with enough history!)

```
*Github:* [[65](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L65), [368](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L368)]


```solidity
File: src/V3Vault.sol

70:     event Add(uint256 indexed tokenId, address owner, uint256 oldTokenId); // when a token is added replacing another token - oldTokenId > 0

158:     mapping(uint256 => uint256) private ownedTokensIndex; // Mapping from token ID to index of the owner tokens list (for removal without loop)

163:     mapping(address => bool) public transformerAllowList; // contracts allowed to transform positions (selected audited contracts e.g. V3Utils)

164:     mapping(address => mapping(uint256 => mapping(address => bool))) public transformApprovals; // owners permissions for other addresses to call transform on owners behalf (e.g. AutoRange contract)

636:             params.feeAmount0 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount0 + params.feeAmount0),

714:                 _handleReserveLiquidation(state.reserveCost, state.newDebtExchangeRateX96, state.newLendExchangeRateX96);

769:             _convertToAssets(totalSupply(), newLendExchangeRateX96, Math.Rounding.Up) * reserveProtectionFactorX32 / Q32;

```
*Github:* [[70](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L70), [158](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L158), [163](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L163), [164](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L164), [636](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L636), [714](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L714), [769](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L769)]


```solidity
File: src/transformers/AutoRange.sol

39:         int32 lowerTickLimit; // if negative also in-range positions may be adjusted / if 0 out of range positions may be adjusted

40:         int32 upperTickLimit; // if negative also in-range positions may be adjusted / if 0 out of range positions may be adjusted

41:         int32 lowerTickDelta; // this amount is added to current tick (floored to tickspacing) to define lowerTick of new position

42:         int32 upperTickDelta; // this amount is added to current tick (floored to tickspacing) to define upperTick of new position

191:             state.amount0 = params.swap0To1 ? state.amount0 - state.amountInDelta : state.amount0 + state.amountOutDelta;

192:             state.amount1 = params.swap0To1 ? state.amount1 + state.amountOutDelta : state.amount1 - state.amountInDelta;

```
*Github:* [[39](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L39), [40](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L40), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L41), [42](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L42), [191](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L191), [192](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L192)]


```solidity
File: src/transformers/LeverageTransformer.sol

139:             params.feeAmount0 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount0 + params.feeAmount0),

```
*Github:* [[139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L139)]


```solidity
File: src/transformers/V3Utils.sol

317:                     _transferToken(instructions.recipient, IERC20(token0), amount0 - amountInDelta, instructions.unwrap);

334:                     _transferToken(instructions.recipient, IERC20(token1), amount1 - amountInDelta, instructions.unwrap);

```
*Github:* [[317](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L317), [334](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L334)]


```solidity
File: src/utils/FlashloanLiquidator.sol

64:         params.flashLoanPool.flash(address(this), isAsset0 ? liquidationCost : 0, !isAsset0 ? liquidationCost : 0, data);

```
*Github:* [[64](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L64)]


```solidity
File: src/utils/Swapper.sol

172:         return IUniswapV3Pool(PoolAddress.computeAddress(address(factory), PoolAddress.getPoolKey(tokenA, tokenB, fee)));

```
*Github:* [[172](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L172)]


</details>


<a name="NC-63"></a> 
### [NC-63] Typos

*There are <b>6</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

/// @audit `recieves`
230:     /// @return liquidationValue If position is liquidatable - the value of the (partial) position which the liquidator recieves - otherwise 0

/// @audit `recieved`
427:     /// @notice Whenever a token is recieved it either creates a new loan, or modifies an existing one when in transform mode.

/// @audit `mutiplied`
854:     /// @param collateralFactorX32 collateral factor for this token mutiplied by Q32

/// @audit `mutiplied`
855:     /// @param collateralValueLimitFactorX32 how much of it maybe used as collateral measured as percentage of total lent assets mutiplied by Q32

```
*Github:* [[230](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L230), [427](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L427), [854](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L854), [855](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L855)]


```solidity
File: src/transformers/LeverageTransformer.sol

/// @audit `direcly`
11: /// @notice Functionality to leverage / deleverage positions direcly in one tx

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L11)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit `recieved`
633:         // check if recieved correct amount of tokens

```
*Github:* [[633](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L633)]



<a name="NC-64"></a> 
### [NC-64] Unnecessary cast
The variable is being cast to its own type.

<details>
<summary>
There are <b>16</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit no need to cast `answer` into int256
342:         return uint256(answer) * Q96 / (10 ** feedConfig.feedDecimals);

```
*Github:* [[342](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L342)]


```solidity
File: src/V3Vault.sol

/// @audit no need to cast `asset` into address
1275:         (fullValue, feeValue,,) = oracle.getValue(tokenId, address(asset));

```
*Github:* [[1275](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1275)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit no need to cast `token0` into address
669:             if (address(weth) == address(token0)) {

/// @audit no need to cast `token0` into address
669:             if (address(weth) == address(token0)) {

/// @audit no need to cast `token1` into address
674:             } else if (address(weth) == address(token1)) {

/// @audit no need to cast `token1` into address
674:             } else if (address(weth) == address(token1)) {

/// @audit no need to cast `token` into address
865:         if (address(weth) == address(token) && unwrap) {

```
*Github:* [[669](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L669), [669](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L669), [674](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L674), [674](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L674), [865](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L865)]


```solidity
File: src/utils/Swapper.sol

/// @audit no need to cast `amount0Delta` into int256
145:             amountInDelta = params.swap0For1 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `amount1Delta` into int256
145:             amountInDelta = params.swap0For1 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `amount0Delta` into int256
145:             amountInDelta = params.swap0For1 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `amount1Delta` into int256
145:             amountInDelta = params.swap0For1 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `amount0Delta` into int256
166:         uint256 amountToPay = amount0Delta > 0 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `amount1Delta` into int256
166:         uint256 amountToPay = amount0Delta > 0 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `amount0Delta` into int256
166:         uint256 amountToPay = amount0Delta > 0 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `amount1Delta` into int256
166:         uint256 amountToPay = amount0Delta > 0 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `factory` into address
172:         return IUniswapV3Pool(PoolAddress.computeAddress(address(factory), PoolAddress.getPoolKey(tokenA, tokenB, fee)));

```
*Github:* [[145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L145), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L145), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L145), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L145), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L166), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L166), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L166), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L166), [172](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L172)]


</details>


<a name="NC-65"></a> 
### [NC-65] Unsafe conversion from unsigned to signed values
Solidity follows [two's complement](https://en.wikipedia.org/wiki/Two%27s_complement) rules for its integers, meaning that the most significant bit for signed integers is used to denote the sign, and converting between the two requires inverting all of the bits and adding one. Because of this, casting an unsigned integer to a signed one may result in a change of the sign and or magnitude of the value. For example, `int8(type(uint8).max)` is not equal to `type(int8).max`, but is equal to `-1`. `type(uint8).max` in binary is `11111111`, which if cast to a signed value, means the first binary `1` indicates a negative value, and the binary `1`s, invert to all zeroes, and when one is added, it becomes one, but negative, and therefore the decimal value of binary `11111111` is `-1`.

*There are <b>5</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

/// @audit uint56 -> int56
369:             int24 tick = int24((tickCumulatives[0] - tickCumulatives[1]) / int56(uint56(twapSeconds)));

```
*Github:* [[369](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L369)]


```solidity
File: src/automators/Automator.sol

/// @audit uint16 -> int16
173:             return twapTick - currentTick >= -int16(maxDifference) && twapTick - currentTick <= int16(maxDifference);

/// @audit uint16 -> int16
173:             return twapTick - currentTick >= -int16(maxDifference) && twapTick - currentTick <= int16(maxDifference);

/// @audit uint56 -> int56
187:             return (int24((tickCumulatives[0] - tickCumulatives[1]) / int56(uint56(twapPeriod))), true);

```
*Github:* [[173](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L173), [173](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L173), [187](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L187)]


```solidity
File: src/utils/Swapper.sol

/// @audit uint256 -> int256
137:                 int256(params.amountIn),

```
*Github:* [[137](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L137)]



<a name="NC-66"></a> 
### [NC-66] Unsafe solidity low-level call can cause gas grief attack
Using the low-level calls of a solidity address can leave the contract open to gas grief attacks. These attacks occur when the called contract returns a large amount of data. So when calling an external contract, it is necessary to check the length of the return data before reading/copying it (using `returndatasize()`).

*There are <b>6</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

522:         (bool success,) = transformer.call(data);

```
*Github:* [[522](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L522)]


```solidity
File: src/automators/Automator.sol

130:             (bool sent,) = to.call{value: balance}("");

221:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[130](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L130), [221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L221)]


```solidity
File: src/transformers/V3Utils.sol

867:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[867](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L867)]


```solidity
File: src/utils/Swapper.sol

89:                 (bool success,) = zeroxRouter.call(data.data);

89:                 (bool success,) = zeroxRouter.call(data.data);

```
*Github:* [[89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L89), [89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L89)]



<a name="NC-67"></a> 
### [NC-67] Unused named return
Declaring named returns, but not using them, is confusing to the reader. Consider either completely removing them (by declaring just the type without a name), or remove the return statement and do a variable assignment. This would improve the readability of the code, and it may also help reduce regressions during future code refactors.

*There are <b>5</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

/// @audit `owner` not used
258:     function ownerOf(uint256 tokenId) external view override returns (address owner) {

/// @audit `shares` not used
289:     function convertToShares(uint256 assets) external view override returns (uint256 shares) {

/// @audit `assets` not used
295:     function convertToAssets(uint256 shares) external view override returns (uint256 assets) {

/// @audit `newTokenId` not used
497:     function transform(uint256 tokenId, address transformer, bytes calldata data)
             external
             override
             returns (uint256 newTokenId)
         {

```
*Github:* [[258](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L258), [289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L289), [295](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L295), [497](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L497)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit `newTokenId` not used
98:     function executeWithPermit(uint256 tokenId, Instructions memory instructions, uint8 v, bytes32 r, bytes32 s)
            public
            returns (uint256 newTokenId)
        {

```
*Github:* [[98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L98)]



<a name="NC-68"></a> 
### [NC-68] Unused contract variables
The following state variables are defined but not used. It is recommended to check the code for logical omissions that cause them not to be used. If it's determined that they are not needed anywhere, it's best to remove them from the codebase to improve code clarity and minimize confusion.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/InterestRateModel.sol

24:     uint256 public baseRatePerSecondX96;

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L24)]


```solidity
File: src/transformers/AutoCompound.sol

47:     uint64 public constant MAX_REWARD_X64 = uint64(Q64 / 50); // 2%

```
*Github:* [[47](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L47)]



<a name="NC-69"></a> 
### [NC-69] Use `abi.encodeCall()` instead of `abi.encodeWithSignature()`/`abi.encodeWithSelector()`
`abi.encodeCall()` has compiler type safety, whereas the other two functions do not

*There are <b>2</b> instances of this issue:*
```solidity
File: src/transformers/AutoCompound.sol

92:             params.tokenId, address(this), abi.encodeWithSelector(AutoCompound.execute.selector, params)

```
*Github:* [[92](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L92)]


```solidity
File: src/transformers/AutoRange.sol

102:             params.tokenId, address(this), abi.encodeWithSelector(AutoRange.execute.selector, params)

```
*Github:* [[102](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L102)]



<a name="NC-70"></a> 
### [NC-70] Consider using `delete` rather than assigning zero/false to clear values
The `delete` keyword more closely matches the semantics of what is being done, and draws more attention to the changing of state, which may lead to a more thorough audit of its associated logic.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

366:             secondsAgos[0] = 0; // from (before)

```
*Github:* [[366](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L366)]


```solidity
File: src/automators/Automator.sol

182:         secondsAgos[0] = 0; // from (before)

```
*Github:* [[182](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L182)]



<a name="NC-71"></a> 
### [NC-71] Solidity compiler version is not fixed
To prevent the actual contracts deployed from behaving differently depending on the compiler version, it is recommended to use a fixed solidity version.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L2)]


```solidity
File: src/V3Oracle.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L2)]


```solidity
File: src/V3Vault.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L2)]


```solidity
File: src/automators/AutoExit.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L2)]


```solidity
File: src/automators/Automator.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L2)]


```solidity
File: src/transformers/AutoCompound.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L2)]


```solidity
File: src/transformers/AutoRange.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L2)]


```solidity
File: src/transformers/LeverageTransformer.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L2)]


```solidity
File: src/transformers/V3Utils.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L2)]


```solidity
File: src/utils/FlashloanLiquidator.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L2)]


```solidity
File: src/utils/Swapper.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L2)]


</details>


<a name="NC-72"></a> 
### [NC-72] Expressions for constant values should use `immutable` rather than `constant`
While it doesn't save any gas because the compiler knows that developers often make this mistake, it's still best to use the right tool for the task at hand. There is a difference between `constant` variables and `immutable` variables, and they should each be used in their appropriate contexts. `constants` should be used for literal values written into the code, and `immutable` variables should be used for expressions, or values calculated in, or passed into the constructor.

<details>
<summary>
There are <b>20</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

12:     uint256 private constant Q96 = 2 ** 96;

13:     uint256 public constant YEAR_SECS = 31557600; // taking into account leap years

15:     uint256 public constant MAX_BASE_RATE_X96 = Q96 / 10; // 10%

16:     uint256 public constant MAX_MULTIPLIER_X96 = Q96 * 2; // 200%

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L12), [13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L13), [15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L15), [16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L16)]


```solidity
File: src/V3Oracle.sol

25:     uint16 public constant MIN_PRICE_DIFFERENCE = 200; //2%

27:     uint256 private constant Q96 = 2 ** 96;

28:     uint256 private constant Q128 = 2 ** 128;

```
*Github:* [[25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L25), [27](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L27), [28](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L28)]


```solidity
File: src/V3Vault.sol

33:     uint256 private constant Q32 = 2 ** 32;

34:     uint256 private constant Q96 = 2 ** 96;

36:     uint32 public constant MAX_COLLATERAL_FACTOR_X32 = uint32(Q32 * 90 / 100); // 90%

38:     uint32 public constant MIN_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 2 / 100); // 2%

39:     uint32 public constant MAX_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 10 / 100); // 10%

41:     uint32 public constant MIN_RESERVE_PROTECTION_FACTOR_X32 = uint32(Q32 / 100); //1%

43:     uint32 public constant MAX_DAILY_LEND_INCREASE_X32 = uint32(Q32 / 10); //10%

44:     uint32 public constant MAX_DAILY_DEBT_INCREASE_X32 = uint32(Q32 / 10); //10%

```
*Github:* [[33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L33), [34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L34), [36](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L36), [38](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L38), [39](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L39), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L41), [43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L43), [44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L44)]


```solidity
File: src/automators/Automator.sol

20:     uint256 internal constant Q64 = 2 ** 64;

21:     uint256 internal constant Q96 = 2 ** 96;

23:     uint32 public constant MIN_TWAP_SECONDS = 60; // 1 minute

24:     uint32 public constant MAX_TWAP_TICK_DIFFERENCE = 200; // 2%

```
*Github:* [[20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L20), [21](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L21), [23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L23), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L24)]


```solidity
File: src/transformers/AutoCompound.sol

47:     uint64 public constant MAX_REWARD_X64 = uint64(Q64 / 50); // 2%

```
*Github:* [[47](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L47)]


</details>


<a name="NC-73"></a> 
### [NC-73] Use `@inheritdoc` for overridden functions

<details>
<summary>
There are <b>29</b> instances (click to show):
</summary>

```solidity
File: src/V3Vault.sol

219:     function lendInfo(address account) external view override returns (uint256 amount) {

258:     function ownerOf(uint256 tokenId) external view override returns (address owner) {

264:     function loanCount(address owner) external view override returns (uint256) {

271:     function loanAtIndex(address owner, uint256 index) external view override returns (uint256) {

284:     function totalAssets() public view override returns (uint256) {

289:     function convertToShares(uint256 assets) external view override returns (uint256 shares) {

295:     function convertToAssets(uint256 shares) external view override returns (uint256 assets) {

301:     function maxDeposit(address) external view override returns (uint256) {

312:     function maxMint(address) external view override returns (uint256) {

323:     function maxWithdraw(address owner) external view override returns (uint256) {

329:     function maxRedeem(address owner) external view override returns (uint256) {

334:     function previewDeposit(uint256 assets) public view override returns (uint256) {

340:     function previewMint(uint256 shares) public view override returns (uint256) {

346:     function previewWithdraw(uint256 assets) public view override returns (uint256) {

352:     function previewRedeem(uint256 shares) public view override returns (uint256) {

360:     function deposit(uint256 assets, address receiver) external override returns (uint256) {

366:     function mint(uint256 shares, address receiver) external override returns (uint256) {

372:     function withdraw(uint256 assets, address receiver, address owner) external override returns (uint256) {

378:     function redeem(uint256 shares, address receiver, address owner) external override returns (uint256) {

384:     function deposit(uint256 assets, address receiver, bytes calldata permitData) external override returns (uint256) {

390:     function mint(uint256 shares, address receiver, bytes calldata permitData) external override returns (uint256) {

400:     function create(uint256 tokenId, address recipient) external override {

483:     function approveTransform(uint256 tokenId, address target, bool isActive) external override {

550:     function borrow(uint256 tokenId, uint256 assets) external override {

652:     function repay(uint256 tokenId, uint256 amount, bool isShare) external override {

661:     function repay(uint256 tokenId, uint256 amount, bool isShare, bytes calldata permitData) external override {

685:     function liquidate(LiquidateParams calldata params) external override returns (uint256 amount0, uint256 amount1) {

```
*Github:* [[219](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L219), [258](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L258), [264](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L264), [271](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L271), [284](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L284), [289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L289), [295](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L295), [301](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L301), [312](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L312), [323](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L323), [329](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L329), [334](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L334), [340](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L340), [346](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L346), [352](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L352), [360](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L360), [366](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L366), [372](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L372), [378](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L378), [384](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L384), [390](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L390), [400](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L400), [483](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L483), [550](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L550), [652](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L652), [661](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L661), [685](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L685)]


```solidity
File: src/transformers/AutoCompound.sol

227:     function withdrawBalances(address[] calldata tokens, address to) external override nonReentrant {

```
*Github:* [[227](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L227)]


```solidity
File: src/utils/Swapper.sol

156:     function uniswapV3SwapCallback(int256 amount0Delta, int256 amount1Delta, bytes calldata data) external override {

```
*Github:* [[156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L156)]


</details>


<a name="NC-74"></a> 
### [NC-74] Upgrade `openzeppelin` to the latest version (`5.0.1`)
These contracts import contracts from openzeppelin contracts but they are not using the latest version. For more information, please visit: [OpenZeppelin GitHub Releases](https://github.com/OpenZeppelin/openzeppelin-contracts/releases) It is recommended to always use the latest version to take advantage of updates and security fixes.

*There is one instance of this issue:*
```solidity

Global finding

```
*Github:* [[Global](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/)]



<a name="NC-75"></a> 
### [NC-75] Use the latest solidity version for deployment (`0.8.24`)
Upgrading to a newer Solidity release can optimize gas usage, take advantage of new features and improve overall contract efficiency. Where possible, based on compatibility requirements, it is recommended to use newer/latest solidity version to take advantage of the latest optimizations and features.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L2)]


```solidity
File: src/V3Oracle.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L2)]


```solidity
File: src/V3Vault.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L2)]


```solidity
File: src/automators/AutoExit.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L2)]


```solidity
File: src/automators/Automator.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L2)]


```solidity
File: src/transformers/AutoCompound.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L2)]


```solidity
File: src/transformers/AutoRange.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L2)]


```solidity
File: src/transformers/LeverageTransformer.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L2)]


```solidity
File: src/transformers/V3Utils.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L2)]


```solidity
File: src/utils/FlashloanLiquidator.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L2)]


```solidity
File: src/utils/Swapper.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L2)]


</details>


<a name="NC-76"></a> 
### [NC-76] Use the Modern Upgradeable Contract Paradigm
Modern smart contract development often employs upgradeable contract structures, utilizing proxy patterns like OpenZeppelin’s Upgradeable Contracts. This paradigm separates logic and state, allowing developers to amend and enhance the contract's functionality without altering its state or the deployed contract address. Transitioning to this approach enhances long-term maintainability.

Resolution: Adopt a well-established proxy pattern for upgradeability, ensuring proper initialization and employing transparent proxies to mitigate potential risks. Embrace comprehensive testing and audit practices, particularly when updating contract logic, to ensure state consistency and security are preserved across upgrades. This ensures your contract remains robust and adaptable to future requirements.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

11: contract InterestRateModel is Ownable, IInterestRateModel, IErrors {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L11)]


```solidity
File: src/V3Oracle.sol

24: contract V3Oracle is IV3Oracle, Ownable, IErrors {

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L24)]


```solidity
File: src/V3Vault.sol

30: contract V3Vault is ERC20, Multicall, Ownable, IVault, IERC721Receiver, IErrors {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L30)]


```solidity
File: src/automators/AutoExit.sol

10: contract AutoExit is Automator {

```
*Github:* [[10](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L10)]


```solidity
File: src/automators/Automator.sol

19: abstract contract Automator is Swapper, Ownable {

```
*Github:* [[19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L19)]


```solidity
File: src/transformers/AutoCompound.sol

16: contract AutoCompound is Automator, Multicall, ReentrancyGuard {

```
*Github:* [[16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L16)]


```solidity
File: src/transformers/AutoRange.sol

11: contract AutoRange is Automator {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L11)]


```solidity
File: src/transformers/LeverageTransformer.sol

12: contract LeverageTransformer is Swapper {

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L12)]


```solidity
File: src/transformers/V3Utils.sol

15: contract V3Utils is Swapper, IERC721Receiver {

```
*Github:* [[15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L15)]


```solidity
File: src/utils/FlashloanLiquidator.sol

11: contract FlashloanLiquidator is Swapper, IUniswapV3FlashCallback {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L11)]


```solidity
File: src/utils/Swapper.sol

17: abstract contract Swapper is IUniswapV3SwapCallback, IErrors {

```
*Github:* [[17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L17)]


</details>


<a name="NC-77"></a> 
### [NC-77] Consider using modifiers for address control
Modifiers in Solidity can improve code readability and modularity by encapsulating repetitive checks, such as address validity checks, into a reusable construct. For example, an `onlyOwner` modifier can be used to replace repetitive `require(msg.sender == owner)` checks across several functions, reducing code redundancy and enhancing maintainability. To implement, define a modifier with the check, then apply the modifier to relevant functions.

<details>
<summary>
There are <b>20</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

250:         if (msg.sender != emergencyAdmin && msg.sender != owner()) {

```
*Github:* [[250](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L250)]


```solidity
File: src/V3Vault.sol

419:         if (msg.sender != owner) {

435:         if (msg.sender != address(nonfungiblePositionManager) || from == address(this)) {

484:         if (tokenOwner[tokenId] != msg.sender) {

515:         if (loanOwner != msg.sender && !transformApprovals[loanOwner][tokenId][msg.sender]) {

561:         if (!isTransformMode && tokenOwner[tokenId] != msg.sender && address(this) != msg.sender) {

621:         if (owner != msg.sender) {

814:         if (msg.sender != emergencyAdmin && msg.sender != owner()) {

935:         if (msg.sender != owner) {

```
*Github:* [[419](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L419), [435](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L435), [484](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L484), [515](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L515), [561](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L561), [621](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L621), [814](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L814), [935](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L935)]


```solidity
File: src/automators/AutoExit.sol

220:         if (owner != msg.sender) {

```
*Github:* [[220](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L220)]


```solidity
File: src/automators/Automator.sol

105:         if (msg.sender != withdrawer) {

124:         if (msg.sender != withdrawer) {

245:         if (owner != msg.sender) {

252:         if (msg.sender != address(weth)) {

```
*Github:* [[105](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L105), [124](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L124), [245](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L245), [252](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L252)]


```solidity
File: src/transformers/AutoCompound.sol

205:         if (owner != msg.sender) {

228:         if (msg.sender != withdrawer) {

```
*Github:* [[205](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L205), [228](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L228)]


```solidity
File: src/transformers/V3Utils.sol

102:         if (nonfungiblePositionManager.ownerOf(tokenId) != msg.sender) {

362:         if (msg.sender != address(nonfungiblePositionManager)) {

915:         if (msg.sender != address(weth)) {

```
*Github:* [[102](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L102), [362](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L362), [915](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L915)]


```solidity
File: src/utils/Swapper.sol

161:         if (address(_getPool(tokenIn, tokenOut, fee)) != msg.sender) {

```
*Github:* [[161](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L161)]


</details>


<a name="NC-78"></a> 
### [NC-78] Use of `override` is unnecessary
Starting with Solidity version [0.8.8](https://docs.soliditylang.org/en/v0.8.20/contracts.html#function-overriding), using the `override` keyword when the function solely overrides an interface function, and the function doesn't exist in multiple base contracts, is unnecessary.

<details>
<summary>
There are <b>30</b> instances (click to show):
</summary>

```solidity
File: src/V3Vault.sol

219:     function lendInfo(address account) external view override returns (uint256 amount) {

258:     function ownerOf(uint256 tokenId) external view override returns (address owner) {

264:     function loanCount(address owner) external view override returns (uint256) {

271:     function loanAtIndex(address owner, uint256 index) external view override returns (uint256) {

284:     function totalAssets() public view override returns (uint256) {

289:     function convertToShares(uint256 assets) external view override returns (uint256 shares) {

295:     function convertToAssets(uint256 shares) external view override returns (uint256 assets) {

301:     function maxDeposit(address) external view override returns (uint256) {

312:     function maxMint(address) external view override returns (uint256) {

323:     function maxWithdraw(address owner) external view override returns (uint256) {

329:     function maxRedeem(address owner) external view override returns (uint256) {

334:     function previewDeposit(uint256 assets) public view override returns (uint256) {

340:     function previewMint(uint256 shares) public view override returns (uint256) {

346:     function previewWithdraw(uint256 assets) public view override returns (uint256) {

352:     function previewRedeem(uint256 shares) public view override returns (uint256) {

360:     function deposit(uint256 assets, address receiver) external override returns (uint256) {

366:     function mint(uint256 shares, address receiver) external override returns (uint256) {

372:     function withdraw(uint256 assets, address receiver, address owner) external override returns (uint256) {

378:     function redeem(uint256 shares, address receiver, address owner) external override returns (uint256) {

384:     function deposit(uint256 assets, address receiver, bytes calldata permitData) external override returns (uint256) {

390:     function mint(uint256 shares, address receiver, bytes calldata permitData) external override returns (uint256) {

400:     function create(uint256 tokenId, address recipient) external override {

418:     ) external override {

483:     function approveTransform(uint256 tokenId, address target, bool isActive) external override {

550:     function borrow(uint256 tokenId, uint256 assets) external override {

652:     function repay(uint256 tokenId, uint256 amount, bool isShare) external override {

661:     function repay(uint256 tokenId, uint256 amount, bool isShare, bytes calldata permitData) external override {

685:     function liquidate(LiquidateParams calldata params) external override returns (uint256 amount0, uint256 amount1) {

```
*Github:* [[219](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L219), [258](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L258), [264](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L264), [271](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L271), [284](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L284), [289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L289), [295](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L295), [301](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L301), [312](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L312), [323](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L323), [329](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L329), [334](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L334), [340](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L340), [346](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L346), [352](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L352), [360](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L360), [366](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L366), [372](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L372), [378](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L378), [384](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L384), [390](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L390), [400](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L400), [418](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L418), [483](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L483), [550](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L550), [652](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L652), [661](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L661), [685](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L685)]


```solidity
File: src/transformers/AutoCompound.sol

227:     function withdrawBalances(address[] calldata tokens, address to) external override nonReentrant {

```
*Github:* [[227](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L227)]


```solidity
File: src/utils/Swapper.sol

156:     function uniswapV3SwapCallback(int256 amount0Delta, int256 amount1Delta, bytes calldata data) external override {

```
*Github:* [[156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L156)]


</details>


<a name="NC-79"></a> 
### [NC-79] Returning a struct instead of a bunch of variables is better
If a function returns [too many variables](https://docs.soliditylang.org/en/v0.8.21/contracts.html#returning-multiple-values), replacing them with a struct can improve code readability, maintainability and reusability.

*There are <b>10</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

/// @audit 4 return variables
95:     function getValue(uint256 tokenId, address token)
            external
            view
            override
            returns (uint256 value, uint256 feeValue, uint256 price0X96, uint256 price1X96)
        {

/// @audit 8 return variables
162:     function getPositionBreakdown(uint256 tokenId)
             public
             view
             override
             returns (
                 address token0,
                 address token1,
                 uint24 fee,
                 uint128 liquidity,
                 uint256 amount0,
                 uint256 amount1,
                 uint128 fees0,
                 uint128 fees1
             )
         {

/// @audit 4 return variables
426:     function _getAmounts(PositionState memory state)
             internal
             view
             returns (uint256 amount0, uint256 amount1, uint128 fees0, uint128 fees1)
         {

```
*Github:* [[95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L95), [162](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L162), [426](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L426)]


```solidity
File: src/V3Vault.sol

/// @audit 7 return variables
195:     function vaultInfo()
             external
             view
             override
             returns (
                 uint256 debt,
                 uint256 lent,
                 uint256 balance,
                 uint256 available,
                 uint256 reserves,
                 uint256 debtExchangeRateX96,
                 uint256 lendExchangeRateX96
             )
         {

/// @audit 5 return variables
231:     function loanInfo(uint256 tokenId)
             external
             view
             override
             returns (
                 uint256 debt,
                 uint256 fullValue,
                 uint256 collateralValue,
                 uint256 liquidationCost,
                 uint256 liquidationValue
             )
         {

/// @audit 4 return variables
1270:     function _checkLoanIsHealthy(uint256 tokenId, uint256 debt)
              internal
              view
              returns (bool isHealthy, uint256 fullValue, uint256 collateralValue, uint256 feeValue)
          {

```
*Github:* [[195](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L195), [231](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L231), [1270](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1270)]


```solidity
File: src/automators/Automator.sol

/// @audit 4 return variables
139:     function _validateSwap(
             bool swap0For1,
             uint256 amountIn,
             IUniswapV3Pool pool,
             uint32 twapPeriod,
             uint16 maxTickDifference,
             uint64 maxPriceDifferenceX64
         ) internal view returns (uint256 amountOutMin, int24 currentTick, uint160 sqrtPriceX96, uint256 priceX96) {

/// @audit 4 return variables
193:     function _decreaseFullLiquidityAndCollect(
             uint256 tokenId,
             uint128 liquidity,
             uint256 amountRemoveMin0,
             uint256 amountRemoveMin1,
             uint256 deadline
         ) internal returns (uint256 amount0, uint256 amount1, uint256 feeAmount0, uint256 feeAmount1) {

```
*Github:* [[139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L139), [193](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L193)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit 4 return variables
467:     function swapAndMint(SwapAndMintParams calldata params)
             external
             payable
             returns (uint256 tokenId, uint128 liquidity, uint256 amount0, uint256 amount1)
         {

/// @audit 4 return variables
705:     function _swapAndMint(SwapAndMintParams memory params, bool unwrap)
             internal
             returns (uint256 tokenId, uint128 liquidity, uint256 added0, uint256 added1)
         {

```
*Github:* [[467](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L467), [705](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L705)]



<a name="NC-80"></a> 
### [NC-80] Use a struct to encapsulate multiple function parameters
If a function has too many parameters, replacing them with a struct can improve code readability and maintainability, increase reusability, and reduce the likelihood of errors when passing the parameters.

*There are <b>4</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

/// @audit 7 parameters
201:     function setTokenConfig(
             address token,
             AggregatorV3Interface feed,
             uint32 maxFeedAge,
             IUniswapV3Pool pool,
             uint32 twapSeconds,
             Mode mode,
             uint16 maxDifference
         ) external onlyOwner {

```
*Github:* [[201](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L201)]


```solidity
File: src/V3Vault.sol

/// @audit 7 parameters
410:     function createWithPermit(
             uint256 tokenId,
             address owner,
             address recipient,
             uint256 deadline,
             uint8 v,
             bytes32 r,
             bytes32 s
         ) external override {

```
*Github:* [[410](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L410)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit 8 parameters
598:     function _prepareAddPermit2(
             IERC20 token0,
             IERC20 token1,
             IERC20 otherToken,
             uint256 amount0,
             uint256 amount1,
             uint256 amountOther,
             IPermit2.PermitBatchTransferFrom memory permit,
             bytes memory signature
         ) internal {

/// @audit 8 parameters
841:     function _returnLeftoverTokens(
             address to,
             IERC20 token0,
             IERC20 token1,
             uint256 total0,
             uint256 total1,
             uint256 added0,
             uint256 added1,
             bool unwrap
         ) internal {

```
*Github:* [[598](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L598), [841](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L841)]



<a name="NC-81"></a> 
### [NC-81] Use `type(X).max` instead of constant formulas like `2**n`
Earlier versions of solidity can use `uint<n>(-1)` instead. Expressions `2**n -1` can often be rewritten to accommodate the change (e.g. by using a `>` instead of a `>=`, which will also saves gas).

*There are <b>3</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

28:     uint256 private constant Q128 = 2 ** 128;

```
*Github:* [[28](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L28)]


```solidity
File: src/V3Vault.sol

33:     uint256 private constant Q32 = 2 ** 32;

```
*Github:* [[33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L33)]


```solidity
File: src/automators/Automator.sol

20:     uint256 internal constant Q64 = 2 ** 64;

```
*Github:* [[20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L20)]



<a name="NC-82"></a> 
### [NC-82] Common functions should be refactored to a common base contract
The functions below have the same implementation as is seen in other files. The functions should be refactored into functions of a common base contract.

*There are <b>4</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

/// @audit seen in src/V3Vault.sol
265:     function setEmergencyAdmin(address admin) external onlyOwner {

```
*Github:* [[265](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L265)]


```solidity
File: src/V3Vault.sol

/// @audit seen in src/V3Oracle.sol
870:     function setEmergencyAdmin(address admin) external onlyOwner {

```
*Github:* [[870](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L870)]


```solidity
File: src/automators/Automator.sol

/// @audit seen in src/transformers/V3Utils.sol
218:     function _transferToken(address to, IERC20 token, uint256 amount, bool unwrap) internal {

```
*Github:* [[218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L218)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit seen in src/automators/Automator.sol
864:     function _transferToken(address to, IERC20 token, uint256 amount, bool unwrap) internal {

```
*Github:* [[864](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L864)]



<a name="NC-83"></a> 
### [NC-83] Empty body - Consider commenting why

*There are <b>5</b> instances of this issue:*
```solidity
File: src/automators/AutoExit.sol

41:     ) Automator(_npm, _operator, _withdrawer, _TWAPSeconds, _maxTWAPTickDifference, _zeroxRouter, _universalRouter) {}

```
*Github:* [[41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L41)]


```solidity
File: src/transformers/AutoCompound.sol

43:     ) Automator(_npm, _operator, _withdrawer, _TWAPSeconds, _maxTWAPTickDifference, address(0), address(0)) {}

```
*Github:* [[43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L43)]


```solidity
File: src/transformers/AutoRange.sol

33:     ) Automator(_npm, _operator, _withdrawer, _TWAPSeconds, _maxTWAPTickDifference, _zeroxRouter, _universalRouter) {}

```
*Github:* [[33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L33)]


```solidity
File: src/transformers/LeverageTransformer.sol

15:     {}

```
*Github:* [[15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L15)]


```solidity
File: src/utils/FlashloanLiquidator.sol

26:     {}

```
*Github:* [[26](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L26)]



<a name="NC-84"></a> 
### [NC-84] Names of `private`/`internal` state variables should be prefixed with an underscore
It is recommended by the [Solidity Style Guide](https://docs.soliditylang.org/en/v0.8.20/style-guide.html#underscore-prefix-for-non-external-functions-and-variables)

<details>
<summary>
There are <b>12</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

12:     uint256 private constant Q96 = 2 ** 96;

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L12)]


```solidity
File: src/V3Oracle.sol

27:     uint256 private constant Q96 = 2 ** 96;

28:     uint256 private constant Q128 = 2 ** 128;

```
*Github:* [[27](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L27), [28](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L28)]


```solidity
File: src/V3Vault.sol

33:     uint256 private constant Q32 = 2 ** 32;

34:     uint256 private constant Q96 = 2 ** 96;

65:     uint8 private immutable assetDecimals;

157:     mapping(address => uint256[]) private ownedTokens; // Mapping from owner address to list of owned token IDs

158:     mapping(uint256 => uint256) private ownedTokensIndex; // Mapping from token ID to index of the owner tokens list (for removal without loop)

159:     mapping(uint256 => address) private tokenOwner; // Mapping from token ID to owner

161:     uint256 private transformedTokenId = 0; // transient storage (when available in dencun)

```
*Github:* [[33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L33), [34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L34), [65](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L65), [157](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L157), [158](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L158), [159](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L159), [161](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L161)]


```solidity
File: src/automators/Automator.sol

20:     uint256 internal constant Q64 = 2 ** 64;

21:     uint256 internal constant Q96 = 2 ** 96;

```
*Github:* [[20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L20), [21](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L21)]


</details>


<a name="NC-85"></a> 
### [NC-85] Internal function calls within for loops
Making function calls or external calls within loops in Solidity can lead to inefficient gas usage, potential bottlenecks, and increased vulnerability to attacks. Each function call or external call consumes gas, and when executed within a loop, the gas cost multiplies, potentially causing the transaction to run out of gas or exceed block gas limits. This can result in transaction failure or unpredictable behavior.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/automators/Automator.sol

/// @audit `_transferToken`
111:         for (; i < count; ++i) {

```
*Github:* [[111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L111)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit `_withdrawBalanceInternal`
233:         for (; i < count; ++i) {

```
*Github:* [[233](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L233)]



<a name="NC-86"></a> 
### [NC-86]  `require()` / `revert()` statements should have descriptive reason strings

*There is one instance of this issue:*
```solidity
File: src/utils/Swapper.sol

157:         require(amount0Delta > 0 || amount1Delta > 0); // swaps entirely within 0-liquidity regions are not supported

```
*Github:* [[157](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L157)]



<a name="NC-87"></a> 
### [NC-87] Variables should be named in mixedCase style
As the [Solidity Style Guide](https://docs.soliditylang.org/en/latest/style-guide.html#naming-styles) suggests: `arguments`, `local variables` and `mutable state variables` should be named in mixedCase style.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/automators/Automator.sol

/// @audit `TWAPSeconds`
31:     event TWAPConfigChanged(uint32 TWAPSeconds, uint16 maxTWAPTickDifference);

/// @audit `TWAPSeconds`
38:     uint32 public TWAPSeconds;

```
*Github:* [[31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L31), [38](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L38)]



<a name="NC-88"></a> 
### [NC-88] Event is missing `indexed` fields
Index event fields make the field more quickly accessible to off-chain tools that parse events. However, note that each index field costs extra gas during emission, so it's not necessarily best to index the maximum allowed per event (three fields). Each event should use three indexed fields if there are three or more fields, and gas usage is not particularly of concern for the events in question. If there are fewer than three fields, all of the fields should be indexed.

<details>
<summary>
There are <b>38</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

18:     event SetValues(

```
*Github:* [[18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L18)]


```solidity
File: src/V3Oracle.sol

30:     event TokenConfigUpdated(address indexed token, TokenConfig config);

31:     event OracleModeUpdated(address indexed token, Mode mode);

32:     event SetMaxPoolPriceDifference(uint16 maxPoolPriceDifference);

33:     event SetEmergencyAdmin(address emergencyAdmin);

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L30), [31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L31), [32](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L32), [33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L33)]


```solidity
File: src/V3Vault.sol

68:     event ApprovedTransform(uint256 indexed tokenId, address owner, address target, bool isActive);

70:     event Add(uint256 indexed tokenId, address owner, uint256 oldTokenId); // when a token is added replacing another token - oldTokenId > 0

71:     event Remove(uint256 indexed tokenId, address recipient);

73:     event ExchangeRateUpdate(uint256 debtExchangeRateX96, uint256 lendExchangeRateX96);

75:     event WithdrawCollateral(

78:     event Borrow(uint256 indexed tokenId, address owner, uint256 assets, uint256 shares);

79:     event Repay(uint256 indexed tokenId, address repayer, address owner, uint256 assets, uint256 shares);

80:     event Liquidate(

93:     event WithdrawReserves(uint256 amount, address receiver);

94:     event SetTransformer(address transformer, bool active);

95:     event SetLimits(

102:     event SetReserveFactor(uint32 reserveFactorX32);

103:     event SetReserveProtectionFactor(uint32 reserveProtectionFactorX32);

104:     event SetTokenConfig(address token, uint32 collateralFactorX32, uint32 collateralValueLimitFactorX32);

106:     event SetEmergencyAdmin(address emergencyAdmin);

```
*Github:* [[68](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L68), [70](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L70), [71](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L71), [73](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L73), [75](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L75), [78](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L78), [79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L79), [80](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L80), [93](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L93), [94](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L94), [95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L95), [102](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L102), [103](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L103), [104](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L104), [106](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L106)]


```solidity
File: src/automators/AutoExit.sol

11:     event Executed(

20:     event PositionConfigured(

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L11), [20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L20)]


```solidity
File: src/automators/Automator.sol

27:     event OperatorChanged(address newOperator, bool active);

28:     event VaultChanged(address newVault, bool active);

30:     event WithdrawerChanged(address newWithdrawer);

31:     event TWAPConfigChanged(uint32 TWAPSeconds, uint16 maxTWAPTickDifference);

```
*Github:* [[27](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L27), [28](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L28), [30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L30), [31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L31)]


```solidity
File: src/transformers/AutoCompound.sol

18:     event AutoCompounded(

30:     event RewardUpdated(address account, uint64 totalRewardX64);

33:     event BalanceAdded(uint256 tokenId, address token, uint256 amount);

34:     event BalanceRemoved(uint256 tokenId, address token, uint256 amount);

35:     event BalanceWithdrawn(uint256 tokenId, address token, address to, uint256 amount);

```
*Github:* [[18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L18), [30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L30), [33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L33), [34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L34), [35](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L35)]


```solidity
File: src/transformers/AutoRange.sol

13:     event PositionConfigured(

```
*Github:* [[13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L13)]


```solidity
File: src/transformers/V3Utils.sol

22:     event CompoundFees(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

23:     event ChangeRange(uint256 indexed tokenId, uint256 newTokenId);

24:     event WithdrawAndCollectAndSwap(uint256 indexed tokenId, address token, uint256 amount);

25:     event SwapAndMint(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

26:     event SwapAndIncreaseLiquidity(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

```
*Github:* [[22](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L22), [23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L23), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L24), [25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L25), [26](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L26)]


```solidity
File: src/utils/Swapper.sol

18:     event Swap(address indexed tokenIn, address indexed tokenOut, uint256 amountIn, uint256 amountOut);

```
*Github:* [[18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L18)]


</details>


<a name="NC-89"></a> 
### [NC-89] Functions not used internally could be marked `external`

*There are <b>8</b> instances of this issue:*
```solidity
File: src/InterestRateModel.sol

58:     function getRatesPerSecondX96(uint256 cash, uint256 debt)

```
*Github:* [[58](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L58)]


```solidity
File: src/V3Vault.sol

277:     function decimals() public view override(IERC20Metadata, ERC20) returns (uint8) {

334:     function previewDeposit(uint256 assets) public view override returns (uint256) {

340:     function previewMint(uint256 shares) public view override returns (uint256) {

346:     function previewWithdraw(uint256 assets) public view override returns (uint256) {

352:     function previewRedeem(uint256 shares) public view override returns (uint256) {

```
*Github:* [[277](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L277), [334](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L334), [340](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L340), [346](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L346), [352](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L352)]


```solidity
File: src/automators/Automator.sol

79:     function setVault(address _vault, bool _active) public onlyOwner {

```
*Github:* [[79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L79)]


```solidity
File: src/transformers/V3Utils.sol

98:     function executeWithPermit(uint256 tokenId, Instructions memory instructions, uint8 v, bytes32 r, bytes32 s)

```
*Github:* [[98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L98)]



<a name="NC-90"></a> 
### [NC-90] Avoid commenting out unused code in production
Commenting out lines of code or entire functions in production code can lead to confusion and misinterpretation. This is because it becomes unclear if the commented-out code is intended for future use, is deprecated, or is just an artifact of previous development stages. Such practices can lead to codebase clutter and make it harder for other developers to understand and maintain the code. Furthermore, commented-out code could contain security vulnerabilities that might be overlooked because it is not active. The resolution is to always clean up your code before deploying it to production. Remove any non-essential comments, debug lines, and unused functions. If there is a need to preserve certain stages of your code, use version control systems like Git, which are designed to track and revert to previous versions of the code when needed.

*There is one instance of this issue:*
```solidity
File: src/V3Vault.sol

605:     /// This function is not allowed during transformation (if a transformer wants to decreaseLiquidity he can call the methods directly on the NonfungiblePositionManager)

```
*Github:* [[605](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L605)]



<a name="NC-91"></a> 
### [NC-91] Default address(0) can be returned
Allowing a function in Solidity to return the default address (address(0)) can be problematic as it can represent uninitialized or invalid addresses. If such an address is utilized in transfer operations or other sensitive actions, it could lead to loss of funds or unpredicted behavior. It's prudent to include checks in your functions to prevent the return of the zero address, enhancing contract security.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

/// @audit `address token0`
/// @audit `address token1`
162:     function getPositionBreakdown(uint256 tokenId)
             public
             view
             override
             returns (
                 address token0,
                 address token1,
                 uint24 fee,
                 uint128 liquidity,
                 uint256 amount0,
                 uint256 amount1,
                 uint128 fees0,
                 uint128 fees1
             )
         {

```
*Github:* [[162](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L162)]


```solidity
File: src/V3Vault.sol

/// @audit `address owner`
258:     function ownerOf(uint256 tokenId) external view override returns (address owner) {

```
*Github:* [[258](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L258)]


```solidity
File: src/automators/Automator.sol

/// @audit `address owner`
230:     function _validateOwner(uint256 tokenId, address vault) internal returns (address owner) {

```
*Github:* [[230](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L230)]



<a name="NC-92"></a> 
### [NC-92] Don't assume specific token balance
Token balances, much like ETH balances, can be susceptible to unexpected changes due to transaction ordering, approval allowances, or other on-chain activities. Relying on exact checks with == or != can result in unintended behaviors. Instead of checking for an exact token balance, developers should employ safer practices, like checking that a balance is above or below certain thresholds or within specified ranges. This approach mitigates potential issues arising from minute discrepancies in expected values. To ensure robust and resilient smart contracts, avoid strict equalities and embrace flexible conditions for token balance verifications.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/transformers/V3Utils.sol

635:             if (token0.balanceOf(address(this)) - state.balanceBefore0 != state.needed0) {

640:             if (token1.balanceOf(address(this)) - state.balanceBefore1 != state.needed1) {

645:             if (otherToken.balanceOf(address(this)) - state.balanceBeforeOther != state.neededOther) {

```
*Github:* [[635](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L635), [640](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L640), [645](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L645)]



<a name="NC-93"></a> 
### [NC-93] Don't only depend on Solidity's arithmetic ordering
Relying on Solidity's default arithmetic operator precedence can lead to misunderstood or overlooked nuances in code execution. Misinterpretation risks can be significant, especially when different developers or auditors review the code. To ensure clarity and minimize potential errors, it's recommended to use parentheses. These not only override the default precedence when needed but also emphasize the intended order of operations. By deliberately showing the intended calculation sequence using parentheses, developers make the code's logic explicit, reducing the risk of unintended behaviors and making the codebase more maintainable and understandable for all stakeholders.

<details>
<summary>
There are <b>30</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

15:     uint256 public constant MAX_BASE_RATE_X96 = Q96 / 10; // 10%

16:     uint256 public constant MAX_MULTIPLIER_X96 = Q96 * 2; // 200%

74:         supplyRateX96 = utilizationRateX96 * borrowRateX96 / Q96;

```
*Github:* [[15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L15), [16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L16), [74](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L74)]


```solidity
File: src/V3Oracle.sol

122:         price0X96 = price0X96 * Q96 / priceTokenX96;

123:         price1X96 = price1X96 * Q96 / priceTokenX96;

129:         uint256 derivedPoolPriceX96 = price0X96 * Q96 / price1X96;

353:             poolTWAPPriceX96 = Q96 * Q96 / priceX96;

489:                 feeGrowthInside0X128 = feeGrowthGlobal0X128 - lowerFeeGrowthOutside0X128 - upperFeeGrowthOutside0X128;

490:                 feeGrowthInside1X128 = feeGrowthGlobal1X128 - lowerFeeGrowthOutside1X128 - upperFeeGrowthOutside1X128;

```
*Github:* [[122](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L122), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L123), [129](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L129), [353](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L353), [489](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L489), [490](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L490)]


```solidity
File: src/V3Vault.sol

1027:         reserves = balance + debt > lent ? balance + debt - lent : 0;

1105:             uint256 startLiquidationValue = debt * fullValue / collateralValue;

1230:                             > lentAssets * collateralValueLimitFactorX32 / Q32

1238:                             > lentAssets * collateralValueLimitFactorX32 / Q32

```
*Github:* [[1027](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1027), [1105](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1105), [1230](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1230), [1238](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1238)]


```solidity
File: src/automators/AutoExit.sol

155:                 state.amount0 -= state.feeAmount0 * params.rewardX64 / Q64;

156:                 state.amount1 -= state.feeAmount1 * params.rewardX64 / Q64;

181:             state.amount0 = state.isAbove ? state.amount0 + state.amountOutDelta : state.amount0 - state.amountInDelta;

182:             state.amount1 = state.isAbove ? state.amount1 - state.amountInDelta : state.amount1 + state.amountOutDelta;

187:                     state.amount0 -= state.amount0 * params.rewardX64 / Q64;

189:                     state.amount1 -= state.amount1 * params.rewardX64 / Q64;

```
*Github:* [[155](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L155), [156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L156), [181](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L181), [182](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L182), [187](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L187), [189](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L189)]


```solidity
File: src/transformers/AutoCompound.sol

148:                         params.swap0To1 ? state.amount0 - state.amountInDelta : state.amount0 + state.amountOutDelta;

150:                         params.swap0To1 ? state.amount1 + state.amountOutDelta : state.amount1 - state.amountInDelta;

170:                 state.amount0Fees = state.compounded0 * rewardX64 / Q64;

171:                 state.amount1Fees = state.compounded1 * rewardX64 / Q64;

```
*Github:* [[148](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L148), [150](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L150), [170](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L170), [171](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L171)]


```solidity
File: src/transformers/AutoRange.sol

143:             state.protocolReward0 = state.feeAmount0 * params.rewardX64 / Q64;

144:             state.protocolReward1 = state.feeAmount1 * params.rewardX64 / Q64;

191:             state.amount0 = params.swap0To1 ? state.amount0 - state.amountInDelta : state.amount0 + state.amountOutDelta;

192:             state.amount1 = params.swap0To1 ? state.amount1 + state.amountOutDelta : state.amount1 - state.amountInDelta;

236:                 state.protocolReward0 = state.amountAdded0 * params.rewardX64 / Q64;

237:                 state.protocolReward1 = state.amountAdded1 * params.rewardX64 / Q64;

```
*Github:* [[143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L143), [144](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L144), [191](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L191), [192](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L192), [236](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L236), [237](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L237)]


```solidity
File: src/transformers/V3Utils.sol

820:             uint256 leftOver = params.amountIn0 + params.amountIn1 - amountInDelta0 - amountInDelta1;

```
*Github:* [[820](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L820)]


</details>


<a name="NC-94"></a> 
### [NC-94] Incorrect comparison against a max value
Comparing a value using `>= MAX_VALUE` is conceptually incorrect when `MAX_VALUE` is defined as the upper limit that a variable can take. According to the definition of a maximum value, the condition should only revert if the variable is greater than `MAX_VALUE`, not equal to it. Using `>=` can introduce unintended behavior, as the condition will trigger a revert even when the variable reaches its legitimate upper bound. This can lead to bugs and vulnerabilities, as well as hamper the contract's intended functionality. The resolution is to strictly use `>` when making comparisons against a defined `MAX_VALUE` to align with its conceptual definition and to prevent unintended reverts or vulnerabilities.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

147:         if (differenceX10000 >= maxDifferenceX10000) {

```
*Github:* [[147](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L147)]


```solidity
File: src/V3Vault.sol

1103:         if (fullValue >= maxPenaltyValue) {

```
*Github:* [[1103](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1103)]



<a name="NC-95"></a> 
### [NC-95] Payable functions which do not interact with the native token should not be payable
In Ethereum, a function marked `payable` can accept Ether. If a function is intended to work with Ether but isn't marked payable, it will reject any Ether sent to it, leading to failed transactions. Conversely, if a function doesn't involve Ether transactions but is mistakenly marked payable, it can inadvertently accept Ether, potentially locking it in the contract. Thus, functions that should handle Ether transfers must be correctly marked payable, and those that shouldn't must be non-payable. Proper function designation ensures the intended flow of Ether and guards against unintended Ether reception or loss.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/automators/Automator.sol

251:     receive() external payable {

```
*Github:* [[251](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L251)]


```solidity
File: src/transformers/V3Utils.sol

397:     function swap(SwapParams calldata params) external payable returns (uint256 amountOut) {

914:     receive() external payable {

```
*Github:* [[397](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L397), [914](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L914)]




## Gas Optimizations

<a name="GAS-1"></a> 
### [GAS-1] Assigning to structs can be more efficient
By changing the pattern of assigning value to the structure, gas savings of ~130 per instance are achieved. In addition, this use will provide significant savings in distribution costs. Instead of:
```solidity
MyStruct memory myStruct = MyStruct(_a, _b, _c);
```
write:
```solidity
MyStruct memory myStruct;
myStruct.a = _a;
myStruct.b = _b;
myStruct.c = _c;
```

<details>
<summary>
There are <b>14</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

231:             config = TokenConfig(
                     feed, maxFeedAge, feedDecimals, tokenDecimals, pool, isToken0, twapSeconds, mode, maxDifference

235:             config = TokenConfig(
                     feed, maxFeedAge, feedDecimals, tokenDecimals, IUniswapV3Pool(address(0)), false, 0, Mode.CHAINLINK, 0

```
*Github:* [[231](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L231), [235](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L235)]


```solidity
File: src/V3Vault.sol

446:             loans[tokenId] = Loan(0);

461:                 loans[tokenId] = Loan(loans[oldTokenId].debtShares);

```
*Github:* [[446](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L446), [461](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L461)]


```solidity
File: src/transformers/V3Utils.sol

149:                     SwapAndIncreaseLiquidityParams(
                             tokenId,
                             amount0,
                             amount1,
                             instructions.recipient,
                             instructions.deadline,
                             IERC20(token1),
                             instructions.amountIn1,
                             instructions.amountOut1Min,
                             instructions.swapData1,
                             0,
                             0,
                             "",
                             instructions.amountAddMin0,
                             instructions.amountAddMin1,
                             ""

172:                     SwapAndIncreaseLiquidityParams(
                             tokenId,
                             amount0,
                             amount1,
                             instructions.recipient,
                             instructions.deadline,
                             IERC20(token0),
                             0,
                             0,
                             "",
                             instructions.amountIn0,
                             instructions.amountOut0Min,
                             instructions.swapData0,
                             instructions.amountAddMin0,
                             instructions.amountAddMin1,
                             ""

196:                     SwapAndIncreaseLiquidityParams(
                             tokenId,
                             amount0,
                             amount1,
                             instructions.recipient,
                             instructions.deadline,
                             IERC20(address(0)),
                             0,
                             0,
                             "",
                             0,
                             0,
                             "",
                             instructions.amountAddMin0,
                             instructions.amountAddMin1,
                             ""

222:                     SwapAndMintParams(
                             IERC20(token0),
                             IERC20(token1),
                             instructions.fee,
                             instructions.tickLower,
                             instructions.tickUpper,
                             amount0,
                             amount1,
                             instructions.recipient,
                             instructions.recipientNFT,
                             instructions.deadline,
                             IERC20(token1),
                             instructions.amountIn1,
                             instructions.amountOut1Min,
                             instructions.swapData1,
                             0,
                             0,
                             "",
                             instructions.amountAddMin0,
                             instructions.amountAddMin1,
                             instructions.swapAndMintReturnData,
                             ""

249:                     SwapAndMintParams(
                             IERC20(token0),
                             IERC20(token1),
                             instructions.fee,
                             instructions.tickLower,
                             instructions.tickUpper,
                             amount0,
                             amount1,
                             instructions.recipient,
                             instructions.recipientNFT,
                             instructions.deadline,
                             IERC20(token0),
                             0,
                             0,
                             "",
                             instructions.amountIn0,
                             instructions.amountOut0Min,
                             instructions.swapData0,
                             instructions.amountAddMin0,
                             instructions.amountAddMin1,
                             instructions.swapAndMintReturnData,
                             ""

277:                     SwapAndMintParams(
                             IERC20(token0),
                             IERC20(token1),
                             instructions.fee,
                             instructions.tickLower,
                             instructions.tickUpper,
                             amount0,
                             amount1,
                             instructions.recipient,
                             instructions.recipientNFT,
                             instructions.deadline,
                             IERC20(address(0)),
                             0,
                             0,
                             "",
                             0,
                             0,
                             "",
                             instructions.amountAddMin0,
                             instructions.amountAddMin1,
                             instructions.swapAndMintReturnData,
                             ""

740:             SwapAndMintParams(
                     token0,
                     token1,
                     0,
                     0,
                     0,
                     params.amount0,
                     params.amount1,
                     params.recipient,
                     params.recipient,
                     params.deadline,
                     params.swapSourceToken,
                     params.amountIn0,
                     params.amountOut0Min,
                     params.swapData0,
                     params.amountIn1,
                     params.amountOut1Min,
                     params.swapData1,
                     params.amountAddMin0,
                     params.amountAddMin1,
                     "",
                     params.permitData

```
*Github:* [[149](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L149), [172](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L172), [196](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L196), [222](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L222), [249](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L249), [277](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L277), [740](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L740)]


```solidity
File: src/utils/FlashloanLiquidator.sol

52:             FlashCallbackData(
                    params.tokenId,
                    params.debtShares,
                    liquidationCost,
                    params.vault,
                    IERC20(asset),
                    RouterSwapParams(IERC20(token0), IERC20(asset), params.amount0In, 0, params.swapData0),
                    RouterSwapParams(IERC20(token1), IERC20(asset), params.amount1In, 0, params.swapData1),
                    msg.sender,
                    params.minReward

58:                 RouterSwapParams(IERC20(token0), IERC20(asset), params.amount0In, 0, params.swapData0),

59:                 RouterSwapParams(IERC20(token1), IERC20(asset), params.amount1In, 0, params.swapData1),

```
*Github:* [[52](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L52), [58](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L58), [59](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L59)]


</details>


<a name="GAS-2"></a> 
### [GAS-2] Optimize gas by using do-while loops
Using `do-while` loops instead of `for` loops can be more gas-efficient. Even if you add an `if` condition to account for the case where the loop doesn't execute at all, a `do-while` loop can still be cheaper in terms of gas.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/automators/Automator.sol

111:         for (; i < count; ++i) {

```
*Github:* [[111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L111)]


```solidity
File: src/transformers/AutoCompound.sol

233:         for (; i < count; ++i) {

```
*Github:* [[233](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L233)]



<a name="GAS-3"></a> 
### [GAS-3] Multiple `address`/ID mappings can be combined into a single `mapping` of an `address`/ID to a `struct`, where appropriate
Saves a storage slot for the mapping. Depending on the circumstances and sizes of types, can avoid a Gsset (20000 gas) per mapping combined. Reads and subsequent writes can also be cheaper when a function requires both values and they both fit in the same storage slot. Finally, if both fields are accessed in the same function, can save ~42 gas per access due to not having to [recalculate the key's keccak256 hash](https://gist.github.com/IllIllI000/ec23a57daa30a8f8ca8b9681c8ccefb0) (Gkeccak256 - 30 gas) and that calculation's associated stack operations.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

164:     mapping(address => mapping(uint256 => mapping(address => bool))) public transformApprovals; // owners permissions for other addresses to call transform on owners behalf (e.g. AutoRange contract)

```
*Github:* [[164](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L164)]


```solidity
File: src/transformers/AutoCompound.sol

45:     mapping(uint256 => mapping(address => uint256)) public positionBalances;

```
*Github:* [[45](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L45)]



<a name="GAS-4"></a> 
### [GAS-4] Consider activating via-ir for deploying
By using `--via-ir` or `{"viaIR": true}`, the compiler is able to use more advanced [multi-function optimizations](https://docs.soliditylang.org/en/v0.8.17/ir-breaking-changes.html#solidity-ir-based-codegen-changes), for extra gas savings.

*There is one instance of this issue:*
```solidity

Global finding

```
*Github:* [[Global](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/)]



<a name="GAS-5"></a> 
### [GAS-5] Divisions can be `unchecked` to save gas
The expression `type(int).min/(-1)` is the only case where division causes an overflow. Therefore, uncheck can be used to [save gas](https://gist.github.com/DadeKuma/3bc597338ae774b8b3bd43280d55271f) in scenarios where it is certain that such an overflow will not occur.

<details>
<summary>
There are <b>70</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

15:     uint256 public constant MAX_BASE_RATE_X96 = Q96 / 10; // 10%

50:         return debt * Q96 / (cash + debt);

67:             borrowRateX96 = (utilizationRateX96 * multiplierPerSecondX96 / Q96) + baseRatePerSecondX96;

69:             uint256 normalRateX96 = (kinkX96 * multiplierPerSecondX96 / Q96) + baseRatePerSecondX96;

71:             borrowRateX96 = (excessUtilX96 * jumpMultiplierPerSecondX96 / Q96) + normalRateX96;

74:         supplyRateX96 = utilizationRateX96 * borrowRateX96 / Q96;

95:         baseRatePerSecondX96 = baseRatePerYearX96 / YEAR_SECS;

96:         multiplierPerSecondX96 = multiplierPerYearX96 / YEAR_SECS;

97:         jumpMultiplierPerSecondX96 = jumpMultiplierPerYearX96 / YEAR_SECS;

```
*Github:* [[15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L15), [50](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L50), [67](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L67), [69](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L69), [71](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L71), [74](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L74), [95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L95), [96](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L96), [97](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L97)]


```solidity
File: src/V3Oracle.sol

120:         value = (price0X96 * (amount0 + fees0) / Q96 + price1X96 * (amount1 + fees1) / Q96) * Q96 / priceTokenX96;

120:         value = (price0X96 * (amount0 + fees0) / Q96 + price1X96 * (amount1 + fees1) / Q96) * Q96 / priceTokenX96;

120:         value = (price0X96 * (amount0 + fees0) / Q96 + price1X96 * (amount1 + fees1) / Q96) * Q96 / priceTokenX96;

121:         feeValue = (price0X96 * fees0 / Q96 + price1X96 * fees1 / Q96) * Q96 / priceTokenX96;

121:         feeValue = (price0X96 * fees0 / Q96 + price1X96 * fees1 / Q96) * Q96 / priceTokenX96;

121:         feeValue = (price0X96 * fees0 / Q96 + price1X96 * fees1 / Q96) * Q96 / priceTokenX96;

122:         price0X96 = price0X96 * Q96 / priceTokenX96;

123:         price1X96 = price1X96 * Q96 / priceTokenX96;

129:         uint256 derivedPoolPriceX96 = price0X96 * Q96 / price1X96;

144:             ? (priceX96 - verifyPriceX96) * 10000 / priceX96

145:             : (verifyPriceX96 - priceX96) * 10000 / verifyPriceX96;

304:             chainlinkPriceX96 = (10 ** referenceTokenDecimals) * chainlinkPriceX96 * Q96 / chainlinkReferencePriceX96

305:                 / (10 ** feedConfig.tokenDecimals);

342:         return uint256(answer) * Q96 / (10 ** feedConfig.feedDecimals);

353:             poolTWAPPriceX96 = Q96 * Q96 / priceX96;

369:             int24 tick = int24((tickCumulatives[0] - tickCumulatives[1]) / int56(uint56(twapSeconds)));

```
*Github:* [[120](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L120), [120](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L120), [120](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L120), [121](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L121), [121](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L121), [121](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L121), [122](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L122), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L123), [129](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L129), [144](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L144), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L145), [304](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L304), [305](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L305), [342](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L342), [353](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L353), [369](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L369)]


```solidity
File: src/V3Vault.sol

36:     uint32 public constant MAX_COLLATERAL_FACTOR_X32 = uint32(Q32 * 90 / 100); // 90%

38:     uint32 public constant MIN_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 2 / 100); // 2%

39:     uint32 public constant MAX_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 10 / 100); // 10%

41:     uint32 public constant MIN_RESERVE_PROTECTION_FACTOR_X32 = uint32(Q32 / 100); //1%

43:     uint32 public constant MAX_DAILY_LEND_INCREASE_X32 = uint32(Q32 / 10); //10%

44:     uint32 public constant MAX_DAILY_DEBT_INCREASE_X32 = uint32(Q32 / 10); //10%

769:             _convertToAssets(totalSupply(), newLendExchangeRateX96, Math.Rounding.Up) * reserveProtectionFactorX32 / Q32;

1054:                 fees0 = uint128(liquidationValue * fees0 / feeValue);

1055:                 fees1 = uint128(liquidationValue * fees1 / feeValue);

1060:                 liquidity = uint128((liquidationValue - feeValue) * liquidity / (fullValue - feeValue));

1100:         uint256 maxPenaltyValue = debt * (Q32 + MAX_LIQUIDATION_PENALTY_X32) / Q32;

1105:             uint256 startLiquidationValue = debt * fullValue / collateralValue;

1107:                 (Q96 - ((fullValue - maxPenaltyValue) * Q96 / (startLiquidationValue - maxPenaltyValue)));

1109:                 + (MAX_LIQUIDATION_PENALTY_X32 - MIN_LIQUIDATION_PENALTY_X32) * penaltyFractionX96 / Q96;

1111:             liquidationValue = debt * (Q32 + penaltyX32) / Q32;

1116:             uint256 penaltyValue = fullValue * (Q32 - MAX_LIQUIDATION_PENALTY_X32) / Q32;

1137:             newLendExchangeRateX96 = (totalLent - missing) * newLendExchangeRateX96 / totalLent;

1188:                 + oldDebtExchangeRateX96 * (block.timestamp - lastRateUpdate) * borrowRateX96 / Q96;

1190:                 + oldLendExchangeRateX96 * (block.timestamp - lastRateUpdate) * supplyRateX96 / Q96;

1230:                             > lentAssets * collateralValueLimitFactorX32 / Q32

1238:                             > lentAssets * collateralValueLimitFactorX32 / Q32

1248:         uint256 time = block.timestamp / 1 days;

1260:         uint256 time = block.timestamp / 1 days;

```
*Github:* [[36](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L36), [38](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L38), [39](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L39), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L41), [43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L43), [44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L44), [769](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L769), [1054](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1054), [1055](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1055), [1060](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1060), [1100](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1100), [1105](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1105), [1107](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1107), [1109](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1109), [1111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1111), [1116](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1116), [1137](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1137), [1188](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1188), [1190](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1190), [1230](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1230), [1238](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1238), [1248](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1248), [1260](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1260)]


```solidity
File: src/automators/AutoExit.sol

155:                 state.amount0 -= state.feeAmount0 * params.rewardX64 / Q64;

156:                 state.amount1 -= state.feeAmount1 * params.rewardX64 / Q64;

187:                     state.amount0 -= state.amount0 * params.rewardX64 / Q64;

189:                     state.amount1 -= state.amount1 * params.rewardX64 / Q64;

194:             state.amount0 -= (config.onlyFees ? state.feeAmount0 : state.amount0) * params.rewardX64 / Q64;

195:             state.amount1 -= (config.onlyFees ? state.feeAmount1 : state.amount1) * params.rewardX64 / Q64;

```
*Github:* [[155](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L155), [156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L156), [187](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L187), [189](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L189), [194](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L194), [195](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L195)]


```solidity
File: src/automators/Automator.sol

187:             return (int24((tickCumulatives[0] - tickCumulatives[1]) / int56(uint56(twapPeriod))), true);

```
*Github:* [[187](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L187)]


```solidity
File: src/transformers/AutoCompound.sol

47:     uint64 public constant MAX_REWARD_X64 = uint64(Q64 / 50); // 2%

156:             state.maxAddAmount0 = state.amount0 * Q64 / (rewardX64 + Q64);

157:             state.maxAddAmount1 = state.amount1 * Q64 / (rewardX64 + Q64);

170:                 state.amount0Fees = state.compounded0 * rewardX64 / Q64;

171:                 state.amount1Fees = state.compounded1 * rewardX64 / Q64;

```
*Github:* [[47](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L47), [156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L156), [157](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L157), [170](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L170), [171](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L171)]


```solidity
File: src/transformers/AutoRange.sol

39:         int32 lowerTickLimit; // if negative also in-range positions may be adjusted / if 0 out of range positions may be adjusted

40:         int32 upperTickLimit; // if negative also in-range positions may be adjusted / if 0 out of range positions may be adjusted

43:         uint64 token0SlippageX64; // max price difference from current pool price for swap / Q64 for token0

44:         uint64 token1SlippageX64; // max price difference from current pool price for swap / Q64 for token1

143:             state.protocolReward0 = state.feeAmount0 * params.rewardX64 / Q64;

144:             state.protocolReward1 = state.feeAmount1 * params.rewardX64 / Q64;

195:             state.maxAddAmount0 = config.onlyFees ? state.amount0 : state.amount0 * Q64 / (params.rewardX64 + Q64);

196:             state.maxAddAmount1 = config.onlyFees ? state.amount1 : state.amount1 * Q64 / (params.rewardX64 + Q64);

236:                 state.protocolReward0 = state.amountAdded0 * params.rewardX64 / Q64;

237:                 state.protocolReward1 = state.amountAdded1 * params.rewardX64 / Q64;

```
*Github:* [[39](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L39), [40](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L40), [43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L43), [44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L44), [143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L143), [144](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L144), [195](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L195), [196](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L196), [236](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L236), [237](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L237)]


</details>


<a name="GAS-6"></a> 
### [GAS-6] Do not calculate constants
Due to how constant variables are implemented (replacements at compile-time), an expression assigned to a constant variable is recomputed each time that the variable is used, which wastes some gas.

<details>
<summary>
There are <b>16</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

12:     uint256 private constant Q96 = 2 ** 96;

15:     uint256 public constant MAX_BASE_RATE_X96 = Q96 / 10; // 10%

16:     uint256 public constant MAX_MULTIPLIER_X96 = Q96 * 2; // 200%

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L12), [15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L15), [16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L16)]


```solidity
File: src/V3Oracle.sol

27:     uint256 private constant Q96 = 2 ** 96;

28:     uint256 private constant Q128 = 2 ** 128;

```
*Github:* [[27](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L27), [28](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L28)]


```solidity
File: src/V3Vault.sol

33:     uint256 private constant Q32 = 2 ** 32;

34:     uint256 private constant Q96 = 2 ** 96;

36:     uint32 public constant MAX_COLLATERAL_FACTOR_X32 = uint32(Q32 * 90 / 100); // 90%

38:     uint32 public constant MIN_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 2 / 100); // 2%

39:     uint32 public constant MAX_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 10 / 100); // 10%

41:     uint32 public constant MIN_RESERVE_PROTECTION_FACTOR_X32 = uint32(Q32 / 100); //1%

43:     uint32 public constant MAX_DAILY_LEND_INCREASE_X32 = uint32(Q32 / 10); //10%

44:     uint32 public constant MAX_DAILY_DEBT_INCREASE_X32 = uint32(Q32 / 10); //10%

```
*Github:* [[33](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L33), [34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L34), [36](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L36), [38](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L38), [39](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L39), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L41), [43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L43), [44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L44)]


```solidity
File: src/automators/Automator.sol

20:     uint256 internal constant Q64 = 2 ** 64;

21:     uint256 internal constant Q96 = 2 ** 96;

```
*Github:* [[20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L20), [21](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L21)]


```solidity
File: src/transformers/AutoCompound.sol

47:     uint64 public constant MAX_REWARD_X64 = uint64(Q64 / 50); // 2%

```
*Github:* [[47](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L47)]


</details>


<a name="GAS-7"></a> 
### [GAS-7] Operator `+=` costs more gas than `<x> = <x> + <y>` for state variables

*There are <b>7</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

/// @audit `debtSharesTotal +=`
569:         debtSharesTotal += shares;

/// @audit `dailyDebtIncreaseLimitLeft -=`
577:             dailyDebtIncreaseLimitLeft -= assets;

/// @audit `debtSharesTotal -=`
731:         debtSharesTotal -= debtShares;

/// @audit `dailyLendIncreaseLimitLeft -=`
913:             dailyLendIncreaseLimitLeft -= assets;

/// @audit `dailyLendIncreaseLimitLeft +=`
949:         dailyLendIncreaseLimitLeft += assets;

/// @audit `debtSharesTotal -=`
992:         debtSharesTotal -= shares;

/// @audit `dailyDebtIncreaseLimitLeft +=`
995:         dailyDebtIncreaseLimitLeft += assets;

```
*Github:* [[569](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L569), [577](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L577), [731](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L731), [913](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L913), [949](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L949), [992](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L992), [995](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L995)]



<a name="GAS-8"></a> 
### [GAS-8] Duplicated `require()`/`revert()` checks should be refactored to a modifier or function to save gas
Saves deployment costs.

<details>
<summary>
There are <b>24</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit duplicated on line 212
187:             revert InvalidConfig();

/// @audit duplicated on line 222
256:             revert InvalidConfig();

```
*Github:* [[187](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L187), [256](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L256)]


```solidity
File: src/V3Vault.sol

/// @audit duplicated on line 485
420:             revert Unauthorized();

/// @audit duplicated on line 616
503:             revert TransformNotAllowed();

/// @audit duplicated on line 533
516:             revert Unauthorized();

/// @audit duplicated on line 622
562:             revert Unauthorized();

/// @audit duplicated on line 1009
587:             revert MinLoanSize();

/// @audit duplicated on line 941
775:             revert InsufficientLiquidity();

/// @audit duplicated on line 846
794:             revert InvalidConfig();

/// @audit duplicated on line 1240
1232:                     revert CollateralValueLimit();

```
*Github:* [[420](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L420), [503](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L503), [516](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L516), [562](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L562), [587](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L587), [775](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L775), [794](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L794), [1232](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1232)]


```solidity
File: src/automators/AutoExit.sol

/// @audit duplicated on line 221
102:             revert Unauthorized();

```
*Github:* [[102](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L102)]


```solidity
File: src/automators/Automator.sol

/// @audit duplicated on line 92
89:             revert InvalidConfig();

/// @audit duplicated on line 125
106:             revert Unauthorized();

/// @audit duplicated on line 223
132:                 revert EtherSendFailed();

/// @audit duplicated on line 238
233:             revert Unauthorized();

```
*Github:* [[89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L89), [106](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L106), [132](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L132), [233](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L233)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit duplicated on line 103
89:             revert Unauthorized();

/// @audit duplicated on line 229
206:             revert Unauthorized();

```
*Github:* [[89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L89), [206](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L206)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit duplicated on line 113
99:             revert Unauthorized();

```
*Github:* [[99](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L99)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit duplicated on line 785
143:             revert AmountError();

/// @audit duplicated on line 473
399:             revert SameToken();

/// @audit duplicated on line 641
636:                 revert TransferError(); // reverts for fee-on-transfer tokens

/// @audit duplicated on line 677
672:                     revert TooMuchEtherSent();

/// @audit duplicated on line 909
906:             revert CollectError();

```
*Github:* [[143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L143), [399](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L399), [636](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L636), [672](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L672), [906](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L906)]


```solidity
File: src/utils/Swapper.sol

/// @audit duplicated on line 150
112:                 revert SlippageError();

```
*Github:* [[112](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L112)]


</details>


<a name="GAS-9"></a> 
### [GAS-9] Increments can be `unchecked` to save gas
Using `unchecked` increments can save gas by bypassing the built-in overflow checks. This can save 30-40 gas per iteration. So it is recommended to use unchecked increments when overflow is not possible.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/automators/Automator.sol

111:         for (; i < count; ++i) {

```
*Github:* [[111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L111)]


```solidity
File: src/transformers/AutoCompound.sol

233:         for (; i < count; ++i) {

```
*Github:* [[233](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L233)]



<a name="GAS-10"></a> 
### [GAS-10] `internal` functions only called once can be inlined to save gas
If an `internal` function is only used once, there is no need to modularize it, unless the function calling it would otherwise be too long and complex. Not inlining costs 20 to 40 gas because of two extra JUMP instructions and additional stack operations needed for function calls.

<details>
<summary>
There are <b>17</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit `_checkPoolPrice` is used only once
133:     function _checkPoolPrice(address token0, address token1, uint24 fee, uint256 derivedPoolPriceX96) internal view {

/// @audit `_getTWAPPriceX96` is used only once
346:     function _getTWAPPriceX96(TokenConfig memory feedConfig) internal view returns (uint256 poolTWAPPriceX96) {

/// @audit `_initializeState` is used only once
395:     function _initializeState(uint256 tokenId) internal view returns (PositionState memory state) {

/// @audit `_getAmounts` is used only once
426:     function _getAmounts(PositionState memory state)

/// @audit `_getUncollectedFees` is used only once
445:     function _getUncollectedFees(PositionState memory position, int24 tick)

/// @audit `_getFeeGrowthInside` is used only once
472:     function _getFeeGrowthInside(

```
*Github:* [[133](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L133), [346](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L346), [395](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L395), [426](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L426), [445](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L445), [472](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L472)]


```solidity
File: src/V3Vault.sol

/// @audit `_sendPositionValue` is used only once
1032:     function _sendPositionValue(

/// @audit `_handleReserveLiquidation` is used only once
1123:     function _handleReserveLiquidation(

/// @audit `_calculateTokenCollateralFactorX32` is used only once
1143:     function _calculateTokenCollateralFactorX32(uint256 tokenId) internal view returns (uint32) {

/// @audit `_removeTokenFromOwner` is used only once
1303:     function _removeTokenFromOwner(address from, uint256 tokenId) internal {

```
*Github:* [[1032](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1032), [1123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1123), [1143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1143), [1303](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1303)]


```solidity
File: src/automators/Automator.sol

/// @audit `_getTWAPTick` is used only once
180:     function _getTWAPTick(IUniswapV3Pool pool, uint32 twapPeriod) internal view returns (int24, bool) {

/// @audit `_validateOwner` is used only once
230:     function _validateOwner(uint256 tokenId, address vault) internal returns (address owner) {

```
*Github:* [[180](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L180), [230](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L230)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit `_checkApprovals` is used only once
276:     function _checkApprovals(address token0, address token1) internal {

```
*Github:* [[276](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L276)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `_getTickSpacing` is used only once
300:     function _getTickSpacing(uint24 fee) internal view returns (int24) {

```
*Github:* [[300](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L300)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit `_decreaseLiquidity` is used only once
877:     function _decreaseLiquidity(

/// @audit `_collectFees` is used only once
892:     function _collectFees(uint256 tokenId, IERC20 token0, IERC20 token1, uint128 collectAmount0, uint128 collectAmount1)

```
*Github:* [[877](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L877), [892](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L892)]


```solidity
File: src/utils/Swapper.sol

/// @audit `_poolSwap` is used only once
132:     function _poolSwap(PoolSwapParams memory params) internal returns (uint256 amountInDelta, uint256 amountOutDelta) {

```
*Github:* [[132](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L132)]


</details>


<a name="GAS-11"></a> 
### [GAS-11] Low level `call` can be optimized with assembly
When using low-level calls, the `returnData` is copied to memory even if the variable is not utilized. The proper way to handle this is through a low level assembly call.

*There are <b>6</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

522:         (bool success,) = transformer.call(data);

```
*Github:* [[522](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L522)]


```solidity
File: src/automators/Automator.sol

130:             (bool sent,) = to.call{value: balance}("");

221:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[130](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L130), [221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L221)]


```solidity
File: src/transformers/V3Utils.sol

867:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[867](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L867)]


```solidity
File: src/utils/Swapper.sol

89:                 (bool success,) = zeroxRouter.call(data.data);

89:                 (bool success,) = zeroxRouter.call(data.data);

```
*Github:* [[89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L89), [89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L89)]



<a name="GAS-12"></a> 
### [GAS-12] Multiple accesses of the same mapping/array key/index should be cached
The instances below point to the second+ access of a value inside a mapping/array, within a function. Caching a mapping's value in a local `storage` or `calldata` variable when the value is accessed [multiple times](https://gist.github.com/IllIllI000/ec23a57daa30a8f8ca8b9681c8ccefb0), saves ~42 gas per access due to not having to recalculate the key's keccak256 hash (Gkeccak256 - 30 gas) and that calculation's associated stack operations. Caching an array's struct avoids recalculating the array offsets into memory/calldata

<details>
<summary>
There are <b>15</b> instances (click to show):
</summary>

```solidity
File: src/V3Vault.sol

/// @audit `loans[tokenId]` is also accessed on line 446
461:                 loans[tokenId] = Loan(loans[oldTokenId].debtShares);

/// @audit `loans[tokenId]` is also accessed on line 446
471:                     tokenId, debtExchangeRateX96, lendExchangeRateX96, 0, loans[tokenId].debtShares

/// @audit `tokenOwner[tokenId]` is also accessed on line 561
595:         address owner = tokenOwner[tokenId];

/// @audit `tokenConfigs[token]` is also accessed on line 863
864:         tokenConfigs[token].collateralValueLimitFactorX32 = collateralValueLimitFactorX32;

/// @audit `loans[tokenId]` is also accessed on line 1081
1082:         delete loans[tokenId];

/// @audit `ownedTokens[to]` is also accessed on line 1298
1299:         ownedTokens[to].push(tokenId);

/// @audit `ownedTokens[from]` is also accessed on line 1304
1307:             uint256 lastTokenId = ownedTokens[from][lastTokenIndex];

/// @audit `ownedTokens[from]` is also accessed on line 1304
1308:             ownedTokens[from][tokenIndex] = lastTokenId;

/// @audit `ownedTokens[from]` is also accessed on line 1304
1311:         ownedTokens[from].pop();

/// @audit `ownedTokensIndex[tokenId]` is also accessed on line 1305
1312:         // Note that ownedTokensIndex[tokenId] is not deleted. There is no need to delete it - gas optimization

```
*Github:* [[461](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L461), [471](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L471), [595](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L595), [864](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L864), [1082](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1082), [1299](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1299), [1307](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1307), [1308](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1308), [1311](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1311), [1312](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1312)]


```solidity
File: src/automators/AutoExit.sol

/// @audit `positionConfigs[params.tokenId]` is also accessed on line 106
207:         delete positionConfigs[params.tokenId];

```
*Github:* [[207](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L207)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit `positionBalances[params.tokenId]` is also accessed on line 119
120:         state.amount1 = state.amount1 + positionBalances[params.tokenId][state.token1];

/// @audit `positionBalances[tokenId]` is also accessed on line 211
215:         uint256 balance1 = positionBalances[tokenId][token1];

/// @audit `positionBalances[tokenId]` is also accessed on line 255
257:             positionBalances[tokenId][token] = amount;

```
*Github:* [[120](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L120), [215](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L215), [257](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L257)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `positionConfigs[params.tokenId]` is also accessed on line 116
265:             delete positionConfigs[params.tokenId];

```
*Github:* [[265](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L265)]


</details>


<a name="GAS-13"></a> 
### [GAS-13] Operator `>=`/`<=` costs less gas than operator `>`/`<`
The compiler uses opcodes `GT` and `ISZERO` for code that uses `>`, but only requires `LT` for `>=`. A similar behavior applies for `>`, which uses opcodes `LT` and `ISZERO`, but only requires `GT` for `<=`. It can save 3 gas for each. It should be converted to the `<=`/`>=` equivalent when comparing against integer literals.

<details>
<summary>
There are <b>124</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

89:             baseRatePerYearX96 > MAX_BASE_RATE_X96 || multiplierPerYearX96 > MAX_MULTIPLIER_X96

89:             baseRatePerYearX96 > MAX_BASE_RATE_X96 || multiplierPerYearX96 > MAX_MULTIPLIER_X96

90:                 || jumpMultiplierPerYearX96 > MAX_MULTIPLIER_X96

```
*Github:* [[89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L89), [89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L89), [90](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L90)]


```solidity
File: src/V3Oracle.sol

143:         uint256 differenceX10000 = priceX96 > verifyPriceX96

186:         if (_maxPoolPriceDifference < MIN_PRICE_DIFFERENCE) {

221:             if (maxDifference < MIN_PRICE_DIFFERENCE) {

338:         if (updatedAt + feedConfig.maxFeedAge < block.timestamp || answer < 0) {

338:         if (updatedAt + feedConfig.maxFeedAge < block.timestamp || answer < 0) {

431:         if (state.liquidity > 0) {

485:             if (tickCurrent < tickLower) {

488:             } else if (tickCurrent < tickUpper) {

```
*Github:* [[143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L143), [186](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L186), [221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L221), [338](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L338), [338](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L338), [431](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L431), [485](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L485), [488](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L488)]


```solidity
File: src/V3Vault.sol

70:     event Add(uint256 indexed tokenId, address owner, uint256 oldTokenId); // when a token is added replacing another token - oldTokenId > 0

443:             if (data.length > 0) {

505:         if (transformedTokenId > 0) {

552:             transformedTokenId > 0 && transformedTokenId == tokenId && transformerAllowList[msg.sender];

571:         if (debtSharesTotal > _convertToShares(globalDebtLimit, newDebtExchangeRateX96, Math.Rounding.Down)) {

574:         if (assets > dailyDebtIncreaseLimitLeft) {

586:         if (debt < minLoanSize) {

615:         if (transformedTokenId > 0) {

687:         if (transformedTokenId > 0) {

712:         if (state.reserveCost > 0) {

717:         if (params.permitData.length > 0) {

737:         if (amount0 < params.amount0Min || amount1 < params.amount1Min) {

737:         if (amount0 < params.amount0Min || amount1 < params.amount1Min) {

771:         uint256 unprotected = reserves > protected ? reserves - protected : 0;

772:         uint256 available = balance > unprotected ? unprotected : balance;

774:         if (amount > available) {

778:         if (amount > 0) {

845:         if (_reserveProtectionFactorX32 < MIN_RESERVE_PROTECTION_FACTOR_X32) {

860:         if (collateralFactorX32 > MAX_COLLATERAL_FACTOR_X32) {

893:         if (permitData.length > 0) {

910:         if (assets > dailyLendIncreaseLimitLeft) {

940:         if (available < assets) {

973:         if (shares > currentShares) {

977:         if (assets > 0) {

978:             if (permitData.length > 0) {

1027:         reserves = balance + debt > lent ? balance + debt - lent : 0;

1028:         available = balance > reserves ? balance - reserves : 0;

1052:             if (liquidationValue < feeValue) {

1064:         if (liquidity > 0) {

1131:         if (reserveCost > reserves) {

1147:         return factor0X32 > factor1X32 ? factor1X32 : factor0X32;

1155:         if (block.timestamp > lastExchangeRateUpdate) {

1186:         if (lastRateUpdate > 0) {

1216:             if (oldShares > newShares) {

1228:                     collateralValueLimitFactorX32 < type(uint32).max

1236:                     collateralValueLimitFactorX32 < type(uint32).max

1249:         if (force || time > dailyLendIncreaseLimitLastReset) {

1253:                 dailyLendIncreaseLimitMin > lendIncreaseLimit ? dailyLendIncreaseLimitMin : lendIncreaseLimit;

1261:         if (force || time > dailyDebtIncreaseLimitLastReset) {

1265:                 dailyDebtIncreaseLimitMin > debtIncreaseLimit ? dailyDebtIncreaseLimitMin : debtIncreaseLimit;

```
*Github:* [[70](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L70), [443](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L443), [505](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L505), [552](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L552), [571](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L571), [574](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L574), [586](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L586), [615](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L615), [687](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L687), [712](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L712), [717](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L717), [737](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L737), [737](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L737), [771](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L771), [772](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L772), [774](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L774), [778](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L778), [845](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L845), [860](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L860), [893](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L893), [910](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L910), [940](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L940), [973](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L973), [977](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L977), [978](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L978), [1027](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1027), [1028](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1028), [1052](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1052), [1064](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1064), [1131](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1131), [1147](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1147), [1155](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1155), [1186](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1186), [1216](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1216), [1228](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1228), [1236](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1236), [1249](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1249), [1253](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1253), [1261](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1261), [1265](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1265)]


```solidity
File: src/automators/AutoExit.sol

113:             config.onlyFees && params.rewardX64 > config.maxRewardX64

114:                 || !config.onlyFees && params.rewardX64 > config.maxRewardX64

135:         if (config.token0TriggerTick <= state.tick && state.tick < config.token1TriggerTick) {

199:         if (state.amount0 > 0) {

202:         if (state.amount1 > 0) {

```
*Github:* [[113](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L113), [114](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L114), [135](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L135), [199](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L199), [202](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L202)]


```solidity
File: src/automators/Automator.sol

88:         if (_TWAPSeconds < MIN_TWAP_SECONDS) {

91:         if (_maxTWAPTickDifference > MAX_TWAP_TICK_DIFFERENCE) {

111:         for (; i < count; ++i) {

113:             if (balance > 0) {

129:         if (balance > 0) {

200:         if (liquidity > 0) {

```
*Github:* [[88](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L88), [91](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L91), [111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L111), [113](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L113), [129](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L129), [200](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L200)]


```solidity
File: src/transformers/AutoCompound.sol

123:         if (state.amount0 > 0 || state.amount1 > 0) {

123:         if (state.amount0 > 0 || state.amount1 > 0) {

127:             if (amountIn > 0) {

133:                 if (tSecs > 0) {

140:                 if (amountIn > 0) {

160:             if (state.maxAddAmount0 > 0 || state.maxAddAmount1 > 0) {

160:             if (state.maxAddAmount0 > 0 || state.maxAddAmount1 > 0) {

212:         if (balance0 > 0) {

216:         if (balance1 > 0) {

233:         for (; i < count; ++i) {

258:             if (amount > currentBalance) {

```
*Github:* [[123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L123), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L123), [127](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L127), [133](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L133), [140](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L140), [160](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L160), [160](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L160), [212](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L212), [216](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L216), [233](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L233), [258](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L258)]


```solidity
File: src/transformers/AutoRange.sol

123:             config.onlyFees && params.rewardX64 > config.maxRewardX64

124:                 || !config.onlyFees && params.rewardX64 > config.maxRewardX64

149:         if (params.swap0To1 && params.amountIn > state.amount0 || !params.swap0To1 && params.amountIn > state.amount1) {

149:         if (params.swap0To1 && params.amountIn > state.amount0 || !params.swap0To1 && params.amountIn > state.amount1) {

167:             state.currentTick < state.tickLower - config.lowerTickLimit

243:             if (state.amount0 - state.amountAdded0 > 0) {

246:             if (state.amount1 - state.amountAdded1 > 0) {

280:         if (config.lowerTickDelta > config.upperTickDelta) {

```
*Github:* [[123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L123), [124](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L124), [149](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L149), [149](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L149), [167](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L167), [243](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L243), [246](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L246), [280](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L280)]


```solidity
File: src/transformers/LeverageTransformer.sol

52:         if (params.amountIn0 > 0) {

64:         if (params.amountIn1 > 0) {

87:         if (amount0 > added0) {

90:         if (amount1 > added1) {

93:         if (token != token0 && token != token1 && amount > 0) {

146:         if (params.amountIn0 > 0 && token != token0) {

155:         if (params.amountIn1 > 0 && token != token1) {

169:         if (amount0 > 0 && token != token0) {

172:         if (amount1 > 0 && token != token1) {

```
*Github:* [[52](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L52), [64](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L64), [87](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L87), [90](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L90), [93](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L93), [146](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L146), [155](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L155), [169](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L169), [172](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L172)]


```solidity
File: src/transformers/V3Utils.sol

142:         if (amount0 < instructions.amountIn0 || amount1 < instructions.amountIn1) {

142:         if (amount0 < instructions.amountIn0 || amount1 < instructions.amountIn1) {

316:                 if (amountInDelta < amount0) {

333:                 if (amountInDelta < amount1) {

402:         if (params.permitData.length > 0) {

476:         if (params.permitData.length > 0) {

539:         if (params.permitData.length > 0) {

577:         if (needed0 > 0) {

580:         if (needed1 > 0) {

583:         if (neededOther > 0) {

617:         if (state.needed0 > 0) {

621:         if (state.needed1 > 0) {

625:         if (state.neededOther > 0) {

634:         if (state.needed0 > 0) {

639:         if (state.needed1 > 0) {

644:         if (state.neededOther > 0) {

671:                 if (amountAdded0 > amount0) {

676:                 if (amountAdded1 > amount1) {

681:                 if (amountAddedOther > amountOther) {

690:         if (amount0 > amountAdded0) {

693:         if (amount1 > amountAdded1) {

697:             amountOther > amountAddedOther && address(otherToken) != address(0) && token0 != otherToken

784:             if (params.amount0 < params.amountIn1) {

795:             if (params.amount1 < params.amountIn0) {

```
*Github:* [[142](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L142), [142](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L142), [316](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L316), [333](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L333), [402](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L402), [476](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L476), [539](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L539), [577](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L577), [580](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L580), [583](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L583), [617](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L617), [621](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L621), [625](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L625), [634](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L634), [639](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L639), [644](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L644), [671](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L671), [676](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L676), [681](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L681), [690](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L690), [693](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L693), [697](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L697), [784](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L784), [795](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L795)]


```solidity
File: src/utils/FlashloanLiquidator.sol

90:             if (balance > 0) {

96:             if (balance > 0) {

102:             if (balance < data.minReward) {

105:             if (balance > 0) {

```
*Github:* [[90](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L90), [96](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L96), [102](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L102), [105](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L105)]


```solidity
File: src/utils/Swapper.sol

111:             if (amountOutDelta < params.amountOutMin) {

133:         if (params.amountIn > 0) {

149:             if (amountOutDelta < params.amountOutMin) {

157:         require(amount0Delta > 0 || amount1Delta > 0); // swaps entirely within 0-liquidity regions are not supported

157:         require(amount0Delta > 0 || amount1Delta > 0); // swaps entirely within 0-liquidity regions are not supported

166:         uint256 amountToPay = amount0Delta > 0 ? uint256(amount0Delta) : uint256(amount1Delta);

```
*Github:* [[111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L111), [133](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L133), [149](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L149), [157](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L157), [157](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L157), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L166)]


</details>


<a name="GAS-14"></a> 
### [GAS-14] Optimize Gas by splitting `if() revert` statements
Using boolean operators in a single `if() revert` statement can consume more gas than necessary. Consider splitting these statements to save gas.

*There are <b>9</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

227:             if (!(token0 == token && token1 == referenceToken || token0 == referenceToken && token1 == token)) {

338:         if (updatedAt + feedConfig.maxFeedAge < block.timestamp || answer < 0) {

```
*Github:* [[227](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L227), [338](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L338)]


```solidity
File: src/V3Vault.sol

435:         if (msg.sender != address(nonfungiblePositionManager) || from == address(this)) {

502:         if (tokenId == 0 || !transformerAllowList[transformer]) {

737:         if (amount0 < params.amount0Min || amount1 < params.amount1Min) {

```
*Github:* [[435](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L435), [502](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L502), [737](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L737)]


```solidity
File: src/transformers/AutoCompound.sol

88:         if (!operators[msg.sender] || !vaults[vault]) {

```
*Github:* [[88](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L88)]


```solidity
File: src/transformers/AutoRange.sol

98:         if (!operators[msg.sender] || !vaults[vault]) {

149:         if (params.swap0To1 && params.amountIn > state.amount0 || !params.swap0To1 && params.amountIn > state.amount1) {

```
*Github:* [[98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L98), [149](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L149)]


```solidity
File: src/transformers/V3Utils.sol

142:         if (amount0 < instructions.amountIn0 || amount1 < instructions.amountIn1) {

```
*Github:* [[142](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L142)]



<a name="GAS-15"></a> 
### [GAS-15] Optimize names to save gas
`public`/`external` function names and `public` member variable names can be optimized to save gas. See this [link](https://gist.github.com/IllIllI000/a5d8b486a8259f9f77891a919febd1a9) for an example of how it works. Below are the interfaces/abstract contracts that can be optimized so that the most frequently-called functions use the least amount of gas possible during method lookup. Method IDs that have two leading zero bytes can save 128 gas each during deployment, and renaming functions to have lower method IDs will save 22 gas per call, [per sorted position shifted](https://medium.com/joyso/solidity-how-does-function-name-affect-gas-consumption-in-smart-contract-47d270d8ac92)

*There are <b>9</b> instances of this issue:*
```solidity
File: src/InterestRateModel.sol

/// @audit `getUtilizationRateX96`, `getRatesPerSecondX96`, `setValues`
11: contract InterestRateModel is Ownable, IInterestRateModel, IErrors {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L11)]


```solidity
File: src/V3Oracle.sol

/// @audit `getValue`, `getPositionBreakdown`, `setMaxPoolPriceDifference`, `setTokenConfig`, `setOracleMode`, `setEmergencyAdmin`
24: contract V3Oracle is IV3Oracle, Ownable, IErrors {

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L24)]


```solidity
File: src/V3Vault.sol

/// @audit `vaultInfo`, `lendInfo`, `loanInfo`, `ownerOf`, `loanCount`, `loanAtIndex`, `decimals`, `totalAssets`, `convertToShares`, `convertToAssets`, `maxDeposit`, `maxMint`, `maxWithdraw`, `maxRedeem`, `previewDeposit`, `previewMint`, `previewWithdraw`, `previewRedeem`, `deposit`, `mint`, `withdraw`, `redeem`, `deposit`, `mint`, `create`, `createWithPermit`, `onERC721Received`, `approveTransform`, `transform`, `borrow`, `decreaseLiquidityAndCollect`, `repay`, `repay`, `liquidate`, `withdrawReserves`, `setTransformer`, `setLimits`, `setReserveFactor`, `setReserveProtectionFactor`, `setTokenConfig`, `setEmergencyAdmin`
30: contract V3Vault is ERC20, Multicall, Ownable, IVault, IERC721Receiver, IErrors {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L30)]


```solidity
File: src/automators/AutoExit.sol

/// @audit `execute`, `configToken`
10: contract AutoExit is Automator {

```
*Github:* [[10](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L10)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit `executeWithVault`, `execute`, `withdrawLeftoverBalances`, `withdrawBalances`, `setReward`
16: contract AutoCompound is Automator, Multicall, ReentrancyGuard {

```
*Github:* [[16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L16)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `executeWithVault`, `execute`, `configToken`
11: contract AutoRange is Automator {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L11)]


```solidity
File: src/transformers/LeverageTransformer.sol

/// @audit `leverageUp`, `leverageDown`
12: contract LeverageTransformer is Swapper {

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L12)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit `executeWithPermit`, `execute`, `onERC721Received`, `swap`, `swapAndMint`, `swapAndIncreaseLiquidity`
15: contract V3Utils is Swapper, IERC721Receiver {

```
*Github:* [[15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L15)]


```solidity
File: src/utils/FlashloanLiquidator.sol

/// @audit `liquidate`, `uniswapV3FlashCallback`
11: contract FlashloanLiquidator is Swapper, IUniswapV3FlashCallback {

```
*Github:* [[11](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L11)]



<a name="GAS-16"></a> 
### [GAS-16] Reduce gas usage by moving to Solidity 0.8.19 or later
Solidity version 0.8.19 introduced a number of gas optimizations, refer to the [Solidity 0.8.19 Release Announcement](https://soliditylang.org/blog/2023/02/22/solidity-0.8.19-release-announcement/) for details.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L2)]


```solidity
File: src/V3Oracle.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L2)]


```solidity
File: src/V3Vault.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L2)]


```solidity
File: src/automators/AutoExit.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L2)]


```solidity
File: src/automators/Automator.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L2)]


```solidity
File: src/transformers/AutoCompound.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L2)]


```solidity
File: src/transformers/AutoRange.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L2)]


```solidity
File: src/transformers/LeverageTransformer.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L2)]


```solidity
File: src/transformers/V3Utils.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L2)]


```solidity
File: src/utils/FlashloanLiquidator.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L2)]


```solidity
File: src/utils/Swapper.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L2)]


</details>


<a name="GAS-17"></a> 
### [GAS-17] Redundant state variable getters
Getters for public state variables are automatically generated so there is no need to code them manually and waste gas.

*There is one instance of this issue:*
```solidity
File: src/V3Vault.sol

277:     function decimals() public view override(IERC20Metadata, ERC20) returns (uint8) {
             return assetDecimals;

```
*Github:* [[277](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L277)]



<a name="GAS-18"></a> 
### [GAS-18] Remove or replace unused state variables
Saves a storage slot. If the variable is assigned a non-zero value, saves Gsset (20000 gas). If it's assigned a zero value, saves Gsreset (2900 gas). If the variable remains unassigned, there is no gas savings unless the variable is `public`, in which case the compiler-generated non-payable getter deployment cost is saved. If the state variable is overriding an interface's public function, mark the variable as `constant` or `immutable` so that it does not use a storage slot.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/InterestRateModel.sol

24:     uint256 public baseRatePerSecondX96;

```
*Github:* [[24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L24)]


```solidity
File: src/transformers/AutoCompound.sol

47:     uint64 public constant MAX_REWARD_X64 = uint64(Q64 / 50); // 2%

```
*Github:* [[47](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L47)]



<a name="GAS-19"></a> 
### [GAS-19] The result of a function call should be cached rather than re-calling the function
The function calls in solidity are expensive. If the same result of the same function calls are to be used several times, the result should be cached to reduce the gas consumption of repeated calls.

<details>
<summary>
There are <b>19</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit `_getReferenceTokenPriceX96` is called 3 times
74:     constructor(
            INonfungiblePositionManager _nonfungiblePositionManager,
            address _referenceToken,
            address _chainlinkReferenceToken
        ) {

/// @audit `_getReferenceTokenPriceX96` is called 3 times
95:     function getValue(uint256 tokenId, address token)
            external
            view
            override
            returns (uint256 value, uint256 feeValue, uint256 price0X96, uint256 price1X96)
        {

/// @audit `decimals` is called 2 times
201:     function setTokenConfig(
             address token,
             AggregatorV3Interface feed,
             uint32 maxFeedAge,
             IUniswapV3Pool pool,
             uint32 twapSeconds,
             Mode mode,
             uint16 maxDifference
         ) external onlyOwner {

/// @audit `_getChainlinkPriceX96` is called 2 times
272:     function _getReferenceTokenPriceX96(address token, uint256 cachedChainlinkReferencePriceX96)
             internal
             view
             returns (uint256 priceX96, uint256 chainlinkReferencePriceX96)
         {

```
*Github:* [[74](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L74), [95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L95), [201](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L201), [272](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L272)]


```solidity
File: src/V3Vault.sol

/// @audit `convertToAssets` is called 2 times
/// @audit `_convertToAssets` is called 2 times
169:     constructor(
             string memory name,
             string memory symbol,
             address _asset,
             INonfungiblePositionManager _nonfungiblePositionManager,
             IInterestRateModel _interestRateModel,
             IV3Oracle _oracle,
             IPermit2 _permit2
         ) ERC20(name, symbol) {

/// @audit `convertToAssets` is called 2 times
/// @audit `_convertToAssets` is called 2 times
195:     function vaultInfo()
             external
             view
             override
             returns (
                 uint256 debt,
                 uint256 lent,
                 uint256 balance,
                 uint256 available,
                 uint256 reserves,
                 uint256 debtExchangeRateX96,
                 uint256 lendExchangeRateX96
             )
         {

/// @audit `convertToShares` is called 2 times
/// @audit `_convertToShares` is called 2 times
550:     function borrow(uint256 tokenId, uint256 assets) external override {

/// @audit `convertToAssets` is called 2 times
/// @audit `_convertToAssets` is called 2 times
954:     function _repay(uint256 tokenId, uint256 amount, bool isShare, bytes memory permitData) internal {

/// @audit `convertToAssets` is called 2 times
/// @audit `_convertToAssets` is called 2 times
1017:     function _getAvailableBalance(uint256 debtExchangeRateX96, uint256 lendExchangeRateX96)
              internal
              view
              returns (uint256 balance, uint256 available, uint256 reserves)
          {

/// @audit `convertToAssets` is called 3 times
/// @audit `_convertToAssets` is called 3 times
1205:     function _updateAndCheckCollateral(
              uint256 tokenId,
              uint256 debtExchangeRateX96,
              uint256 lendExchangeRateX96,
              uint256 oldShares,
              uint256 newShares
          ) internal {

```
*Github:* [[169](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L169), [195](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L195), [550](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L550), [954](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L954), [1017](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1017), [1205](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1205)]


```solidity
File: src/automators/Automator.sol

/// @audit `ownerOf` is called 2 times
230:     function _validateOwner(uint256 tokenId, address vault) internal returns (address owner) {

```
*Github:* [[230](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L230)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit `ownerOf` is called 2 times
200:     function withdrawLeftoverBalances(uint256 tokenId, address to) external nonReentrant {

```
*Github:* [[200](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L200)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `ownerOf` is called 2 times
111:     function execute(ExecuteParams calldata params) external {

```
*Github:* [[111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L111)]


```solidity
File: src/transformers/LeverageTransformer.sol

/// @audit `_routerSwap` is called 2 times
13:     constructor(INonfungiblePositionManager _nonfungiblePositionManager, address _zeroxRouter, address _universalRouter)
            Swapper(_nonfungiblePositionManager, _zeroxRouter, _universalRouter)
        {}

/// @audit `_routerSwap` is called 2 times
40:     function leverageUp(LeverageUpParams calldata params) external {

/// @audit `_routerSwap` is called 2 times
123:     function leverageDown(LeverageDownParams calldata params) external {

```
*Github:* [[13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L13), [40](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L40), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L123)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit `_swapAndIncrease` is called 3 times
/// @audit `swapAndMint` is called 3 times
/// @audit `_swapAndMint` is called 3 times
/// @audit `_routerSwap` is called 2 times
115:     function execute(uint256 tokenId, Instructions memory instructions) public returns (uint256 newTokenId) {

/// @audit `_routerSwap` is called 4 times
779:     function _swapAndPrepareAmounts(SwapAndMintParams memory params, bool unwrap)
             internal
             returns (uint256 total0, uint256 total1)
         {

```
*Github:* [[115](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L115), [779](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L779)]


```solidity
File: src/utils/FlashloanLiquidator.sol

/// @audit `_routerSwap` is called 2 times
67:     function uniswapV3FlashCallback(uint256 fee0, uint256 fee1, bytes calldata callbackData) external {

```
*Github:* [[67](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L67)]


</details>


<a name="GAS-20"></a> 
### [GAS-20] State variables can be packed into fewer storage slots by new order
Each slot saved can avoid an extra Gsset (20000 gas). Reads and writes (if two variables that occupy the same slot are written by the same function) will have a cheaper gas consumption.

*There is one instance of this issue:*
```solidity
File: src/V3Vault.sol

/// @audit 29 slots -> 28 slots by new order:
/*
 *	  mapping tokenConfigs                                   (32 Bytes)
 *	  uint256 debtSharesTotal                                (32 Bytes)
 *	  uint256 lastExchangeRateUpdate                         (32 Bytes)
 *	  uint256 lastDebtExchangeRateX96                        (32 Bytes)
 *	  uint256 lastLendExchangeRateX96                        (32 Bytes)
 *	  uint256 globalDebtLimit                                (32 Bytes)
 *	  uint256 globalLendLimit                                (32 Bytes)
 *	  uint256 minLoanSize                                    (32 Bytes)
 *	  uint256 dailyLendIncreaseLimitMin                      (32 Bytes)
 *	  uint256 dailyLendIncreaseLimitLeft                     (32 Bytes)
 *	  uint256 dailyLendIncreaseLimitLastReset                (32 Bytes)
 *	  uint256 dailyDebtIncreaseLimitMin                      (32 Bytes)
 *	  uint256 dailyDebtIncreaseLimitLeft                     (32 Bytes)
 *	  uint256 dailyDebtIncreaseLimitLastReset                (32 Bytes)
 *	  mapping loans                                          (32 Bytes)
 *	  mapping ownedTokens                                    (32 Bytes)
 *	  mapping ownedTokensIndex                               (32 Bytes)
 *	  mapping tokenOwner                                     (32 Bytes)
 *	  uint256 transformedTokenId                             (32 Bytes)
 *	  mapping transformerAllowList                           (32 Bytes)
 *	  mapping transformApprovals                             (32 Bytes)
 *	  INonfungiblePositionManager nonfungiblePositionManager (20 Bytes)
 *	  IUniswapV3Factory factory                              (20 Bytes)
 *	  IInterestRateModel interestRateModel                   (20 Bytes)
 *	  IV3Oracle oracle                                       (20 Bytes)
 *	  IPermit2 permit2                                       (20 Bytes)
 *	  address asset                                          (20 Bytes)
 *	  uint8 assetDecimals                                      (1 Byte)
 *	  uint32 reserveFactorX32                                 (4 Bytes)
 *	  uint32 reserveProtectionFactorX32                       (4 Bytes)
 *	  address emergencyAdmin                                 (20 Bytes)
 */
30: contract V3Vault is ERC20, Multicall, Ownable, IVault, IERC721Receiver, IErrors {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L30)]



<a name="GAS-21"></a> 
### [GAS-21] Use smaller sizes for struct variables if possible
In Solidity, each storage slot has a size of 32 bytes. If a struct contains multiple uint values, it's efficient to pack these into as few storage slots as possible to optimize gas usage. The EVM (Ethereum Virtual Machine) charges gas for each storage operation, so minimizing the number of slots used can result in substantial gas savings. This can be achieved by ordering struct fields according to their size or by using smaller data types where possible. However, developers must balance these optimizations with the need for code clarity and the precision requirements of their application. Always ensure that data packing does not compromise the functionality or security of the contract.

<details>
<summary>
There are <b>21</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit `tokenId`
/// @audit `feeGrowthInside0LastX128`
/// @audit `feeGrowthInside1LastX128`
376:     struct PositionState {
             uint256 tokenId;
             address token0;
             address token1;
             uint24 fee;
             int24 tickLower;
             int24 tickUpper;
             uint128 liquidity;
             uint256 feeGrowthInside0LastX128;
             uint256 feeGrowthInside1LastX128;
             uint128 tokensOwed0;
             uint128 tokensOwed1;
             IUniswapV3Pool pool;
             uint160 sqrtPriceX96;
             int24 tick;
             uint160 sqrtPriceX96Lower;
             uint160 sqrtPriceX96Upper;

```
*Github:* [[376](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L376)]


```solidity
File: src/V3Vault.sol

/// @audit `debtShares`
150:     struct Loan {
             uint256 debtShares;

/// @audit `newDebtExchangeRateX96`
/// @audit `newLendExchangeRateX96`
/// @audit `debt`
/// @audit `liquidationValue`
/// @audit `liquidatorCost`
/// @audit `reserveCost`
/// @audit `missing`
/// @audit `fullValue`
/// @audit `collateralValue`
/// @audit `feeValue`
666:     struct LiquidateState {
             uint256 newDebtExchangeRateX96;
             uint256 newLendExchangeRateX96;
             uint256 debt;
             bool isHealthy;
             uint256 liquidationValue;
             uint256 liquidatorCost;
             uint256 reserveCost;
             uint256 missing;
             uint256 fullValue;
             uint256 collateralValue;
             uint256 feeValue;

```
*Github:* [[150](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L150), [666](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L666)]


```solidity
File: src/automators/AutoExit.sol

/// @audit `tokenId`
/// @audit `amountRemoveMin0`
/// @audit `amountRemoveMin1`
/// @audit `deadline`
63:     struct ExecuteParams {
            uint256 tokenId; // tokenid to process
            bytes swapData; // if its a swap order - must include swap data
            uint128 liquidity; // liquidity the calculations are based on
            uint256 amountRemoveMin0; // min amount to be removed from liquidity
            uint256 amountRemoveMin1; // min amount to be removed from liquidity
            uint256 deadline; // for uniswap operations - operator promises fair value
            uint64 rewardX64; // which reward will be used for protocol, can be max configured amount (considering onlyFees)

/// @audit `amount0`
/// @audit `amount1`
/// @audit `feeAmount0`
/// @audit `feeAmount1`
/// @audit `amountOutMin`
/// @audit `amountInDelta`
/// @audit `amountOutDelta`
/// @audit `swapAmount`
73:     struct ExecuteState {
            address token0;
            address token1;
            uint24 fee;
            int24 tickLower;
            int24 tickUpper;
            uint128 liquidity;
            uint256 amount0;
            uint256 amount1;
            uint256 feeAmount0;
            uint256 feeAmount1;
            uint256 amountOutMin;
            uint256 amountInDelta;
            uint256 amountOutDelta;
            IUniswapV3Pool pool;
            uint256 swapAmount;
            int24 tick;
            bool isSwap;
            bool isAbove;
            address owner;

```
*Github:* [[63](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L63), [73](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L73)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit `tokenId`
/// @audit `amountIn`
51:     struct ExecuteParams {
            // tokenid to autocompound
            uint256 tokenId;
            // swap direction - calculated off-chain
            bool swap0To1;
            // swap amount - calculated off-chain - if this is set to 0 no swap happens
            uint256 amountIn;

/// @audit `amount0`
/// @audit `amount1`
/// @audit `maxAddAmount0`
/// @audit `maxAddAmount1`
/// @audit `amount0Fees`
/// @audit `amount1Fees`
/// @audit `priceX96`
/// @audit `compounded0`
/// @audit `compounded1`
/// @audit `amountInDelta`
/// @audit `amountOutDelta`
61:     struct ExecuteState {
            uint256 amount0;
            uint256 amount1;
            uint256 maxAddAmount0;
            uint256 maxAddAmount1;
            uint256 amount0Fees;
            uint256 amount1Fees;
            uint256 priceX96;
            address token0;
            address token1;
            uint24 fee;
            int24 tickLower;
            int24 tickUpper;
            uint256 compounded0;
            uint256 compounded1;
            int24 tick;
            uint160 sqrtPriceX96;
            uint256 amountInDelta;
            uint256 amountOutDelta;

```
*Github:* [[51](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L51), [61](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L61)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `tokenId`
/// @audit `amountIn`
/// @audit `amountRemoveMin0`
/// @audit `amountRemoveMin1`
/// @audit `deadline`
53:     struct ExecuteParams {
            uint256 tokenId;
            bool swap0To1;
            uint256 amountIn; // if this is set to 0 no swap happens
            bytes swapData;
            uint128 liquidity; // liquidity the calculations are based on
            uint256 amountRemoveMin0; // min amount to be removed from liquidity
            uint256 amountRemoveMin1; // min amount to be removed from liquidity
            uint256 deadline; // for uniswap operations - operator promises fair value
            uint64 rewardX64; // which reward will be used for protocol, can be max configured amount (considering onlyFees)

/// @audit `amount0`
/// @audit `amount1`
/// @audit `feeAmount0`
/// @audit `feeAmount1`
/// @audit `maxAddAmount0`
/// @audit `maxAddAmount1`
/// @audit `amountAdded0`
/// @audit `amountAdded1`
/// @audit `protocolReward0`
/// @audit `protocolReward1`
/// @audit `amountOutMin`
/// @audit `amountInDelta`
/// @audit `amountOutDelta`
/// @audit `newTokenId`
65:     struct ExecuteState {
            address owner;
            address realOwner;
            IUniswapV3Pool pool;
            address token0;
            address token1;
            uint24 fee;
            int24 tickLower;
            int24 tickUpper;
            int24 currentTick;
            uint256 amount0;
            uint256 amount1;
            uint256 feeAmount0;
            uint256 feeAmount1;
            uint256 maxAddAmount0;
            uint256 maxAddAmount1;
            uint256 amountAdded0;
            uint256 amountAdded1;
            uint128 liquidity;
            uint256 protocolReward0;
            uint256 protocolReward1;
            uint256 amountOutMin;
            uint256 amountInDelta;
            uint256 amountOutDelta;
            uint256 newTokenId;

```
*Github:* [[53](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L53), [65](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L65)]


```solidity
File: src/transformers/LeverageTransformer.sol

/// @audit `tokenId`
/// @audit `borrowAmount`
/// @audit `amountIn0`
/// @audit `amountOut0Min`
/// @audit `amountIn1`
/// @audit `amountOut1Min`
/// @audit `amountAddMin0`
/// @audit `amountAddMin1`
/// @audit `deadline`
17:     struct LeverageUpParams {
            // which token to leverage
            uint256 tokenId;
            // how much to borrow
            uint256 borrowAmount;
            // how much of borrowed lend token should be swapped to token0
            uint256 amountIn0;
            uint256 amountOut0Min;
            bytes swapData0; // encoded data from 0x api call (address,bytes) - allowanceTarget,data
            // how much of borrowed lend token should be swapped to token1
            uint256 amountIn1;
            uint256 amountOut1Min;
            bytes swapData1; // encoded data from 0x api call (address,bytes) - allowanceTarget,data
            // for adding liquidity slippage
            uint256 amountAddMin0;
            uint256 amountAddMin1;
            // recipient for leftover tokens
            address recipient;
            // for all uniswap deadlineable functions
            uint256 deadline;

/// @audit `tokenId`
/// @audit `amountRemoveMin0`
/// @audit `amountRemoveMin1`
/// @audit `amountIn0`
/// @audit `amountOut0Min`
/// @audit `amountIn1`
/// @audit `amountOut1Min`
/// @audit `deadline`
98:     struct LeverageDownParams {
            // which token to leverage
            uint256 tokenId;
            // for removing - remove liquidity amount
            uint128 liquidity;
            uint256 amountRemoveMin0;
            uint256 amountRemoveMin1;
            // collect fee amount (if type(uint128).max - ALL)
            uint128 feeAmount0;
            uint128 feeAmount1;
            // how much of token0 should be swapped to lend token
            uint256 amountIn0;
            uint256 amountOut0Min;
            bytes swapData0; // encoded data from 0x api call (address,bytes) - allowanceTarget,data
            // how much of token1 should be swapped to lend token
            uint256 amountIn1;
            uint256 amountOut1Min;
            bytes swapData1; // encoded data from 0x api call (address,bytes) - allowanceTarget,data
            // recipient for leftover tokens
            address recipient;
            // for all uniswap deadlineable functions
            uint256 deadline;

```
*Github:* [[17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L17), [98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L98)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit `amountRemoveMin0`
/// @audit `amountRemoveMin1`
/// @audit `amountIn0`
/// @audit `amountOut0Min`
/// @audit `amountIn1`
/// @audit `amountOut1Min`
/// @audit `amountAddMin0`
/// @audit `amountAddMin1`
/// @audit `deadline`
48:     struct Instructions {
            // what action to perform on provided Uniswap v3 position
            WhatToDo whatToDo;
            // target token for swaps (if this is address(0) no swaps are executed)
            address targetToken;
            // for removing liquidity slippage
            uint256 amountRemoveMin0;
            uint256 amountRemoveMin1;
            // amountIn0 is used for swap and also as minAmount0 for decreased liquidity + collected fees
            uint256 amountIn0;
            // if token0 needs to be swapped to targetToken - set values
            uint256 amountOut0Min;
            bytes swapData0; // encoded data from 0x api call (address,bytes) - allowanceTarget,data
            // amountIn1 is used for swap and also as minAmount1 for decreased liquidity + collected fees
            uint256 amountIn1;
            // if token1 needs to be swapped to targetToken - set values
            uint256 amountOut1Min;
            bytes swapData1; // encoded data from 0x api call (address,bytes) - allowanceTarget,data
            // collect fee amount for COMPOUND_FEES / CHANGE_RANGE / WITHDRAW_AND_COLLECT_AND_SWAP (if uint256(128).max - ALL)
            uint128 feeAmount0;
            uint128 feeAmount1;
            // for creating new positions with CHANGE_RANGE
            uint24 fee;
            int24 tickLower;
            int24 tickUpper;
            // remove liquidity amount for COMPOUND_FEES (in this case should be probably 0) / CHANGE_RANGE / WITHDRAW_AND_COLLECT_AND_SWAP
            uint128 liquidity;
            // for adding liquidity slippage
            uint256 amountAddMin0;
            uint256 amountAddMin1;
            // for all uniswap deadlineable functions
            uint256 deadline;
            // left over tokens will be sent to this address
            address recipient;
            // recipient of newly minted nft (the incoming NFT will ALWAYS be returned to from)
            address recipientNFT;
            // if tokenIn or tokenOut is WETH - unwrap
            bool unwrap;
            // data sent with returned token to IERC721Receiver (optional)
            bytes returnData;
            // data sent with minted token to IERC721Receiver (optional)
            bytes swapAndMintReturnData;

/// @audit `amountIn`
/// @audit `minAmountOut`
382:     struct SwapParams {
             IERC20 tokenIn;
             IERC20 tokenOut;
             uint256 amountIn;
             uint256 minAmountOut;
             address recipient; // recipient of tokenOut and leftover tokenIn (if any leftover)
             bytes swapData;
             bool unwrap; // if tokenIn or tokenOut is WETH - unwrap
             bytes permitData; // if permit2 signatures are used - set this

/// @audit `amount0`
/// @audit `amount1`
/// @audit `deadline`
/// @audit `amountIn0`
/// @audit `amountOut0Min`
/// @audit `amountIn1`
/// @audit `amountOut1Min`
/// @audit `amountAddMin0`
/// @audit `amountAddMin1`
432:     struct SwapAndMintParams {
             IERC20 token0;
             IERC20 token1;
             uint24 fee;
             int24 tickLower;
             int24 tickUpper;
             // how much is provided of token0 and token1
             uint256 amount0;
             uint256 amount1;
             address recipient; // recipient of leftover tokens
             address recipientNFT; // recipient of nft
             uint256 deadline;
             // source token for swaps (maybe either address(0), token0, token1 or another token)
             // if swapSourceToken is another token than token0 or token1 -> amountIn0 + amountIn1 of swapSourceToken are expected to be available
             IERC20 swapSourceToken;
             // if swapSourceToken needs to be swapped to token0 - set values
             uint256 amountIn0;
             uint256 amountOut0Min;
             bytes swapData0;
             // if swapSourceToken needs to be swapped to token1 - set values
             uint256 amountIn1;
             uint256 amountOut1Min;
             bytes swapData1;
             // min amount to be added after swap
             uint256 amountAddMin0;
             uint256 amountAddMin1;
             // data to be sent along newly created NFT when transfered to recipientNFT (sent to IERC721Receiver callback)
             bytes returnData;
             // if permit2 signatures are used - set this
             bytes permitData;

/// @audit `tokenId`
/// @audit `amount0`
/// @audit `amount1`
/// @audit `deadline`
/// @audit `amountIn0`
/// @audit `amountOut0Min`
/// @audit `amountIn1`
/// @audit `amountOut1Min`
/// @audit `amountAddMin0`
/// @audit `amountAddMin1`
504:     struct SwapAndIncreaseLiquidityParams {
             uint256 tokenId;
             // how much is provided of token0 and token1
             uint256 amount0;
             uint256 amount1;
             address recipient; // recipient of leftover tokens
             uint256 deadline;
             // source token for swaps (maybe either address(0), token0, token1 or another token)
             // if swapSourceToken is another token than token0 or token1 -> amountIn0 + amountIn1 of swapSourceToken are expected to be available
             IERC20 swapSourceToken;
             // if swapSourceToken needs to be swapped to token0 - set values
             uint256 amountIn0;
             uint256 amountOut0Min;
             bytes swapData0;
             // if swapSourceToken needs to be swapped to token1 - set values
             uint256 amountIn1;
             uint256 amountOut1Min;
             bytes swapData1;
             // min amount to be added after swap
             uint256 amountAddMin0;
             uint256 amountAddMin1;
             // if permit2 signatures are used - set this
             bytes permitData;

/// @audit `needed0`
/// @audit `needed1`
/// @audit `neededOther`
/// @audit `i`
/// @audit `balanceBefore0`
/// @audit `balanceBefore1`
/// @audit `balanceBeforeOther`
588:     struct PrepareAddPermit2State {
             uint256 needed0;
             uint256 needed1;
             uint256 neededOther;
             uint256 i;
             uint256 balanceBefore0;
             uint256 balanceBefore1;
             uint256 balanceBeforeOther;

```
*Github:* [[48](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L48), [382](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L382), [432](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L432), [504](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L504), [588](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L588)]


```solidity
File: src/utils/FlashloanLiquidator.sol

/// @audit `tokenId`
/// @audit `debtShares`
/// @audit `liquidationCost`
/// @audit `minReward`
12:     struct FlashCallbackData {
            uint256 tokenId;
            uint256 debtShares;
            uint256 liquidationCost;
            IVault vault;
            IERC20 asset;
            RouterSwapParams swap0;
            RouterSwapParams swap1;
            address liquidator;
            uint256 minReward;

/// @audit `tokenId`
/// @audit `debtShares`
/// @audit `amount0In`
/// @audit `amount1In`
/// @audit `minReward`
28:     struct LiquidateParams {
            uint256 tokenId; // loan to liquidate
            uint256 debtShares; // debt shares calculation is based on
            IVault vault; // vault where the loan is
            IUniswapV3Pool flashLoanPool; // pool which is used for flashloan - may not be used in the swaps below
            uint256 amount0In; // how much of token0 to swap to asset (0 if no swap should be done)
            bytes swapData0; // swap data for token0 swap
            uint256 amount1In; // how much of token1 to swap to asset (0 if no swap should be done)
            bytes swapData1; // swap data for token1 swap
            uint256 minReward; // min reward amount (works as a global slippage control for complete operation)

```
*Github:* [[12](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L12), [28](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L28)]


```solidity
File: src/utils/Swapper.sol

/// @audit `deadline`
56:     struct UniversalRouterData {
            bytes commands;
            bytes[] inputs;
            uint256 deadline;

/// @audit `amountIn`
/// @audit `amountOutMin`
62:     struct RouterSwapParams {
            IERC20 tokenIn;
            IERC20 tokenOut;
            uint256 amountIn;
            uint256 amountOutMin;
            bytes swapData;

/// @audit `amountIn`
/// @audit `amountOutMin`
120:     struct PoolSwapParams {
             IUniswapV3Pool pool;
             IERC20 token0;
             IERC20 token1;
             uint24 fee;
             bool swap0For1;
             uint256 amountIn;
             uint256 amountOutMin;

```
*Github:* [[56](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L56), [62](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L62), [120](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L120)]


</details>


<a name="GAS-22"></a> 
### [GAS-22] Unlimited gas consumption risk due to external call recipients
When calling an external function without specifying a gas limit , the called contract may consume all the remaining gas, causing the tx to be reverted. To mitigate this, it is recommended to explicitly set a gas limit when making low level external calls.

*There are <b>6</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

522:         (bool success,) = transformer.call(data);

```
*Github:* [[522](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L522)]


```solidity
File: src/automators/Automator.sol

130:             (bool sent,) = to.call{value: balance}("");

221:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[130](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L130), [221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L221)]


```solidity
File: src/transformers/V3Utils.sol

867:             (bool sent,) = to.call{value: amount}("");

```
*Github:* [[867](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L867)]


```solidity
File: src/utils/Swapper.sol

89:                 (bool success,) = zeroxRouter.call(data.data);

89:                 (bool success,) = zeroxRouter.call(data.data);

```
*Github:* [[89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L89), [89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L89)]



<a name="GAS-23"></a> 
### [GAS-23] Unused named return variables without optimizer waste gas
Consider changing the variable to be an unnamed one, since the variable is never assigned, nor is it returned by name. If the optimizer is not turned on, leaving the code as it is will also waste gas for the stack variable.

*There are <b>5</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

/// @audit `owner` not used
258:     function ownerOf(uint256 tokenId) external view override returns (address owner) {

/// @audit `shares` not used
289:     function convertToShares(uint256 assets) external view override returns (uint256 shares) {

/// @audit `assets` not used
295:     function convertToAssets(uint256 shares) external view override returns (uint256 assets) {

/// @audit `newTokenId` not used
497:     function transform(uint256 tokenId, address transformer, bytes calldata data)
             external
             override
             returns (uint256 newTokenId)
         {

```
*Github:* [[258](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L258), [289](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L289), [295](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L295), [497](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L497)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit `newTokenId` not used
98:     function executeWithPermit(uint256 tokenId, Instructions memory instructions, uint8 v, bytes32 r, bytes32 s)
            public
            returns (uint256 newTokenId)
        {

```
*Github:* [[98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L98)]



<a name="GAS-24"></a> 
### [GAS-24] Optimize external calls with assembly for memory efficiency
Using interfaces to make external contract calls in Solidity is convenient but can be inefficient in terms of memory utilization. Each such call involves creating a new memory location to store the data being passed, thus incurring memory expansion costs.

Inline assembly allows for optimized memory usage by re-using already allocated memory spaces or using the scratch space for smaller datasets. This can result in notable gas savings, especially for contracts that make frequent external calls.

Additionally, using inline assembly enables important safety checks like verifying if the target address has code deployed to it using `extcodesize(addr)` before making the call, mitigating risks associated with contract interactions.

<details>
<summary>
There are <b>67</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit `.feeGrowthGlobal0X128(...)`
455:             position.pool.feeGrowthGlobal0X128(),

/// @audit `.feeGrowthGlobal1X128(...)`
456:             position.pool.feeGrowthGlobal1X128()

```
*Github:* [[455](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L455), [456](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L456)]


```solidity
File: src/V3Vault.sol

/// @audit `.safeTransferFrom(...)`
401:         nonfungiblePositionManager.safeTransferFrom(msg.sender, address(this), tokenId, abi.encode(recipient));

/// @audit `.permit(...)`
423:         nonfungiblePositionManager.permit(address(this), tokenId, deadline, v, r, s);

/// @audit `.safeTransferFrom(...)`
424:         nonfungiblePositionManager.safeTransferFrom(owner, address(this), tokenId, abi.encode(recipient));

/// @audit `.approve(...)`
520:         nonfungiblePositionManager.approve(transformer, tokenId);

/// @audit `.approve(...)`
537:         nonfungiblePositionManager.approve(address(0), tokenId);

/// @audit `.safeTransfer(...)`
599:         SafeERC20.safeTransfer(IERC20(asset), isTransformMode ? msg.sender : owner, assets);

/// @audit `.permitTransferFrom(...)`
720:             permit2.permitTransferFrom(

/// @audit `.safeTransferFrom(...)`
728:             SafeERC20.safeTransferFrom(IERC20(asset), msg.sender, address(this), state.liquidatorCost);

/// @audit `.safeTransfer(...)`
779:             SafeERC20.safeTransfer(IERC20(asset), receiver, amount);

/// @audit `.permitTransferFrom(...)`
896:             permit2.permitTransferFrom(

/// @audit `.safeTransferFrom(...)`
901:             SafeERC20.safeTransferFrom(IERC20(asset), msg.sender, address(this), assets);

/// @audit `.safeTransfer(...)`
946:         SafeERC20.safeTransfer(IERC20(asset), receiver, assets);

/// @audit `.permitTransferFrom(...)`
981:                 permit2.permitTransferFrom(

/// @audit `.safeTransferFrom(...)`
986:                 SafeERC20.safeTransferFrom(IERC20(asset), msg.sender, address(this), assets);

/// @audit `.decreaseLiquidity(...)`
1065:             nonfungiblePositionManager.decreaseLiquidity(

/// @audit `.safeTransferFrom(...)`
1083:         nonfungiblePositionManager.safeTransferFrom(address(this), owner, tokenId);

```
*Github:* [[401](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L401), [423](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L423), [424](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L424), [520](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L520), [537](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L537), [599](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L599), [720](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L720), [728](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L728), [779](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L779), [896](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L896), [901](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L901), [946](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L946), [981](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L981), [986](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L986), [1065](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1065), [1083](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1083)]


```solidity
File: src/automators/AutoExit.sol

/// @audit `.positions(...)`
121:             nonfungiblePositionManager.positions(params.tokenId);

```
*Github:* [[121](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L121)]


```solidity
File: src/automators/Automator.sol

/// @audit `.withdraw(...)`
220:             weth.withdraw(amount);

/// @audit `.safeTransfer(...)`
226:             SafeERC20.safeTransfer(token, to, amount);

```
*Github:* [[220](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L220), [226](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L226)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit `.transform(...)`
91:         IVault(vault).transform(

/// @audit `.positions(...)`
116:             nonfungiblePositionManager.positions(params.tokenId);

/// @audit `.safeTransfer(...)`
272:         SafeERC20.safeTransfer(IERC20(token), to, amount);

/// @audit `.safeApprove(...)`
280:             SafeERC20.safeApprove(IERC20(token0), address(nonfungiblePositionManager), type(uint256).max);

/// @audit `.safeApprove(...)`
284:             SafeERC20.safeApprove(IERC20(token1), address(nonfungiblePositionManager), type(uint256).max);

```
*Github:* [[91](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L91), [116](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L116), [272](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L272), [280](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L280), [284](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L284)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `.transform(...)`
101:         IVault(vault).transform(

/// @audit `.positions(...)`
131:             nonfungiblePositionManager.positions(params.tokenId);

/// @audit `.safeApprove(...)`
213:             SafeERC20.safeApprove(IERC20(state.token0), address(nonfungiblePositionManager), state.maxAddAmount0);

/// @audit `.safeApprove(...)`
214:             SafeERC20.safeApprove(IERC20(state.token1), address(nonfungiblePositionManager), state.maxAddAmount1);

/// @audit `.safeApprove(...)`
220:             SafeERC20.safeApprove(IERC20(state.token0), address(nonfungiblePositionManager), 0);

/// @audit `.safeApprove(...)`
221:             SafeERC20.safeApprove(IERC20(state.token1), address(nonfungiblePositionManager), 0);

/// @audit `.safeTransferFrom(...)`
232:             nonfungiblePositionManager.safeTransferFrom(address(this), state.owner, state.newTokenId);

```
*Github:* [[101](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L101), [131](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L131), [213](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L213), [214](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L214), [220](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L220), [221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L221), [232](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L232)]


```solidity
File: src/transformers/LeverageTransformer.sol

/// @audit `.borrow(...)`
45:         IVault(msg.sender).borrow(params.tokenId, amount);

/// @audit `.safeIncreaseAllowance(...)`
77:         SafeERC20.safeIncreaseAllowance(IERC20(token0), address(nonfungiblePositionManager), amount0);

/// @audit `.safeIncreaseAllowance(...)`
78:         SafeERC20.safeIncreaseAllowance(IERC20(token1), address(nonfungiblePositionManager), amount1);

/// @audit `.safeTransfer(...)`
88:             SafeERC20.safeTransfer(IERC20(token0), params.recipient, amount0 - added0);

/// @audit `.safeTransfer(...)`
91:             SafeERC20.safeTransfer(IERC20(token1), params.recipient, amount1 - added1);

/// @audit `.safeTransfer(...)`
94:             SafeERC20.safeTransfer(IERC20(token), params.recipient, amount);

/// @audit `.safeApprove(...)`
165:         SafeERC20.safeApprove(IERC20(token), msg.sender, amount);

/// @audit `.repay(...)`
166:         IVault(msg.sender).repay(params.tokenId, amount, false);

/// @audit `.safeTransfer(...)`
170:             SafeERC20.safeTransfer(IERC20(token0), params.recipient, amount0);

/// @audit `.safeTransfer(...)`
173:             SafeERC20.safeTransfer(IERC20(token1), params.recipient, amount1);

```
*Github:* [[45](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L45), [77](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L77), [78](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L78), [88](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L88), [91](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L91), [94](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L94), [165](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L165), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L166), [170](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L170), [173](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L173)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit `.permit(...)`
106:         nonfungiblePositionManager.permit(address(this), tokenId, instructions.deadline, v, r, s);

/// @audit `.safeTransferFrom(...)`
578:             SafeERC20.safeTransferFrom(token0, msg.sender, address(this), needed0);

/// @audit `.safeTransferFrom(...)`
581:             SafeERC20.safeTransferFrom(token1, msg.sender, address(this), needed1);

/// @audit `.safeTransferFrom(...)`
584:             SafeERC20.safeTransferFrom(otherToken, msg.sender, address(this), neededOther);

/// @audit `.permitTransferFrom(...)`
631:         permit2.permitTransferFrom(permit, transferDetails, msg.sender, signature);

/// @audit `.safeApprove(...)`
831:             SafeERC20.safeApprove(params.token0, address(nonfungiblePositionManager), 0);

/// @audit `.safeApprove(...)`
832:             SafeERC20.safeApprove(params.token0, address(nonfungiblePositionManager), total0);

/// @audit `.safeApprove(...)`
835:             SafeERC20.safeApprove(params.token1, address(nonfungiblePositionManager), 0);

/// @audit `.safeApprove(...)`
836:             SafeERC20.safeApprove(params.token1, address(nonfungiblePositionManager), total1);

/// @audit `.withdraw(...)`
866:             weth.withdraw(amount);

/// @audit `.safeTransfer(...)`
872:             SafeERC20.safeTransfer(token, to, amount);

```
*Github:* [[106](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L106), [578](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L578), [581](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L581), [584](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L584), [631](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L631), [831](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L831), [832](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L832), [835](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L835), [836](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L836), [866](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L866), [872](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L872)]


```solidity
File: src/utils/FlashloanLiquidator.sol

/// @audit `.flash(...)`
64:         params.flashLoanPool.flash(address(this), isAsset0 ? liquidationCost : 0, !isAsset0 ? liquidationCost : 0, data);

/// @audit `.safeApprove(...)`
72:         SafeERC20.safeApprove(data.asset, address(data.vault), data.liquidationCost);

/// @audit `.liquidate(...)`
73:         data.vault.liquidate(

/// @audit `.safeApprove(...)`
78:         SafeERC20.safeApprove(data.asset, address(data.vault), 0);

/// @audit `.safeTransfer(...)`
85:         SafeERC20.safeTransfer(data.asset, msg.sender, data.liquidationCost + (fee0 + fee1));

/// @audit `.safeTransfer(...)`
91:                 SafeERC20.safeTransfer(data.swap0.tokenIn, data.liquidator, balance);

/// @audit `.safeTransfer(...)`
97:                 SafeERC20.safeTransfer(data.swap1.tokenIn, data.liquidator, balance);

/// @audit `.safeTransfer(...)`
106:                 SafeERC20.safeTransfer(data.asset, data.liquidator, balance);

```
*Github:* [[64](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L64), [72](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L72), [73](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L73), [78](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L78), [85](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L85), [91](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L91), [97](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L97), [106](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L106)]


```solidity
File: src/utils/Swapper.sol

/// @audit `.safeApprove(...)`
87:                 SafeERC20.safeApprove(params.tokenIn, data.allowanceTarget, params.amountIn);

/// @audit `.safeApprove(...)`
94:                 SafeERC20.safeApprove(params.tokenIn, data.allowanceTarget, 0);

/// @audit `.safeTransfer(...)`
98:                 SafeERC20.safeTransfer(params.tokenIn, universalRouter, params.amountIn);

/// @audit `.execute(...)`
99:                 IUniversalRouter(universalRouter).execute(data.commands, data.inputs, data.deadline);

/// @audit `.safeTransfer(...)`
167:         SafeERC20.safeTransfer(IERC20(tokenIn), msg.sender, amountToPay);

```
*Github:* [[87](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L87), [94](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L94), [98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L98), [99](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L99), [167](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L167)]


</details>


<a name="GAS-25"></a> 
### [GAS-25] Use assembly in place of `abi.decode` to extract `calldata` values more efficiently
Instead of using `abi.decode`, we can use assembly to decode our desired calldata values directly. This will allow us to avoid decoding calldata values that we will not use. For more details on how to implement this, check the following [report](https://code4rena.com/reports/2023-05-juicebox#g-04-use-assembly-in-place-of-abidecode-to-extract-calldata-values-more-efficiently).

*There are <b>5</b> instances of this issue:*
```solidity
File: src/transformers/V3Utils.sol

371:         Instructions memory instructions = abi.decode(data, (Instructions));

```
*Github:* [[371](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L371)]


```solidity
File: src/utils/FlashloanLiquidator.sol

70:         FlashCallbackData memory data = abi.decode(callbackData, (FlashCallbackData));

```
*Github:* [[70](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L70)]


```solidity
File: src/utils/Swapper.sol

82:             (address router, bytes memory routerData) = abi.decode(params.swapData, (address, bytes));

85:                 ZeroxRouterData memory data = abi.decode(routerData, (ZeroxRouterData));

96:                 UniversalRouterData memory data = abi.decode(routerData, (UniversalRouterData));

```
*Github:* [[82](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L82), [85](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L85), [96](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L96)]



<a name="GAS-26"></a> 
### [GAS-26] Use assembly to emit events
To efficiently emit events, it's possible to utilize assembly by making use of scratch space and the free memory pointer. This approach has the advantage of potentially avoiding the costs associated with memory expansion.

However, it's important to note that in order to safely optimize this process, it is preferable to cache and restore the free memory pointer.

A good example of such practice can be seen in [Solady's](https://github.com/Vectorized/solady/blob/main/src/tokens/ERC1155.sol#L167) codebase.

<details>
<summary>
There are <b>49</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

100:         emit SetValues(baseRatePerYearX96, multiplierPerYearX96, jumpMultiplierPerYearX96, _kinkX96);

```
*Github:* [[100](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L100)]


```solidity
File: src/V3Oracle.sol

190:         emit SetMaxPoolPriceDifference(_maxPoolPriceDifference);

242:         emit TokenConfigUpdated(token, config);

243:         emit OracleModeUpdated(token, mode);

260:         emit OracleModeUpdated(token, mode);

267:         emit SetEmergencyAdmin(admin);

```
*Github:* [[190](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L190), [242](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L242), [243](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L243), [260](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L260), [267](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L267)]


```solidity
File: src/V3Vault.sol

449:             emit Add(tokenId, owner, 0);

464:                 emit Add(tokenId, owner, oldTokenId);

489:         emit ApprovedTransform(tokenId, msg.sender, target, isActive);

601:         emit Borrow(tokenId, owner, assets, shares);

645:         emit WithdrawCollateral(params.tokenId, owner, params.recipient, params.liquidity, amount0, amount1);

746:         emit Liquidate(

782:         emit WithdrawReserves(amount, receiver);

798:         emit SetTransformer(transformer, active);

830:         emit SetLimits(

839:         emit SetReserveFactor(_reserveFactorX32);

849:         emit SetReserveProtectionFactor(_reserveProtectionFactorX32);

865:         emit SetTokenConfig(token, collateralFactorX32, collateralValueLimitFactorX32);

872:         emit SetEmergencyAdmin(admin);

916:         emit Deposit(msg.sender, receiver, assets, shares);

951:         emit Withdraw(msg.sender, receiver, owner, assets, shares);

1013:         emit Repay(tokenId, msg.sender, owner, assets, shares);

1084:         emit Remove(tokenId, owner);

1139:             emit ExchangeRateUpdate(newDebtExchangeRateX96, newLendExchangeRateX96);

1160:             emit ExchangeRateUpdate(newDebtExchangeRateX96, newLendExchangeRateX96);

```
*Github:* [[449](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L449), [464](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L464), [489](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L489), [601](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L601), [645](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L645), [746](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L746), [782](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L782), [798](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L798), [830](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L830), [839](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L839), [849](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L849), [865](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L865), [872](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L872), [916](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L916), [951](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L951), [1013](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1013), [1084](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1084), [1139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1139), [1160](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1160)]


```solidity
File: src/automators/AutoExit.sol

208:         emit PositionConfigured(params.tokenId, false, false, false, 0, 0, 0, 0, false, 0);

211:         emit Executed(

232:         emit PositionConfigured(

```
*Github:* [[208](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L208), [211](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L211), [232](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L232)]


```solidity
File: src/automators/Automator.sol

60:         emit WithdrawerChanged(_withdrawer);

70:         emit OperatorChanged(_operator, _active);

80:         emit VaultChanged(_vault, _active);

94:         emit TWAPConfigChanged(_TWAPSeconds, _maxTWAPTickDifference);

```
*Github:* [[60](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L60), [70](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L70), [80](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L80), [94](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L94)]


```solidity
File: src/transformers/AutoCompound.sol

183:         emit AutoCompounded(

246:         emit RewardUpdated(msg.sender, _totalRewardX64);

251:         emit BalanceAdded(tokenId, token, amount);

259:                 emit BalanceAdded(tokenId, token, amount - currentBalance);

261:                 emit BalanceRemoved(tokenId, token, currentBalance - amount);

271:         emit BalanceRemoved(tokenId, token, amount);

273:         emit BalanceWithdrawn(tokenId, token, to, amount);

```
*Github:* [[183](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L183), [246](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L246), [251](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L251), [259](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L259), [261](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L261), [271](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L271), [273](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L273)]


```solidity
File: src/transformers/AutoRange.sol

252:             emit PositionConfigured(

266:             emit PositionConfigured(params.tokenId, 0, 0, 0, 0, 0, 0, false, 0);

268:             emit RangeChanged(params.tokenId, state.newTokenId);

286:         emit PositionConfigured(

```
*Github:* [[252](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L252), [266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L266), [268](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L268), [286](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L286)]


```solidity
File: src/transformers/V3Utils.sol

218:             emit CompoundFees(tokenId, liquidity, amount0, amount1);

303:             emit ChangeRange(tokenId, newTokenId);

348:             emit WithdrawAndCollectAndSwap(tokenId, instructions.targetToken, targetAmount);

729:         emit SwapAndMint(tokenId, liquidity, added0, added1);

773:         emit SwapAndIncreaseLiquidity(params.tokenId, liquidity, added0, added1);

```
*Github:* [[218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L218), [303](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L303), [348](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L348), [729](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L729), [773](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L773)]


```solidity
File: src/utils/Swapper.sol

116:             emit Swap(address(params.tokenIn), address(params.tokenOut), amountInDelta, amountOutDelta);

```
*Github:* [[116](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L116)]


</details>


<a name="GAS-27"></a> 
### [GAS-27] Use assembly to validate `msg.sender`

<details>
<summary>
There are <b>20</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

250:         if (msg.sender != emergencyAdmin && msg.sender != owner()) {

```
*Github:* [[250](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L250)]


```solidity
File: src/V3Vault.sol

419:         if (msg.sender != owner) {

435:         if (msg.sender != address(nonfungiblePositionManager) || from == address(this)) {

484:         if (tokenOwner[tokenId] != msg.sender) {

515:         if (loanOwner != msg.sender && !transformApprovals[loanOwner][tokenId][msg.sender]) {

561:         if (!isTransformMode && tokenOwner[tokenId] != msg.sender && address(this) != msg.sender) {

621:         if (owner != msg.sender) {

814:         if (msg.sender != emergencyAdmin && msg.sender != owner()) {

935:         if (msg.sender != owner) {

```
*Github:* [[419](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L419), [435](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L435), [484](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L484), [515](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L515), [561](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L561), [621](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L621), [814](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L814), [935](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L935)]


```solidity
File: src/automators/AutoExit.sol

220:         if (owner != msg.sender) {

```
*Github:* [[220](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L220)]


```solidity
File: src/automators/Automator.sol

105:         if (msg.sender != withdrawer) {

124:         if (msg.sender != withdrawer) {

245:         if (owner != msg.sender) {

252:         if (msg.sender != address(weth)) {

```
*Github:* [[105](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L105), [124](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L124), [245](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L245), [252](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L252)]


```solidity
File: src/transformers/AutoCompound.sol

205:         if (owner != msg.sender) {

228:         if (msg.sender != withdrawer) {

```
*Github:* [[205](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L205), [228](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L228)]


```solidity
File: src/transformers/V3Utils.sol

102:         if (nonfungiblePositionManager.ownerOf(tokenId) != msg.sender) {

362:         if (msg.sender != address(nonfungiblePositionManager)) {

915:         if (msg.sender != address(weth)) {

```
*Github:* [[102](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L102), [362](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L362), [915](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L915)]


```solidity
File: src/utils/Swapper.sol

161:         if (address(_getPool(tokenIn, tokenOut, fee)) != msg.sender) {

```
*Github:* [[161](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L161)]


</details>


<a name="GAS-28"></a> 
### [GAS-28] Use assembly to write address/contract type storage values
Using `assembly { sstore(state.slot, addr)` instead of `state = addr` can save gas.

<details>
<summary>
There are <b>19</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

79:         nonfungiblePositionManager = _nonfungiblePositionManager;

80:         factory = _nonfungiblePositionManager.factory();

81:         referenceToken = _referenceToken;

83:         chainlinkReferenceToken = _chainlinkReferenceToken;

266:         emergencyAdmin = admin;

```
*Github:* [[79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L79), [80](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L80), [81](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L81), [83](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L83), [266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L266)]


```solidity
File: src/V3Vault.sol

178:         asset = _asset;

180:         nonfungiblePositionManager = _nonfungiblePositionManager;

181:         factory = IUniswapV3Factory(_nonfungiblePositionManager.factory());

182:         interestRateModel = _interestRateModel;

183:         oracle = _oracle;

184:         permit2 = _permit2;

871:         emergencyAdmin = admin;

```
*Github:* [[178](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L178), [180](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L180), [181](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L181), [182](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L182), [183](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L183), [184](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L184), [871](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L871)]


```solidity
File: src/automators/Automator.sol

61:         withdrawer = _withdrawer;

```
*Github:* [[61](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L61)]


```solidity
File: src/transformers/V3Utils.sol

37:         permit2 = IPermit2(_permit2);

```
*Github:* [[37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L37)]


```solidity
File: src/utils/Swapper.sol

42:         weth = IWETH9(_nonfungiblePositionManager.WETH9());

43:         factory = _nonfungiblePositionManager.factory();

44:         nonfungiblePositionManager = _nonfungiblePositionManager;

45:         zeroxRouter = _zeroxRouter;

46:         universalRouter = _universalRouter;

```
*Github:* [[42](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L42), [43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L43), [44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L44), [45](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L45), [46](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L46)]


</details>


<a name="GAS-29"></a> 
### [GAS-29] Using a double `if` statement instead of a logical AND (`&&`)
Using a double `if` statement instead of a logical AND (`&&`) can provide similar short-circuiting behavior whereas double if is slightly [more gas efficient](https://gist.github.com/DadeKuma/931ce6794a050201ec6544dbcc31316c).

<details>
<summary>
There are <b>38</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

227:             if (!(token0 == token && token1 == referenceToken || token0 == referenceToken && token1 == token)) {

227:             if (!(token0 == token && token1 == referenceToken || token0 == referenceToken && token1 == token)) {

250:         if (msg.sender != emergencyAdmin && msg.sender != owner()) {

```
*Github:* [[227](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L227), [227](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L227), [250](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L250)]


```solidity
File: src/V3Vault.sol

515:         if (loanOwner != msg.sender && !transformApprovals[loanOwner][tokenId][msg.sender]) {

552:             transformedTokenId > 0 && transformedTokenId == tokenId && transformerAllowList[msg.sender];

552:             transformedTokenId > 0 && transformedTokenId == tokenId && transformerAllowList[msg.sender];

561:         if (!isTransformMode && tokenOwner[tokenId] != msg.sender && address(this) != msg.sender) {

561:         if (!isTransformMode && tokenOwner[tokenId] != msg.sender && address(this) != msg.sender) {

814:         if (msg.sender != emergencyAdmin && msg.sender != owner()) {

1229:                         && _convertToAssets(tokenConfigs[token0].totalDebtShares, debtExchangeRateX96, Math.Rounding.Up)

1237:                         && _convertToAssets(tokenConfigs[token1].totalDebtShares, debtExchangeRateX96, Math.Rounding.Up)

```
*Github:* [[515](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L515), [552](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L552), [552](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L552), [561](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L561), [561](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L561), [814](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L814), [1229](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1229), [1237](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1237)]


```solidity
File: src/automators/AutoExit.sol

113:             config.onlyFees && params.rewardX64 > config.maxRewardX64

114:                 || !config.onlyFees && params.rewardX64 > config.maxRewardX64

135:         if (config.token0TriggerTick <= state.tick && state.tick < config.token1TriggerTick) {

140:         state.isSwap = !state.isAbove && config.token0Swap || state.isAbove && config.token1Swap;

140:         state.isSwap = !state.isAbove && config.token0Swap || state.isAbove && config.token1Swap;

```
*Github:* [[113](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L113), [114](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L114), [135](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L135), [140](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L140), [140](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L140)]


```solidity
File: src/automators/Automator.sol

173:             return twapTick - currentTick >= -int16(maxDifference) && twapTick - currentTick <= int16(maxDifference);

219:         if (address(weth) == address(token) && unwrap) {

```
*Github:* [[173](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L173), [219](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L219)]


```solidity
File: src/transformers/AutoCompound.sol

102:         if (!operators[msg.sender] && !vaults[msg.sender]) {

```
*Github:* [[102](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L102)]


```solidity
File: src/transformers/AutoRange.sol

112:         if (!operators[msg.sender] && !vaults[msg.sender]) {

123:             config.onlyFees && params.rewardX64 > config.maxRewardX64

124:                 || !config.onlyFees && params.rewardX64 > config.maxRewardX64

149:         if (params.swap0To1 && params.amountIn > state.amount0 || !params.swap0To1 && params.amountIn > state.amount1) {

149:         if (params.swap0To1 && params.amountIn > state.amount0 || !params.swap0To1 && params.amountIn > state.amount1) {

176:                     && baseTick + config.upperTickDelta == state.tickUpper

```
*Github:* [[112](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L112), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L123), [124](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L124), [149](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L149), [149](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L149), [176](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L176)]


```solidity
File: src/transformers/LeverageTransformer.sol

93:         if (token != token0 && token != token1 && amount > 0) {

93:         if (token != token0 && token != token1 && amount > 0) {

146:         if (params.amountIn0 > 0 && token != token0) {

155:         if (params.amountIn1 > 0 && token != token1) {

169:         if (amount0 > 0 && token != token0) {

172:         if (amount1 > 0 && token != token1) {

```
*Github:* [[93](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L93), [93](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L93), [146](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L146), [155](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L155), [169](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L169), [172](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L172)]


```solidity
File: src/transformers/V3Utils.sol

342:             if (targetAmount != 0 && instructions.targetToken != address(0)) {

697:             amountOther > amountAddedOther && address(otherToken) != address(0) && token0 != otherToken

697:             amountOther > amountAddedOther && address(otherToken) != address(0) && token0 != otherToken

698:                 && token1 != otherToken

865:         if (address(weth) == address(token) && unwrap) {

```
*Github:* [[342](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L342), [697](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L697), [697](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L697), [698](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L698), [865](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L865)]


```solidity
File: src/utils/Swapper.sol

77:         if (params.amountIn != 0 && params.swapData.length != 0 && address(params.tokenOut) != address(0)) {

77:         if (params.amountIn != 0 && params.swapData.length != 0 && address(params.tokenOut) != address(0)) {

```
*Github:* [[77](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L77), [77](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L77)]


</details>


<a name="GAS-30"></a> 
### [GAS-30] Consider using OZ EnumerateSet in place of nested mappings
Nested mappings and multi-dimensional arrays in Solidity operate through a process of double hashing, wherein the original storage slot and the first key are concatenated and hashed, and then this hash is again concatenated with the second key and hashed. This process can be quite gas expensive due to the double-hashing operation and subsequent storage operation (sstore).

A possible optimization involves manually concatenating the keys followed by a single hash operation and an sstore. However, this technique introduces the risk of storage collision, especially when there are other nested hash maps in the contract that use the same key types. Because Solidity is unaware of the number and structure of nested hash maps in a contract, it follows a conservative approach in computing the storage slot to avoid possible collisions.

OpenZeppelin's EnumerableSet provides a potential solution to this problem. It creates a data structure that combines the benefits of set operations with the ability to enumerate stored elements, which is not natively available in Solidity. EnumerableSet handles the element uniqueness internally and can therefore provide a more gas-efficient and collision-resistant alternative to nested mappings or multi-dimensional arrays in certain scenarios.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

164:     mapping(address => mapping(uint256 => mapping(address => bool))) public transformApprovals; // owners permissions for other addresses to call transform on owners behalf (e.g. AutoRange contract)

```
*Github:* [[164](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L164)]


```solidity
File: src/transformers/AutoCompound.sol

45:     mapping(uint256 => mapping(address => uint256)) public positionBalances;

```
*Github:* [[45](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L45)]



<a name="GAS-31"></a> 
### [GAS-31] Use a more recent version of solidity
- Use a solidity version of at least 0.8.2 to get simple compiler automatic inlining.
- Use a solidity version of at least 0.8.3 to get better struct packing and cheaper multiple storage reads.
- Use a solidity version of at least 0.8.4 to get custom errors, which are cheaper at deployment than revert()/require() strings.
- Use a solidity version of at least 0.8.10 to have external calls skip contract existence checks if the external call has a return value.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L2)]


```solidity
File: src/V3Oracle.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L2)]


```solidity
File: src/V3Vault.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L2)]


```solidity
File: src/automators/AutoExit.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L2)]


```solidity
File: src/automators/Automator.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L2)]


```solidity
File: src/transformers/AutoCompound.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L2)]


```solidity
File: src/transformers/AutoRange.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L2)]


```solidity
File: src/transformers/LeverageTransformer.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L2)]


```solidity
File: src/transformers/V3Utils.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L2)]


```solidity
File: src/utils/FlashloanLiquidator.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L2)]


```solidity
File: src/utils/Swapper.sol

2: pragma solidity ^0.8.0;

```
*Github:* [[2](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L2)]


</details>


<a name="GAS-32"></a> 
### [GAS-32] Use != 0 instead of > 0
Replace spotted instances with != 0 for uints as this uses less gas.

<details>
<summary>
There are <b>51</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

431:         if (state.liquidity > 0) {

```
*Github:* [[431](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L431)]


```solidity
File: src/V3Vault.sol

443:             if (data.length > 0) {

505:         if (transformedTokenId > 0) {

615:         if (transformedTokenId > 0) {

687:         if (transformedTokenId > 0) {

712:         if (state.reserveCost > 0) {

717:         if (params.permitData.length > 0) {

778:         if (amount > 0) {

893:         if (permitData.length > 0) {

977:         if (assets > 0) {

978:             if (permitData.length > 0) {

1064:         if (liquidity > 0) {

1186:         if (lastRateUpdate > 0) {

```
*Github:* [[443](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L443), [505](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L505), [615](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L615), [687](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L687), [712](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L712), [717](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L717), [778](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L778), [893](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L893), [977](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L977), [978](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L978), [1064](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1064), [1186](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1186)]


```solidity
File: src/automators/AutoExit.sol

199:         if (state.amount0 > 0) {

202:         if (state.amount1 > 0) {

```
*Github:* [[199](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L199), [202](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L202)]


```solidity
File: src/automators/Automator.sol

113:             if (balance > 0) {

129:         if (balance > 0) {

200:         if (liquidity > 0) {

```
*Github:* [[113](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L113), [129](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L129), [200](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L200)]


```solidity
File: src/transformers/AutoCompound.sol

123:         if (state.amount0 > 0 || state.amount1 > 0) {

127:             if (amountIn > 0) {

133:                 if (tSecs > 0) {

140:                 if (amountIn > 0) {

160:             if (state.maxAddAmount0 > 0 || state.maxAddAmount1 > 0) {

212:         if (balance0 > 0) {

216:         if (balance1 > 0) {

```
*Github:* [[123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L123), [127](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L127), [133](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L133), [140](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L140), [160](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L160), [212](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L212), [216](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L216)]


```solidity
File: src/transformers/AutoRange.sol

243:             if (state.amount0 - state.amountAdded0 > 0) {

246:             if (state.amount1 - state.amountAdded1 > 0) {

```
*Github:* [[243](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L243), [246](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L246)]


```solidity
File: src/transformers/LeverageTransformer.sol

52:         if (params.amountIn0 > 0) {

64:         if (params.amountIn1 > 0) {

93:         if (token != token0 && token != token1 && amount > 0) {

146:         if (params.amountIn0 > 0 && token != token0) {

155:         if (params.amountIn1 > 0 && token != token1) {

169:         if (amount0 > 0 && token != token0) {

172:         if (amount1 > 0 && token != token1) {

```
*Github:* [[52](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L52), [64](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L64), [93](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L93), [146](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L146), [155](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L155), [169](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L169), [172](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L172)]


```solidity
File: src/transformers/V3Utils.sol

402:         if (params.permitData.length > 0) {

476:         if (params.permitData.length > 0) {

539:         if (params.permitData.length > 0) {

577:         if (needed0 > 0) {

580:         if (needed1 > 0) {

583:         if (neededOther > 0) {

617:         if (state.needed0 > 0) {

621:         if (state.needed1 > 0) {

625:         if (state.neededOther > 0) {

634:         if (state.needed0 > 0) {

639:         if (state.needed1 > 0) {

644:         if (state.neededOther > 0) {

```
*Github:* [[402](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L402), [476](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L476), [539](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L539), [577](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L577), [580](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L580), [583](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L583), [617](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L617), [621](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L621), [625](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L625), [634](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L634), [639](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L639), [644](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L644)]


```solidity
File: src/utils/FlashloanLiquidator.sol

90:             if (balance > 0) {

96:             if (balance > 0) {

105:             if (balance > 0) {

```
*Github:* [[90](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L90), [96](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L96), [105](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L105)]


```solidity
File: src/utils/Swapper.sol

133:         if (params.amountIn > 0) {

157:         require(amount0Delta > 0 || amount1Delta > 0); // swaps entirely within 0-liquidity regions are not supported

```
*Github:* [[133](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L133), [157](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L157)]


</details>


<a name="GAS-33"></a> 
### [GAS-33] Use += for mappings
Using `+=` for mappings simplifies code and can potentially save gas. When you need to increment a value within a mapping, writing `mappingA[xyz] = mappingA[xyz] + 1;` can be made more concise with `mappingA[xyz] += 1;`.

Resolution: To enhance code clarity and potentially reduce gas costs, replace explicit addition assignments with the `+=` operator when dealing with mappings. This not only shortens the code but also makes it easier to read and understand. Employ tools like linters or static analysis to systematically identify and correct such instances, ensuring optimized and cleaner code throughout your smart contract.

*There is one instance of this issue:*
```solidity
File: src/transformers/AutoCompound.sol

250:         positionBalances[tokenId][token] = positionBalances[tokenId][token] + amount;

```
*Github:* [[250](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L250)]



<a name="GAS-34"></a> 
### [GAS-34] Use `selfbalance()` instead of `address(this).balance`
Use assembly when getting a contract's balance of ETH.

You can use `selfbalance()` instead of `address(this).balance` when getting your contract's balance of ETH to save gas.
Additionally, you can use `balance(address)` instead of `address.balance()` when getting an external contract's balance of ETH.

*Saves 15 gas when checking internal balance, 6 for external*

*There is one instance of this issue:*
```solidity
File: src/automators/Automator.sol

128:         uint256 balance = address(this).balance;

```
*Github:* [[128](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L128)]



<a name="GAS-35"></a> 
### [GAS-35] State variables can be packed into fewer storage slots by truncating timestamp bytes
State variables in Solidity are typically stored in 32-byte storage slots. When dealing with timestamps, which generally fit into a smaller byte size, it can be beneficial to truncate these bytes and pack them with other variables. This reduces the number of required storage slots, saving both storage space and associated gas costs. For example, a timestamp generally fits into a uint32, so it can be combined with other small variables within a single storage slot. When designing a contract, carefully structuring state variables to utilize truncation and packing can lead to a more efficient and cost-effective implementation.

*There are <b>8</b> instances of this issue:*
```solidity
File: src/automators/AutoExit.sol

/// @audit `deadline`
63:     struct ExecuteParams {
            uint256 tokenId; // tokenid to process
            bytes swapData; // if its a swap order - must include swap data
            uint128 liquidity; // liquidity the calculations are based on
            uint256 amountRemoveMin0; // min amount to be removed from liquidity
            uint256 amountRemoveMin1; // min amount to be removed from liquidity
            uint256 deadline; // for uniswap operations - operator promises fair value
            uint64 rewardX64; // which reward will be used for protocol, can be max configured amount (considering onlyFees)

```
*Github:* [[63](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L63)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `deadline`
53:     struct ExecuteParams {
            uint256 tokenId;
            bool swap0To1;
            uint256 amountIn; // if this is set to 0 no swap happens
            bytes swapData;
            uint128 liquidity; // liquidity the calculations are based on
            uint256 amountRemoveMin0; // min amount to be removed from liquidity
            uint256 amountRemoveMin1; // min amount to be removed from liquidity
            uint256 deadline; // for uniswap operations - operator promises fair value
            uint64 rewardX64; // which reward will be used for protocol, can be max configured amount (considering onlyFees)

```
*Github:* [[53](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L53)]


```solidity
File: src/transformers/LeverageTransformer.sol

/// @audit `deadline`
17:     struct LeverageUpParams {
            // which token to leverage
            uint256 tokenId;
            // how much to borrow
            uint256 borrowAmount;
            // how much of borrowed lend token should be swapped to token0
            uint256 amountIn0;
            uint256 amountOut0Min;
            bytes swapData0; // encoded data from 0x api call (address,bytes) - allowanceTarget,data
            // how much of borrowed lend token should be swapped to token1
            uint256 amountIn1;
            uint256 amountOut1Min;
            bytes swapData1; // encoded data from 0x api call (address,bytes) - allowanceTarget,data
            // for adding liquidity slippage
            uint256 amountAddMin0;
            uint256 amountAddMin1;
            // recipient for leftover tokens
            address recipient;
            // for all uniswap deadlineable functions
            uint256 deadline;

/// @audit `deadline`
98:     struct LeverageDownParams {
            // which token to leverage
            uint256 tokenId;
            // for removing - remove liquidity amount
            uint128 liquidity;
            uint256 amountRemoveMin0;
            uint256 amountRemoveMin1;
            // collect fee amount (if type(uint128).max - ALL)
            uint128 feeAmount0;
            uint128 feeAmount1;
            // how much of token0 should be swapped to lend token
            uint256 amountIn0;
            uint256 amountOut0Min;
            bytes swapData0; // encoded data from 0x api call (address,bytes) - allowanceTarget,data
            // how much of token1 should be swapped to lend token
            uint256 amountIn1;
            uint256 amountOut1Min;
            bytes swapData1; // encoded data from 0x api call (address,bytes) - allowanceTarget,data
            // recipient for leftover tokens
            address recipient;
            // for all uniswap deadlineable functions
            uint256 deadline;

```
*Github:* [[17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L17), [98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L98)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit `deadline`
48:     struct Instructions {
            // what action to perform on provided Uniswap v3 position
            WhatToDo whatToDo;
            // target token for swaps (if this is address(0) no swaps are executed)
            address targetToken;
            // for removing liquidity slippage
            uint256 amountRemoveMin0;
            uint256 amountRemoveMin1;
            // amountIn0 is used for swap and also as minAmount0 for decreased liquidity + collected fees
            uint256 amountIn0;
            // if token0 needs to be swapped to targetToken - set values
            uint256 amountOut0Min;
            bytes swapData0; // encoded data from 0x api call (address,bytes) - allowanceTarget,data
            // amountIn1 is used for swap and also as minAmount1 for decreased liquidity + collected fees
            uint256 amountIn1;
            // if token1 needs to be swapped to targetToken - set values
            uint256 amountOut1Min;
            bytes swapData1; // encoded data from 0x api call (address,bytes) - allowanceTarget,data
            // collect fee amount for COMPOUND_FEES / CHANGE_RANGE / WITHDRAW_AND_COLLECT_AND_SWAP (if uint256(128).max - ALL)
            uint128 feeAmount0;
            uint128 feeAmount1;
            // for creating new positions with CHANGE_RANGE
            uint24 fee;
            int24 tickLower;
            int24 tickUpper;
            // remove liquidity amount for COMPOUND_FEES (in this case should be probably 0) / CHANGE_RANGE / WITHDRAW_AND_COLLECT_AND_SWAP
            uint128 liquidity;
            // for adding liquidity slippage
            uint256 amountAddMin0;
            uint256 amountAddMin1;
            // for all uniswap deadlineable functions
            uint256 deadline;
            // left over tokens will be sent to this address
            address recipient;
            // recipient of newly minted nft (the incoming NFT will ALWAYS be returned to from)
            address recipientNFT;
            // if tokenIn or tokenOut is WETH - unwrap
            bool unwrap;
            // data sent with returned token to IERC721Receiver (optional)
            bytes returnData;
            // data sent with minted token to IERC721Receiver (optional)
            bytes swapAndMintReturnData;

/// @audit `deadline`
432:     struct SwapAndMintParams {
             IERC20 token0;
             IERC20 token1;
             uint24 fee;
             int24 tickLower;
             int24 tickUpper;
             // how much is provided of token0 and token1
             uint256 amount0;
             uint256 amount1;
             address recipient; // recipient of leftover tokens
             address recipientNFT; // recipient of nft
             uint256 deadline;
             // source token for swaps (maybe either address(0), token0, token1 or another token)
             // if swapSourceToken is another token than token0 or token1 -> amountIn0 + amountIn1 of swapSourceToken are expected to be available
             IERC20 swapSourceToken;
             // if swapSourceToken needs to be swapped to token0 - set values
             uint256 amountIn0;
             uint256 amountOut0Min;
             bytes swapData0;
             // if swapSourceToken needs to be swapped to token1 - set values
             uint256 amountIn1;
             uint256 amountOut1Min;
             bytes swapData1;
             // min amount to be added after swap
             uint256 amountAddMin0;
             uint256 amountAddMin1;
             // data to be sent along newly created NFT when transfered to recipientNFT (sent to IERC721Receiver callback)
             bytes returnData;
             // if permit2 signatures are used - set this
             bytes permitData;

/// @audit `deadline`
504:     struct SwapAndIncreaseLiquidityParams {
             uint256 tokenId;
             // how much is provided of token0 and token1
             uint256 amount0;
             uint256 amount1;
             address recipient; // recipient of leftover tokens
             uint256 deadline;
             // source token for swaps (maybe either address(0), token0, token1 or another token)
             // if swapSourceToken is another token than token0 or token1 -> amountIn0 + amountIn1 of swapSourceToken are expected to be available
             IERC20 swapSourceToken;
             // if swapSourceToken needs to be swapped to token0 - set values
             uint256 amountIn0;
             uint256 amountOut0Min;
             bytes swapData0;
             // if swapSourceToken needs to be swapped to token1 - set values
             uint256 amountIn1;
             uint256 amountOut1Min;
             bytes swapData1;
             // min amount to be added after swap
             uint256 amountAddMin0;
             uint256 amountAddMin1;
             // if permit2 signatures are used - set this
             bytes permitData;

```
*Github:* [[48](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L48), [432](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L432), [504](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L504)]


```solidity
File: src/utils/Swapper.sol

/// @audit `deadline`
56:     struct UniversalRouterData {
            bytes commands;
            bytes[] inputs;
            uint256 deadline;

```
*Github:* [[56](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L56)]



<a name="GAS-36"></a> 
### [GAS-36] Consider Using Solady's Gas Optimized Lib for Math
In instances where many similar mathematical operations are performed, consider using Solday's math lib to benefit from the gas saving it can introduce.

<details>
<summary>
There are <b>51</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

50:         return debt * Q96 / (cash + debt);

67:             borrowRateX96 = (utilizationRateX96 * multiplierPerSecondX96 / Q96) + baseRatePerSecondX96;

69:             uint256 normalRateX96 = (kinkX96 * multiplierPerSecondX96 / Q96) + baseRatePerSecondX96;

71:             borrowRateX96 = (excessUtilX96 * jumpMultiplierPerSecondX96 / Q96) + normalRateX96;

74:         supplyRateX96 = utilizationRateX96 * borrowRateX96 / Q96;

```
*Github:* [[50](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L50), [67](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L67), [69](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L69), [71](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L71), [74](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L74)]


```solidity
File: src/V3Oracle.sol

120:         value = (price0X96 * (amount0 + fees0) / Q96 + price1X96 * (amount1 + fees1) / Q96) * Q96 / priceTokenX96;

121:         feeValue = (price0X96 * fees0 / Q96 + price1X96 * fees1 / Q96) * Q96 / priceTokenX96;

122:         price0X96 = price0X96 * Q96 / priceTokenX96;

123:         price1X96 = price1X96 * Q96 / priceTokenX96;

129:         uint256 derivedPoolPriceX96 = price0X96 * Q96 / price1X96;

144:             ? (priceX96 - verifyPriceX96) * 10000 / priceX96

145:             : (verifyPriceX96 - priceX96) * 10000 / verifyPriceX96;

304:             chainlinkPriceX96 = (10 ** referenceTokenDecimals) * chainlinkPriceX96 * Q96 / chainlinkReferencePriceX96

342:         return uint256(answer) * Q96 / (10 ** feedConfig.feedDecimals);

353:             poolTWAPPriceX96 = Q96 * Q96 / priceX96;

```
*Github:* [[120](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L120), [121](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L121), [122](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L122), [123](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L123), [129](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L129), [144](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L144), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L145), [304](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L304), [342](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L342), [353](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L353)]


```solidity
File: src/V3Vault.sol

36:     uint32 public constant MAX_COLLATERAL_FACTOR_X32 = uint32(Q32 * 90 / 100); // 90%

38:     uint32 public constant MIN_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 2 / 100); // 2%

39:     uint32 public constant MAX_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 10 / 100); // 10%

769:             _convertToAssets(totalSupply(), newLendExchangeRateX96, Math.Rounding.Up) * reserveProtectionFactorX32 / Q32;

1054:                 fees0 = uint128(liquidationValue * fees0 / feeValue);

1055:                 fees1 = uint128(liquidationValue * fees1 / feeValue);

1060:                 liquidity = uint128((liquidationValue - feeValue) * liquidity / (fullValue - feeValue));

1100:         uint256 maxPenaltyValue = debt * (Q32 + MAX_LIQUIDATION_PENALTY_X32) / Q32;

1105:             uint256 startLiquidationValue = debt * fullValue / collateralValue;

1107:                 (Q96 - ((fullValue - maxPenaltyValue) * Q96 / (startLiquidationValue - maxPenaltyValue)));

1109:                 + (MAX_LIQUIDATION_PENALTY_X32 - MIN_LIQUIDATION_PENALTY_X32) * penaltyFractionX96 / Q96;

1111:             liquidationValue = debt * (Q32 + penaltyX32) / Q32;

1116:             uint256 penaltyValue = fullValue * (Q32 - MAX_LIQUIDATION_PENALTY_X32) / Q32;

1137:             newLendExchangeRateX96 = (totalLent - missing) * newLendExchangeRateX96 / totalLent;

1188:                 + oldDebtExchangeRateX96 * (block.timestamp - lastRateUpdate) * borrowRateX96 / Q96;

1190:                 + oldLendExchangeRateX96 * (block.timestamp - lastRateUpdate) * supplyRateX96 / Q96;

1230:                             > lentAssets * collateralValueLimitFactorX32 / Q32

1238:                             > lentAssets * collateralValueLimitFactorX32 / Q32

1250:             uint256 lendIncreaseLimit = _convertToAssets(totalSupply(), newLendExchangeRateX96, Math.Rounding.Up)

1262:             uint256 debtIncreaseLimit = _convertToAssets(totalSupply(), newLendExchangeRateX96, Math.Rounding.Up)

```
*Github:* [[36](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L36), [38](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L38), [39](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L39), [769](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L769), [1054](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1054), [1055](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1055), [1060](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1060), [1100](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1100), [1105](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1105), [1107](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1107), [1109](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1109), [1111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1111), [1116](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1116), [1137](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1137), [1188](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1188), [1190](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1190), [1230](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1230), [1238](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1238), [1250](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1250), [1262](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1262)]


```solidity
File: src/automators/AutoExit.sol

155:                 state.amount0 -= state.feeAmount0 * params.rewardX64 / Q64;

156:                 state.amount1 -= state.feeAmount1 * params.rewardX64 / Q64;

187:                     state.amount0 -= state.amount0 * params.rewardX64 / Q64;

189:                     state.amount1 -= state.amount1 * params.rewardX64 / Q64;

194:             state.amount0 -= (config.onlyFees ? state.feeAmount0 : state.amount0) * params.rewardX64 / Q64;

195:             state.amount1 -= (config.onlyFees ? state.feeAmount1 : state.amount1) * params.rewardX64 / Q64;

```
*Github:* [[155](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L155), [156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L156), [187](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L187), [189](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L189), [194](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L194), [195](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L195)]


```solidity
File: src/transformers/AutoCompound.sol

156:             state.maxAddAmount0 = state.amount0 * Q64 / (rewardX64 + Q64);

157:             state.maxAddAmount1 = state.amount1 * Q64 / (rewardX64 + Q64);

170:                 state.amount0Fees = state.compounded0 * rewardX64 / Q64;

171:                 state.amount1Fees = state.compounded1 * rewardX64 / Q64;

```
*Github:* [[156](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L156), [157](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L157), [170](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L170), [171](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L171)]


```solidity
File: src/transformers/AutoRange.sol

143:             state.protocolReward0 = state.feeAmount0 * params.rewardX64 / Q64;

144:             state.protocolReward1 = state.feeAmount1 * params.rewardX64 / Q64;

195:             state.maxAddAmount0 = config.onlyFees ? state.amount0 : state.amount0 * Q64 / (params.rewardX64 + Q64);

196:             state.maxAddAmount1 = config.onlyFees ? state.amount1 : state.amount1 * Q64 / (params.rewardX64 + Q64);

236:                 state.protocolReward0 = state.amountAdded0 * params.rewardX64 / Q64;

237:                 state.protocolReward1 = state.amountAdded1 * params.rewardX64 / Q64;

```
*Github:* [[143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L143), [144](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L144), [195](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L195), [196](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L196), [236](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L236), [237](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L237)]


</details>


<a name="GAS-37"></a> 
### [GAS-37] Use solady library where possible to save gas
The following OpenZeppelin imports have a Solady equivalent, as such they can be used to save GAS as Solady modules have been specifically designed to be as GAS efficient as possible

*There are <b>9</b> instances of this issue:*
```solidity
File: src/InterestRateModel.sol

4: import "@openzeppelin/contracts/access/Ownable.sol";

```
*Github:* [[4](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L4)]


```solidity
File: src/V3Oracle.sol

15: import "@openzeppelin/contracts/access/Ownable.sol";

```
*Github:* [[15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L15)]


```solidity
File: src/V3Vault.sol

13: import "@openzeppelin/contracts/token/ERC20/ERC20.sol";

14: import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";

16: import "@openzeppelin/contracts/access/Ownable.sol";

```
*Github:* [[13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L13), [14](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L14), [16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L16)]


```solidity
File: src/automators/Automator.sol

4: import "@openzeppelin/contracts/access/Ownable.sol";

5: import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";

```
*Github:* [[4](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L4), [5](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L5)]


```solidity
File: src/transformers/LeverageTransformer.sol

5: import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";

```
*Github:* [[5](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L5)]


```solidity
File: src/utils/Swapper.sol

4: import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";

```
*Github:* [[4](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L4)]



<a name="GAS-38"></a> 
### [GAS-38] Use `storage` instead of `memory` for structs/arrays
When fetching data from a storage location, assigning the data to a `memory` variable causes all fields of the struct/array to be read from storage, which incurs a Gcoldsload (**2100 gas**) for *each* field of the struct/array. If the fields are read from the new memory variable, they incur an additional `MLOAD` rather than a cheap stack read. Instead of declaring the variable with the `memory` keyword, declaring the variable with the `storage` keyword and caching any fields that need to be re-read in stack variables, will be much cheaper, only incurring the Gcoldsload for the fields actually read. The only time it makes sense to read the whole struct/array into a `memory` variable, is if the full struct/array is being returned by the function, is being passed to a function that requires `memory`, or if the array/struct is being read from another `memory` array/struct.

*There are <b>4</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

281:         TokenConfig memory feedConfig = feedConfigs[token];

334:         TokenConfig memory feedConfig = feedConfigs[token];

```
*Github:* [[281](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L281), [334](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L334)]


```solidity
File: src/automators/AutoExit.sol

106:         PositionConfig memory config = positionConfigs[params.tokenId];

```
*Github:* [[106](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L106)]


```solidity
File: src/transformers/AutoRange.sol

116:         PositionConfig memory config = positionConfigs[params.tokenId];

```
*Github:* [[116](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L116)]



<a name="GAS-39"></a> 
### [GAS-39] Use `uint256(1)`/`uint256(2)` instead of `true`/`false` to save gas for changes
Avoids a Gsset (20000 gas) when changing from false to true, after having been true in the past. Since most of the bools aren't changed twice in one transaction, I've counted the amount of gas as half of the full amount, for each variable.

*There are <b>4</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

163:     mapping(address => bool) public transformerAllowList; // contracts allowed to transform positions (selected audited contracts e.g. V3Utils)

164:     mapping(address => mapping(uint256 => mapping(address => bool))) public transformApprovals; // owners permissions for other addresses to call transform on owners behalf (e.g. AutoRange contract)

```
*Github:* [[163](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L163), [164](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L164)]


```solidity
File: src/automators/Automator.sol

34:     mapping(address => bool) public operators;

35:     mapping(address => bool) public vaults;

```
*Github:* [[34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L34), [35](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L35)]



<a name="GAS-40"></a> 
### [GAS-40] Use `unchecked` block for safe subtractions
If it can be confirmed that the subtraction operation will not overflow, using an unchecked block can save gas. For example, `require(x <= y); z = y - x;` can be optimized to `require(x <= y); unchecked { z = y - x; }`

<details>
<summary>
There are <b>25</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

/// @audit this subtraction is checked on line 66
70:             uint256 excessUtilX96 = utilizationRateX96 - kinkX96;

```
*Github:* [[70](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L70)]


```solidity
File: src/V3Oracle.sol

/// @audit this subtraction is checked on line 143
144:             ? (priceX96 - verifyPriceX96) * 10000 / priceX96

/// @audit this subtraction is checked on line 143
145:             : (verifyPriceX96 - priceX96) * 10000 / verifyPriceX96;

```
*Github:* [[144](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L144), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L145)]


```solidity
File: src/V3Vault.sol

/// @audit this subtraction is checked on line 304
307:             return globalLendLimit - value;

/// @audit this subtraction is checked on line 304
318:             return _convertToShares(globalLendLimit - value, lendExchangeRateX96, Math.Rounding.Down);

/// @audit this subtraction is checked on line 998
581:             tokenId, newDebtExchangeRateX96, newLendExchangeRateX96, loanDebtShares - shares, loanDebtShares

/// @audit this subtraction is checked on line 771
771:         uint256 unprotected = reserves > protected ? reserves - protected : 0;

/// @audit this subtraction is checked on line 1028
1028:         available = balance > reserves ? balance - reserves : 0;

/// @audit this subtraction is checked on line 1052
1060:                 liquidity = uint128((liquidationValue - feeValue) * liquidity / (fullValue - feeValue));

/// @audit this subtraction is checked on line 1103
1107:                 (Q96 - ((fullValue - maxPenaltyValue) * Q96 / (startLiquidationValue - maxPenaltyValue)));

/// @audit this subtraction is checked on line 1100
1116:             uint256 penaltyValue = fullValue * (Q32 - MAX_LIQUIDATION_PENALTY_X32) / Q32;

/// @audit this subtraction is checked on line 1131
1132:             missing = reserveCost - reserves;

/// @audit this subtraction is checked on line 1212
1217:                 tokenConfigs[token0].totalDebtShares -= SafeCast.toUint192(oldShares - newShares);

/// @audit this subtraction is checked on line 1212
1218:                 tokenConfigs[token1].totalDebtShares -= SafeCast.toUint192(oldShares - newShares);

/// @audit this subtraction is checked on line 1212
1220:                 tokenConfigs[token0].totalDebtShares += SafeCast.toUint192(newShares - oldShares);

/// @audit this subtraction is checked on line 1212
1221:                 tokenConfigs[token1].totalDebtShares += SafeCast.toUint192(newShares - oldShares);

```
*Github:* [[307](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L307), [318](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L318), [581](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L581), [771](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L771), [1028](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1028), [1060](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1060), [1107](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1107), [1116](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1116), [1132](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1132), [1217](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1217), [1218](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1218), [1220](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1220), [1221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1221)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit this subtraction is checked on line 256
259:                 emit BalanceAdded(tokenId, token, amount - currentBalance);

/// @audit this subtraction is checked on line 256
261:                 emit BalanceRemoved(tokenId, token, currentBalance - amount);

```
*Github:* [[259](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L259), [261](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L261)]


```solidity
File: src/transformers/LeverageTransformer.sol

/// @audit this subtraction is checked on line 87
88:             SafeERC20.safeTransfer(IERC20(token0), params.recipient, amount0 - added0);

/// @audit this subtraction is checked on line 90
91:             SafeERC20.safeTransfer(IERC20(token1), params.recipient, amount1 - added1);

```
*Github:* [[88](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L88), [91](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L91)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit this subtraction is checked on line 316
317:                     _transferToken(instructions.recipient, IERC20(token0), amount0 - amountInDelta, instructions.unwrap);

/// @audit this subtraction is checked on line 333
334:                     _transferToken(instructions.recipient, IERC20(token1), amount1 - amountInDelta, instructions.unwrap);

/// @audit this subtraction is checked on line 671
691:             needed0 = amount0 - amountAdded0;

/// @audit this subtraction is checked on line 676
694:             needed1 = amount1 - amountAdded1;

/// @audit this subtraction is checked on line 681
700:             neededOther = amountOther - amountAddedOther;

```
*Github:* [[317](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L317), [334](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L334), [691](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L691), [694](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L694), [700](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L700)]


</details>


<a name="GAS-41"></a> 
### [GAS-41] Using bitmap to store bool states can save gas
Using a bitmap instead of a bool array or a bool mapping to store boolean states can save gas fees. This is because the bitmap can store 256 boolean values in a single slot instead of 256 slots, which can save gas when writing bool values or when reading multiple bool values from the same slot.

*There are <b>4</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

163:     mapping(address => bool) public transformerAllowList; // contracts allowed to transform positions (selected audited contracts e.g. V3Utils)

164:     mapping(address => mapping(uint256 => mapping(address => bool))) public transformApprovals; // owners permissions for other addresses to call transform on owners behalf (e.g. AutoRange contract)

```
*Github:* [[163](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L163), [164](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L164)]


```solidity
File: src/automators/Automator.sol

34:     mapping(address => bool) public operators;

35:     mapping(address => bool) public vaults;

```
*Github:* [[34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L34), [35](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L35)]



<a name="GAS-42"></a> 
### [GAS-42] Using `constant`s directly, rather than caching the value, saves gas

*There are <b>7</b> instances of this issue:*
```solidity
File: src/InterestRateModel.sol

/// @audit `Q96`
74:         supplyRateX96 = utilizationRateX96 * borrowRateX96 / Q96;

/// @audit `YEAR_SECS`
95:         baseRatePerSecondX96 = baseRatePerYearX96 / YEAR_SECS;

/// @audit `YEAR_SECS`
96:         multiplierPerSecondX96 = multiplierPerYearX96 / YEAR_SECS;

/// @audit `YEAR_SECS`
97:         jumpMultiplierPerSecondX96 = jumpMultiplierPerYearX96 / YEAR_SECS;

```
*Github:* [[74](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L74), [95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L95), [96](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L96), [97](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L97)]


```solidity
File: src/V3Vault.sol

/// @audit `Q32`
1100:         uint256 maxPenaltyValue = debt * (Q32 + MAX_LIQUIDATION_PENALTY_X32) / Q32;

/// @audit `Q32`
1111:             liquidationValue = debt * (Q32 + penaltyX32) / Q32;

/// @audit `Q32`
1116:             uint256 penaltyValue = fullValue * (Q32 - MAX_LIQUIDATION_PENALTY_X32) / Q32;

```
*Github:* [[1100](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1100), [1111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1111), [1116](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1116)]



<a name="GAS-43"></a> 
### [GAS-43] Using `this` to access functions results in an external call, wasting gas
External calls have an overhead of 100 gas, which can be avoided by not referencing the function using `this`. Contracts are allowed to override their parents' functions and change the visibility from `external` to `public`, so make this change if it's required in order to call the function internally.

*There is one instance of this issue:*
```solidity
File: src/automators/Automator.sol

128:         uint256 balance = address(this).balance;

```
*Github:* [[128](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L128)]



<a name="GAS-44"></a> 
### [GAS-44] `abi.encodePacked` is more gas efficient than `abi.encode`
`abi.encode` pads all elementary types to 32 bytes, whereas `abi.encodePacked` will only use the minimal required memory to encode the data. See [here](https://docs.soliditylang.org/en/v0.8.11/abi-spec.html?highlight=encodepacked#non-standard-packed-mode) for more info.

*There are <b>4</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

401:         nonfungiblePositionManager.safeTransferFrom(msg.sender, address(this), tokenId, abi.encode(recipient));

424:         nonfungiblePositionManager.safeTransferFrom(owner, address(this), tokenId, abi.encode(recipient));

```
*Github:* [[401](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L401), [424](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L424)]


```solidity
File: src/utils/FlashloanLiquidator.sol

51:         bytes memory data = abi.encode(

```
*Github:* [[51](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L51)]


```solidity
File: src/utils/Swapper.sol

139:                 abi.encode(

```
*Github:* [[139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L139)]



<a name="GAS-45"></a> 
### [GAS-45] `array[index] += amount` is cheaper than `array[index] = array[index] + amount` (or related variants)
When updating a value in an array with arithmetic, using `array[index] += amount` is cheaper than `array[index] = array[index] + amount`.
This is because you avoid an additonal `mload` when the array is stored in memory, and an `sload` when the array is stored in storage.
This can be applied for any arithmetic operation including `+=`, `-=`,`/=`,`*=`,`^=`,`&=`, `%=`, `<<=`,`>>=`, and `>>>=`.
This optimization can be particularly significant if the pattern occurs during a loop.

*Saves 28 gas for a storage array, 38 for a memory array*

*There are <b>2</b> instances of this issue:*
```solidity
File: src/transformers/AutoCompound.sol

250:         positionBalances[tokenId][token] = positionBalances[tokenId][token] + amount;

270:         positionBalances[tokenId][token] = positionBalances[tokenId][token] - amount;

```
*Github:* [[250](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L250), [270](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L270)]



<a name="GAS-46"></a> 
### [GAS-46] Using bools for storage incurs overhead
Use uint256(1) and uint256(2) for true/false to avoid a Gwarmaccess (100 gas), and to avoid Gsset (20000 gas) when changing from ‘false’ to ‘true’, after having been ‘true’ in the past. See [source](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/58f635312aa21f947cae5f8578638a85aa2519f5/contracts/security/ReentrancyGuard.sol#L23-L27).

*There are <b>4</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

163:     mapping(address => bool) public transformerAllowList; // contracts allowed to transform positions (selected audited contracts e.g. V3Utils)

164:     mapping(address => mapping(uint256 => mapping(address => bool))) public transformApprovals; // owners permissions for other addresses to call transform on owners behalf (e.g. AutoRange contract)

```
*Github:* [[163](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L163), [164](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L164)]


```solidity
File: src/automators/Automator.sol

34:     mapping(address => bool) public operators;

35:     mapping(address => bool) public vaults;

```
*Github:* [[34](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L34), [35](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L35)]



<a name="GAS-47"></a> 
### [GAS-47] State variables should be cached in stack variables rather than re-reading them from storage
The instances below point to the second+ access of a state variable within a function. Caching of a state variable replaces each Gwarmaccess (100 gas) with a much cheaper stack read. Other less obvious fixes/optimizations include having local memory caches of state variable structs, or having local caches of state variable contracts/addresses.

*There are <b>8</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

/// @audit more than 1 read for `transformedTokenId`, line 451 and 441
451:             uint256 oldTokenId = transformedTokenId;

/// @audit more than 1 read for `transformedTokenId`, line 458 and 441
458:                 transformedTokenId = tokenId;

/// @audit more than 1 read for `transformedTokenId`, line 528 and 508
528:         tokenId = transformedTokenId;

/// @audit more than 1 read for `transformedTokenId`, line 542 and 508
542:         transformedTokenId = 0;

/// @audit more than 1 read for `tokenConfigs`, line 1146 and 1145
1146:         uint32 factor1X32 = tokenConfigs[token1].collateralFactorX32;

/// @audit more than 1 read for `ownedTokens`, line 1305 and 1304
1305:         uint256 tokenIndex = ownedTokensIndex[tokenId];

/// @audit more than 1 read for `ownedTokens`, line 1307 and 1304
1307:             uint256 lastTokenId = ownedTokens[from][lastTokenIndex];

```
*Github:* [[451](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L451), [458](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L458), [528](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L528), [542](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L542), [1146](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1146), [1305](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1305), [1307](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1307)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit more than 1 read for `positionBalances`, line 215 and 211
215:         uint256 balance1 = positionBalances[tokenId][token1];

```
*Github:* [[215](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L215)]



<a name="GAS-48"></a> 
### [GAS-48] Use `calldata` instead of `memory` for function arguments that do not get mutated
Mark data types as `calldata` instead of `memory` where possible. This makes it so that the data is not automatically loaded into memory. If the data passed into the function does not need to be changed (like updating values in an array), it can be passed in as `calldata`. The one exception to this is if the argument must later be passed into another function that takes an argument that specifies `memory` storage.

*There are <b>4</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

/// @audit make `name` as a calldata
170:         string memory name,

/// @audit make `symbol` as a calldata
171:         string memory symbol,

```
*Github:* [[170](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L170), [171](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L171)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit make `instructions` as a calldata
98:     function executeWithPermit(uint256 tokenId, Instructions memory instructions, uint8 v, bytes32 r, bytes32 s)

/// @audit make `instructions` as a calldata
115:     function execute(uint256 tokenId, Instructions memory instructions) public returns (uint256 newTokenId) {

```
*Github:* [[98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L98), [115](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L115)]



<a name="GAS-49"></a> 
### [GAS-49] Use Custom Errors
[Source](https://blog.soliditylang.org/2021/04/21/custom-errors/)
Instead of using error strings, to reduce deployment and runtime cost, you should use Custom Errors. This would save both deployment and runtime cost.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/transformers/AutoCompound.sol

244:         require(_totalRewardX64 <= totalRewardX64, ">totalRewardX64");

269:         require(amount <= balance, "amount>balance");

```
*Github:* [[244](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L244), [269](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L269)]



<a name="GAS-50"></a> 
### [GAS-50] Don't use `SafeMath` once the solidity version is 0.8.0 or greater
Solidity 0.8.0 introduces internal overflow checks, so using SafeMath is redundant and adds overhead.

*There is one instance of this issue:*
```solidity
File: src/transformers/AutoCompound.sol

6: import "@openzeppelin/contracts/utils/math/SafeMath.sol";

```
*Github:* [[6](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L6)]



<a name="GAS-51"></a> 
### [GAS-51] Don't initialize variables with default value

<details>
<summary>
There are <b>13</b> instances (click to show):
</summary>

```solidity
File: src/V3Vault.sol

118:     uint32 public reserveFactorX32 = 0;

124:     uint256 public debtSharesTotal = 0;

127:     uint256 public lastExchangeRateUpdate = 0;

131:     uint256 public globalDebtLimit = 0;

132:     uint256 public globalLendLimit = 0;

135:     uint256 public minLoanSize = 0;

138:     uint256 public dailyLendIncreaseLimitMin = 0;

139:     uint256 public dailyLendIncreaseLimitLeft = 0;

140:     uint256 public dailyLendIncreaseLimitLastReset = 0;

143:     uint256 public dailyDebtIncreaseLimitMin = 0;

144:     uint256 public dailyDebtIncreaseLimitLeft = 0;

145:     uint256 public dailyDebtIncreaseLimitLastReset = 0;

161:     uint256 private transformedTokenId = 0; // transient storage (when available in dencun)

```
*Github:* [[118](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L118), [124](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L124), [127](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L127), [131](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L131), [132](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L132), [135](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L135), [138](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L138), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L139), [140](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L140), [143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L143), [144](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L144), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L145), [161](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L161)]


</details>


<a name="GAS-52"></a> 
### [GAS-52] Usage of `int`s/`uint`s smaller than 32 bytes incurs overhead
Using `int`s/`uint`s smaller than 32 bytes may cost more gas. This is because the EVM operates on 32 bytes at a time, so if an element is smaller than 32 bytes, the EVM must perform more operations to reduce the size of the element from 32 bytes to the desired size.

<details>
<summary>
There are <b>183</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

25:     uint16 public constant MIN_PRICE_DIFFERENCE = 200; //2%

32:     event SetMaxPoolPriceDifference(uint16 maxPoolPriceDifference);

45:         uint32 maxFeedAge;

46:         uint8 feedDecimals;

47:         uint8 tokenDecimals;

50:         uint32 twapSeconds;

52:         uint16 maxDifference; // max price difference x10000

63:     uint8 public immutable referenceTokenDecimals;

65:     uint16 public maxPoolPriceDifference = MIN_PRICE_DIFFERENCE; // max price difference between oracle derived price and pool price x10000

170:             uint128 liquidity,

173:             uint128 fees0,

174:             uint128 fees1

185:     function setMaxPoolPriceDifference(uint16 _maxPoolPriceDifference) external onlyOwner {

204:         uint32 maxFeedAge,

206:         uint32 twapSeconds,

208:         uint16 maxDifference

215:         uint8 feedDecimals = feed.decimals();

216:         uint8 tokenDecimals = IERC20Metadata(token).decimals();

359:     function _getReferencePoolPriceX96(IUniswapV3Pool pool, uint32 twapSeconds) internal view returns (uint256) {

360:         uint160 sqrtPriceX96;

365:             uint32[] memory secondsAgos = new uint32[](2);

365:             uint32[] memory secondsAgos = new uint32[](2);

383:         uint128 liquidity;

386:         uint128 tokensOwed0;

387:         uint128 tokensOwed1;

389:         uint160 sqrtPriceX96;

391:         uint160 sqrtPriceX96Lower;

392:         uint160 sqrtPriceX96Upper;

404:             uint128 liquidity,

407:             uint128 tokensOwed0,

408:             uint128 tokensOwed1

429:         returns (uint256 amount0, uint256 amount1, uint128 fees0, uint128 fees1)

429:         returns (uint256 amount0, uint256 amount1, uint128 fees0, uint128 fees1)

448:         returns (uint128 fees0, uint128 fees1)

448:         returns (uint128 fees0, uint128 fees1)

467:         fees0 = uint128(FullMath.mulDiv(feeGrowth0, position.liquidity, Q128));

468:         fees1 = uint128(FullMath.mulDiv(feeGrowth1, position.liquidity, Q128));

```
*Github:* [[25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L25), [32](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L32), [45](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L45), [46](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L46), [47](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L47), [50](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L50), [52](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L52), [63](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L63), [65](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L65), [170](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L170), [173](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L173), [174](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L174), [185](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L185), [204](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L204), [206](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L206), [208](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L208), [215](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L215), [216](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L216), [359](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L359), [360](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L360), [365](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L365), [365](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L365), [383](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L383), [386](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L386), [387](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L387), [389](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L389), [391](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L391), [392](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L392), [404](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L404), [407](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L407), [408](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L408), [429](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L429), [429](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L429), [448](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L448), [448](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L448), [467](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L467), [468](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L468)]


```solidity
File: src/V3Vault.sol

7: import "v3-core/libraries/FixedPoint128.sol";

36:     uint32 public constant MAX_COLLATERAL_FACTOR_X32 = uint32(Q32 * 90 / 100); // 90%

36:     uint32 public constant MAX_COLLATERAL_FACTOR_X32 = uint32(Q32 * 90 / 100); // 90%

38:     uint32 public constant MIN_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 2 / 100); // 2%

38:     uint32 public constant MIN_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 2 / 100); // 2%

39:     uint32 public constant MAX_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 10 / 100); // 10%

39:     uint32 public constant MAX_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 10 / 100); // 10%

41:     uint32 public constant MIN_RESERVE_PROTECTION_FACTOR_X32 = uint32(Q32 / 100); //1%

41:     uint32 public constant MIN_RESERVE_PROTECTION_FACTOR_X32 = uint32(Q32 / 100); //1%

43:     uint32 public constant MAX_DAILY_LEND_INCREASE_X32 = uint32(Q32 / 10); //10%

43:     uint32 public constant MAX_DAILY_LEND_INCREASE_X32 = uint32(Q32 / 10); //10%

44:     uint32 public constant MAX_DAILY_DEBT_INCREASE_X32 = uint32(Q32 / 10); //10%

44:     uint32 public constant MAX_DAILY_DEBT_INCREASE_X32 = uint32(Q32 / 10); //10%

65:     uint8 private immutable assetDecimals;

76:         uint256 indexed tokenId, address owner, address recipient, uint128 liquidity, uint256 amount0, uint256 amount1

102:     event SetReserveFactor(uint32 reserveFactorX32);

103:     event SetReserveProtectionFactor(uint32 reserveProtectionFactorX32);

104:     event SetTokenConfig(address token, uint32 collateralFactorX32, uint32 collateralValueLimitFactorX32);

104:     event SetTokenConfig(address token, uint32 collateralFactorX32, uint32 collateralValueLimitFactorX32);

110:         uint32 collateralFactorX32; // how much this token is valued as collateral

111:         uint32 collateralValueLimitFactorX32; // how much asset equivalent may be lent out given this collateral

118:     uint32 public reserveFactorX32 = 0;

121:     uint32 public reserveProtectionFactorX32 = MIN_RESERVE_PROTECTION_FACTOR_X32;

277:     function decimals() public view override(IERC20Metadata, ERC20) returns (uint8) {

415:         uint8 v,

636:             params.feeAmount0 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount0 + params.feeAmount0),

636:             params.feeAmount0 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount0 + params.feeAmount0),

636:             params.feeAmount0 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount0 + params.feeAmount0),

637:             params.feeAmount1 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount1 + params.feeAmount1)

637:             params.feeAmount1 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount1 + params.feeAmount1)

637:             params.feeAmount1 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount1 + params.feeAmount1)

837:     function setReserveFactor(uint32 _reserveFactorX32) external onlyOwner {

844:     function setReserveProtectionFactor(uint32 _reserveProtectionFactorX32) external onlyOwner {

856:     function setTokenConfig(address token, uint32 collateralFactorX32, uint32 collateralValueLimitFactorX32)

856:     function setTokenConfig(address token, uint32 collateralFactorX32, uint32 collateralValueLimitFactorX32)

1039:         uint128 liquidity;

1040:         uint128 fees0;

1041:         uint128 fees1;

1046:             fees0 = type(uint128).max;

1047:             fees1 = type(uint128).max;

1054:                 fees0 = uint128(liquidationValue * fees0 / feeValue);

1055:                 fees1 = uint128(liquidationValue * fees1 / feeValue);

1058:                 fees0 = type(uint128).max;

1059:                 fees1 = type(uint128).max;

1060:                 liquidity = uint128((liquidationValue - feeValue) * liquidity / (fullValue - feeValue));

1143:     function _calculateTokenCollateralFactorX32(uint256 tokenId) internal view returns (uint32) {

1145:         uint32 factor0X32 = tokenConfigs[token0].collateralFactorX32;

1146:         uint32 factor1X32 = tokenConfigs[token1].collateralFactorX32;

1228:                     collateralValueLimitFactorX32 < type(uint32).max

1236:                     collateralValueLimitFactorX32 < type(uint32).max

```
*Github:* [[7](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L7), [36](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L36), [36](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L36), [38](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L38), [38](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L38), [39](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L39), [39](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L39), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L41), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L41), [43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L43), [43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L43), [44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L44), [44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L44), [65](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L65), [76](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L76), [102](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L102), [103](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L103), [104](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L104), [104](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L104), [110](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L110), [111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L111), [118](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L118), [121](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L121), [277](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L277), [415](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L415), [636](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L636), [636](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L636), [636](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L636), [637](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L637), [637](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L637), [637](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L637), [837](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L837), [844](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L844), [856](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L856), [856](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L856), [1039](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1039), [1040](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1040), [1041](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1041), [1046](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1046), [1047](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1047), [1054](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1054), [1055](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1055), [1058](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1058), [1059](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1059), [1060](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1060), [1143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1143), [1145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1145), [1146](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1146), [1228](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1228), [1236](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1236)]


```solidity
File: src/automators/AutoExit.sol

27:         uint64 token0SlippageX64,

28:         uint64 token1SlippageX64,

30:         uint64 maxRewardX64

37:         uint32 _TWAPSeconds,

38:         uint16 _maxTWAPTickDifference,

53:         uint64 token0SlippageX64; // when token 0 is swapped to token 1

54:         uint64 token1SlippageX64; // when token 1 is swapped to token 0

56:         uint64 maxRewardX64; // max allowed reward percentage of fees or full position

66:         uint128 liquidity; // liquidity the calculations are based on

70:         uint64 rewardX64; // which reward will be used for protocol, can be max configured amount (considering onlyFees)

79:         uint128 liquidity;

```
*Github:* [[27](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L27), [28](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L28), [30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L30), [37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L37), [38](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L38), [53](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L53), [54](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L54), [56](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L56), [66](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L66), [70](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L70), [79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L79)]


```solidity
File: src/automators/Automator.sol

23:     uint32 public constant MIN_TWAP_SECONDS = 60; // 1 minute

24:     uint32 public constant MAX_TWAP_TICK_DIFFERENCE = 200; // 2%

31:     event TWAPConfigChanged(uint32 TWAPSeconds, uint16 maxTWAPTickDifference);

31:     event TWAPConfigChanged(uint32 TWAPSeconds, uint16 maxTWAPTickDifference);

38:     uint32 public TWAPSeconds;

39:     uint16 public maxTWAPTickDifference;

45:         uint32 _TWAPSeconds,

46:         uint16 _maxTWAPTickDifference,

87:     function setTWAPConfig(uint16 _maxTWAPTickDifference, uint32 _TWAPSeconds) public onlyOwner {

87:     function setTWAPConfig(uint16 _maxTWAPTickDifference, uint32 _TWAPSeconds) public onlyOwner {

143:         uint32 twapPeriod,

144:         uint16 maxTickDifference,

145:         uint64 maxPriceDifferenceX64

146:     ) internal view returns (uint256 amountOutMin, int24 currentTick, uint160 sqrtPriceX96, uint256 priceX96) {

166:     function _hasMaxTWAPTickDifference(IUniswapV3Pool pool, uint32 twapPeriod, int24 currentTick, uint16 maxDifference)

166:     function _hasMaxTWAPTickDifference(IUniswapV3Pool pool, uint32 twapPeriod, int24 currentTick, uint16 maxDifference)

173:             return twapTick - currentTick >= -int16(maxDifference) && twapTick - currentTick <= int16(maxDifference);

173:             return twapTick - currentTick >= -int16(maxDifference) && twapTick - currentTick <= int16(maxDifference);

180:     function _getTWAPTick(IUniswapV3Pool pool, uint32 twapPeriod) internal view returns (int24, bool) {

181:         uint32[] memory secondsAgos = new uint32[](2);

181:         uint32[] memory secondsAgos = new uint32[](2);

186:         try pool.observe(secondsAgos) returns (int56[] memory tickCumulatives, uint160[] memory) {

195:         uint128 liquidity,

209:             INonfungiblePositionManager.CollectParams(tokenId, address(this), type(uint128).max, type(uint128).max)

209:             INonfungiblePositionManager.CollectParams(tokenId, address(this), type(uint128).max, type(uint128).max)

```
*Github:* [[23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L23), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L24), [31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L31), [31](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L31), [38](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L38), [39](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L39), [45](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L45), [46](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L46), [87](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L87), [87](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L87), [143](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L143), [144](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L144), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L145), [146](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L146), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L166), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L166), [173](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L173), [173](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L173), [180](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L180), [181](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L181), [181](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L181), [186](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L186), [195](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L195), [209](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L209), [209](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L209)]


```solidity
File: src/transformers/AutoCompound.sol

30:     event RewardUpdated(address account, uint64 totalRewardX64);

41:         uint32 _TWAPSeconds,

42:         uint16 _maxTWAPTickDifference

47:     uint64 public constant MAX_REWARD_X64 = uint64(Q64 / 50); // 2%

47:     uint64 public constant MAX_REWARD_X64 = uint64(Q64 / 50); // 2%

48:     uint64 public totalRewardX64 = MAX_REWARD_X64; // 2%

77:         uint160 sqrtPriceX96;

110:                 params.tokenId, address(this), type(uint128).max, type(uint128).max

110:                 params.tokenId, address(this), type(uint128).max, type(uint128).max

132:                 uint32 tSecs = TWAPSeconds;

243:     function setReward(uint64 _totalRewardX64) external onlyOwner {

```
*Github:* [[30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L30), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L41), [42](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L42), [47](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L47), [47](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L47), [48](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L48), [77](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L77), [110](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L110), [110](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L110), [132](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L132), [243](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L243)]


```solidity
File: src/transformers/AutoRange.sol

15:         int32 lowerTickLimit,

16:         int32 upperTickLimit,

17:         int32 lowerTickDelta,

18:         int32 upperTickDelta,

19:         uint64 token0SlippageX64,

20:         uint64 token1SlippageX64,

22:         uint64 maxRewardX64

29:         uint32 _TWAPSeconds,

30:         uint16 _maxTWAPTickDifference,

39:         int32 lowerTickLimit; // if negative also in-range positions may be adjusted / if 0 out of range positions may be adjusted

40:         int32 upperTickLimit; // if negative also in-range positions may be adjusted / if 0 out of range positions may be adjusted

41:         int32 lowerTickDelta; // this amount is added to current tick (floored to tickspacing) to define lowerTick of new position

42:         int32 upperTickDelta; // this amount is added to current tick (floored to tickspacing) to define upperTick of new position

43:         uint64 token0SlippageX64; // max price difference from current pool price for swap / Q64 for token0

44:         uint64 token1SlippageX64; // max price difference from current pool price for swap / Q64 for token1

46:         uint64 maxRewardX64; // max allowed reward percentage of fees or full position

58:         uint128 liquidity; // liquidity the calculations are based on

62:         uint64 rewardX64; // which reward will be used for protocol, can be max configured amount (considering onlyFees)

83:         uint128 liquidity;

```
*Github:* [[15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L15), [16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L16), [17](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L17), [18](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L18), [19](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L19), [20](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L20), [22](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L22), [29](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L29), [30](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L30), [39](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L39), [40](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L40), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L41), [42](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L42), [43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L43), [44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L44), [46](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L46), [58](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L58), [62](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L62), [83](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L83)]


```solidity
File: src/transformers/LeverageTransformer.sol

102:         uint128 liquidity;

106:         uint128 feeAmount0;

107:         uint128 feeAmount1;

139:             params.feeAmount0 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount0 + params.feeAmount0),

139:             params.feeAmount0 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount0 + params.feeAmount0),

139:             params.feeAmount0 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount0 + params.feeAmount0),

140:             params.feeAmount1 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount1 + params.feeAmount1)

140:             params.feeAmount1 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount1 + params.feeAmount1)

140:             params.feeAmount1 == type(uint128).max ? type(uint128).max : SafeCast.toUint128(amount1 + params.feeAmount1)

```
*Github:* [[102](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L102), [106](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L106), [107](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L107), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L139), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L139), [139](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L139), [140](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L140), [140](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L140), [140](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L140)]


```solidity
File: src/transformers/V3Utils.sol

22:     event CompoundFees(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

25:     event SwapAndMint(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

26:     event SwapAndIncreaseLiquidity(uint256 indexed tokenId, uint128 liquidity, uint256 amount0, uint256 amount1);

67:         uint128 feeAmount0;

68:         uint128 feeAmount1;

74:         uint128 liquidity;

98:     function executeWithPermit(uint256 tokenId, Instructions memory instructions, uint8 v, bytes32 r, bytes32 s)

116:         (,, address token0, address token1,,,, uint128 liquidity,,,,) = nonfungiblePositionManager.positions(tokenId);

133:             instructions.feeAmount0 == type(uint128).max

134:                 ? type(uint128).max

135:                 : (amount0 + instructions.feeAmount0).toUint128(),

136:             instructions.feeAmount1 == type(uint128).max

137:                 ? type(uint128).max

138:                 : (amount1 + instructions.feeAmount1).toUint128()

470:         returns (uint256 tokenId, uint128 liquidity, uint256 amount0, uint256 amount1)

535:         returns (uint128 liquidity, uint256 amount0, uint256 amount1)

707:         returns (uint256 tokenId, uint128 liquidity, uint256 added0, uint256 added1)

737:         returns (uint128 liquidity, uint256 added0, uint256 added1)

879:         uint128 liquidity,

892:     function _collectFees(uint256 tokenId, IERC20 token0, IERC20 token1, uint128 collectAmount0, uint128 collectAmount1)

892:     function _collectFees(uint256 tokenId, IERC20 token0, IERC20 token1, uint128 collectAmount0, uint128 collectAmount1)

```
*Github:* [[22](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L22), [25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L25), [26](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L26), [67](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L67), [68](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L68), [74](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L74), [98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L98), [116](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L116), [133](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L133), [134](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L134), [135](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L135), [136](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L136), [137](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L137), [138](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L138), [470](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L470), [535](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L535), [707](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L707), [737](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L737), [879](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L879), [892](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L892), [892](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L892)]


</details>


<a name="GAS-53"></a> 
### [GAS-53] Functions guaranteed to revert when called by normal users can be marked `payable`
If a function modifier such as `onlyOwner` is used, the function will revert if a normal user tries to pay the function. Marking the function as `payable` will lower the gas cost for legitimate callers because the compiler will not include checks for whether a payment was provided.

<details>
<summary>
There are <b>12</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

185:     function setMaxPoolPriceDifference(uint16 _maxPoolPriceDifference) external onlyOwner {

265:     function setEmergencyAdmin(address admin) external onlyOwner {

```
*Github:* [[185](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L185), [265](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L265)]


```solidity
File: src/V3Vault.sol

765:     function withdrawReserves(uint256 amount, address receiver) external onlyOwner {

788:     function setTransformer(address transformer, bool active) external onlyOwner {

837:     function setReserveFactor(uint32 _reserveFactorX32) external onlyOwner {

844:     function setReserveProtectionFactor(uint32 _reserveProtectionFactorX32) external onlyOwner {

870:     function setEmergencyAdmin(address admin) external onlyOwner {

```
*Github:* [[765](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L765), [788](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L788), [837](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L837), [844](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L844), [870](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L870)]


```solidity
File: src/automators/Automator.sol

59:     function setWithdrawer(address _withdrawer) public onlyOwner {

69:     function setOperator(address _operator, bool _active) public onlyOwner {

79:     function setVault(address _vault, bool _active) public onlyOwner {

87:     function setTWAPConfig(uint16 _maxTWAPTickDifference, uint32 _TWAPSeconds) public onlyOwner {

```
*Github:* [[59](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L59), [69](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L69), [79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L79), [87](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L87)]


```solidity
File: src/transformers/AutoCompound.sol

243:     function setReward(uint64 _totalRewardX64) external onlyOwner {

```
*Github:* [[243](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L243)]


</details>


<a name="GAS-54"></a> 
### [GAS-54] Using `private` rather than `public` for constants, saves gas
If needed, the values can be read from the verified contract source code, or if there are multiple values there can be a single getter function that [returns a tuple](https://github.com/code-423n4/2022-08-frax/blob/90f55a9ce4e25bceed3a74290b854341d8de6afa/src/contracts/FraxlendPair.sol#L156-L178) of the values of all currently-public constants. Saves **3406-3606 gas** in deployment gas due to the compiler not having to create non-payable getter functions for deployment calldata, not having to store the bytes of the value outside of where it's used, and not adding another entry to the method ID table

<details>
<summary>
There are <b>13</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

13:     uint256 public constant YEAR_SECS = 31557600; // taking into account leap years

15:     uint256 public constant MAX_BASE_RATE_X96 = Q96 / 10; // 10%

16:     uint256 public constant MAX_MULTIPLIER_X96 = Q96 * 2; // 200%

```
*Github:* [[13](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L13), [15](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L15), [16](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L16)]


```solidity
File: src/V3Oracle.sol

25:     uint16 public constant MIN_PRICE_DIFFERENCE = 200; //2%

```
*Github:* [[25](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L25)]


```solidity
File: src/V3Vault.sol

36:     uint32 public constant MAX_COLLATERAL_FACTOR_X32 = uint32(Q32 * 90 / 100); // 90%

38:     uint32 public constant MIN_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 2 / 100); // 2%

39:     uint32 public constant MAX_LIQUIDATION_PENALTY_X32 = uint32(Q32 * 10 / 100); // 10%

41:     uint32 public constant MIN_RESERVE_PROTECTION_FACTOR_X32 = uint32(Q32 / 100); //1%

43:     uint32 public constant MAX_DAILY_LEND_INCREASE_X32 = uint32(Q32 / 10); //10%

44:     uint32 public constant MAX_DAILY_DEBT_INCREASE_X32 = uint32(Q32 / 10); //10%

```
*Github:* [[36](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L36), [38](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L38), [39](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L39), [41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L41), [43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L43), [44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L44)]


```solidity
File: src/automators/Automator.sol

23:     uint32 public constant MIN_TWAP_SECONDS = 60; // 1 minute

24:     uint32 public constant MAX_TWAP_TICK_DIFFERENCE = 200; // 2%

```
*Github:* [[23](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L23), [24](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L24)]


```solidity
File: src/transformers/AutoCompound.sol

47:     uint64 public constant MAX_REWARD_X64 = uint64(Q64 / 50); // 2%

```
*Github:* [[47](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L47)]


</details>


<a name="GAS-55"></a> 
### [GAS-55] Use assembly to check for `address(0)`
Saves 6 gas per instance.

*There are <b>6</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

791:             transformer == address(0) || transformer == address(this) || transformer == asset

```
*Github:* [[791](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L791)]


```solidity
File: src/automators/Automator.sol

236:         if (vault != address(0)) {

```
*Github:* [[236](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L236)]


```solidity
File: src/transformers/V3Utils.sol

342:             if (targetAmount != 0 && instructions.targetToken != address(0)) {

697:             amountOther > amountAddedOther && address(otherToken) != address(0) && token0 != otherToken

805:         } else if (address(params.swapSourceToken) != address(0)) {

```
*Github:* [[342](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L342), [697](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L697), [805](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L805)]


```solidity
File: src/utils/Swapper.sol

77:         if (params.amountIn != 0 && params.swapData.length != 0 && address(params.tokenOut) != address(0)) {

```
*Github:* [[77](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L77)]



<a name="GAS-56"></a> 
### [GAS-56] Avoid updating storage when the value hasn't changed
In Ethereum, updating storage is costly in terms of gas. Therefore, it's beneficial to avoid redundant updates, particularly when the value being written is identical to the existing one. A comparison check before updating can prevent unnecessary operations, thus saving gas. The resolution could involve implementing a conditional check in your function to verify if the new value differs from the current one. If it's the same, the function could simply return without proceeding to the costly storage update. This simple adjustment in your code can lead to significant gas savings in scenarios where redundant updates might occur frequently.

<details>
<summary>
There are <b>70</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

95:         baseRatePerSecondX96 = baseRatePerYearX96 / YEAR_SECS;

96:         multiplierPerSecondX96 = multiplierPerYearX96 / YEAR_SECS;

97:         jumpMultiplierPerSecondX96 = jumpMultiplierPerYearX96 / YEAR_SECS;

98:         kinkX96 = _kinkX96;

```
*Github:* [[95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L95), [96](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L96), [97](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L97), [98](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L98)]


```solidity
File: src/V3Oracle.sol

79:         nonfungiblePositionManager = _nonfungiblePositionManager;

80:         factory = _nonfungiblePositionManager.factory();

81:         referenceToken = _referenceToken;

82:         referenceTokenDecimals = IERC20Metadata(_referenceToken).decimals();

83:         chainlinkReferenceToken = _chainlinkReferenceToken;

189:         maxPoolPriceDifference = _maxPoolPriceDifference;

240:         feedConfigs[token] = config;

266:         emergencyAdmin = admin;

```
*Github:* [[79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L79), [80](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L80), [81](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L81), [82](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L82), [83](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L83), [189](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L189), [240](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L240), [266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L266)]


```solidity
File: src/V3Vault.sol

178:         asset = _asset;

179:         assetDecimals = IERC20Metadata(_asset).decimals();

180:         nonfungiblePositionManager = _nonfungiblePositionManager;

181:         factory = IUniswapV3Factory(_nonfungiblePositionManager.factory());

182:         interestRateModel = _interestRateModel;

183:         oracle = _oracle;

184:         permit2 = _permit2;

446:             loans[tokenId] = Loan(0);

458:                 transformedTokenId = tokenId;

461:                 loans[tokenId] = Loan(loans[oldTokenId].debtShares);

508:         transformedTokenId = tokenId;

542:         transformedTokenId = 0;

569:         debtSharesTotal += shares;

577:             dailyDebtIncreaseLimitLeft -= assets;

731:         debtSharesTotal -= debtShares;

797:         transformerAllowList[transformer] = active;

818:         minLoanSize = _minLoanSize;

819:         globalLendLimit = _globalLendLimit;

820:         globalDebtLimit = _globalDebtLimit;

821:         dailyLendIncreaseLimitMin = _dailyLendIncreaseLimitMin;

822:         dailyDebtIncreaseLimitMin = _dailyDebtIncreaseLimitMin;

838:         reserveFactorX32 = _reserveFactorX32;

848:         reserveProtectionFactorX32 = _reserveProtectionFactorX32;

871:         emergencyAdmin = admin;

913:             dailyLendIncreaseLimitLeft -= assets;

949:         dailyLendIncreaseLimitLeft += assets;

992:         debtSharesTotal -= shares;

995:         dailyDebtIncreaseLimitLeft += assets;

1138:             lastLendExchangeRateX96 = newLendExchangeRateX96;

1157:             lastDebtExchangeRateX96 = newDebtExchangeRateX96;

1158:             lastLendExchangeRateX96 = newLendExchangeRateX96;

1159:             lastExchangeRateUpdate = block.timestamp;

1252:             dailyLendIncreaseLimitLeft =

1254:             dailyLendIncreaseLimitLastReset = time;

1264:             dailyDebtIncreaseLimitLeft =

1266:             dailyDebtIncreaseLimitLastReset = time;

1298:         ownedTokensIndex[tokenId] = ownedTokens[to].length;

1300:         tokenOwner[tokenId] = to;

1308:             ownedTokens[from][tokenIndex] = lastTokenId;

1309:             ownedTokensIndex[lastTokenId] = tokenIndex;

```
*Github:* [[178](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L178), [179](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L179), [180](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L180), [181](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L181), [182](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L182), [183](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L183), [184](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L184), [446](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L446), [458](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L458), [461](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L461), [508](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L508), [542](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L542), [569](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L569), [577](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L577), [731](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L731), [797](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L797), [818](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L818), [819](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L819), [820](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L820), [821](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L821), [822](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L822), [838](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L838), [848](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L848), [871](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L871), [913](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L913), [949](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L949), [992](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L992), [995](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L995), [1138](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1138), [1157](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1157), [1158](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1158), [1159](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1159), [1252](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1252), [1254](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1254), [1264](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1264), [1266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1266), [1298](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1298), [1300](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1300), [1308](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1308), [1309](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1309)]


```solidity
File: src/automators/AutoExit.sol

230:         positionConfigs[tokenId] = config;

```
*Github:* [[230](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L230)]


```solidity
File: src/automators/Automator.sol

61:         withdrawer = _withdrawer;

71:         operators[_operator] = _active;

81:         vaults[_vault] = _active;

95:         TWAPSeconds = _TWAPSeconds;

96:         maxTWAPTickDifference = _maxTWAPTickDifference;

```
*Github:* [[61](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L61), [71](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L71), [81](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L81), [95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L95), [96](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L96)]


```solidity
File: src/transformers/AutoCompound.sol

245:         totalRewardX64 = _totalRewardX64;

250:         positionBalances[tokenId][token] = positionBalances[tokenId][token] + amount;

257:             positionBalances[tokenId][token] = amount;

270:         positionBalances[tokenId][token] = positionBalances[tokenId][token] - amount;

```
*Github:* [[245](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L245), [250](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L250), [257](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L257), [270](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L270)]


```solidity
File: src/transformers/AutoRange.sol

251:             positionConfigs[state.newTokenId] = config;

284:         positionConfigs[tokenId] = config;

```
*Github:* [[251](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L251), [284](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L284)]


```solidity
File: src/transformers/V3Utils.sol

37:         permit2 = IPermit2(_permit2);

```
*Github:* [[37](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L37)]


```solidity
File: src/utils/Swapper.sol

42:         weth = IWETH9(_nonfungiblePositionManager.WETH9());

43:         factory = _nonfungiblePositionManager.factory();

44:         nonfungiblePositionManager = _nonfungiblePositionManager;

45:         zeroxRouter = _zeroxRouter;

46:         universalRouter = _universalRouter;

```
*Github:* [[42](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L42), [43](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L43), [44](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L44), [45](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L45), [46](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L46)]


</details>


<a name="GAS-57"></a> 
### [GAS-57] Cache address(this) when used more than once

<details>
<summary>
There are <b>14</b> instances (click to show):
</summary>

```solidity
File: src/V3Vault.sol

/// @audit `address(this)` is used more than once in this function
424:         nonfungiblePositionManager.safeTransferFrom(owner, address(this), tokenId, abi.encode(recipient));

/// @audit `address(this)` is used more than once in this function
728:             SafeERC20.safeTransferFrom(IERC20(asset), msg.sender, address(this), state.liquidatorCost);

/// @audit `address(this)` is used more than once in this function
901:             SafeERC20.safeTransferFrom(IERC20(asset), msg.sender, address(this), assets);

/// @audit `address(this)` is used more than once in this function
986:                 SafeERC20.safeTransferFrom(IERC20(asset), msg.sender, address(this), assets);

```
*Github:* [[424](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L424), [728](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L728), [901](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L901), [986](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L986)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit `address(this)` is used more than once in this function
282:         uint256 allowance1 = IERC20(token1).allowance(address(this), address(nonfungiblePositionManager));

```
*Github:* [[282](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L282)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `address(this)` is used more than once in this function
232:             nonfungiblePositionManager.safeTransferFrom(address(this), state.owner, state.newTokenId);

```
*Github:* [[232](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L232)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit `address(this)` is used more than once in this function
376:         nonfungiblePositionManager.safeTransferFrom(address(this), from, tokenId, instructions.returnData);

/// @audit `address(this)` is used more than once in this function
584:             SafeERC20.safeTransferFrom(otherToken, msg.sender, address(this), neededOther);

/// @audit `address(this)` is used more than once in this function
645:             if (otherToken.balanceOf(address(this)) - state.balanceBeforeOther != state.neededOther) {

/// @audit `address(this)` is used more than once in this function
727:         nonfungiblePositionManager.safeTransferFrom(address(this), params.recipientNFT, tokenId, params.returnData);

/// @audit `address(this)` is used more than once in this function
902:         uint256 balanceAfter1 = token1.balanceOf(address(this));

```
*Github:* [[376](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L376), [584](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L584), [645](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L645), [727](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L727), [902](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L902)]


```solidity
File: src/utils/FlashloanLiquidator.sol

/// @audit `address(this)` is used more than once in this function
101:             uint256 balance = data.asset.balanceOf(address(this));

```
*Github:* [[101](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L101)]


```solidity
File: src/utils/Swapper.sol

/// @audit `address(this)` is used more than once in this function
105:             uint256 balanceOutAfter = params.tokenOut.balanceOf(address(this));

/// @audit `address(this)` is used more than once in this function
105:             uint256 balanceOutAfter = params.tokenOut.balanceOf(address(this));

```
*Github:* [[105](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L105), [105](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L105)]


</details>


<a name="GAS-58"></a> 
### [GAS-58] Unnecessary casting as variable is already of the same type
Unnecessary casting of a variable to the same type is redundant and can contribute to gas inefficiency and code clutter. This situation commonly arises when developers, perhaps due to oversight or misunderstanding, explicitly cast a variable to its existing type. For example, casting a uint256 variable to uint256 again does not change its type or value but adds unnecessary operations to the code.

Resolution: Developers should scrutinize their code to identify and remove any unnecessary type casting. Utilizing linters or static analysis tools can aid in detecting such redundancies. Ensuring that the code is clean and efficient not only saves gas but also enhances readability and maintainability.

<details>
<summary>
There are <b>16</b> instances (click to show):
</summary>

```solidity
File: src/V3Oracle.sol

/// @audit no need to cast `answer` into int256
342:         return uint256(answer) * Q96 / (10 ** feedConfig.feedDecimals);

```
*Github:* [[342](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L342)]


```solidity
File: src/V3Vault.sol

/// @audit no need to cast `asset` into address
1275:         (fullValue, feeValue,,) = oracle.getValue(tokenId, address(asset));

```
*Github:* [[1275](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L1275)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit no need to cast `token0` into address
669:             if (address(weth) == address(token0)) {

/// @audit no need to cast `token0` into address
669:             if (address(weth) == address(token0)) {

/// @audit no need to cast `token1` into address
674:             } else if (address(weth) == address(token1)) {

/// @audit no need to cast `token1` into address
674:             } else if (address(weth) == address(token1)) {

/// @audit no need to cast `token` into address
865:         if (address(weth) == address(token) && unwrap) {

```
*Github:* [[669](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L669), [669](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L669), [674](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L674), [674](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L674), [865](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L865)]


```solidity
File: src/utils/Swapper.sol

/// @audit no need to cast `amount0Delta` into int256
145:             amountInDelta = params.swap0For1 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `amount1Delta` into int256
145:             amountInDelta = params.swap0For1 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `amount0Delta` into int256
145:             amountInDelta = params.swap0For1 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `amount1Delta` into int256
145:             amountInDelta = params.swap0For1 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `amount0Delta` into int256
166:         uint256 amountToPay = amount0Delta > 0 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `amount1Delta` into int256
166:         uint256 amountToPay = amount0Delta > 0 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `amount0Delta` into int256
166:         uint256 amountToPay = amount0Delta > 0 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `amount1Delta` into int256
166:         uint256 amountToPay = amount0Delta > 0 ? uint256(amount0Delta) : uint256(amount1Delta);

/// @audit no need to cast `factory` into address
172:         return IUniswapV3Pool(PoolAddress.computeAddress(address(factory), PoolAddress.getPoolKey(tokenA, tokenB, fee)));

```
*Github:* [[145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L145), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L145), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L145), [145](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L145), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L166), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L166), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L166), [166](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L166), [172](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L172)]


</details>


<a name="GAS-59"></a> 
### [GAS-59] Where a value is casted more than once, consider caching the result to save gas
Casting values multiple times in Solidity can be gas-inefficient. When a value undergoes repeated type conversions, the EVM must execute additional operations for each cast, consuming more gas than necessary. To optimize for gas efficiency, cache the result of the initial cast in a local variable and reuse it, rather than performing multiple casts. This not only conserves gas but also enhances code readability, reducing potential error points. For example, instead of repeatedly casting an address to uint256, cast once, store the result in a local variable, and reference that variable in subsequent operations.

<details>
<summary>
There are <b>42</b> instances (click to show):
</summary>

```solidity
File: src/V3Vault.sol

/// @audit `address(this)` is casted more than once in this function
424:         nonfungiblePositionManager.safeTransferFrom(owner, address(this), tokenId, abi.encode(recipient));

/// @audit `address(this)` is casted more than once in this function
722:                 ISignatureTransfer.SignatureTransferDetails(address(this), state.liquidatorCost),

/// @audit `address(this)` is casted more than once in this function
897:                 permit, ISignatureTransfer.SignatureTransferDetails(address(this), assets), msg.sender, signature

/// @audit `address(this)` is casted more than once in this function
982:                     permit, ISignatureTransfer.SignatureTransferDetails(address(this), assets), msg.sender, signature

```
*Github:* [[424](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L424), [722](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L722), [897](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L897), [982](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L982)]


```solidity
File: src/automators/Automator.sol

/// @audit `int16(maxDifference)` is casted more than once in this function
173:             return twapTick - currentTick >= -int16(maxDifference) && twapTick - currentTick <= int16(maxDifference);

```
*Github:* [[173](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L173)]


```solidity
File: src/transformers/AutoCompound.sol

/// @audit `address(nonfungiblePositionManager)` is casted more than once in this function
280:             SafeERC20.safeApprove(IERC20(token0), address(nonfungiblePositionManager), type(uint256).max);

/// @audit `address(this)` is casted more than once in this function
282:         uint256 allowance1 = IERC20(token1).allowance(address(this), address(nonfungiblePositionManager));

/// @audit `address(nonfungiblePositionManager)` is casted more than once in this function
282:         uint256 allowance1 = IERC20(token1).allowance(address(this), address(nonfungiblePositionManager));

/// @audit `address(nonfungiblePositionManager)` is casted more than once in this function
284:             SafeERC20.safeApprove(IERC20(token1), address(nonfungiblePositionManager), type(uint256).max);

```
*Github:* [[280](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L280), [282](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L282), [282](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L282), [284](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L284)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `address(nonfungiblePositionManager)` is casted more than once in this function
214:             SafeERC20.safeApprove(IERC20(state.token1), address(nonfungiblePositionManager), state.maxAddAmount1);

/// @audit `address(nonfungiblePositionManager)` is casted more than once in this function
220:             SafeERC20.safeApprove(IERC20(state.token0), address(nonfungiblePositionManager), 0);

/// @audit `address(nonfungiblePositionManager)` is casted more than once in this function
221:             SafeERC20.safeApprove(IERC20(state.token1), address(nonfungiblePositionManager), 0);

/// @audit `address(this)` is casted more than once in this function
232:             nonfungiblePositionManager.safeTransferFrom(address(this), state.owner, state.newTokenId);

```
*Github:* [[214](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L214), [220](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L220), [221](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L221), [232](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L232)]


```solidity
File: src/transformers/LeverageTransformer.sol

/// @audit `address(nonfungiblePositionManager)` is casted more than once in this function
78:         SafeERC20.safeIncreaseAllowance(IERC20(token1), address(nonfungiblePositionManager), amount1);

```
*Github:* [[78](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/LeverageTransformer.sol#L78)]


```solidity
File: src/transformers/V3Utils.sol

/// @audit `address(this)` is casted more than once in this function
376:         nonfungiblePositionManager.safeTransferFrom(address(this), from, tokenId, instructions.returnData);

/// @audit `address(this)` is casted more than once in this function
581:             SafeERC20.safeTransferFrom(token1, msg.sender, address(this), needed1);

/// @audit `address(this)` is casted more than once in this function
584:             SafeERC20.safeTransferFrom(otherToken, msg.sender, address(this), neededOther);

/// @audit `address(this)` is casted more than once in this function
619:             transferDetails[state.i++] = ISignatureTransfer.SignatureTransferDetails(address(this), state.needed0);

/// @audit `address(this)` is casted more than once in this function
622:             state.balanceBefore1 = token1.balanceOf(address(this));

/// @audit `address(this)` is casted more than once in this function
623:             transferDetails[state.i++] = ISignatureTransfer.SignatureTransferDetails(address(this), state.needed1);

/// @audit `address(this)` is casted more than once in this function
626:             state.balanceBeforeOther = otherToken.balanceOf(address(this));

/// @audit `address(this)` is casted more than once in this function
627:             transferDetails[state.i++] = ISignatureTransfer.SignatureTransferDetails(address(this), state.neededOther);

/// @audit `address(this)` is casted more than once in this function
635:             if (token0.balanceOf(address(this)) - state.balanceBefore0 != state.needed0) {

/// @audit `address(this)` is casted more than once in this function
640:             if (token1.balanceOf(address(this)) - state.balanceBefore1 != state.needed1) {

/// @audit `address(this)` is casted more than once in this function
645:             if (otherToken.balanceOf(address(this)) - state.balanceBeforeOther != state.neededOther) {

/// @audit `address(weth)` is casted more than once in this function
674:             } else if (address(weth) == address(token1)) {

/// @audit `address(weth)` is casted more than once in this function
679:             } else if (address(weth) == address(otherToken)) {

/// @audit `address(otherToken)` is casted more than once in this function
697:             amountOther > amountAddedOther && address(otherToken) != address(0) && token0 != otherToken

/// @audit `address(this)` is casted more than once in this function
727:         nonfungiblePositionManager.safeTransferFrom(address(this), params.recipientNFT, tokenId, params.returnData);

/// @audit `address(nonfungiblePositionManager)` is casted more than once in this function
832:             SafeERC20.safeApprove(params.token0, address(nonfungiblePositionManager), total0);

/// @audit `address(nonfungiblePositionManager)` is casted more than once in this function
835:             SafeERC20.safeApprove(params.token1, address(nonfungiblePositionManager), 0);

/// @audit `address(nonfungiblePositionManager)` is casted more than once in this function
836:             SafeERC20.safeApprove(params.token1, address(nonfungiblePositionManager), total1);

/// @audit `address(this)` is casted more than once in this function
897:         uint256 balanceBefore1 = token1.balanceOf(address(this));

/// @audit `address(this)` is casted more than once in this function
899:             INonfungiblePositionManager.CollectParams(tokenId, address(this), collectAmount0, collectAmount1)

/// @audit `address(this)` is casted more than once in this function
901:         uint256 balanceAfter0 = token0.balanceOf(address(this));

/// @audit `address(this)` is casted more than once in this function
902:         uint256 balanceAfter1 = token1.balanceOf(address(this));

```
*Github:* [[376](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L376), [581](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L581), [584](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L584), [619](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L619), [622](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L622), [623](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L623), [626](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L626), [627](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L627), [635](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L635), [640](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L640), [645](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L645), [674](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L674), [679](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L679), [697](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L697), [727](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L727), [832](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L832), [835](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L835), [836](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L836), [897](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L897), [899](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L899), [901](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L901), [902](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L902)]


```solidity
File: src/utils/FlashloanLiquidator.sol

/// @audit `address(this)` is casted more than once in this function
89:             uint256 balance = data.swap0.tokenIn.balanceOf(address(this));

/// @audit `address(this)` is casted more than once in this function
95:             uint256 balance = data.swap1.tokenIn.balanceOf(address(this));

/// @audit `address(this)` is casted more than once in this function
101:             uint256 balance = data.asset.balanceOf(address(this));

```
*Github:* [[89](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L89), [95](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L95), [101](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/FlashloanLiquidator.sol#L101)]


```solidity
File: src/utils/Swapper.sol

/// @audit `address(this)` is casted more than once in this function
79:             uint256 balanceOutBefore = params.tokenOut.balanceOf(address(this));

/// @audit `address(this)` is casted more than once in this function
104:             uint256 balanceInAfter = params.tokenIn.balanceOf(address(this));

/// @audit `address(this)` is casted more than once in this function
105:             uint256 balanceOutAfter = params.tokenOut.balanceOf(address(this));

```
*Github:* [[79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L79), [104](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L104), [105](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/utils/Swapper.sol#L105)]


</details>


<a name="GAS-60"></a> 
### [GAS-60] Constants are cheaper than Enums
Using constants instead of enums in Solidity can lead to gas savings. Constants, particularly for primitive data types like `uint` or `bool`, are directly substituted by the Solidity compiler at compile time, effectively hardcoding their values into the bytecode. This means that accessing a constant does not incur any runtime gas costs, as no storage or memory access is needed. In contrast, enums, while useful for readability and ensuring valid value ranges, are stored in contract storage or memory, incurring gas costs for reads and writes. For scenarios where an enum's value range aligns with a simple constant (like true/false or small integer ranges), substituting with constants can be a more gas-efficient choice.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

35:     enum Mode {

```
*Github:* [[35](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L35)]


```solidity
File: src/transformers/V3Utils.sol

41:     enum WhatToDo {

```
*Github:* [[41](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L41)]



<a name="GAS-61"></a> 
### [GAS-61] It is a waste of GAS to emit variable literals
Emitting variable literals (true, false, 'hello', 1 etc...) in events is inefficient, as it consumes extra gas without providing added value. These literals are fixed values that can be accessed or hardcoded elsewhere in the smart contract or application, making their inclusion in events redundant and an unnecessary drain on resources during transaction execution.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/V3Vault.sol

/// @audit `0`
449:             emit Add(tokenId, owner, 0);

```
*Github:* [[449](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L449)]


```solidity
File: src/automators/AutoExit.sol

/// @audit `false`
/// @audit `false`
/// @audit `false`
/// @audit `0`
/// @audit `0`
/// @audit `0`
/// @audit `0`
/// @audit `false`
/// @audit `0`
208:         emit PositionConfigured(params.tokenId, false, false, false, 0, 0, 0, 0, false, 0);

```
*Github:* [[208](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L208)]


```solidity
File: src/transformers/AutoRange.sol

/// @audit `0`
/// @audit `0`
/// @audit `0`
/// @audit `0`
/// @audit `0`
/// @audit `0`
/// @audit `false`
/// @audit `0`
266:             emit PositionConfigured(params.tokenId, 0, 0, 0, 0, 0, 0, false, 0);

```
*Github:* [[266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L266)]



<a name="GAS-62"></a> 
### [GAS-62] Merge events to save gas
Consolidating multiple event emissions into a single event in Solidity can result in significant gas savings. Each event emission in Ethereum involves a gas cost, specifically for the topics logged with the event. By merging sequential events into a singular event, you can save on the Glogtopic cost, which is incurred for each topic of each event. This approach can save around 375 gas per additional topic. This strategy is particularly beneficial in functions where multiple related events are emitted in sequence. However, it's crucial to balance gas optimization with the clarity and utility of the event data for off-chain consumers.

*There are <b>7</b> instances of this issue:*
```solidity
File: src/V3Oracle.sol

201:     function setTokenConfig(
             address token,
             AggregatorV3Interface feed,
             uint32 maxFeedAge,
             IUniswapV3Pool pool,
             uint32 twapSeconds,
             Mode mode,
             uint16 maxDifference
         ) external onlyOwner {
             // can not be unset
             if (mode == Mode.NOT_SET) {
                 revert InvalidConfig();
             }
     
             uint8 feedDecimals = feed.decimals();
             uint8 tokenDecimals = IERC20Metadata(token).decimals();
     
             TokenConfig memory config;
     
             if (token != referenceToken) {
                 if (maxDifference < MIN_PRICE_DIFFERENCE) {
                     revert InvalidConfig();
                 }
     
                 address token0 = pool.token0();
                 address token1 = pool.token1();
                 if (!(token0 == token && token1 == referenceToken || token0 == referenceToken && token1 == token)) {
                     revert InvalidPool();
                 }
                 bool isToken0 = token0 == token;
                 config = TokenConfig(
                     feed, maxFeedAge, feedDecimals, tokenDecimals, pool, isToken0, twapSeconds, mode, maxDifference
                 );
             } else {
                 config = TokenConfig(
                     feed, maxFeedAge, feedDecimals, tokenDecimals, IUniswapV3Pool(address(0)), false, 0, Mode.CHAINLINK, 0
                 );
             }
     
             feedConfigs[token] = config;
     
             emit TokenConfigUpdated(token, config);
             emit OracleModeUpdated(token, mode);

```
*Github:* [[201](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L201)]


```solidity
File: src/V3Vault.sol

429:     function onERC721Received(address, address from, uint256 tokenId, bytes calldata data)
             external
             override
             returns (bytes4)
         {
             // only Uniswap v3 NFTs allowed - sent from other contract
             if (msg.sender != address(nonfungiblePositionManager) || from == address(this)) {
                 revert WrongContract();
             }
     
             (uint256 debtExchangeRateX96, uint256 lendExchangeRateX96) = _updateGlobalInterest();
     
             if (transformedTokenId == 0) {
                 address owner = from;
                 if (data.length > 0) {
                     owner = abi.decode(data, (address));
                 }
                 loans[tokenId] = Loan(0);
     
                 _addTokenToOwner(owner, tokenId);
                 emit Add(tokenId, owner, 0);

```
*Github:* [[429](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L429)]


```solidity
File: src/automators/AutoExit.sol

100:     function execute(ExecuteParams calldata params) external {
             if (!operators[msg.sender]) {
                 revert Unauthorized();
             }
     
             ExecuteState memory state;
             PositionConfig memory config = positionConfigs[params.tokenId];
     
             if (!config.isActive) {
                 revert NotConfigured();
             }
     
             if (
                 config.onlyFees && params.rewardX64 > config.maxRewardX64
                     || !config.onlyFees && params.rewardX64 > config.maxRewardX64
             ) {
                 revert ExceedsMaxReward();
             }
     
             // get position info
             (,, state.token0, state.token1, state.fee, state.tickLower, state.tickUpper, state.liquidity,,,,) =
                 nonfungiblePositionManager.positions(params.tokenId);
     
             // so can be executed only once
             if (state.liquidity == 0) {
                 revert NoLiquidity();
             }
             if (state.liquidity != params.liquidity) {
                 revert LiquidityChanged();
             }
     
             state.pool = _getPool(state.token0, state.token1, state.fee);
             (, state.tick,,,,,) = state.pool.slot0();
     
             // not triggered
             if (config.token0TriggerTick <= state.tick && state.tick < config.token1TriggerTick) {
                 revert NotReady();
             }
     
             state.isAbove = state.tick >= config.token1TriggerTick;
             state.isSwap = !state.isAbove && config.token0Swap || state.isAbove && config.token1Swap;
     
             // decrease full liquidity for given position - and return fees as well
             (state.amount0, state.amount1, state.feeAmount0, state.feeAmount1) = _decreaseFullLiquidityAndCollect(
                 params.tokenId, state.liquidity, params.amountRemoveMin0, params.amountRemoveMin1, params.deadline
             );
     
             // swap to other token
             if (state.isSwap) {
                 if (params.swapData.length == 0) {
                     revert MissingSwapData();
                 }
     
                 // reward is taken before swap - if from fees only
                 if (config.onlyFees) {
                     state.amount0 -= state.feeAmount0 * params.rewardX64 / Q64;
                     state.amount1 -= state.feeAmount1 * params.rewardX64 / Q64;
                 }
     
                 state.swapAmount = state.isAbove ? state.amount1 : state.amount0;
     
                 // checks if price in valid oracle range and calculates amountOutMin
                 (state.amountOutMin,,,) = _validateSwap(
                     !state.isAbove,
                     state.swapAmount,
                     state.pool,
                     TWAPSeconds,
                     maxTWAPTickDifference,
                     state.isAbove ? config.token1SlippageX64 : config.token0SlippageX64
                 );
     
                 (state.amountInDelta, state.amountOutDelta) = _routerSwap(
                     Swapper.RouterSwapParams(
                         state.isAbove ? IERC20(state.token1) : IERC20(state.token0),
                         state.isAbove ? IERC20(state.token0) : IERC20(state.token1),
                         state.swapAmount,
                         state.amountOutMin,
                         params.swapData
                     )
                 );
     
                 state.amount0 = state.isAbove ? state.amount0 + state.amountOutDelta : state.amount0 - state.amountInDelta;
                 state.amount1 = state.isAbove ? state.amount1 - state.amountInDelta : state.amount1 + state.amountOutDelta;
     
                 // when swap and !onlyFees - protocol reward is removed only from target token (to incentivize optimal swap done by operator)
                 if (!config.onlyFees) {
                     if (state.isAbove) {
                         state.amount0 -= state.amount0 * params.rewardX64 / Q64;
                     } else {
                         state.amount1 -= state.amount1 * params.rewardX64 / Q64;
                     }
                 }
             } else {
                 // reward is taken as configured
                 state.amount0 -= (config.onlyFees ? state.feeAmount0 : state.amount0) * params.rewardX64 / Q64;
                 state.amount1 -= (config.onlyFees ? state.feeAmount1 : state.amount1) * params.rewardX64 / Q64;
             }
     
             state.owner = nonfungiblePositionManager.ownerOf(params.tokenId);
             if (state.amount0 > 0) {
                 _transferToken(state.owner, IERC20(state.token0), state.amount0, true);
             }
             if (state.amount1 > 0) {
                 _transferToken(state.owner, IERC20(state.token1), state.amount1, true);
             }
     
             // delete config for position
             delete positionConfigs[params.tokenId];
             emit PositionConfigured(params.tokenId, false, false, false, 0, 0, 0, 0, false, 0);
     
             // log event
             emit Executed(

```
*Github:* [[100](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/AutoExit.sol#L100)]


```solidity
File: src/transformers/AutoCompound.sol

254:     function _setBalance(uint256 tokenId, address token, uint256 amount) internal {
             uint256 currentBalance = positionBalances[tokenId][token];
             if (amount != currentBalance) {
                 positionBalances[tokenId][token] = amount;
                 if (amount > currentBalance) {
                     emit BalanceAdded(tokenId, token, amount - currentBalance);

266:     function _withdrawBalanceInternal(uint256 tokenId, address token, address to, uint256 balance, uint256 amount)
             internal
         {
             require(amount <= balance, "amount>balance");
             positionBalances[tokenId][token] = positionBalances[tokenId][token] - amount;
             emit BalanceRemoved(tokenId, token, amount);
             SafeERC20.safeTransfer(IERC20(token), to, amount);
             emit BalanceWithdrawn(tokenId, token, to, amount);

```
*Github:* [[254](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L254), [266](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L266)]


```solidity
File: src/transformers/AutoRange.sol

111:     function execute(ExecuteParams calldata params) external {
             if (!operators[msg.sender] && !vaults[msg.sender]) {
                 revert Unauthorized();
             }
             ExecuteState memory state;
             PositionConfig memory config = positionConfigs[params.tokenId];
     
             if (config.lowerTickDelta == config.upperTickDelta) {
                 revert NotConfigured();
             }
     
             if (
                 config.onlyFees && params.rewardX64 > config.maxRewardX64
                     || !config.onlyFees && params.rewardX64 > config.maxRewardX64
             ) {
                 revert ExceedsMaxReward();
             }
     
             // get position info
             (,, state.token0, state.token1, state.fee, state.tickLower, state.tickUpper, state.liquidity,,,,) =
                 nonfungiblePositionManager.positions(params.tokenId);
     
             if (state.liquidity != params.liquidity) {
                 revert LiquidityChanged();
             }
     
             (state.amount0, state.amount1, state.feeAmount0, state.feeAmount1) = _decreaseFullLiquidityAndCollect(
                 params.tokenId, state.liquidity, params.amountRemoveMin0, params.amountRemoveMin1, params.deadline
             );
     
             // if only fees reward is removed before adding
             if (config.onlyFees) {
                 state.protocolReward0 = state.feeAmount0 * params.rewardX64 / Q64;
                 state.protocolReward1 = state.feeAmount1 * params.rewardX64 / Q64;
                 state.amount0 -= state.protocolReward0;
                 state.amount1 -= state.protocolReward1;
             }
     
             if (params.swap0To1 && params.amountIn > state.amount0 || !params.swap0To1 && params.amountIn > state.amount1) {
                 revert SwapAmountTooLarge();
             }
     
             // get pool info
             state.pool = _getPool(state.token0, state.token1, state.fee);
     
             // check oracle for swap
             (state.amountOutMin, state.currentTick,,) = _validateSwap(
                 params.swap0To1,
                 params.amountIn,
                 state.pool,
                 TWAPSeconds,
                 maxTWAPTickDifference,
                 params.swap0To1 ? config.token0SlippageX64 : config.token1SlippageX64
             );
     
             if (
                 state.currentTick < state.tickLower - config.lowerTickLimit
                     || state.currentTick >= state.tickUpper + config.upperTickLimit
             ) {
                 int24 tickSpacing = _getTickSpacing(state.fee);
                 int24 baseTick = state.currentTick - (((state.currentTick % tickSpacing) + tickSpacing) % tickSpacing);
     
                 // check if new range same as old range
                 if (
                     baseTick + config.lowerTickDelta == state.tickLower
                         && baseTick + config.upperTickDelta == state.tickUpper
                 ) {
                     revert SameRange();
                 }
     
                 (state.amountInDelta, state.amountOutDelta) = _routerSwap(
                     Swapper.RouterSwapParams(
                         params.swap0To1 ? IERC20(state.token0) : IERC20(state.token1),
                         params.swap0To1 ? IERC20(state.token1) : IERC20(state.token0),
                         params.amountIn,
                         state.amountOutMin,
                         params.swapData
                     )
                 );
     
                 state.amount0 = params.swap0To1 ? state.amount0 - state.amountInDelta : state.amount0 + state.amountOutDelta;
                 state.amount1 = params.swap0To1 ? state.amount1 + state.amountOutDelta : state.amount1 - state.amountInDelta;
     
                 // max amount to add - removing max potential fees (if config.onlyFees - the have been removed already)
                 state.maxAddAmount0 = config.onlyFees ? state.amount0 : state.amount0 * Q64 / (params.rewardX64 + Q64);
                 state.maxAddAmount1 = config.onlyFees ? state.amount1 : state.amount1 * Q64 / (params.rewardX64 + Q64);
     
                 INonfungiblePositionManager.MintParams memory mintParams = INonfungiblePositionManager.MintParams(
                     address(state.token0),
                     address(state.token1),
                     state.fee,
                     SafeCast.toInt24(baseTick + config.lowerTickDelta), // reverts if out of valid range
                     SafeCast.toInt24(baseTick + config.upperTickDelta), // reverts if out of valid range
                     state.maxAddAmount0,
                     state.maxAddAmount1,
                     0,
                     0,
                     address(this), // is sent to real recipient aftwards
                     params.deadline
                 );
     
                 // approve npm
                 SafeERC20.safeApprove(IERC20(state.token0), address(nonfungiblePositionManager), state.maxAddAmount0);
                 SafeERC20.safeApprove(IERC20(state.token1), address(nonfungiblePositionManager), state.maxAddAmount1);
     
                 // mint is done to address(this) first - its not a safemint
                 (state.newTokenId,, state.amountAdded0, state.amountAdded1) = nonfungiblePositionManager.mint(mintParams);
     
                 // remove remaining approval
                 SafeERC20.safeApprove(IERC20(state.token0), address(nonfungiblePositionManager), 0);
                 SafeERC20.safeApprove(IERC20(state.token1), address(nonfungiblePositionManager), 0);
     
                 state.owner = nonfungiblePositionManager.ownerOf(params.tokenId);
     
                 // get the real owner - if owner is vault - for sending leftover tokens
                 state.realOwner = state.owner;
                 if (vaults[state.owner]) {
                     state.realOwner = IVault(state.owner).ownerOf(params.tokenId);
                 }
     
                 // send the new nft to the owner / vault
                 nonfungiblePositionManager.safeTransferFrom(address(this), state.owner, state.newTokenId);
     
                 // protocol reward is calculated based on added amount (to incentivize optimal swap done by operator)
                 if (!config.onlyFees) {
                     state.protocolReward0 = state.amountAdded0 * params.rewardX64 / Q64;
                     state.protocolReward1 = state.amountAdded1 * params.rewardX64 / Q64;
                     state.amount0 -= state.protocolReward0;
                     state.amount1 -= state.protocolReward1;
                 }
     
                 // send leftover to real owner
                 if (state.amount0 - state.amountAdded0 > 0) {
                     _transferToken(state.realOwner, IERC20(state.token0), state.amount0 - state.amountAdded0, true);
                 }
                 if (state.amount1 - state.amountAdded1 > 0) {
                     _transferToken(state.realOwner, IERC20(state.token1), state.amount1 - state.amountAdded1, true);
                 }
     
                 // copy token config for new token
                 positionConfigs[state.newTokenId] = config;
                 emit PositionConfigured(
                     state.newTokenId,
                     config.lowerTickLimit,
                     config.upperTickLimit,
                     config.lowerTickDelta,
                     config.upperTickDelta,
                     config.token0SlippageX64,
                     config.token1SlippageX64,
                     config.onlyFees,
                     config.maxRewardX64
                 );
     
                 // delete config for old position
                 delete positionConfigs[params.tokenId];
                 emit PositionConfigured(params.tokenId, 0, 0, 0, 0, 0, 0, false, 0);
     
                 emit RangeChanged(params.tokenId, state.newTokenId);

```
*Github:* [[111](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoRange.sol#L111)]


```solidity
File: src/transformers/V3Utils.sol

115:     function execute(uint256 tokenId, Instructions memory instructions) public returns (uint256 newTokenId) {
             (,, address token0, address token1,,,, uint128 liquidity,,,,) = nonfungiblePositionManager.positions(tokenId);
     
             uint256 amount0;
             uint256 amount1;
             if (instructions.liquidity != 0) {
                 (amount0, amount1) = _decreaseLiquidity(
                     tokenId,
                     instructions.liquidity,
                     instructions.deadline,
                     instructions.amountRemoveMin0,
                     instructions.amountRemoveMin1
                 );
             }
             (amount0, amount1) = _collectFees(
                 tokenId,
                 IERC20(token0),
                 IERC20(token1),
                 instructions.feeAmount0 == type(uint128).max
                     ? type(uint128).max
                     : (amount0 + instructions.feeAmount0).toUint128(),
                 instructions.feeAmount1 == type(uint128).max
                     ? type(uint128).max
                     : (amount1 + instructions.feeAmount1).toUint128()
             );
     
             // check if enough tokens are available for swaps
             if (amount0 < instructions.amountIn0 || amount1 < instructions.amountIn1) {
                 revert AmountError();
             }
     
             if (instructions.whatToDo == WhatToDo.COMPOUND_FEES) {
                 if (instructions.targetToken == token0) {
                     (liquidity, amount0, amount1) = _swapAndIncrease(
                         SwapAndIncreaseLiquidityParams(
                             tokenId,
                             amount0,
                             amount1,
                             instructions.recipient,
                             instructions.deadline,
                             IERC20(token1),
                             instructions.amountIn1,
                             instructions.amountOut1Min,
                             instructions.swapData1,
                             0,
                             0,
                             "",
                             instructions.amountAddMin0,
                             instructions.amountAddMin1,
                             ""
                         ),
                         IERC20(token0),
                         IERC20(token1),
                         instructions.unwrap
                     );
                 } else if (instructions.targetToken == token1) {
                     (liquidity, amount0, amount1) = _swapAndIncrease(
                         SwapAndIncreaseLiquidityParams(
                             tokenId,
                             amount0,
                             amount1,
                             instructions.recipient,
                             instructions.deadline,
                             IERC20(token0),
                             0,
                             0,
                             "",
                             instructions.amountIn0,
                             instructions.amountOut0Min,
                             instructions.swapData0,
                             instructions.amountAddMin0,
                             instructions.amountAddMin1,
                             ""
                         ),
                         IERC20(token0),
                         IERC20(token1),
                         instructions.unwrap
                     );
                 } else {
                     // no swap is done here
                     (liquidity, amount0, amount1) = _swapAndIncrease(
                         SwapAndIncreaseLiquidityParams(
                             tokenId,
                             amount0,
                             amount1,
                             instructions.recipient,
                             instructions.deadline,
                             IERC20(address(0)),
                             0,
                             0,
                             "",
                             0,
                             0,
                             "",
                             instructions.amountAddMin0,
                             instructions.amountAddMin1,
                             ""
                         ),
                         IERC20(token0),
                         IERC20(token1),
                         instructions.unwrap
                     );
                 }
                 emit CompoundFees(tokenId, liquidity, amount0, amount1);

```
*Github:* [[115](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/V3Utils.sol#L115)]



<a name="GAS-63"></a> 
### [GAS-63] Only emit event in setter function if the state variable was changed
Emitting events in setter functions of smart contracts only when state variables change saves gas. This is because emitting events consumes gas, and unnecessary events, where no actual state change occurs, lead to wasteful consumption.

<details>
<summary>
There are <b>14</b> instances (click to show):
</summary>

```solidity
File: src/InterestRateModel.sol

82:     function setValues(
            uint256 baseRatePerYearX96,
            uint256 multiplierPerYearX96,
            uint256 jumpMultiplierPerYearX96,
            uint256 _kinkX96
        ) public onlyOwner {
            if (
                baseRatePerYearX96 > MAX_BASE_RATE_X96 || multiplierPerYearX96 > MAX_MULTIPLIER_X96
                    || jumpMultiplierPerYearX96 > MAX_MULTIPLIER_X96
            ) {
                revert InvalidConfig();
            }
    
            baseRatePerSecondX96 = baseRatePerYearX96 / YEAR_SECS;
            multiplierPerSecondX96 = multiplierPerYearX96 / YEAR_SECS;
            jumpMultiplierPerSecondX96 = jumpMultiplierPerYearX96 / YEAR_SECS;
            kinkX96 = _kinkX96;
    
            emit SetValues(baseRatePerYearX96, multiplierPerYearX96, jumpMultiplierPerYearX96, _kinkX96);

```
*Github:* [[82](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/InterestRateModel.sol#L82)]


```solidity
File: src/V3Oracle.sol

185:     function setMaxPoolPriceDifference(uint16 _maxPoolPriceDifference) external onlyOwner {
             if (_maxPoolPriceDifference < MIN_PRICE_DIFFERENCE) {
                 revert InvalidConfig();
             }
             maxPoolPriceDifference = _maxPoolPriceDifference;
             emit SetMaxPoolPriceDifference(_maxPoolPriceDifference);

201:     function setTokenConfig(
             address token,
             AggregatorV3Interface feed,
             uint32 maxFeedAge,
             IUniswapV3Pool pool,
             uint32 twapSeconds,
             Mode mode,
             uint16 maxDifference
         ) external onlyOwner {
             // can not be unset
             if (mode == Mode.NOT_SET) {
                 revert InvalidConfig();
             }
     
             uint8 feedDecimals = feed.decimals();
             uint8 tokenDecimals = IERC20Metadata(token).decimals();
     
             TokenConfig memory config;
     
             if (token != referenceToken) {
                 if (maxDifference < MIN_PRICE_DIFFERENCE) {
                     revert InvalidConfig();
                 }
     
                 address token0 = pool.token0();
                 address token1 = pool.token1();
                 if (!(token0 == token && token1 == referenceToken || token0 == referenceToken && token1 == token)) {
                     revert InvalidPool();
                 }
                 bool isToken0 = token0 == token;
                 config = TokenConfig(
                     feed, maxFeedAge, feedDecimals, tokenDecimals, pool, isToken0, twapSeconds, mode, maxDifference
                 );
             } else {
                 config = TokenConfig(
                     feed, maxFeedAge, feedDecimals, tokenDecimals, IUniswapV3Pool(address(0)), false, 0, Mode.CHAINLINK, 0
                 );
             }
     
             feedConfigs[token] = config;
     
             emit TokenConfigUpdated(token, config);
             emit OracleModeUpdated(token, mode);

265:     function setEmergencyAdmin(address admin) external onlyOwner {
             emergencyAdmin = admin;
             emit SetEmergencyAdmin(admin);

```
*Github:* [[185](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L185), [201](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L201), [265](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Oracle.sol#L265)]


```solidity
File: src/V3Vault.sol

788:     function setTransformer(address transformer, bool active) external onlyOwner {
             // protects protocol from owner trying to set dangerous transformer
             if (
                 transformer == address(0) || transformer == address(this) || transformer == asset
                     || transformer == address(nonfungiblePositionManager)
             ) {
                 revert InvalidConfig();
             }
     
             transformerAllowList[transformer] = active;
             emit SetTransformer(transformer, active);

807:     function setLimits(
             uint256 _minLoanSize,
             uint256 _globalLendLimit,
             uint256 _globalDebtLimit,
             uint256 _dailyLendIncreaseLimitMin,
             uint256 _dailyDebtIncreaseLimitMin
         ) external {
             if (msg.sender != emergencyAdmin && msg.sender != owner()) {
                 revert Unauthorized();
             }
     
             minLoanSize = _minLoanSize;
             globalLendLimit = _globalLendLimit;
             globalDebtLimit = _globalDebtLimit;
             dailyLendIncreaseLimitMin = _dailyLendIncreaseLimitMin;
             dailyDebtIncreaseLimitMin = _dailyDebtIncreaseLimitMin;
     
             (, uint256 newLendExchangeRateX96) = _updateGlobalInterest();
     
             // force reset daily limits with new values
             _resetDailyLendIncreaseLimit(newLendExchangeRateX96, true);
             _resetDailyDebtIncreaseLimit(newLendExchangeRateX96, true);
     
             emit SetLimits(

837:     function setReserveFactor(uint32 _reserveFactorX32) external onlyOwner {
             reserveFactorX32 = _reserveFactorX32;
             emit SetReserveFactor(_reserveFactorX32);

844:     function setReserveProtectionFactor(uint32 _reserveProtectionFactorX32) external onlyOwner {
             if (_reserveProtectionFactorX32 < MIN_RESERVE_PROTECTION_FACTOR_X32) {
                 revert InvalidConfig();
             }
             reserveProtectionFactorX32 = _reserveProtectionFactorX32;
             emit SetReserveProtectionFactor(_reserveProtectionFactorX32);

870:     function setEmergencyAdmin(address admin) external onlyOwner {
             emergencyAdmin = admin;
             emit SetEmergencyAdmin(admin);

```
*Github:* [[788](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L788), [807](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L807), [837](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L837), [844](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L844), [870](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/V3Vault.sol#L870)]


```solidity
File: src/automators/Automator.sol

59:     function setWithdrawer(address _withdrawer) public onlyOwner {
            emit WithdrawerChanged(_withdrawer);
            withdrawer = _withdrawer;

69:     function setOperator(address _operator, bool _active) public onlyOwner {
            emit OperatorChanged(_operator, _active);
            operators[_operator] = _active;

79:     function setVault(address _vault, bool _active) public onlyOwner {
            emit VaultChanged(_vault, _active);
            vaults[_vault] = _active;

87:     function setTWAPConfig(uint16 _maxTWAPTickDifference, uint32 _TWAPSeconds) public onlyOwner {
            if (_TWAPSeconds < MIN_TWAP_SECONDS) {
                revert InvalidConfig();
            }
            if (_maxTWAPTickDifference > MAX_TWAP_TICK_DIFFERENCE) {
                revert InvalidConfig();
            }
            emit TWAPConfigChanged(_TWAPSeconds, _maxTWAPTickDifference);
            TWAPSeconds = _TWAPSeconds;
            maxTWAPTickDifference = _maxTWAPTickDifference;

```
*Github:* [[59](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L59), [69](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L69), [79](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L79), [87](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L87)]


```solidity
File: src/transformers/AutoCompound.sol

243:     function setReward(uint64 _totalRewardX64) external onlyOwner {
             require(_totalRewardX64 <= totalRewardX64, ">totalRewardX64");
             totalRewardX64 = _totalRewardX64;
             emit RewardUpdated(msg.sender, _totalRewardX64);

```
*Github:* [[243](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L243)]


</details>


<a name="GAS-64"></a> 
### [GAS-64] Variable declared within iteration

*There are <b>2</b> instances of this issue:*
```solidity
File: src/automators/Automator.sol

112:             uint256 balance = IERC20(tokens[i]).balanceOf(address(this));

```
*Github:* [[112](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/automators/Automator.sol#L112)]


```solidity
File: src/transformers/AutoCompound.sol

234:             uint256 balance = positionBalances[0][tokens[i]];

```
*Github:* [[234](https://github.com/code-423n4/2024-03-revert-lend/blob/ac520c5fedf4e1654c597a46efaf5a7c27295de1/src/transformers/AutoCompound.sol#L234)]



