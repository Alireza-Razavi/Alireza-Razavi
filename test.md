# Report

Audit report for **2024-02-uniswap-foundation** generated by *ubl4nk_bot*.

## Medium Issues


*Total <b>1</b> instance over <b>1</b> issue:*

|ID|Issue|Instances|
|-|:-|:-:|
| [M-1](#M-1) | Return values of `approve()` not checked | 1 |

## Low Issues


*Total <b>85</b> instances over <b>18</b> issues:*

|ID|Issue|Instances|
|-|:-|:-:|
| [L-1](#L-1) | Missing zero address check in functions with address parameters | 27 |
| [L-2](#L-2) | Use increase/decrease allowance instead of `approve()`/`safeApprove()` | 1 |
| [L-3](#L-3) | Division by zero not prevented | 1 |
| [L-4](#L-4) | Consider implementing two-step procedure for updating protocol addresses | 1 |
| [L-5](#L-5) | Constructor / initialization function lacks parameter validation | 3 |
| [L-6](#L-6) | Contracts use infinite approvals | 1 |
| [L-7](#L-7) | Functions calling contracts/addresses with transfer hooks are missing reentrancy guards | 3 |
| [L-8](#L-8) | Large approvals may not work with some `ERC20` tokens | 1 |
| [L-9](#L-9) | Loss of precision in divisions | 4 |
| [L-10](#L-10) | Missing checks for state variable assignments | 11 |
| [L-11](#L-11) | Missing limits when setting min/max amounts | 1 |
| [L-12](#L-12) | Missing zero address check in constructor | 3 |
| [L-13](#L-13) | Consider some checks for `address(0)` when setting address state variables | 8 |
| [L-14](#L-14) | Solidity version 0.8.20 or above may not work on other chains due to PUSH0 | 7 |
| [L-15](#L-15) | Some functions do not work correctly with fee-on-transfer tokens | 3 |
| [L-16](#L-16) | Some tokens may revert when large transfers are made | 3 |
| [L-17](#L-17) | Some tokens may revert when zero value transfers are made | 3 |
| [L-18](#L-18) | Using zero as a parameter | 4 |

## Non Critical Issues


*Total <b>338</b> instances over <b>47</b> issues:*

|ID|Issue|Instances|
|-|:-|:-:|
| [NC-1](#NC-1) | Add inline comments for unnamed variables | 1 |
| [NC-2](#NC-2) | Names of errors should use CapWords style | 9 |
| [NC-3](#NC-3) | Consider adding a block/deny-list | 3 |
| [NC-4](#NC-4) | Consider adding emergency-stop functionality | 3 |
| [NC-5](#NC-5) | Consider adding formal verification proofs | 1 |
| [NC-6](#NC-6) | Consider using descriptive `constant`s when passing zero as a function argument | 1 |
| [NC-7](#NC-7) | Constant decimal values | 1 |
| [NC-8](#NC-8) | Constants should be put on the left side of comparisons | 9 |
| [NC-9](#NC-9) | `Constructor` should emit an event | 2 |
| [NC-10](#NC-10) | Contract does not follow the Solidity Style Guide's suggested layout ordering | 30 |
| [NC-11](#NC-11) | Contract should expose an `interface` | 23 |
| [NC-12](#NC-12) | Contracts should have full test coverage | 1 |
| [NC-13](#NC-13) | Events that mark critical parameter changes should contain both the old and the new value | 17 |
| [NC-14](#NC-14) | Custom errors has no error details | 8 |
| [NC-15](#NC-15) | Solidity version is different in some files | 2 |
| [NC-16](#NC-16) | Polymorphic functions make security audits more time-consuming and error-prone | 1 |
| [NC-17](#NC-17) | Empty bytes check is missing | 7 |
| [NC-18](#NC-18) | Enable IR-based code generation | 1 |
| [NC-19](#NC-19) | Events are emitted without the sender information | 14 |
| [NC-20](#NC-20) | Events may be emitted out of order due to reentrancy | 2 |
| [NC-21](#NC-21) |  Function ordering does not follow the Solidity Style Guide | 16 |
| [NC-22](#NC-22) | Incorrect withdraw declaration | 3 |
| [NC-23](#NC-23) | It is best practice to use linear inheritance | 1 |
| [NC-24](#NC-24) | Large or complicated code bases should implement invariant tests | 1 |
| [NC-25](#NC-25) | Long functions should be refactored into multiple, smaller, functions | 1 |
| [NC-26](#NC-26) | Missing NatSpec from contract/error/event/function/modifier declarations | 12 |
| [NC-27](#NC-27) | Missing NatSpec `@author` from contract declaration | 3 |
| [NC-28](#NC-28) | Missing NatSpec `@dev` from contract/event/function/modifier declarations | 52 |
| [NC-29](#NC-29) | Missing NatSpec `@notice` from contract/event/function/modifier declarations | 15 |
| [NC-30](#NC-30) | Missing NatSpec `@param` from event/function/modifier declarations | 26 |
| [NC-31](#NC-31) | Missing NatSpec `@return` from function declaration | 10 |
| [NC-32](#NC-32) | Missing NatSpec `@title` from contract declaration | 1 |
| [NC-33](#NC-33) | Off-by-one timestamp error | 1 |
| [NC-34](#NC-34) | Potential Re-org Attack Vector | 1 |
| [NC-35](#NC-35) | Setters should prevent re-setting the same value | 4 |
| [NC-36](#NC-36) | Unused arguments should be removed or implemented | 13 |
| [NC-37](#NC-37) | Consider using `delete` rather than assigning zero/false to clear values | 1 |
| [NC-38](#NC-38) | Solidity compiler version is not fixed | 4 |
| [NC-39](#NC-39) | Expressions for constant values should use `immutable` rather than `constant` | 8 |
| [NC-40](#NC-40) | Upgrade `openzeppelin` to the latest version (`5.0.1`) | 1 |
| [NC-41](#NC-41) | Use the latest solidity version for deployment (`0.8.24`) | 7 |
| [NC-42](#NC-42) | Use the Modern Upgradeable Contract Paradigm | 3 |
| [NC-43](#NC-43) | Consider using modifiers for address control | 2 |
| [NC-44](#NC-44) | Use a struct to encapsulate multiple function parameters | 2 |
| [NC-45](#NC-45) | Common functions should be refactored to a common base contract | 7 |
| [NC-46](#NC-46) | Names of `private`/`internal` state variables should be prefixed with an underscore | 1 |
| [NC-47](#NC-47) | Event is missing `indexed` fields | 6 |

## Gas Optimizations


*Total <b>149</b> instances over <b>33</b> issues:*

|ID|Issue|Instances|Gas|
|-|:-|:-:|:-:|
| [GAS-1](#GAS-1) | Assigning to structs can be more efficient | 1 | 6 |
| [GAS-2](#GAS-2) | Assigning state variables directly with named struct constructors wastes gas | 1 | 28 |
| [GAS-3](#GAS-3) | Consider activating via-ir for deploying | 1 | - |
| [GAS-4](#GAS-4) | Divisions can be `unchecked` to save gas | 5 | 100 |
| [GAS-5](#GAS-5) | Operator `+=` costs more gas than `<x> = <x> + <y>` for state variables | 3 | 339 |
| [GAS-6](#GAS-6) | `internal` functions only called once can be inlined to save gas | 1 | 30 |
| [GAS-7](#GAS-7) | `keccak256()` hash of literals should only be computed once | 3 | 126 |
| [GAS-8](#GAS-8) | Multiple accesses of the same mapping/array key/index should be cached | 2 | 84 |
| [GAS-9](#GAS-9) | Operator `>=`/`<=` costs less gas than operator `>`/`<` | 2 | 6 |
| [GAS-10](#GAS-10) | Optimize Gas by splitting `if() revert` statements | 1 | - |
| [GAS-11](#GAS-11) | Optimize names to save gas | 2 | 44 |
| [GAS-12](#GAS-12) | Use smaller sizes for struct variables if possible | 1 | 2500 |
| [GAS-13](#GAS-13) | Optimize external calls with assembly for memory efficiency | 12 | 2640 |
| [GAS-14](#GAS-14) | Use assembly to compute hashes to save gas | 12 | 960 |
| [GAS-15](#GAS-15) | Use assembly to emit events | 17 | 646 |
| [GAS-16](#GAS-16) | Use assembly to validate `msg.sender` | 2 | - |
| [GAS-17](#GAS-17) | Use assembly to write address/contract type storage values | 8 | 400 |
| [GAS-18](#GAS-18) | Use local variables for emitting | 3 | 291 |
| [GAS-19](#GAS-19) | Use a more recent version of solidity | 7 | - |
| [GAS-20](#GAS-20) | State variables can be packed into fewer storage slots by truncating timestamp bytes | 2 | 5000 |
| [GAS-21](#GAS-21) | Consider Using Solady's Gas Optimized Lib for Math | 3 | - |
| [GAS-22](#GAS-22) | Use solady library where possible to save gas | 2 | 2000 |
| [GAS-23](#GAS-23) | Use `uint256(1)`/`uint256(2)` instead of `true`/`false` to save gas for changes | 1 | 8550 |
| [GAS-24](#GAS-24) | Using bitmap to store bool states can save gas | 1 | - |
| [GAS-25](#GAS-25) | Using `constant`s directly, rather than caching the value, saves gas | 3 | - |
| [GAS-26](#GAS-26) | `abi.encodePacked` is more gas efficient than `abi.encode` | 6 | - |
| [GAS-27](#GAS-27) | Using bools for storage incurs overhead | 1 | 100 |
| [GAS-28](#GAS-28) | State variables should be cached in stack variables rather than re-reading them from storage | 9 | 873 |
| [GAS-29](#GAS-29) | Use `calldata` instead of `memory` for function arguments that do not get mutated | 6 | - |
| [GAS-30](#GAS-30) | Usage of `int`s/`uint`s smaller than 32 bytes incurs overhead | 18 | 990 |
| [GAS-31](#GAS-31) | Constructors can be marked as `payable` to save deployment gas | 1 | 21 |
| [GAS-32](#GAS-32) | Using `private` rather than `public` for constants, saves gas | 8 | - |
| [GAS-33](#GAS-33) | Use assembly to check for `address(0)` | 4 | 24 |

## Medium Issues

<a name="M-1"></a> 
### [M-1] Return values of `approve()` not checked
Not all IERC20 implementations `revert()` when there's a failure in `approve()`. The function signature has a boolean return value and they indicate errors that way instead. By not checking the return value, operations that should have marked as failed, may potentially go through without actually approving anything

*There is one instance of this issue:*
```solidity
File: src/DelegationSurrogate.sol

27:     _token.approve(msg.sender, type(uint256).max);

```
*Github:* [[27](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L27)]




## Low Issues

<a name="L-1"></a> 
### [L-1] Missing zero address check in functions with address parameters
Adding a zero address check for each address type parameter can prevent errors.

<details>
<summary>
There are <b>27</b> instances (click to show):
</summary>

```solidity
File: src/UniStaker.sol

/// @audit missing zero check for `_rewardNotifier`
210:   function setRewardNotifier(address _rewardNotifier, bool _isEnabled) external {

/// @audit missing zero check for `_beneficiary`
241:   function unclaimedReward(address _beneficiary) public view returns (uint256) {

/// @audit missing zero check for `_delegatee`
256:   function stake(uint256 _amount, address _delegatee)
         external
         returns (DepositIdentifier _depositId)
       {

/// @audit missing zero check for `_delegatee`
/// @audit missing zero check for `_beneficiary`
271:   function stake(uint256 _amount, address _delegatee, address _beneficiary)
         external
         returns (DepositIdentifier _depositId)
       {

/// @audit missing zero check for `_delegatee`
/// @audit missing zero check for `_beneficiary`
292:   function permitAndStake(
         uint256 _amount,
         address _delegatee,
         address _beneficiary,
         uint256 _deadline,
         uint8 _v,
         bytes32 _r,
         bytes32 _s
       ) external returns (DepositIdentifier _depositId) {

/// @audit missing zero check for `_delegatee`
/// @audit missing zero check for `_beneficiary`
315:   function stakeOnBehalf(
         uint256 _amount,
         address _delegatee,
         address _beneficiary,
         address _depositor,
         bytes memory _signature
       ) external returns (DepositIdentifier _depositId) {

/// @audit missing zero check for `_newDelegatee`
410:   function alterDelegatee(DepositIdentifier _depositId, address _newDelegatee) external {

/// @audit missing zero check for `_newDelegatee`
423:   function alterDelegateeOnBehalf(
         DepositIdentifier _depositId,
         address _newDelegatee,
         address _depositor,
         bytes memory _signature
       ) external {

/// @audit missing zero check for `_newBeneficiary`
453:   function alterBeneficiary(DepositIdentifier _depositId, address _newBeneficiary) external {

/// @audit missing zero check for `_newBeneficiary`
466:   function alterBeneficiaryOnBehalf(
         DepositIdentifier _depositId,
         address _newBeneficiary,
         address _depositor,
         bytes memory _signature
       ) external {

/// @audit missing zero check for `_delegatee`
605:   function _fetchOrDeploySurrogate(address _delegatee)
         internal
         returns (DelegationSurrogate _surrogate)
       {
         _surrogate = surrogates[_delegatee];

/// @audit missing zero check for `_from`
/// @audit missing zero check for `_to`
623:   function _stakeTokenSafeTransferFrom(address _from, address _to, uint256 _value) internal {
         SafeERC20.safeTransferFrom(IERC20(address(STAKE_TOKEN)), _from, _to, _value);

/// @audit missing zero check for `_depositor`
638:   function _stake(address _depositor, uint256 _amount, address _delegatee, address _beneficiary)
         internal
         returns (DepositIdentifier _depositId)
       {
         _revertIfAddressZero(_delegatee);

/// @audit missing zero check for `owner`
787:   function _revertIfNotDepositOwner(Deposit storage deposit, address owner) internal view {
         if (owner != deposit.owner) revert UniStaker__Unauthorized("not owner", owner);

/// @audit missing zero check for `_signer`
803:   function _revertIfSignatureIsNotValidNow(address _signer, bytes32 _hash, bytes memory _signature)
         internal
         view
       {
         bool _isValid = SignatureChecker.isValidSignatureNow(_signer, _hash, _signature);

```
*Github:* [[210](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L210), [241](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L241), [256](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L256), [271](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L271), [292](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L292), [315](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L315), [410](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L410), [423](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L423), [453](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L453), [466](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L466), [605](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L605), [623](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L623), [638](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L638), [787](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L787), [803](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L803)]


```solidity
File: src/V3FactoryOwner.sol

/// @audit missing zero check for `_pool`
142:   function setFeeProtocol(
         IUniswapV3PoolOwnerActions _pool,
         uint8 _feeProtocol0,
         uint8 _feeProtocol1
       ) external {

/// @audit missing zero check for `_recipient`
181:   function claimFees(
         IUniswapV3PoolOwnerActions _pool,
         address _recipient,
         uint128 _amount0Requested,
         uint128 _amount1Requested
       ) external returns (uint128, uint128) {

```
*Github:* [[142](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L142), [181](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L181)]


```solidity
File: src/interfaces/IERC20Delegates.sol

/// @audit missing zero check for `account`
/// @audit missing zero check for `spender`
10:   function allowance(address account, address spender) external view returns (uint256);

/// @audit missing zero check for `spender`
11:   function approve(address spender, uint256 rawAmount) external returns (bool);

/// @audit missing zero check for `account`
12:   function balanceOf(address account) external view returns (uint256);

/// @audit missing zero check for `dst`
16:   function transfer(address dst, uint256 rawAmount) external returns (bool);

/// @audit missing zero check for `src`
/// @audit missing zero check for `dst`
17:   function transferFrom(address src, address dst, uint256 rawAmount) external returns (bool);

/// @audit missing zero check for `owner`
/// @audit missing zero check for `spender`
18:   function permit(

/// @audit missing zero check for `delegatee`
29:   function delegate(address delegatee) external;

/// @audit missing zero check for ``
30:   function delegates(address) external view returns (address);

```
*Github:* [[10](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L10), [11](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L11), [12](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L12), [16](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L16), [17](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L17), [18](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L18), [29](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L29), [30](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L30)]


```solidity
File: src/interfaces/IUniswapV3FactoryOwnerActions.sol

/// @audit missing zero check for `_owner`
18:   function setOwner(address _owner) external;

```
*Github:* [[18](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3FactoryOwnerActions.sol#L18)]


```solidity
File: src/interfaces/IUniswapV3PoolOwnerActions.sol

/// @audit missing zero check for `recipient`
22:   function collectProtocol(address recipient, uint128 amount0Requested, uint128 amount1Requested)

```
*Github:* [[22](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L22)]


</details>


<a name="L-2"></a> 
### [L-2] Use increase/decrease allowance instead of `approve()`/`safeApprove()`
Changing an allowance with approve() brings the risk that someone may use both the old and the new allowance by unfortunate transaction ordering. Refer to [ERC20 API: An Attack Vector on the Approve/TransferFrom Methods](https://docs.google.com/document/d/1YLPtQxZu1UAvO9cZ1O2RPXBbT0mooh4DYKjA_jp-RLM). It is recommended to use the `increaseAllowance()`/`decreaseAllowance()` to avoid this problem.

*There is one instance of this issue:*
```solidity
File: src/DelegationSurrogate.sol

27:     _token.approve(msg.sender, type(uint256).max);

```
*Github:* [[27](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L27)]



<a name="L-3"></a> 
### [L-3] Division by zero not prevented
The divisions below take an input parameter that has no zero-value checks, which can cause the functions reverting if zero is passed.

*There is one instance of this issue:*
```solidity
File: src/UniStaker.sol

/// @audit `totalStaked`
233:       + (scaledRewardRate * (lastTimeRewardDistributed() - lastCheckpointTime)) / totalStaked;

```
*Github:* [[233](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L233)]



<a name="L-4"></a> 
### [L-4] Consider implementing two-step procedure for updating protocol addresses
A copy-paste error or a typo may end up bricking protocol functionality, or sending tokens to an address with no known private key. Consider implementing a two-step procedure for updating protocol addresses, where the recipient is set as pending, and must "accept" the assignment by making an affirmative call. A straight forward way of doing this would be to have the target contracts implement [EIP-165](https://eips.ethereum.org/EIPS/eip-165), and to have the "set" functions ensure that the recipient is of the right interface type.

*There is one instance of this issue:*
```solidity
File: src/V3FactoryOwner.sol

/// @audit `admin`
110:   function setAdmin(address _newAdmin) external {

```
*Github:* [[110](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L110)]



<a name="L-5"></a> 
### [L-5] Constructor / initialization function lacks parameter validation
Constructors and initialization functions play a critical role in contracts by setting important initial states when the contract is first deployed before the system starts. The parameters passed to the constructor and initialization functions directly affect the behavior of the contract / protocol. If incorrect parameters are provided, the system may fail to run, behave abnormally, be unstable, or lack security. Therefore, it's crucial to carefully check each parameter in the constructor and initialization functions. If an exception is found, the transaction should be rolled back.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/DelegationSurrogate.sol

/// @audit `_token` not validated
25:   constructor(IERC20Delegates _token, address _delegatee) {

```
*Github:* [[25](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L25)]


```solidity
File: src/UniStaker.sol

/// @audit `_rewardToken` not validated
/// @audit `_stakeToken` not validated
190:   constructor(IERC20 _rewardToken, IERC20Delegates _stakeToken, address _admin)

```
*Github:* [[190](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L190)]


```solidity
File: src/V3FactoryOwner.sol

/// @audit `_factory` not validated
/// @audit `_payoutToken` not validated
/// @audit `_rewardReceiver` not validated
88:   constructor(

```
*Github:* [[88](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L88)]



<a name="L-6"></a> 
### [L-6] Contracts use infinite approvals
Infinite approvals on external contracts can be dangerous if the target becomes compromised. See [here](https://revoke.cash/exploits) for a list of approval exploits. The following contracts are vulnerable to such attacks since they have no functionality to revoke the approval (call approve with amount 0). Consider enabling the contract to revoke approval in emergency situations.

*There is one instance of this issue:*
```solidity
File: src/DelegationSurrogate.sol

27:     _token.approve(msg.sender, type(uint256).max);

```
*Github:* [[27](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L27)]



<a name="L-7"></a> 
### [L-7] Functions calling contracts/addresses with transfer hooks are missing reentrancy guards
While adherence to the check-effects-interaction pattern is commendable, the absence of a reentrancy guard in functions, especially where transfer hooks might be present, can expose the protocol users to risks of read-only reentrancies. Such reentrancy vulnerabilities can be exploited to execute malicious actions even without altering the contract state. Without a reentrancy guard, the only potential mitigation would be to blocklist the entire protocol - an extreme and disruptive measure. Therefore, incorporating a reentrancy guard into these functions is vital to bolster security, as it helps protect against both traditional reentrancy attacks and read-only reentrancies, ensuring robust and safe protocol operations.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

499:   function withdraw(DepositIdentifier _depositId, uint256 _amount) external {
         Deposit storage deposit = deposits[_depositId];
         _revertIfNotDepositOwner(deposit, msg.sender);
         _withdraw(deposit, _depositId, _amount);

512:   function withdrawOnBehalf(
         DepositIdentifier _depositId,
         uint256 _amount,
         address _depositor,
         bytes memory _signature
       ) external {
         Deposit storage deposit = deposits[_depositId];
         _revertIfNotDepositOwner(deposit, _depositor);
     
         _revertIfSignatureIsNotValidNow(
           _depositor,
           _hashTypedDataV4(
             keccak256(
               abi.encode(WITHDRAW_TYPEHASH, _depositId, _amount, _depositor, _useNonce(_depositor))
             )
           ),
           _signature
         );
     
         _withdraw(deposit, _depositId, _amount);

```
*Github:* [[499](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L499), [512](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L512)]


```solidity
File: src/V3FactoryOwner.sol

181:   function claimFees(
         IUniswapV3PoolOwnerActions _pool,
         address _recipient,
         uint128 _amount0Requested,
         uint128 _amount1Requested
       ) external returns (uint128, uint128) {
         PAYOUT_TOKEN.safeTransferFrom(msg.sender, address(REWARD_RECEIVER), payoutAmount);

```
*Github:* [[181](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L181)]



<a name="L-8"></a> 
### [L-8] Large approvals may not work with some `ERC20` tokens
Not all `IERC20` implementations are totally compliant, and some (e.g `UNI`, `COMP`) may fail if the valued passed to `approve` is larger than `uint96`. If the approval amount is `type(uint256).max`, which may cause issues with systems that expect the value passed to approve to be reflected in the allowances mapping.

*There is one instance of this issue:*
```solidity
File: src/DelegationSurrogate.sol

27:     _token.approve(msg.sender, type(uint256).max);

```
*Github:* [[27](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L27)]



<a name="L-9"></a> 
### [L-9] Loss of precision in divisions
Division by large numbers may result in the result being zero, due to solidity not supporting fractions. Consider requiring a minimum amount for the numerator to ensure that it is always larger than the denominator.

*There are <b>4</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

233:       + (scaledRewardRate * (lastTimeRewardDistributed() - lastCheckpointTime)) / totalStaked;

578:       scaledRewardRate = (_amount * SCALE_FACTOR) / REWARD_DURATION;

581:       scaledRewardRate = (_remainingReward + _amount * SCALE_FACTOR) / REWARD_DURATION;

595:       (scaledRewardRate * REWARD_DURATION) > (REWARD_TOKEN.balanceOf(address(this)) * SCALE_FACTOR)

```
*Github:* [[233](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L233), [578](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L578), [581](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L581), [595](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L595)]



<a name="L-10"></a> 
### [L-10] Missing checks for state variable assignments
There are some missing checks in these functions, and this could lead to unexpected scenarios. Consider always adding a sanity check for state variables.

<details>
<summary>
There are <b>11</b> instances (click to show):
</summary>

```solidity
File: src/UniStaker.sol

/// @audit `_rewardToken`
193:     REWARD_TOKEN = _rewardToken;

/// @audit `_stakeToken`
194:     STAKE_TOKEN = _stakeToken;

/// @audit `_isEnabled`
212:     isRewardNotifier[_rewardNotifier] = _isEnabled;

/// @audit `_newAdmin`
774:     admin = _newAdmin;

```
*Github:* [[193](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L193), [194](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L194), [212](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L212), [774](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L774)]


```solidity
File: src/V3FactoryOwner.sol

/// @audit `_admin`
98:     admin = _admin;

/// @audit `_factory`
99:     FACTORY = _factory;

/// @audit `_payoutToken`
100:     PAYOUT_TOKEN = _payoutToken;

/// @audit `_payoutAmount`
101:     payoutAmount = _payoutAmount;

/// @audit `_rewardReceiver`
102:     REWARD_RECEIVER = _rewardReceiver;

/// @audit `_newAdmin`
114:     admin = _newAdmin;

/// @audit `_newPayoutAmount`
123:     payoutAmount = _newPayoutAmount;

```
*Github:* [[98](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L98), [99](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L99), [100](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L100), [101](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L101), [102](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L102), [114](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L114), [123](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L123)]


</details>


<a name="L-11"></a> 
### [L-11] Missing limits when setting min/max amounts
There are some missing limits in these functions, and this could lead to unexpected scenarios. Consider adding a min/max limit for the following values, when appropriate.

*There is one instance of this issue:*
```solidity
File: src/V3FactoryOwner.sol

/// @audit `_newPayoutAmount`
119:   function setPayoutAmount(uint256 _newPayoutAmount) external {

```
*Github:* [[119](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L119)]



<a name="L-12"></a> 
### [L-12] Missing zero address check in constructor
Constructors often take address parameters to initialize important components of a contract, such as owner or linked contracts. However, without a checking, there's a risk that an address parameter could be mistakenly set to the zero address (0x0). This could be due to an error or oversight during contract deployment. A zero address in a crucial role can cause serious issues, as it cannot perform actions like a normal address, and any funds sent to it will be irretrievable. It's therefore crucial to include a zero address check in constructors to prevent such potential problems. If a zero address is detected, the constructor should revert the transaction.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/DelegationSurrogate.sol

/// @audit missing zero check for `_token`
25:   constructor(IERC20Delegates _token, address _delegatee) {
        _token.delegate(_delegatee);

```
*Github:* [[25](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L25)]


```solidity
File: src/UniStaker.sol

/// @audit missing zero check for `_rewardToken`
/// @audit missing zero check for `_stakeToken`
190:   constructor(IERC20 _rewardToken, IERC20Delegates _stakeToken, address _admin)
         EIP712("UniStaker", "1")
       {

```
*Github:* [[190](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L190)]


```solidity
File: src/V3FactoryOwner.sol

/// @audit missing zero check for `_factory`
/// @audit missing zero check for `_payoutToken`
/// @audit missing zero check for `_rewardReceiver`
88:   constructor(
        address _admin,
        IUniswapV3FactoryOwnerActions _factory,
        IERC20 _payoutToken,
        uint256 _payoutAmount,
        INotifiableRewardReceiver _rewardReceiver
      ) {

```
*Github:* [[88](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L88)]



<a name="L-13"></a> 
### [L-13] Consider some checks for `address(0)` when setting address state variables
Check for zero-address to avoid the risk of setting `address(0)` for state variables after an update.

*There are <b>8</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

/// @audit `_rewardToken`
193:     REWARD_TOKEN = _rewardToken;

/// @audit `_stakeToken`
194:     STAKE_TOKEN = _stakeToken;

/// @audit `_newAdmin`
774:     admin = _newAdmin;

```
*Github:* [[193](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L193), [194](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L194), [774](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L774)]


```solidity
File: src/V3FactoryOwner.sol

/// @audit `_admin`
98:     admin = _admin;

/// @audit `_factory`
99:     FACTORY = _factory;

/// @audit `_payoutToken`
100:     PAYOUT_TOKEN = _payoutToken;

/// @audit `_rewardReceiver`
102:     REWARD_RECEIVER = _rewardReceiver;

/// @audit `_newAdmin`
114:     admin = _newAdmin;

```
*Github:* [[98](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L98), [99](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L99), [100](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L100), [102](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L102), [114](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L114)]



<a name="L-14"></a> 
### [L-14] Solidity version 0.8.20 or above may not work on other chains due to PUSH0
Solidity version 0.8.20 or above uses the new [Shanghai EVM](https://blog.soliditylang.org/2023/05/10/solidity-0.8.20-release-announcement/#important-note) which introduces the PUSH0 opcode. This op code may not yet be implemented on all evm-chains or Layer2s, so deployment on these chains will fail. Consider using an earlier solidity version.

*There are <b>7</b> instances of this issue:*
```solidity
File: src/DelegationSurrogate.sol

2: pragma solidity 0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L2)]


```solidity
File: src/UniStaker.sol

2: pragma solidity 0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L2)]


```solidity
File: src/V3FactoryOwner.sol

2: pragma solidity 0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L2)]


```solidity
File: src/interfaces/IERC20Delegates.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L2)]


```solidity
File: src/interfaces/INotifiableRewardReceiver.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/INotifiableRewardReceiver.sol#L2)]


```solidity
File: src/interfaces/IUniswapV3FactoryOwnerActions.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3FactoryOwnerActions.sol#L2)]


```solidity
File: src/interfaces/IUniswapV3PoolOwnerActions.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L2)]



<a name="L-15"></a> 
### [L-15] Some functions do not work correctly with fee-on-transfer tokens
Some tokens take a transfer fee (e.g. `STA`, `PAXG`), some do not currently charge a fee but may do so in the future (e.g. `USDT`, `USDC`).

Should a fee-on-transfer token be added as an asset and deposited, it could be abused, as the accounting is wrong. In the current implementation the following function calls do not work well with fee-on-transfer tokens as the amount variable is the pre-fee amount, including the fee, whereas the final balance do not include the fee anymore.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

624:     SafeERC20.safeTransferFrom(IERC20(address(STAKE_TOKEN)), _from, _to, _value);

749:     SafeERC20.safeTransfer(REWARD_TOKEN, _beneficiary, _reward);

```
*Github:* [[624](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L624), [749](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L749)]


```solidity
File: src/V3FactoryOwner.sol

187:     PAYOUT_TOKEN.safeTransferFrom(msg.sender, address(REWARD_RECEIVER), payoutAmount);

```
*Github:* [[187](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L187)]



<a name="L-16"></a> 
### [L-16] Some tokens may revert when large transfers are made
Tokens such as COMP or UNI will revert when an address' balance reaches `type(uint96).max`. Ensure that the calls below can be broken up into smaller batches if necessary.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

624:     SafeERC20.safeTransferFrom(IERC20(address(STAKE_TOKEN)), _from, _to, _value);

749:     SafeERC20.safeTransfer(REWARD_TOKEN, _beneficiary, _reward);

```
*Github:* [[624](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L624), [749](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L749)]


```solidity
File: src/V3FactoryOwner.sol

187:     PAYOUT_TOKEN.safeTransferFrom(msg.sender, address(REWARD_RECEIVER), payoutAmount);

```
*Github:* [[187](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L187)]



<a name="L-17"></a> 
### [L-17] Some tokens may revert when zero value transfers are made
Despite the fact that [EIP-20 states](https://github.com/ethereum/EIPs/blob/7500ac4fc1bbdfaf684e7ef851f798f6b667b2fe/EIPS/eip-20.md?plain=1#L116) that zero-value transfers must be accepted, some tokens, such as LEND, will revert if this is attempted, which may cause transactions that involve other tokens (such as batch operations) to fully revert. Consider skipping the transfer if the amount is zero, which will also save gas.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

624:     SafeERC20.safeTransferFrom(IERC20(address(STAKE_TOKEN)), _from, _to, _value);

749:     SafeERC20.safeTransfer(REWARD_TOKEN, _beneficiary, _reward);

```
*Github:* [[624](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L624), [749](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L749)]


```solidity
File: src/V3FactoryOwner.sol

187:     PAYOUT_TOKEN.safeTransferFrom(msg.sender, address(REWARD_RECEIVER), payoutAmount);

```
*Github:* [[187](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L187)]



<a name="L-18"></a> 
### [L-18] Using zero as a parameter
Taking `0` as a valid argument in Solidity without checks can lead to severe security issues. A historical example is the infamous `0x0` address bug where numerous tokens were lost. This happens because 0 can be interpreted as an uninitialized `address`, leading to transfers to the 0x0 address, effectively burning tokens. Moreover, `0` as a denominator in division operations would cause a runtime exception. It's also often indicative of a logical error in the caller's code. It's important to always validate input and handle edge cases like `0` appropriately. Use `require()` statements to enforce conditions and provide clear error messages to facilitate debugging and safer code.

*There are <b>4</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

662:     emit BeneficiaryAltered(_depositId, address(0), _beneficiary);

663:     emit DelegateeAltered(_depositId, address(0), _delegatee);

```
*Github:* [[662](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L662), [663](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L663)]


```solidity
File: src/V3FactoryOwner.sol

104:     emit AdminSet(address(0), _admin);

105:     emit PayoutAmountSet(0, _payoutAmount);

```
*Github:* [[104](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L104), [105](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L105)]




## Non Critical Issues

<a name="NC-1"></a> 
### [NC-1] Add inline comments for unnamed variables
`function foo(address x, address)` -> `function foo(address x, address /* y */)`

*There is one instance of this issue:*
```solidity
File: src/interfaces/IERC20Delegates.sol

30:   function delegates(address) external view returns (address);

```
*Github:* [[30](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L30)]



<a name="NC-2"></a> 
### [NC-2] Names of errors should use CapWords style
It is recommended by the [Solidity Style Guide](https://docs.soliditylang.org/en/latest/style-guide.html)

*There are <b>9</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

73:   error UniStaker__Unauthorized(bytes32 reason, address caller);

76:   error UniStaker__InvalidRewardRate();

81:   error UniStaker__InsufficientRewardBalance();

84:   error UniStaker__InvalidAddress();

87:   error UniStaker__InvalidSignature();

```
*Github:* [[73](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L73), [76](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L76), [81](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L81), [84](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L84), [87](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L87)]


```solidity
File: src/V3FactoryOwner.sol

54:   error V3FactoryOwner__Unauthorized();

57:   error V3FactoryOwner__InvalidAddress();

60:   error V3FactoryOwner__InvalidPayoutAmount();

63:   error V3FactoryOwner__InsufficientFeesCollected();

```
*Github:* [[54](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L54), [57](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L57), [60](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L60), [63](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L63)]



<a name="NC-3"></a> 
### [NC-3] Consider adding a block/deny-list
Doing so will significantly increase centralization, but will help to prevent hackers from using stolen tokens.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/DelegationSurrogate.sol

20: contract DelegationSurrogate {

```
*Github:* [[20](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L20)]


```solidity
File: src/UniStaker.sol

31: contract UniStaker is INotifiableRewardReceiver, Multicall, EIP712, Nonces {

```
*Github:* [[31](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L31)]


```solidity
File: src/V3FactoryOwner.sol

30: contract V3FactoryOwner {

```
*Github:* [[30](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L30)]



<a name="NC-4"></a> 
### [NC-4] Consider adding emergency-stop functionality
Consider adding `Pausable` to the following contracts so it's possible to stop them in case of an emergency.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/DelegationSurrogate.sol

20: contract DelegationSurrogate {

```
*Github:* [[20](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L20)]


```solidity
File: src/UniStaker.sol

31: contract UniStaker is INotifiableRewardReceiver, Multicall, EIP712, Nonces {

```
*Github:* [[31](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L31)]


```solidity
File: src/V3FactoryOwner.sol

30: contract V3FactoryOwner {

```
*Github:* [[30](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L30)]



<a name="NC-5"></a> 
### [NC-5] Consider adding formal verification proofs
Formal verification is the act of proving or disproving the correctness of intended algorithms underlying a system with respect to a certain formal specification/property/invariant, using formal methods of mathematics.

Some tools that are currently available to perform these tests on smart contracts are [SMTChecker](https://docs.soliditylang.org/en/latest/smtchecker.html) and [Certora Prover](https://www.certora.com/).

*There is one instance of this issue:*
```solidity

Global finding

```
*Github:* [[Global](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/)]



<a name="NC-6"></a> 
### [NC-6] Consider using descriptive `constant`s when passing zero as a function argument
Passing zero as a function argument can sometimes result in a security issue (e.g. passing zero as the slippage parameter). Consider using a `constant` variable with a descriptive name, so it's clear that the argument is intentionally being used, and for the right reasons.

*There is one instance of this issue:*
```solidity
File: src/V3FactoryOwner.sol

105:     emit PayoutAmountSet(0, _payoutAmount);

```
*Github:* [[105](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L105)]



<a name="NC-7"></a> 
### [NC-7] Constant decimal values
The use of fixed decimal values such as 1e18 or 1e8 in Solidity contracts can lead to inaccuracies, bugs, and vulnerabilities, particularly when interacting with tokens having different decimal configurations. Not all ERC20 tokens follow the standard 18 decimal places, and assumptions about decimal places can lead to miscalculations.

Resolution: Always retrieve and use the decimals() function from the token contract itself when performing calculations involving token amounts. This ensures that your contract correctly handles tokens with any number of decimal places, mitigating the risk of numerical errors or under/overflows that could jeopardize contract integrity and user funds.

*There is one instance of this issue:*
```solidity
File: src/UniStaker.sol

134:   uint256 public constant SCALE_FACTOR = 1e36;

```
*Github:* [[134](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L134)]



<a name="NC-8"></a> 
### [NC-8] Constants should be put on the left side of comparisons
Putting constants on the left side of comparison statements is a best practice known as [Yoda conditions](https://en.wikipedia.org/wiki/Yoda_conditions). Although solidity's static typing system prevents accidental assignments within conditionals, adopting this practice can improve code readability and consistency, especially when working across multiple languages.

*There are <b>9</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

230:     if (totalStaked == 0) return rewardPerTokenAccumulatedCheckpoint;

587:     if ((scaledRewardRate / SCALE_FACTOR) == 0) revert UniStaker__InvalidRewardRate();

611:     if (address(_surrogate) == address(0)) {

745:     if (_reward == 0) return;

795:     if (_account == address(0)) revert UniStaker__InvalidAddress();

```
*Github:* [[230](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L230), [587](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L587), [611](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L611), [745](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L745), [795](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L795)]


```solidity
File: src/V3FactoryOwner.sol

95:     if (_admin == address(0)) revert V3FactoryOwner__InvalidAddress();

96:     if (_payoutAmount == 0) revert V3FactoryOwner__InvalidPayoutAmount();

112:     if (_newAdmin == address(0)) revert V3FactoryOwner__InvalidAddress();

121:     if (_newPayoutAmount == 0) revert V3FactoryOwner__InvalidPayoutAmount();

```
*Github:* [[95](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L95), [96](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L96), [112](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L112), [121](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L121)]



<a name="NC-9"></a> 
### [NC-9] `Constructor` should emit an event
Use events to signal significant changes to off-chain monitoring tools.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/DelegationSurrogate.sol

25:   constructor(IERC20Delegates _token, address _delegatee) {

```
*Github:* [[25](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L25)]


```solidity
File: src/UniStaker.sol

190:   constructor(IERC20 _rewardToken, IERC20Delegates _stakeToken, address _admin)

```
*Github:* [[190](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L190)]



<a name="NC-10"></a> 
### [NC-10] Contract does not follow the Solidity Style Guide's suggested layout ordering
The [style guide](https://docs.soliditylang.org/en/v0.8.16/style-guide.html#order-of-layout) says that, within a contract, the ordering should be `1) Type declarations`, `2) State variables`, `3) Events`, `4) Modifiers`, and `5) Functions`, but the contract(s) below do not follow this ordering

<details>
<summary>
There are <b>30</b> instances (click to show):
</summary>

```solidity
File: src/UniStaker.sol

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
94:   struct Deposit {

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
102:   bytes32 public constant STAKE_TYPEHASH = keccak256(

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
106:   bytes32 public constant STAKE_MORE_TYPEHASH =

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
109:   bytes32 public constant ALTER_DELEGATEE_TYPEHASH = keccak256(

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
113:   bytes32 public constant ALTER_BENEFICIARY_TYPEHASH = keccak256(

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
117:   bytes32 public constant WITHDRAW_TYPEHASH =

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
120:   bytes32 public constant CLAIM_REWARD_TYPEHASH =

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
124:   IERC20 public immutable REWARD_TOKEN;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
127:   IERC20Delegates public immutable STAKE_TOKEN;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
130:   uint256 public constant REWARD_DURATION = 30 days;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
134:   uint256 public constant SCALE_FACTOR = 1e36;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
137:   DepositIdentifier private nextDepositId;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
140:   address public admin;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
143:   uint256 public totalStaked;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
146:   mapping(address depositor => uint256 amount) public depositorTotalStaked;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
149:   mapping(address beneficiary => uint256 amount) public earningPower;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
152:   mapping(DepositIdentifier depositId => Deposit deposit) public deposits;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
156:   mapping(address delegatee => DelegationSurrogate surrogate) public surrogates;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
159:   uint256 public rewardEndTime;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
162:   uint256 public lastCheckpointTime;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
166:   uint256 public scaledRewardRate;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
169:   uint256 public rewardPerTokenAccumulatedCheckpoint;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
175:   mapping(address account => uint256) public beneficiaryRewardPerTokenCheckpoint;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
182:   mapping(address account => uint256 amount) public unclaimedRewardCheckpoint;

/// @audit event/error `StakeDeposited` came earlier
/// @audit event/error `StakeWithdrawn` came earlier
/// @audit event/error `DelegateeAltered` came earlier
/// @audit event/error `BeneficiaryAltered` came earlier
/// @audit event/error `RewardClaimed` came earlier
/// @audit event/error `RewardNotified` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `RewardNotifierSet` came earlier
/// @audit event/error `SurrogateDeployed` came earlier
/// @audit event/error `UniStaker__Unauthorized` came earlier
/// @audit event/error `UniStaker__InvalidRewardRate` came earlier
/// @audit event/error `UniStaker__InsufficientRewardBalance` came earlier
/// @audit event/error `UniStaker__InvalidAddress` came earlier
/// @audit event/error `UniStaker__InvalidSignature` came earlier
185:   mapping(address rewardNotifier => bool) public isRewardNotifier;

```
*Github:* [[94](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L94), [102](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L102), [106](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L106), [109](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L109), [113](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L113), [117](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L117), [120](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L120), [124](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L124), [127](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L127), [130](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L130), [134](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L134), [137](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L137), [140](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L140), [143](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L143), [146](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L146), [149](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L149), [152](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L152), [156](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L156), [159](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L159), [162](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L162), [166](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L166), [169](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L169), [175](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L175), [182](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L182), [185](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L185)]


```solidity
File: src/V3FactoryOwner.sol

/// @audit event/error `FeesClaimed` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `PayoutAmountSet` came earlier
/// @audit event/error `V3FactoryOwner__Unauthorized` came earlier
/// @audit event/error `V3FactoryOwner__InvalidAddress` came earlier
/// @audit event/error `V3FactoryOwner__InvalidPayoutAmount` came earlier
/// @audit event/error `V3FactoryOwner__InsufficientFeesCollected` came earlier
66:   IUniswapV3FactoryOwnerActions public immutable FACTORY;

/// @audit event/error `FeesClaimed` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `PayoutAmountSet` came earlier
/// @audit event/error `V3FactoryOwner__Unauthorized` came earlier
/// @audit event/error `V3FactoryOwner__InvalidAddress` came earlier
/// @audit event/error `V3FactoryOwner__InvalidPayoutAmount` came earlier
/// @audit event/error `V3FactoryOwner__InsufficientFeesCollected` came earlier
69:   IERC20 public immutable PAYOUT_TOKEN;

/// @audit event/error `FeesClaimed` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `PayoutAmountSet` came earlier
/// @audit event/error `V3FactoryOwner__Unauthorized` came earlier
/// @audit event/error `V3FactoryOwner__InvalidAddress` came earlier
/// @audit event/error `V3FactoryOwner__InvalidPayoutAmount` came earlier
/// @audit event/error `V3FactoryOwner__InsufficientFeesCollected` came earlier
72:   uint256 public payoutAmount;

/// @audit event/error `FeesClaimed` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `PayoutAmountSet` came earlier
/// @audit event/error `V3FactoryOwner__Unauthorized` came earlier
/// @audit event/error `V3FactoryOwner__InvalidAddress` came earlier
/// @audit event/error `V3FactoryOwner__InvalidPayoutAmount` came earlier
/// @audit event/error `V3FactoryOwner__InsufficientFeesCollected` came earlier
76:   INotifiableRewardReceiver public immutable REWARD_RECEIVER;

/// @audit event/error `FeesClaimed` came earlier
/// @audit event/error `AdminSet` came earlier
/// @audit event/error `PayoutAmountSet` came earlier
/// @audit event/error `V3FactoryOwner__Unauthorized` came earlier
/// @audit event/error `V3FactoryOwner__InvalidAddress` came earlier
/// @audit event/error `V3FactoryOwner__InvalidPayoutAmount` came earlier
/// @audit event/error `V3FactoryOwner__InsufficientFeesCollected` came earlier
80:   address public admin;

```
*Github:* [[66](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L66), [69](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L69), [72](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L72), [76](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L76), [80](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L80)]


</details>


<a name="NC-11"></a> 
### [NC-11] Contract should expose an `interface`
All `external`/`public` functions should extend an `interface`. This is useful to make sure that the whole API is extracted.

*Note:* It is possible that the interface is out-of-scope and has not been seen by the bot.

<details>
<summary>
There are <b>23</b> instances (click to show):
</summary>

```solidity
File: src/UniStaker.sol

201:   function setAdmin(address _newAdmin) external {

210:   function setRewardNotifier(address _rewardNotifier, bool _isEnabled) external {

220:   function lastTimeRewardDistributed() public view returns (uint256) {

229:   function rewardPerTokenAccumulated() public view returns (uint256) {

241:   function unclaimedReward(address _beneficiary) public view returns (uint256) {

256:   function stake(uint256 _amount, address _delegatee)

271:   function stake(uint256 _amount, address _delegatee, address _beneficiary)

292:   function permitAndStake(

315:   function stakeOnBehalf(

342:   function stakeMore(DepositIdentifier _depositId, uint256 _amount) external {

360:   function permitAndStakeMore(

382:   function stakeMoreOnBehalf(

410:   function alterDelegatee(DepositIdentifier _depositId, address _newDelegatee) external {

423:   function alterDelegateeOnBehalf(

453:   function alterBeneficiary(DepositIdentifier _depositId, address _newBeneficiary) external {

466:   function alterBeneficiaryOnBehalf(

499:   function withdraw(DepositIdentifier _depositId, uint256 _amount) external {

512:   function withdrawOnBehalf(

536:   function claimReward() external {

544:   function claimRewardOnBehalf(address _beneficiary, bytes memory _signature) external {

```
*Github:* [[201](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L201), [210](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L210), [220](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L220), [229](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L229), [241](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L241), [256](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L256), [271](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L271), [292](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L292), [315](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L315), [342](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L342), [360](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L360), [382](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L382), [410](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L410), [423](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L423), [453](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L453), [466](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L466), [499](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L499), [512](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L512), [536](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L536), [544](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L544)]


```solidity
File: src/V3FactoryOwner.sol

110:   function setAdmin(address _newAdmin) external {

119:   function setPayoutAmount(uint256 _newPayoutAmount) external {

181:   function claimFees(

```
*Github:* [[110](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L110), [119](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L119), [181](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L181)]


</details>


<a name="NC-12"></a> 
### [NC-12] Contracts should have full test coverage
While 100% code coverage does not guarantee that there are no bugs, it often will catch easy-to-find bugs, and will ensure that there are fewer regressions when the code invariably has to be modified. Furthermore, in order to get full coverage, code authors will often have to re-organize their code so that it is more modular, so that each component can be tested separately, which reduces interdependencies between modules and layers, and makes for code that is easier to reason about and audit.

*There is one instance of this issue:*
```solidity

Global finding

```
*Github:* [[Global](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/)]



<a name="NC-13"></a> 
### [NC-13] Events that mark critical parameter changes should contain both the old and the new value
This should especially be done if the new value is not required to be different from the old value.

<details>
<summary>
There are <b>17</b> instances (click to show):
</summary>

```solidity
File: src/UniStaker.sol

213:     emit RewardNotifierSet(_rewardNotifier, _isEnabled);

598:     emit RewardNotified(_amount, msg.sender);

614:       emit SurrogateDeployed(_delegatee, address(_surrogate));

661:     emit StakeDeposited(_depositor, _depositId, _amount, _amount);

662:     emit BeneficiaryAltered(_depositId, address(0), _beneficiary);

663:     emit DelegateeAltered(_depositId, address(0), _delegatee);

682:     emit StakeDeposited(deposit.owner, _depositId, _amount, deposit.balance);

695:     emit DelegateeAltered(_depositId, deposit.delegatee, _newDelegatee);

715:     emit BeneficiaryAltered(_depositId, deposit.beneficiary, _newBeneficiary);

734:     emit StakeWithdrawn(_depositId, _amount, deposit.balance);

747:     emit RewardClaimed(_beneficiary, _reward);

773:     emit AdminSet(admin, _newAdmin);

```
*Github:* [[213](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L213), [598](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L598), [614](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L614), [661](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L661), [662](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L662), [663](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L663), [682](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L682), [695](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L695), [715](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L715), [734](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L734), [747](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L747), [773](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L773)]


```solidity
File: src/V3FactoryOwner.sol

104:     emit AdminSet(address(0), _admin);

105:     emit PayoutAmountSet(0, _payoutAmount);

113:     emit AdminSet(admin, _newAdmin);

122:     emit PayoutAmountSet(payoutAmount, _newPayoutAmount);

196:     emit FeesClaimed(address(_pool), msg.sender, _recipient, _amount0, _amount1);

```
*Github:* [[104](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L104), [105](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L105), [113](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L113), [122](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L122), [196](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L196)]


</details>


<a name="NC-14"></a> 
### [NC-14] Custom errors has no error details
Consider adding parameters to the error to indicate which user or values caused the failure.

*There are <b>8</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

76:   error UniStaker__InvalidRewardRate();

81:   error UniStaker__InsufficientRewardBalance();

84:   error UniStaker__InvalidAddress();

87:   error UniStaker__InvalidSignature();

```
*Github:* [[76](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L76), [81](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L81), [84](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L84), [87](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L87)]


```solidity
File: src/V3FactoryOwner.sol

54:   error V3FactoryOwner__Unauthorized();

57:   error V3FactoryOwner__InvalidAddress();

60:   error V3FactoryOwner__InvalidPayoutAmount();

63:   error V3FactoryOwner__InsufficientFeesCollected();

```
*Github:* [[54](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L54), [57](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L57), [60](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L60), [63](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L63)]



<a name="NC-15"></a> 
### [NC-15] Solidity version is different in some files

*There are <b>2</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

2: pragma solidity 0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L2)]


```solidity
File: src/interfaces/IERC20Delegates.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L2)]



<a name="NC-16"></a> 
### [NC-16] Polymorphic functions make security audits more time-consuming and error-prone
The instances below point to one of two functions with the same name. Consider naming each function differently, in order to make code navigation and analysis easier.

*There is one instance of this issue:*
```solidity
File: src/UniStaker.sol

/// @audit also found on line 271
256:   function stake(uint256 _amount, address _delegatee)

```
*Github:* [[256](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L256)]



<a name="NC-17"></a> 
### [NC-17] Empty bytes check is missing
Passing empty bytes to a function can cause unexpected behavior, such as certain operations failing, producing incorrect results, or wasting gas. It is recommended to check that all byte parameters are not empty.

*There are <b>7</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

/// @audit missing empty check for `_signature`
315:   function stakeOnBehalf(
         uint256 _amount,
         address _delegatee,
         address _beneficiary,
         address _depositor,
         bytes memory _signature
       ) external returns (DepositIdentifier _depositId) {

/// @audit missing empty check for `_signature`
382:   function stakeMoreOnBehalf(
         DepositIdentifier _depositId,
         uint256 _amount,
         address _depositor,
         bytes memory _signature
       ) external {

/// @audit missing empty check for `_signature`
423:   function alterDelegateeOnBehalf(
         DepositIdentifier _depositId,
         address _newDelegatee,
         address _depositor,
         bytes memory _signature
       ) external {

/// @audit missing empty check for `_signature`
466:   function alterBeneficiaryOnBehalf(
         DepositIdentifier _depositId,
         address _newBeneficiary,
         address _depositor,
         bytes memory _signature
       ) external {

/// @audit missing empty check for `_signature`
512:   function withdrawOnBehalf(
         DepositIdentifier _depositId,
         uint256 _amount,
         address _depositor,
         bytes memory _signature
       ) external {

/// @audit missing empty check for `_signature`
544:   function claimRewardOnBehalf(address _beneficiary, bytes memory _signature) external {

/// @audit missing empty check for `_signature`
803:   function _revertIfSignatureIsNotValidNow(address _signer, bytes32 _hash, bytes memory _signature)
         internal
         view
       {
         bool _isValid = SignatureChecker.isValidSignatureNow(_signer, _hash, _signature);

```
*Github:* [[315](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L315), [382](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L382), [423](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L423), [466](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L466), [512](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L512), [544](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L544), [803](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L803)]



<a name="NC-18"></a> 
### [NC-18] Enable IR-based code generation
The IR-based code generator was introduced with an aim to not only allow code generation to be more transparent and auditable but also to enable more powerful optimization passes that span across functions. You can enable it on the command line using `--via-ir` or with the option `{"viaIR": true}`. This will take longer to compile, but you can just simple test it before deploying and if you got a better benchmark then you can add --via-ir to your deploy command More on: https://docs.soliditylang.org/en/v0.8.17/ir-breaking-changes.html

*There is one instance of this issue:*
```solidity

Global finding

```
*Github:* [[Global](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/)]



<a name="NC-19"></a> 
### [NC-19] Events are emitted without the sender information
When an action is triggered based on a user's action, not being able to filter based on who triggered the action makes event processing a lot more cumbersome. Including the `msg.sender` the events of these types of action will make events much more useful to end users, especially when `msg.sender` is not `tx.origin`.

<details>
<summary>
There are <b>14</b> instances (click to show):
</summary>

```solidity
File: src/UniStaker.sol

213:     emit RewardNotifierSet(_rewardNotifier, _isEnabled);

661:     emit StakeDeposited(_depositor, _depositId, _amount, _amount);

662:     emit BeneficiaryAltered(_depositId, address(0), _beneficiary);

663:     emit DelegateeAltered(_depositId, address(0), _delegatee);

682:     emit StakeDeposited(deposit.owner, _depositId, _amount, deposit.balance);

695:     emit DelegateeAltered(_depositId, deposit.delegatee, _newDelegatee);

715:     emit BeneficiaryAltered(_depositId, deposit.beneficiary, _newBeneficiary);

734:     emit StakeWithdrawn(_depositId, _amount, deposit.balance);

747:     emit RewardClaimed(_beneficiary, _reward);

773:     emit AdminSet(admin, _newAdmin);

```
*Github:* [[213](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L213), [661](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L661), [662](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L662), [663](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L663), [682](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L682), [695](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L695), [715](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L715), [734](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L734), [747](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L747), [773](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L773)]


```solidity
File: src/V3FactoryOwner.sol

104:     emit AdminSet(address(0), _admin);

105:     emit PayoutAmountSet(0, _payoutAmount);

113:     emit AdminSet(admin, _newAdmin);

122:     emit PayoutAmountSet(payoutAmount, _newPayoutAmount);

```
*Github:* [[104](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L104), [105](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L105), [113](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L113), [122](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L122)]


</details>


<a name="NC-20"></a> 
### [NC-20] Events may be emitted out of order due to reentrancy
Ensure that events follow the best practice of check-effects-interaction, and are emitted before external calls.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

/// @audit `.balanceOf(...)` is called on line 595
598:     emit RewardNotified(_amount, msg.sender);

```
*Github:* [[598](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L598)]


```solidity
File: src/V3FactoryOwner.sol

/// @audit `.safeTransferFrom(...)` is called on line 187
/// @audit `.notifyRewardAmount(...)` is called on line 188
/// @audit `.collectProtocol(...)` is called on line 190
196:     emit FeesClaimed(address(_pool), msg.sender, _recipient, _amount0, _amount1);

```
*Github:* [[196](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L196)]



<a name="NC-21"></a> 
### [NC-21]  Function ordering does not follow the Solidity Style Guide
According to the [solidity style guide](https://docs.soliditylang.org/en/v0.8.17/style-guide.html#order-of-functions), functions should be laid out in the following order: `constructor()`, `receive()`, `fallback()`, `external`, `public`, `internal`, `private`, but the cases below do not follow this pattern

<details>
<summary>
There are <b>16</b> instances (click to show):
</summary>

```solidity
File: src/UniStaker.sol

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
256:   function stake(uint256 _amount, address _delegatee)

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
271:   function stake(uint256 _amount, address _delegatee, address _beneficiary)

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
292:   function permitAndStake(

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
315:   function stakeOnBehalf(

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
342:   function stakeMore(DepositIdentifier _depositId, uint256 _amount) external {

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
360:   function permitAndStakeMore(

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
382:   function stakeMoreOnBehalf(

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
410:   function alterDelegatee(DepositIdentifier _depositId, address _newDelegatee) external {

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
423:   function alterDelegateeOnBehalf(

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
453:   function alterBeneficiary(DepositIdentifier _depositId, address _newBeneficiary) external {

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
466:   function alterBeneficiaryOnBehalf(

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
499:   function withdraw(DepositIdentifier _depositId, uint256 _amount) external {

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
512:   function withdrawOnBehalf(

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
536:   function claimReward() external {

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
544:   function claimRewardOnBehalf(address _beneficiary, bytes memory _signature) external {

/// @audit public function `lastTimeRewardDistributed` came earlier from this external function
/// @audit public function `rewardPerTokenAccumulated` came earlier from this external function
/// @audit public function `unclaimedReward` came earlier from this external function
570:   function notifyRewardAmount(uint256 _amount) external {

```
*Github:* [[256](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L256), [271](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L271), [292](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L292), [315](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L315), [342](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L342), [360](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L360), [382](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L382), [410](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L410), [423](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L423), [453](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L453), [466](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L466), [499](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L499), [512](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L512), [536](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L536), [544](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L544), [570](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L570)]


</details>


<a name="NC-22"></a> 
### [NC-22] Incorrect withdraw declaration
In Solidity, it's essential for clarity and interoperability to correctly specify return types in function declarations. If the `withdraw` function is expected to return a `bool` to indicate success or failure, its omission could lead to ambiguity or unexpected behavior when interacting with or calling this function from other contracts or off-chain systems. Missing return values can mislead developers and potentially lead to contract integrations built on incorrect assumptions. To resolve this, the function declaration for withdraw should be modified to explicitly include the `bool` return type, ensuring clarity and correctness in contract interactions.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

499:   function withdraw(DepositIdentifier _depositId, uint256 _amount) external {

512:   function withdrawOnBehalf(
         DepositIdentifier _depositId,
         uint256 _amount,
         address _depositor,
         bytes memory _signature
       ) external {

723:   function _withdraw(Deposit storage deposit, DepositIdentifier _depositId, uint256 _amount)
         internal
       {
         _checkpointGlobalReward();

```
*Github:* [[499](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L499), [512](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L512), [723](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L723)]



<a name="NC-23"></a> 
### [NC-23] It is best practice to use linear inheritance
In Solidity, complex inheritance structures can obfuscate code understanding, introducing potential security risks. Multiple inheritance, especially with overlapping function names or state variables, can cause unintentional overrides or ambiguous behavior. 

Resolution: Strive for linear and simple inheritance chains. Avoid diamond or circular inheritance patterns. Clearly document the purpose and relationships of base contracts, ensuring that overrides are intentional. Tools like Remix or Hardhat can visualize inheritance chains, assisting in verification. Keeping inheritance streamlined aids in better code readability, reduces potential errors, and ensures smoother audits and upgrades.

*There is one instance of this issue:*
```solidity
File: src/UniStaker.sol

31: contract UniStaker is INotifiableRewardReceiver, Multicall, EIP712, Nonces {

```
*Github:* [[31](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L31)]



<a name="NC-24"></a> 
### [NC-24] Large or complicated code bases should implement invariant tests
This includes: large code bases, or code with lots of inline-assembly, complicated math, or complicated interactions between multiple contracts. Invariant fuzzers such as Echidna require the test writer to come up with invariants which should not be violated under any circumstances, and the fuzzer tests various inputs and function calls to ensure that the invariants always hold. Even code with 100% code coverage can still have bugs due to the order of the operations a user performs, and invariant fuzzers may help significantly.

*There is one instance of this issue:*
```solidity

Global finding

```
*Github:* [[Global](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/)]



<a name="NC-25"></a> 
### [NC-25] Long functions should be refactored into multiple, smaller, functions

*There is one instance of this issue:*
```solidity
File: src/V3FactoryOwner.sol

/// @audit 187 lines
88:   constructor(
        address _admin,
        IUniswapV3FactoryOwnerActions _factory,
        IERC20 _payoutToken,
        uint256 _payoutAmount,
        INotifiableRewardReceiver _rewardReceiver
      ) {

```
*Github:* [[88](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L88)]



<a name="NC-26"></a> 
### [NC-26] Missing NatSpec from contract/error/event/function/modifier declarations
e.g. `@dev` or `@notice`, and it must appear above the contract definition braces in order to be identified by the compiler as NatSpec.

<details>
<summary>
There are <b>12</b> instances (click to show):
</summary>

```solidity
File: src/UniStaker.sol

570:   function notifyRewardAmount(uint256 _amount) external {

```
*Github:* [[570](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L570)]


```solidity
File: src/interfaces/IERC20Delegates.sol

10:   function allowance(address account, address spender) external view returns (uint256);

11:   function approve(address spender, uint256 rawAmount) external returns (bool);

12:   function balanceOf(address account) external view returns (uint256);

13:   function decimals() external view returns (uint8);

14:   function symbol() external view returns (string memory);

15:   function totalSupply() external view returns (uint256);

16:   function transfer(address dst, uint256 rawAmount) external returns (bool);

17:   function transferFrom(address src, address dst, uint256 rawAmount) external returns (bool);

18:   function permit(

29:   function delegate(address delegatee) external;

30:   function delegates(address) external view returns (address);

```
*Github:* [[10](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L10), [11](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L11), [12](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L12), [13](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L13), [14](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L14), [15](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L15), [16](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L16), [17](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L17), [18](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L18), [29](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L29), [30](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L30)]


</details>


<a name="NC-27"></a> 
### [NC-27] Missing NatSpec `@author` from contract declaration
Some contract definitions have an incomplete NatSpec: add a `@author` notation to improve the code documentation.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/interfaces/IERC20Delegates.sol

8: interface IERC20Delegates {

```
*Github:* [[8](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L8)]


```solidity
File: src/interfaces/IUniswapV3FactoryOwnerActions.sol

9: interface IUniswapV3FactoryOwnerActions {

```
*Github:* [[9](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3FactoryOwnerActions.sol#L9)]


```solidity
File: src/interfaces/IUniswapV3PoolOwnerActions.sol

8: interface IUniswapV3PoolOwnerActions {

```
*Github:* [[8](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L8)]



<a name="NC-28"></a> 
### [NC-28] Missing NatSpec `@dev` from contract/event/function/modifier declarations
Some contract definitions have an incomplete NatSpec: add a `@dev` notation to improve the code documentation.

<details>
<summary>
There are <b>52</b> instances (click to show):
</summary>

```solidity
File: src/DelegationSurrogate.sol

20: contract DelegationSurrogate {

25:   constructor(IERC20Delegates _token, address _delegatee) {

```
*Github:* [[20](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L20), [25](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L25)]


```solidity
File: src/UniStaker.sol

31: contract UniStaker is INotifiableRewardReceiver, Multicall, EIP712, Nonces {

36:   event StakeDeposited(

41:   event StakeWithdrawn(DepositIdentifier indexed depositId, uint256 amount, uint256 depositBalance);

44:   event DelegateeAltered(

49:   event BeneficiaryAltered(

56:   event RewardClaimed(address indexed beneficiary, uint256 amount);

59:   event RewardNotified(uint256 amount, address notifier);

62:   event AdminSet(address indexed oldAdmin, address indexed newAdmin);

65:   event RewardNotifierSet(address indexed account, bool isEnabled);

68:   event SurrogateDeployed(address indexed delegatee, address indexed surrogate);

190:   constructor(IERC20 _rewardToken, IERC20Delegates _stakeToken, address _admin)

220:   function lastTimeRewardDistributed() public view returns (uint256) {

229:   function rewardPerTokenAccumulated() public view returns (uint256) {

241:   function unclaimedReward(address _beneficiary) public view returns (uint256) {

382:   function stakeMoreOnBehalf(

536:   function claimReward() external {

544:   function claimRewardOnBehalf(address _beneficiary, bytes memory _signature) external {

570:   function notifyRewardAmount(uint256 _amount) external {

605:   function _fetchOrDeploySurrogate(address _delegatee)

623:   function _stakeTokenSafeTransferFrom(address _from, address _to, uint256 _value) internal {

630:   function _useDepositId() internal returns (DepositIdentifier _depositId) {

753:   function _checkpointGlobalReward() internal {

771:   function _setAdmin(address _newAdmin) internal {

779:   function _revertIfNotAdmin() internal view {

787:   function _revertIfNotDepositOwner(Deposit storage deposit, address owner) internal view {

794:   function _revertIfAddressZero(address _account) internal pure {

803:   function _revertIfSignatureIsNotValidNow(address _signer, bytes32 _hash, bytes memory _signature)

```
*Github:* [[31](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L31), [36](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L36), [41](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L41), [44](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L44), [49](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L49), [56](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L56), [59](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L59), [62](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L62), [65](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L65), [68](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L68), [190](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L190), [220](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L220), [229](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L229), [241](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L241), [382](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L382), [536](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L536), [544](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L544), [570](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L570), [605](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L605), [623](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L623), [630](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L630), [753](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L753), [771](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L771), [779](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L779), [787](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L787), [794](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L794), [803](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L803)]


```solidity
File: src/V3FactoryOwner.sol

30: contract V3FactoryOwner {

39:   event FeesClaimed(

48:   event AdminSet(address indexed oldAmin, address indexed newAdmin);

51:   event PayoutAmountSet(uint256 indexed oldPayoutAmount, uint256 indexed newPayoutAmount);

88:   constructor(

110:   function setAdmin(address _newAdmin) external {

119:   function setPayoutAmount(uint256 _newPayoutAmount) external {

```
*Github:* [[30](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L30), [39](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L39), [48](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L48), [51](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L51), [88](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L88), [110](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L110), [119](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L119)]


```solidity
File: src/interfaces/IERC20Delegates.sol

8: interface IERC20Delegates {

10:   function allowance(address account, address spender) external view returns (uint256);

11:   function approve(address spender, uint256 rawAmount) external returns (bool);

12:   function balanceOf(address account) external view returns (uint256);

13:   function decimals() external view returns (uint8);

14:   function symbol() external view returns (string memory);

15:   function totalSupply() external view returns (uint256);

16:   function transfer(address dst, uint256 rawAmount) external returns (bool);

17:   function transferFrom(address src, address dst, uint256 rawAmount) external returns (bool);

18:   function permit(

29:   function delegate(address delegatee) external;

30:   function delegates(address) external view returns (address);

```
*Github:* [[8](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L8), [10](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L10), [11](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L11), [12](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L12), [13](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L13), [14](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L14), [15](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L15), [16](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L16), [17](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L17), [18](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L18), [29](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L29), [30](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L30)]


```solidity
File: src/interfaces/INotifiableRewardReceiver.sol

10: interface INotifiableRewardReceiver {

13:   function notifyRewardAmount(uint256 _amount) external;

```
*Github:* [[10](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/INotifiableRewardReceiver.sol#L10), [13](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/INotifiableRewardReceiver.sol#L13)]


```solidity
File: src/interfaces/IUniswapV3PoolOwnerActions.sol

12:   function setFeeProtocol(uint8 feeProtocol0, uint8 feeProtocol1) external;

22:   function collectProtocol(address recipient, uint128 amount0Requested, uint128 amount1Requested)

```
*Github:* [[12](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L12), [22](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L22)]


</details>


<a name="NC-29"></a> 
### [NC-29] Missing NatSpec `@notice` from contract/event/function/modifier declarations
Some contract definitions have an incomplete NatSpec: add a `@notice` notation to improve the code documentation.

<details>
<summary>
There are <b>15</b> instances (click to show):
</summary>

```solidity
File: src/DelegationSurrogate.sol

25:   constructor(IERC20Delegates _token, address _delegatee) {

```
*Github:* [[25](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L25)]


```solidity
File: src/UniStaker.sol

190:   constructor(IERC20 _rewardToken, IERC20Delegates _stakeToken, address _admin)

570:   function notifyRewardAmount(uint256 _amount) external {

```
*Github:* [[190](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L190), [570](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L570)]


```solidity
File: src/V3FactoryOwner.sol

88:   constructor(

```
*Github:* [[88](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L88)]


```solidity
File: src/interfaces/IERC20Delegates.sol

10:   function allowance(address account, address spender) external view returns (uint256);

11:   function approve(address spender, uint256 rawAmount) external returns (bool);

12:   function balanceOf(address account) external view returns (uint256);

13:   function decimals() external view returns (uint8);

14:   function symbol() external view returns (string memory);

15:   function totalSupply() external view returns (uint256);

16:   function transfer(address dst, uint256 rawAmount) external returns (bool);

17:   function transferFrom(address src, address dst, uint256 rawAmount) external returns (bool);

18:   function permit(

29:   function delegate(address delegatee) external;

30:   function delegates(address) external view returns (address);

```
*Github:* [[10](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L10), [11](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L11), [12](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L12), [13](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L13), [14](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L14), [15](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L15), [16](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L16), [17](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L17), [18](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L18), [29](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L29), [30](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L30)]


</details>


<a name="NC-30"></a> 
### [NC-30] Missing NatSpec `@param` from event/function/modifier declarations
Some event definitions have an incomplete NatSpec: add a `@param` notation to improve the code documentation.

<details>
<summary>
There are <b>26</b> instances (click to show):
</summary>

```solidity
File: src/UniStaker.sol

36:   event StakeDeposited(

41:   event StakeWithdrawn(DepositIdentifier indexed depositId, uint256 amount, uint256 depositBalance);

44:   event DelegateeAltered(

49:   event BeneficiaryAltered(

56:   event RewardClaimed(address indexed beneficiary, uint256 amount);

59:   event RewardNotified(uint256 amount, address notifier);

62:   event AdminSet(address indexed oldAdmin, address indexed newAdmin);

65:   event RewardNotifierSet(address indexed account, bool isEnabled);

68:   event SurrogateDeployed(address indexed delegatee, address indexed surrogate);

/// @audit missing @param for `_beneficiary`
241:   function unclaimedReward(address _beneficiary) public view returns (uint256) {

/// @audit missing @param for `_amount`
570:   function notifyRewardAmount(uint256 _amount) external {

/// @audit missing @param for `_depositor`
/// @audit missing @param for `_amount`
/// @audit missing @param for `_delegatee`
/// @audit missing @param for `_beneficiary`
638:   function _stake(address _depositor, uint256 _amount, address _delegatee, address _beneficiary)
         internal
         returns (DepositIdentifier _depositId)
       {
         _revertIfAddressZero(_delegatee);

/// @audit missing @param for `deposit`
/// @audit missing @param for `_depositId`
/// @audit missing @param for `_amount`
669:   function _stakeMore(Deposit storage deposit, DepositIdentifier _depositId, uint256 _amount)
         internal
       {
         _checkpointGlobalReward();

/// @audit missing @param for `deposit`
/// @audit missing @param for `_depositId`
/// @audit missing @param for `_newDelegatee`
688:   function _alterDelegatee(
         Deposit storage deposit,
         DepositIdentifier _depositId,
         address _newDelegatee
       ) internal {
         _revertIfAddressZero(_newDelegatee);

/// @audit missing @param for `deposit`
/// @audit missing @param for `_depositId`
/// @audit missing @param for `_newBeneficiary`
704:   function _alterBeneficiary(
         Deposit storage deposit,
         DepositIdentifier _depositId,
         address _newBeneficiary
       ) internal {
         _revertIfAddressZero(_newBeneficiary);

/// @audit missing @param for `deposit`
/// @audit missing @param for `_depositId`
/// @audit missing @param for `_amount`
723:   function _withdraw(Deposit storage deposit, DepositIdentifier _depositId, uint256 _amount)
         internal
       {
         _checkpointGlobalReward();

/// @audit missing @param for `_beneficiary`
740:   function _claimReward(address _beneficiary) internal {
         _checkpointGlobalReward();

```
*Github:* [[36](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L36), [41](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L41), [44](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L44), [49](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L49), [56](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L56), [59](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L59), [62](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L62), [65](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L65), [68](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L68), [241](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L241), [570](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L570), [638](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L638), [669](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L669), [688](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L688), [704](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L704), [723](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L723), [740](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L740)]


```solidity
File: src/V3FactoryOwner.sol

48:   event AdminSet(address indexed oldAmin, address indexed newAdmin);

51:   event PayoutAmountSet(uint256 indexed oldPayoutAmount, uint256 indexed newPayoutAmount);

```
*Github:* [[48](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L48), [51](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L51)]


```solidity
File: src/interfaces/IERC20Delegates.sol

/// @audit missing @param for `account`
/// @audit missing @param for `spender`
10:   function allowance(address account, address spender) external view returns (uint256);

/// @audit missing @param for `spender`
/// @audit missing @param for `rawAmount`
11:   function approve(address spender, uint256 rawAmount) external returns (bool);

/// @audit missing @param for `account`
12:   function balanceOf(address account) external view returns (uint256);

/// @audit missing @param for `dst`
/// @audit missing @param for `rawAmount`
16:   function transfer(address dst, uint256 rawAmount) external returns (bool);

/// @audit missing @param for `src`
/// @audit missing @param for `dst`
/// @audit missing @param for `rawAmount`
17:   function transferFrom(address src, address dst, uint256 rawAmount) external returns (bool);

/// @audit missing @param for `owner`
/// @audit missing @param for `spender`
/// @audit missing @param for `rawAmount`
/// @audit missing @param for `deadline`
/// @audit missing @param for `v`
/// @audit missing @param for `r`
/// @audit missing @param for `s`
18:   function permit(

/// @audit missing @param for `delegatee`
29:   function delegate(address delegatee) external;

```
*Github:* [[10](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L10), [11](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L11), [12](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L12), [16](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L16), [17](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L17), [18](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L18), [29](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L29)]


</details>


<a name="NC-31"></a> 
### [NC-31] Missing NatSpec `@return` from function declaration
Some function definitions have an incomplete NatSpec: add a `@return` notation to improve the code documentation.

*There are <b>10</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

638:   function _stake(address _depositor, uint256 _amount, address _delegatee, address _beneficiary)
         internal
         returns (DepositIdentifier _depositId)
       {
         _revertIfAddressZero(_delegatee);

```
*Github:* [[638](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L638)]


```solidity
File: src/interfaces/IERC20Delegates.sol

10:   function allowance(address account, address spender) external view returns (uint256);

11:   function approve(address spender, uint256 rawAmount) external returns (bool);

12:   function balanceOf(address account) external view returns (uint256);

13:   function decimals() external view returns (uint8);

14:   function symbol() external view returns (string memory);

15:   function totalSupply() external view returns (uint256);

16:   function transfer(address dst, uint256 rawAmount) external returns (bool);

17:   function transferFrom(address src, address dst, uint256 rawAmount) external returns (bool);

30:   function delegates(address) external view returns (address);

```
*Github:* [[10](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L10), [11](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L11), [12](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L12), [13](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L13), [14](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L14), [15](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L15), [16](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L16), [17](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L17), [30](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L30)]



<a name="NC-32"></a> 
### [NC-32] Missing NatSpec `@title` from contract declaration
Some contract definitions have an incomplete NatSpec: add a `@title` notation to improve the code documentation.

*There is one instance of this issue:*
```solidity
File: src/interfaces/IERC20Delegates.sol

8: interface IERC20Delegates {

```
*Github:* [[8](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L8)]



<a name="NC-33"></a> 
### [NC-33] Off-by-one timestamp error
In Solidity, using `>=` or `<=` to compare against `block.timestamp` (alias now) may introduce off-by-one errors due to the fact that `block.timestamp` is only updated once per block and its value remains constant throughout the block's execution. If an operation happens at the exact second when `block.timestamp` changes, it could result in unexpected behavior. To avoid this, it's safer to use strict inequality operators (`>` or `<`). For instance, if a condition should only be met after a certain time, use `block.timestamp > time` rather than `block.timestamp >= time`. This way, potential off-by-one errors due to the exact timing of block mining are mitigated, leading to safer, more predictable contract behavior.

*There is one instance of this issue:*
```solidity
File: src/UniStaker.sol

221:     if (rewardEndTime <= block.timestamp) return rewardEndTime;

```
*Github:* [[221](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L221)]



<a name="NC-34"></a> 
### [NC-34] Potential Re-org Attack Vector
The contract appears to deploy new contracts using the `new` keyword. In a re-org attack scenario, such deployments can be exploited by a malicious actor who might rewrite the blockchain's history and deploy the contract at an expected address.

Consider deploying the contract via `CREATE2` opcode with a specific salt that includes `msg.sender` and the existing contract address. This will ensure a predictable contract address, reducing the chances of such an attack.

*There is one instance of this issue:*
```solidity
File: src/UniStaker.sol

612:       _surrogate = new DelegationSurrogate(STAKE_TOKEN, _delegatee);

```
*Github:* [[612](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L612)]



<a name="NC-35"></a> 
### [NC-35] Setters should prevent re-setting the same value
Not only is wasteful in terms of gas, but this is especially problematic when an event is emitted and the old and new values set are the same, as listeners might not expect this kind of scenario.

*There are <b>4</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

212:     isRewardNotifier[_rewardNotifier] = _isEnabled;

774:     admin = _newAdmin;

```
*Github:* [[212](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L212), [774](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L774)]


```solidity
File: src/V3FactoryOwner.sol

114:     admin = _newAdmin;

123:     payoutAmount = _newPayoutAmount;

```
*Github:* [[114](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L114), [123](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L123)]



<a name="NC-36"></a> 
### [NC-36] Unused arguments should be removed or implemented
Some arguments are never used: if this is intentional, consider removing these arguments from the function. Otherwise, implement the missing logic accordingly.

<details>
<summary>
There are <b>13</b> instances (click to show):
</summary>

```solidity
File: src/interfaces/IERC20Delegates.sol

/// @audit `account`
/// @audit `spender`
10:   function allowance(address account, address spender) external view returns (uint256);

/// @audit `spender`
/// @audit `rawAmount`
11:   function approve(address spender, uint256 rawAmount) external returns (bool);

/// @audit `account`
12:   function balanceOf(address account) external view returns (uint256);

/// @audit `dst`
/// @audit `rawAmount`
16:   function transfer(address dst, uint256 rawAmount) external returns (bool);

/// @audit `src`
/// @audit `dst`
/// @audit `rawAmount`
17:   function transferFrom(address src, address dst, uint256 rawAmount) external returns (bool);

/// @audit `owner`
/// @audit `spender`
/// @audit `rawAmount`
/// @audit `deadline`
/// @audit `v`
/// @audit `r`
/// @audit `s`
18:   function permit(

/// @audit `delegatee`
29:   function delegate(address delegatee) external;

```
*Github:* [[10](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L10), [11](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L11), [12](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L12), [16](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L16), [17](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L17), [18](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L18), [29](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L29)]


```solidity
File: src/interfaces/INotifiableRewardReceiver.sol

/// @audit `_amount`
13:   function notifyRewardAmount(uint256 _amount) external;

```
*Github:* [[13](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/INotifiableRewardReceiver.sol#L13)]


```solidity
File: src/interfaces/IUniswapV3FactoryOwnerActions.sol

/// @audit `_owner`
18:   function setOwner(address _owner) external;

/// @audit `fee`
/// @audit `tickSpacing`
25:   function enableFeeAmount(uint24 fee, int24 tickSpacing) external;

/// @audit `fee`
33:   function feeAmountTickSpacing(uint24 fee) external view returns (int24);

```
*Github:* [[18](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3FactoryOwnerActions.sol#L18), [25](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3FactoryOwnerActions.sol#L25), [33](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3FactoryOwnerActions.sol#L33)]


```solidity
File: src/interfaces/IUniswapV3PoolOwnerActions.sol

/// @audit `feeProtocol0`
/// @audit `feeProtocol1`
12:   function setFeeProtocol(uint8 feeProtocol0, uint8 feeProtocol1) external;

/// @audit `recipient`
/// @audit `amount0Requested`
/// @audit `amount1Requested`
22:   function collectProtocol(address recipient, uint128 amount0Requested, uint128 amount1Requested)

```
*Github:* [[12](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L12), [22](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L22)]


</details>


<a name="NC-37"></a> 
### [NC-37] Consider using `delete` rather than assigning zero/false to clear values
The `delete` keyword more closely matches the semantics of what is being done, and draws more attention to the changing of state, which may lead to a more thorough audit of its associated logic.

*There is one instance of this issue:*
```solidity
File: src/UniStaker.sol

746:     unclaimedRewardCheckpoint[_beneficiary] = 0;

```
*Github:* [[746](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L746)]



<a name="NC-38"></a> 
### [NC-38] Solidity compiler version is not fixed
To prevent the actual contracts deployed from behaving differently depending on the compiler version, it is recommended to use a fixed solidity version.

*There are <b>4</b> instances of this issue:*
```solidity
File: src/interfaces/IERC20Delegates.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L2)]


```solidity
File: src/interfaces/INotifiableRewardReceiver.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/INotifiableRewardReceiver.sol#L2)]


```solidity
File: src/interfaces/IUniswapV3FactoryOwnerActions.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3FactoryOwnerActions.sol#L2)]


```solidity
File: src/interfaces/IUniswapV3PoolOwnerActions.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L2)]



<a name="NC-39"></a> 
### [NC-39] Expressions for constant values should use `immutable` rather than `constant`
While it doesn't save any gas because the compiler knows that developers often make this mistake, it's still best to use the right tool for the task at hand. There is a difference between `constant` variables and `immutable` variables, and they should each be used in their appropriate contexts. `constants` should be used for literal values written into the code, and `immutable` variables should be used for expressions, or values calculated in, or passed into the constructor.

*There are <b>8</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

102:   bytes32 public constant STAKE_TYPEHASH = keccak256(

106:   bytes32 public constant STAKE_MORE_TYPEHASH =

109:   bytes32 public constant ALTER_DELEGATEE_TYPEHASH = keccak256(

113:   bytes32 public constant ALTER_BENEFICIARY_TYPEHASH = keccak256(

117:   bytes32 public constant WITHDRAW_TYPEHASH =

120:   bytes32 public constant CLAIM_REWARD_TYPEHASH =

130:   uint256 public constant REWARD_DURATION = 30 days;

134:   uint256 public constant SCALE_FACTOR = 1e36;

```
*Github:* [[102](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L102), [106](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L106), [109](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L109), [113](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L113), [117](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L117), [120](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L120), [130](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L130), [134](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L134)]



<a name="NC-40"></a> 
### [NC-40] Upgrade `openzeppelin` to the latest version (`5.0.1`)
These contracts import contracts from openzeppelin contracts but they are not using the latest version. For more information, please visit: [OpenZeppelin GitHub Releases](https://github.com/OpenZeppelin/openzeppelin-contracts/releases) It is recommended to always use the latest version to take advantage of updates and security fixes.

*There is one instance of this issue:*
```solidity

Global finding

```
*Github:* [[Global](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/)]



<a name="NC-41"></a> 
### [NC-41] Use the latest solidity version for deployment (`0.8.24`)
Upgrading to a newer Solidity release can optimize gas usage, take advantage of new features and improve overall contract efficiency. Where possible, based on compatibility requirements, it is recommended to use newer/latest solidity version to take advantage of the latest optimizations and features.

*There are <b>7</b> instances of this issue:*
```solidity
File: src/DelegationSurrogate.sol

2: pragma solidity 0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L2)]


```solidity
File: src/UniStaker.sol

2: pragma solidity 0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L2)]


```solidity
File: src/V3FactoryOwner.sol

2: pragma solidity 0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L2)]


```solidity
File: src/interfaces/IERC20Delegates.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L2)]


```solidity
File: src/interfaces/INotifiableRewardReceiver.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/INotifiableRewardReceiver.sol#L2)]


```solidity
File: src/interfaces/IUniswapV3FactoryOwnerActions.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3FactoryOwnerActions.sol#L2)]


```solidity
File: src/interfaces/IUniswapV3PoolOwnerActions.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L2)]



<a name="NC-42"></a> 
### [NC-42] Use the Modern Upgradeable Contract Paradigm
Modern smart contract development often employs upgradeable contract structures, utilizing proxy patterns like OpenZeppelin’s Upgradeable Contracts. This paradigm separates logic and state, allowing developers to amend and enhance the contract's functionality without altering its state or the deployed contract address. Transitioning to this approach enhances long-term maintainability.

Resolution: Adopt a well-established proxy pattern for upgradeability, ensuring proper initialization and employing transparent proxies to mitigate potential risks. Embrace comprehensive testing and audit practices, particularly when updating contract logic, to ensure state consistency and security are preserved across upgrades. This ensures your contract remains robust and adaptable to future requirements.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/DelegationSurrogate.sol

20: contract DelegationSurrogate {

```
*Github:* [[20](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L20)]


```solidity
File: src/UniStaker.sol

31: contract UniStaker is INotifiableRewardReceiver, Multicall, EIP712, Nonces {

```
*Github:* [[31](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L31)]


```solidity
File: src/V3FactoryOwner.sol

30: contract V3FactoryOwner {

```
*Github:* [[30](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L30)]



<a name="NC-43"></a> 
### [NC-43] Consider using modifiers for address control
Modifiers in Solidity can improve code readability and modularity by encapsulating repetitive checks, such as address validity checks, into a reusable construct. For example, an `onlyOwner` modifier can be used to replace repetitive `require(msg.sender == owner)` checks across several functions, reducing code redundancy and enhancing maintainability. To implement, define a modifier with the check, then apply the modifier to relevant functions.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

780:     if (msg.sender != admin) revert UniStaker__Unauthorized("not admin", msg.sender);

```
*Github:* [[780](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L780)]


```solidity
File: src/V3FactoryOwner.sol

203:     if (msg.sender != admin) revert V3FactoryOwner__Unauthorized();

```
*Github:* [[203](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L203)]



<a name="NC-44"></a> 
### [NC-44] Use a struct to encapsulate multiple function parameters
If a function has too many parameters, replacing them with a struct can improve code readability and maintainability, increase reusability, and reduce the likelihood of errors when passing the parameters.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

/// @audit 7 parameters
292:   function permitAndStake(
         uint256 _amount,
         address _delegatee,
         address _beneficiary,
         uint256 _deadline,
         uint8 _v,
         bytes32 _r,
         bytes32 _s
       ) external returns (DepositIdentifier _depositId) {

```
*Github:* [[292](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L292)]


```solidity
File: src/interfaces/IERC20Delegates.sol

/// @audit 7 parameters
18:   function permit(

```
*Github:* [[18](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L18)]



<a name="NC-45"></a> 
### [NC-45] Common functions should be refactored to a common base contract
The functions below have the same implementation as is seen in other files. The functions should be refactored into functions of a common base contract.

*There are <b>7</b> instances of this issue:*
```solidity
File: src/interfaces/INotifiableRewardReceiver.sol

/// @audit seen in src/interfaces/IUniswapV3FactoryOwnerActions.sol
13:   function notifyRewardAmount(uint256 _amount) external;

```
*Github:* [[13](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/INotifiableRewardReceiver.sol#L13)]


```solidity
File: src/interfaces/IUniswapV3FactoryOwnerActions.sol

/// @audit seen in src/interfaces/INotifiableRewardReceiver.sol
13:   function owner() external view returns (address);

/// @audit seen in src/interfaces/INotifiableRewardReceiver.sol
18:   function setOwner(address _owner) external;

/// @audit seen in src/interfaces/INotifiableRewardReceiver.sol
25:   function enableFeeAmount(uint24 fee, int24 tickSpacing) external;

/// @audit seen in src/interfaces/INotifiableRewardReceiver.sol
33:   function feeAmountTickSpacing(uint24 fee) external view returns (int24);

```
*Github:* [[13](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3FactoryOwnerActions.sol#L13), [18](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3FactoryOwnerActions.sol#L18), [25](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3FactoryOwnerActions.sol#L25), [33](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3FactoryOwnerActions.sol#L33)]


```solidity
File: src/interfaces/IUniswapV3PoolOwnerActions.sol

/// @audit seen in src/interfaces/INotifiableRewardReceiver.sol
12:   function setFeeProtocol(uint8 feeProtocol0, uint8 feeProtocol1) external;

/// @audit seen in src/interfaces/INotifiableRewardReceiver.sol
22:   function collectProtocol(address recipient, uint128 amount0Requested, uint128 amount1Requested)

```
*Github:* [[12](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L12), [22](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L22)]



<a name="NC-46"></a> 
### [NC-46] Names of `private`/`internal` state variables should be prefixed with an underscore
It is recommended by the [Solidity Style Guide](https://docs.soliditylang.org/en/v0.8.20/style-guide.html#underscore-prefix-for-non-external-functions-and-variables)

*There is one instance of this issue:*
```solidity
File: src/UniStaker.sol

137:   DepositIdentifier private nextDepositId;

```
*Github:* [[137](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L137)]



<a name="NC-47"></a> 
### [NC-47] Event is missing `indexed` fields
Index event fields make the field more quickly accessible to off-chain tools that parse events. However, note that each index field costs extra gas during emission, so it's not necessarily best to index the maximum allowed per event (three fields). Each event should use three indexed fields if there are three or more fields, and gas usage is not particularly of concern for the events in question. If there are fewer than three fields, all of the fields should be indexed.

*There are <b>6</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

36:   event StakeDeposited(

41:   event StakeWithdrawn(DepositIdentifier indexed depositId, uint256 amount, uint256 depositBalance);

44:   event DelegateeAltered(

56:   event RewardClaimed(address indexed beneficiary, uint256 amount);

59:   event RewardNotified(uint256 amount, address notifier);

65:   event RewardNotifierSet(address indexed account, bool isEnabled);

```
*Github:* [[36](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L36), [41](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L41), [44](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L44), [56](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L56), [59](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L59), [65](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L65)]




## Gas Optimizations

<a name="GAS-1"></a> 
### [GAS-1] Assigning to structs can be more efficient
By changing the pattern of assigning value to the structure, gas savings of ~130 per instance are achieved. In addition, this use will provide significant savings in distribution costs. Instead of:
```solidity
MyStruct memory myStruct = MyStruct(_a, _b, _c);
```
write:
```solidity
MyStruct memory myStruct;
myStruct.a = _a;
myStruct.b = _b;
myStruct.c = _c;
```

*There is one instance of this issue:*
```solidity
File: src/UniStaker.sol

654:     deposits[_depositId] = Deposit({
           balance: _amount,
           owner: _depositor,
           delegatee: _delegatee,
           beneficiary: _beneficiary

```
*Github:* [[654](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L654)]



<a name="GAS-2"></a> 
### [GAS-2] Assigning state variables directly with named struct constructors wastes gas
Using named arguments for struct means that the compiler needs to organize the fields in memory before doing the assignment, which wastes gas. Set each field directly in storage (use dot-notation), or use the unnamed version of the constructor.

*There is one instance of this issue:*
```solidity
File: src/UniStaker.sol

654:     deposits[_depositId] = Deposit({
           balance: _amount,
           owner: _depositor,
           delegatee: _delegatee,
           beneficiary: _beneficiary

```
*Github:* [[654](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L654)]



<a name="GAS-3"></a> 
### [GAS-3] Consider activating via-ir for deploying
By using `--via-ir` or `{"viaIR": true}`, the compiler is able to use more advanced [multi-function optimizations](https://docs.soliditylang.org/en/v0.8.17/ir-breaking-changes.html#solidity-ir-based-codegen-changes), for extra gas savings.

*There is one instance of this issue:*
```solidity

Global finding

```
*Github:* [[Global](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/)]



<a name="GAS-4"></a> 
### [GAS-4] Divisions can be `unchecked` to save gas
The expression `type(int).min/(-1)` is the only case where division causes an overflow. Therefore, uncheck can be used to [save gas](https://gist.github.com/DadeKuma/3bc597338ae774b8b3bd43280d55271f) in scenarios where it is certain that such an overflow will not occur.

*There are <b>5</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

233:       + (scaledRewardRate * (lastTimeRewardDistributed() - lastCheckpointTime)) / totalStaked;

246:       ) / SCALE_FACTOR;

578:       scaledRewardRate = (_amount * SCALE_FACTOR) / REWARD_DURATION;

581:       scaledRewardRate = (_remainingReward + _amount * SCALE_FACTOR) / REWARD_DURATION;

587:     if ((scaledRewardRate / SCALE_FACTOR) == 0) revert UniStaker__InvalidRewardRate();

```
*Github:* [[233](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L233), [246](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L246), [578](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L578), [581](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L581), [587](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L587)]



<a name="GAS-5"></a> 
### [GAS-5] Operator `+=` costs more gas than `<x> = <x> + <y>` for state variables

*There are <b>3</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

/// @audit `totalStaked +=`
651:     totalStaked += _amount;

/// @audit `totalStaked +=`
677:     totalStaked += _amount;

/// @audit `totalStaked -=`
730:     totalStaked -= _amount;

```
*Github:* [[651](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L651), [677](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L677), [730](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L730)]



<a name="GAS-6"></a> 
### [GAS-6] `internal` functions only called once can be inlined to save gas
If an `internal` function is only used once, there is no need to modularize it, unless the function calling it would otherwise be too long and complex. Not inlining costs 20 to 40 gas because of two extra JUMP instructions and additional stack operations needed for function calls.

*There is one instance of this issue:*
```solidity
File: src/UniStaker.sol

/// @audit `_useDepositId` is used only once
630:   function _useDepositId() internal returns (DepositIdentifier _depositId) {

```
*Github:* [[630](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L630)]



<a name="GAS-7"></a> 
### [GAS-7] `keccak256()` hash of literals should only be computed once
The result of the hash should be stored in an immutable variable, and the variable should be used instead. If the hash is being used as a part of a function selector, the cast to `bytes4` should also only be done once.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

107:     keccak256("StakeMore(uint256 depositId,uint256 amount,address depositor,uint256 nonce)");

118:     keccak256("Withdraw(uint256 depositId,uint256 amount,address depositor,uint256 nonce)");

121:     keccak256("ClaimReward(address beneficiary,uint256 nonce)");

```
*Github:* [[107](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L107), [118](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L118), [121](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L121)]



<a name="GAS-8"></a> 
### [GAS-8] Multiple accesses of the same mapping/array key/index should be cached
The instances below point to the second+ access of a value inside a mapping/array, within a function. Caching a mapping's value in a local `storage` or `calldata` variable when the value is accessed [multiple times](https://gist.github.com/IllIllI000/ec23a57daa30a8f8ca8b9681c8ccefb0), saves ~42 gas per access due to not having to recalculate the key's keccak256 hash (Gkeccak256 - 30 gas) and that calculation's associated stack operations. Caching an array's struct avoids recalculating the array offsets into memory/calldata

*There are <b>2</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

/// @audit `surrogates[_delegatee]` is also accessed on line 609
613:       surrogates[_delegatee] = _surrogate;

/// @audit `unclaimedRewardCheckpoint[_beneficiary]` is also accessed on line 744
746:     unclaimedRewardCheckpoint[_beneficiary] = 0;

```
*Github:* [[613](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L613), [746](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L746)]



<a name="GAS-9"></a> 
### [GAS-9] Operator `>=`/`<=` costs less gas than operator `>`/`<`
The compiler uses opcodes `GT` and `ISZERO` for code that uses `>`, but only requires `LT` for `>=`. A similar behavior applies for `>`, which uses opcodes `LT` and `ISZERO`, but only requires `GT` for `<=`. It can save 3 gas for each. It should be converted to the `<=`/`>=` equivalent when comparing against integer literals.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/V3FactoryOwner.sol

193:     if (_amount0 < _amount0Requested || _amount1 < _amount1Requested) {

193:     if (_amount0 < _amount0Requested || _amount1 < _amount1Requested) {

```
*Github:* [[193](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L193), [193](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L193)]



<a name="GAS-10"></a> 
### [GAS-10] Optimize Gas by splitting `if() revert` statements
Using boolean operators in a single `if() revert` statement can consume more gas than necessary. Consider splitting these statements to save gas.

*There is one instance of this issue:*
```solidity
File: src/V3FactoryOwner.sol

193:     if (_amount0 < _amount0Requested || _amount1 < _amount1Requested) {

```
*Github:* [[193](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L193)]



<a name="GAS-11"></a> 
### [GAS-11] Optimize names to save gas
`public`/`external` function names and `public` member variable names can be optimized to save gas. See this [link](https://gist.github.com/IllIllI000/a5d8b486a8259f9f77891a919febd1a9) for an example of how it works. Below are the interfaces/abstract contracts that can be optimized so that the most frequently-called functions use the least amount of gas possible during method lookup. Method IDs that have two leading zero bytes can save 128 gas each during deployment, and renaming functions to have lower method IDs will save 22 gas per call, [per sorted position shifted](https://medium.com/joyso/solidity-how-does-function-name-affect-gas-consumption-in-smart-contract-47d270d8ac92)

*There are <b>2</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

/// @audit `setAdmin`, `setRewardNotifier`, `lastTimeRewardDistributed`, `rewardPerTokenAccumulated`, `unclaimedReward`, `stake`, `stake`, `permitAndStake`, `stakeOnBehalf`, `stakeMore`, `permitAndStakeMore`, `stakeMoreOnBehalf`, `alterDelegatee`, `alterDelegateeOnBehalf`, `alterBeneficiary`, `alterBeneficiaryOnBehalf`, `withdraw`, `withdrawOnBehalf`, `claimReward`, `claimRewardOnBehalf`, `notifyRewardAmount`
31: contract UniStaker is INotifiableRewardReceiver, Multicall, EIP712, Nonces {

```
*Github:* [[31](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L31)]


```solidity
File: src/V3FactoryOwner.sol

/// @audit `setAdmin`, `setPayoutAmount`, `enableFeeAmount`, `setFeeProtocol`, `claimFees`
30: contract V3FactoryOwner {

```
*Github:* [[30](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L30)]



<a name="GAS-12"></a> 
### [GAS-12] Use smaller sizes for struct variables if possible
In Solidity, each storage slot has a size of 32 bytes. If a struct contains multiple uint values, it's efficient to pack these into as few storage slots as possible to optimize gas usage. The EVM (Ethereum Virtual Machine) charges gas for each storage operation, so minimizing the number of slots used can result in substantial gas savings. This can be achieved by ordering struct fields according to their size or by using smaller data types where possible. However, developers must balance these optimizations with the need for code clarity and the precision requirements of their application. Always ensure that data packing does not compromise the functionality or security of the contract.

*There is one instance of this issue:*
```solidity
File: src/UniStaker.sol

/// @audit `balance`
94:   struct Deposit {
        uint256 balance;
        address owner;
        address delegatee;
        address beneficiary;

```
*Github:* [[94](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L94)]



<a name="GAS-13"></a> 
### [GAS-13] Optimize external calls with assembly for memory efficiency
Using interfaces to make external contract calls in Solidity is convenient but can be inefficient in terms of memory utilization. Each such call involves creating a new memory location to store the data being passed, thus incurring memory expansion costs.

Inline assembly allows for optimized memory usage by re-using already allocated memory spaces or using the scratch space for smaller datasets. This can result in notable gas savings, especially for contracts that make frequent external calls.

Additionally, using inline assembly enables important safety checks like verifying if the target address has code deployed to it using `extcodesize(addr)` before making the call, mitigating risks associated with contract interactions.

<details>
<summary>
There are <b>12</b> instances (click to show):
</summary>

```solidity
File: src/DelegationSurrogate.sol

/// @audit `.delegate(...)`
26:     _token.delegate(_delegatee);

/// @audit `.approve(...)`
27:     _token.approve(msg.sender, type(uint256).max);

```
*Github:* [[26](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L26), [27](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L27)]


```solidity
File: src/UniStaker.sol

/// @audit `.permit(...)`
301:     STAKE_TOKEN.permit(msg.sender, address(this), _amount, _deadline, _v, _r, _s);

/// @audit `.permit(...)`
371:     STAKE_TOKEN.permit(msg.sender, address(this), _amount, _deadline, _v, _r, _s);

/// @audit `.balanceOf(...)`
595:       (scaledRewardRate * REWARD_DURATION) > (REWARD_TOKEN.balanceOf(address(this)) * SCALE_FACTOR)

/// @audit `.safeTransferFrom(...)`
624:     SafeERC20.safeTransferFrom(IERC20(address(STAKE_TOKEN)), _from, _to, _value);

/// @audit `.safeTransfer(...)`
749:     SafeERC20.safeTransfer(REWARD_TOKEN, _beneficiary, _reward);

```
*Github:* [[301](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L301), [371](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L371), [595](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L595), [624](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L624), [749](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L749)]


```solidity
File: src/V3FactoryOwner.sol

/// @audit `.enableFeeAmount(...)`
133:     FACTORY.enableFeeAmount(_fee, _tickSpacing);

/// @audit `.setFeeProtocol(...)`
148:     _pool.setFeeProtocol(_feeProtocol0, _feeProtocol1);

/// @audit `.safeTransferFrom(...)`
187:     PAYOUT_TOKEN.safeTransferFrom(msg.sender, address(REWARD_RECEIVER), payoutAmount);

/// @audit `.notifyRewardAmount(...)`
188:     REWARD_RECEIVER.notifyRewardAmount(payoutAmount);

/// @audit `.collectProtocol(...)`
190:       _pool.collectProtocol(_recipient, _amount0Requested, _amount1Requested);

```
*Github:* [[133](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L133), [148](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L148), [187](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L187), [188](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L188), [190](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L190)]


</details>


<a name="GAS-14"></a> 
### [GAS-14] Use assembly to compute hashes to save gas
If the arguments to the encode call can fit into the scratch space (two words or fewer), then it's more efficient to use assembly to generate the hash (80 gas):

`keccak256(abi.encodePacked(x, y)) -> assembly {mstore(0x00, a); mstore(0x20, b); let hash := keccak256(0x00, 0x40); }`

<details>
<summary>
There are <b>12</b> instances (click to show):
</summary>

```solidity
File: src/UniStaker.sol

102:   bytes32 public constant STAKE_TYPEHASH = keccak256(

107:     keccak256("StakeMore(uint256 depositId,uint256 amount,address depositor,uint256 nonce)");

109:   bytes32 public constant ALTER_DELEGATEE_TYPEHASH = keccak256(

113:   bytes32 public constant ALTER_BENEFICIARY_TYPEHASH = keccak256(

118:     keccak256("Withdraw(uint256 depositId,uint256 amount,address depositor,uint256 nonce)");

121:     keccak256("ClaimReward(address beneficiary,uint256 nonce)");

325:         keccak256(

394:         keccak256(

435:         keccak256(

478:         keccak256(

524:         keccak256(

548:         keccak256(abi.encode(CLAIM_REWARD_TYPEHASH, _beneficiary, _useNonce(_beneficiary)))

```
*Github:* [[102](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L102), [107](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L107), [109](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L109), [113](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L113), [118](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L118), [121](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L121), [325](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L325), [394](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L394), [435](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L435), [478](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L478), [524](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L524), [548](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L548)]


</details>


<a name="GAS-15"></a> 
### [GAS-15] Use assembly to emit events
To efficiently emit events, it's possible to utilize assembly by making use of scratch space and the free memory pointer. This approach has the advantage of potentially avoiding the costs associated with memory expansion.

However, it's important to note that in order to safely optimize this process, it is preferable to cache and restore the free memory pointer.

A good example of such practice can be seen in [Solady's](https://github.com/Vectorized/solady/blob/main/src/tokens/ERC1155.sol#L167) codebase.

<details>
<summary>
There are <b>17</b> instances (click to show):
</summary>

```solidity
File: src/UniStaker.sol

213:     emit RewardNotifierSet(_rewardNotifier, _isEnabled);

598:     emit RewardNotified(_amount, msg.sender);

614:       emit SurrogateDeployed(_delegatee, address(_surrogate));

661:     emit StakeDeposited(_depositor, _depositId, _amount, _amount);

662:     emit BeneficiaryAltered(_depositId, address(0), _beneficiary);

663:     emit DelegateeAltered(_depositId, address(0), _delegatee);

682:     emit StakeDeposited(deposit.owner, _depositId, _amount, deposit.balance);

695:     emit DelegateeAltered(_depositId, deposit.delegatee, _newDelegatee);

715:     emit BeneficiaryAltered(_depositId, deposit.beneficiary, _newBeneficiary);

734:     emit StakeWithdrawn(_depositId, _amount, deposit.balance);

747:     emit RewardClaimed(_beneficiary, _reward);

773:     emit AdminSet(admin, _newAdmin);

```
*Github:* [[213](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L213), [598](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L598), [614](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L614), [661](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L661), [662](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L662), [663](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L663), [682](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L682), [695](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L695), [715](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L715), [734](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L734), [747](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L747), [773](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L773)]


```solidity
File: src/V3FactoryOwner.sol

104:     emit AdminSet(address(0), _admin);

105:     emit PayoutAmountSet(0, _payoutAmount);

113:     emit AdminSet(admin, _newAdmin);

122:     emit PayoutAmountSet(payoutAmount, _newPayoutAmount);

196:     emit FeesClaimed(address(_pool), msg.sender, _recipient, _amount0, _amount1);

```
*Github:* [[104](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L104), [105](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L105), [113](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L113), [122](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L122), [196](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L196)]


</details>


<a name="GAS-16"></a> 
### [GAS-16] Use assembly to validate `msg.sender`

*There are <b>2</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

780:     if (msg.sender != admin) revert UniStaker__Unauthorized("not admin", msg.sender);

```
*Github:* [[780](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L780)]


```solidity
File: src/V3FactoryOwner.sol

203:     if (msg.sender != admin) revert V3FactoryOwner__Unauthorized();

```
*Github:* [[203](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L203)]



<a name="GAS-17"></a> 
### [GAS-17] Use assembly to write address/contract type storage values
Using `assembly { sstore(state.slot, addr)` instead of `state = addr` can save gas.

*There are <b>8</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

193:     REWARD_TOKEN = _rewardToken;

194:     STAKE_TOKEN = _stakeToken;

774:     admin = _newAdmin;

```
*Github:* [[193](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L193), [194](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L194), [774](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L774)]


```solidity
File: src/V3FactoryOwner.sol

98:     admin = _admin;

99:     FACTORY = _factory;

100:     PAYOUT_TOKEN = _payoutToken;

102:     REWARD_RECEIVER = _rewardReceiver;

114:     admin = _newAdmin;

```
*Github:* [[98](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L98), [99](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L99), [100](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L100), [102](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L102), [114](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L114)]



<a name="GAS-18"></a> 
### [GAS-18] Use local variables for emitting
Use the function/modifier's local copy of the state variable, rather than incurring an extra Gwarmaccess (100 gas). In the unlikely event that the state variable hasn't already been used by the function/modifier, consider whether it is really necessary to include it in the event, given the fact that it incurs a Gcoldsload (2100 gas), or whether it can be passed in to or back out of the functions that do use it

*There are <b>3</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

/// @audit `admin`
773:     emit AdminSet(admin, _newAdmin);

```
*Github:* [[773](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L773)]


```solidity
File: src/V3FactoryOwner.sol

/// @audit `admin`
113:     emit AdminSet(admin, _newAdmin);

/// @audit `payoutAmount`
122:     emit PayoutAmountSet(payoutAmount, _newPayoutAmount);

```
*Github:* [[113](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L113), [122](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L122)]



<a name="GAS-19"></a> 
### [GAS-19] Use a more recent version of solidity
- Use a solidity version of at least 0.8.2 to get simple compiler automatic inlining.
- Use a solidity version of at least 0.8.3 to get better struct packing and cheaper multiple storage reads.
- Use a solidity version of at least 0.8.4 to get custom errors, which are cheaper at deployment than revert()/require() strings.
- Use a solidity version of at least 0.8.10 to have external calls skip contract existence checks if the external call has a return value.

*There are <b>7</b> instances of this issue:*
```solidity
File: src/DelegationSurrogate.sol

2: pragma solidity 0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L2)]


```solidity
File: src/UniStaker.sol

2: pragma solidity 0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L2)]


```solidity
File: src/V3FactoryOwner.sol

2: pragma solidity 0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L2)]


```solidity
File: src/interfaces/IERC20Delegates.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L2)]


```solidity
File: src/interfaces/INotifiableRewardReceiver.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/INotifiableRewardReceiver.sol#L2)]


```solidity
File: src/interfaces/IUniswapV3FactoryOwnerActions.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3FactoryOwnerActions.sol#L2)]


```solidity
File: src/interfaces/IUniswapV3PoolOwnerActions.sol

2: pragma solidity ^0.8.23;

```
*Github:* [[2](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L2)]



<a name="GAS-20"></a> 
### [GAS-20] State variables can be packed into fewer storage slots by truncating timestamp bytes
State variables in Solidity are typically stored in 32-byte storage slots. When dealing with timestamps, which generally fit into a smaller byte size, it can be beneficial to truncate these bytes and pack them with other variables. This reduces the number of required storage slots, saving both storage space and associated gas costs. For example, a timestamp generally fits into a uint32, so it can be combined with other small variables within a single storage slot. When designing a contract, carefully structuring state variables to utilize truncation and packing can lead to a more efficient and cost-effective implementation.

*There are <b>2</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

159:   uint256 public rewardEndTime;

162:   uint256 public lastCheckpointTime;

```
*Github:* [[159](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L159), [162](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L162)]



<a name="GAS-21"></a> 
### [GAS-21] Consider Using Solady's Gas Optimized Lib for Math
In instances where many similar mathematical operations are performed, consider using Solday's math lib to benefit from the gas saving it can introduce.

*There are <b>3</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

233:       + (scaledRewardRate * (lastTimeRewardDistributed() - lastCheckpointTime)) / totalStaked;

578:       scaledRewardRate = (_amount * SCALE_FACTOR) / REWARD_DURATION;

581:       scaledRewardRate = (_remainingReward + _amount * SCALE_FACTOR) / REWARD_DURATION;

```
*Github:* [[233](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L233), [578](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L578), [581](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L581)]



<a name="GAS-22"></a> 
### [GAS-22] Use solady library where possible to save gas
The following OpenZeppelin imports have a Solady equivalent, as such they can be used to save GAS as Solady modules have been specifically designed to be as GAS efficient as possible

*There are <b>2</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

7: import {IERC20} from "openzeppelin/token/ERC20/IERC20.sol";

```
*Github:* [[7](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L7)]


```solidity
File: src/V3FactoryOwner.sol

7: import {IERC20} from "openzeppelin/token/ERC20/IERC20.sol";

```
*Github:* [[7](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L7)]



<a name="GAS-23"></a> 
### [GAS-23] Use `uint256(1)`/`uint256(2)` instead of `true`/`false` to save gas for changes
Avoids a Gsset (20000 gas) when changing from false to true, after having been true in the past. Since most of the bools aren't changed twice in one transaction, I've counted the amount of gas as half of the full amount, for each variable.

*There is one instance of this issue:*
```solidity
File: src/UniStaker.sol

185:   mapping(address rewardNotifier => bool) public isRewardNotifier;

```
*Github:* [[185](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L185)]



<a name="GAS-24"></a> 
### [GAS-24] Using bitmap to store bool states can save gas
Using a bitmap instead of a bool array or a bool mapping to store boolean states can save gas fees. This is because the bitmap can store 256 boolean values in a single slot instead of 256 slots, which can save gas when writing bool values or when reading multiple bool values from the same slot.

*There is one instance of this issue:*
```solidity
File: src/UniStaker.sol

185:   mapping(address rewardNotifier => bool) public isRewardNotifier;

```
*Github:* [[185](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L185)]



<a name="GAS-25"></a> 
### [GAS-25] Using `constant`s directly, rather than caching the value, saves gas

*There are <b>3</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

/// @audit `REWARD_DURATION`
578:       scaledRewardRate = (_amount * SCALE_FACTOR) / REWARD_DURATION;

/// @audit `REWARD_DURATION`
581:       scaledRewardRate = (_remainingReward + _amount * SCALE_FACTOR) / REWARD_DURATION;

/// @audit `REWARD_DURATION`
584:     rewardEndTime = block.timestamp + REWARD_DURATION;

```
*Github:* [[578](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L578), [581](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L581), [584](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L584)]



<a name="GAS-26"></a> 
### [GAS-26] `abi.encodePacked` is more gas efficient than `abi.encode`
`abi.encode` pads all elementary types to 32 bytes, whereas `abi.encodePacked` will only use the minimal required memory to encode the data. See [here](https://docs.soliditylang.org/en/v0.8.11/abi-spec.html?highlight=encodepacked#non-standard-packed-mode) for more info.

*There are <b>6</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

326:           abi.encode(

395:           abi.encode(STAKE_MORE_TYPEHASH, _depositId, _amount, _depositor, _useNonce(_depositor))

436:           abi.encode(

479:           abi.encode(

525:           abi.encode(WITHDRAW_TYPEHASH, _depositId, _amount, _depositor, _useNonce(_depositor))

548:         keccak256(abi.encode(CLAIM_REWARD_TYPEHASH, _beneficiary, _useNonce(_beneficiary)))

```
*Github:* [[326](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L326), [395](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L395), [436](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L436), [479](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L479), [525](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L525), [548](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L548)]



<a name="GAS-27"></a> 
### [GAS-27] Using bools for storage incurs overhead
Use uint256(1) and uint256(2) for true/false to avoid a Gwarmaccess (100 gas), and to avoid Gsset (20000 gas) when changing from ‘false’ to ‘true’, after having been ‘true’ in the past. See [source](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/58f635312aa21f947cae5f8578638a85aa2519f5/contracts/security/ReentrancyGuard.sol#L23-L27).

*There is one instance of this issue:*
```solidity
File: src/UniStaker.sol

185:   mapping(address rewardNotifier => bool) public isRewardNotifier;

```
*Github:* [[185](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L185)]



<a name="GAS-28"></a> 
### [GAS-28] State variables should be cached in stack variables rather than re-reading them from storage
The instances below point to the second+ access of a state variable within a function. Caching of a state variable replaces each Gwarmaccess (100 gas) with a much cheaper stack read. Other less obvious fixes/optimizations include having local memory caches of state variable structs, or having local caches of state variable contracts/addresses.

*There are <b>9</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

/// @audit more than 1 read for `scaledRewardRate`, line 580 and 578
580:       uint256 _remainingReward = scaledRewardRate * (rewardEndTime - block.timestamp);

/// @audit more than 1 read for `scaledRewardRate`, line 581 and 578
581:       scaledRewardRate = (_remainingReward + _amount * SCALE_FACTOR) / REWARD_DURATION;

/// @audit more than 1 read for `rewardEndTime`, line 584 and 577
584:     rewardEndTime = block.timestamp + REWARD_DURATION;

/// @audit more than 1 read for `nextDepositId`, line 632 and 631
632:     nextDepositId = DepositIdentifier.wrap(DepositIdentifier.unwrap(_depositId) + 1);

```
*Github:* [[580](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L580), [581](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L581), [584](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L584), [632](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L632)]


```solidity
File: src/V3FactoryOwner.sol

/// @audit more than 1 read for `admin`, line 98 and 95
98:     admin = _admin;

/// @audit more than 1 read for `payoutAmount`, line 101 and 96
101:     payoutAmount = _payoutAmount;

/// @audit more than 1 read for `admin`, line 114 and 95
114:     admin = _newAdmin;

/// @audit more than 1 read for `payoutAmount`, line 123 and 96
123:     payoutAmount = _newPayoutAmount;

/// @audit more than 1 read for `admin`, line 203 and 95
203:     if (msg.sender != admin) revert V3FactoryOwner__Unauthorized();

```
*Github:* [[98](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L98), [101](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L101), [114](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L114), [123](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L123), [203](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L203)]



<a name="GAS-29"></a> 
### [GAS-29] Use `calldata` instead of `memory` for function arguments that do not get mutated
Mark data types as `calldata` instead of `memory` where possible. This makes it so that the data is not automatically loaded into memory. If the data passed into the function does not need to be changed (like updating values in an array), it can be passed in as `calldata`. The one exception to this is if the argument must later be passed into another function that takes an argument that specifies `memory` storage.

*There are <b>6</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

/// @audit make `_signature` as a calldata
320:     bytes memory _signature

/// @audit make `_signature` as a calldata
386:     bytes memory _signature

/// @audit make `_signature` as a calldata
427:     bytes memory _signature

/// @audit make `_signature` as a calldata
470:     bytes memory _signature

/// @audit make `_signature` as a calldata
516:     bytes memory _signature

/// @audit make `_signature` as a calldata
544:   function claimRewardOnBehalf(address _beneficiary, bytes memory _signature) external {

```
*Github:* [[320](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L320), [386](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L386), [427](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L427), [470](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L470), [516](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L516), [544](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L544)]



<a name="GAS-30"></a> 
### [GAS-30] Usage of `int`s/`uint`s smaller than 32 bytes incurs overhead
Using `int`s/`uint`s smaller than 32 bytes may cost more gas. This is because the EVM operates on 32 bytes at a time, so if an element is smaller than 32 bytes, the EVM must perform more operations to reduce the size of the element from 32 bytes to the desired size.

<details>
<summary>
There are <b>18</b> instances (click to show):
</summary>

```solidity
File: src/UniStaker.sol

297:     uint8 _v,

364:     uint8 _v,

```
*Github:* [[297](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L297), [364](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L364)]


```solidity
File: src/V3FactoryOwner.sol

144:     uint8 _feeProtocol0,

145:     uint8 _feeProtocol1

184:     uint128 _amount0Requested,

185:     uint128 _amount1Requested

186:   ) external returns (uint128, uint128) {

186:   ) external returns (uint128, uint128) {

189:     (uint128 _amount0, uint128 _amount1) =

189:     (uint128 _amount0, uint128 _amount1) =

```
*Github:* [[144](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L144), [145](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L145), [184](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L184), [185](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L185), [186](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L186), [186](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L186), [189](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L189), [189](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L189)]


```solidity
File: src/interfaces/IERC20Delegates.sol

13:   function decimals() external view returns (uint8);

23:     uint8 v,

```
*Github:* [[13](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L13), [23](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IERC20Delegates.sol#L23)]


```solidity
File: src/interfaces/IUniswapV3PoolOwnerActions.sol

12:   function setFeeProtocol(uint8 feeProtocol0, uint8 feeProtocol1) external;

12:   function setFeeProtocol(uint8 feeProtocol0, uint8 feeProtocol1) external;

22:   function collectProtocol(address recipient, uint128 amount0Requested, uint128 amount1Requested)

22:   function collectProtocol(address recipient, uint128 amount0Requested, uint128 amount1Requested)

24:     returns (uint128 amount0, uint128 amount1);

24:     returns (uint128 amount0, uint128 amount1);

```
*Github:* [[12](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L12), [12](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L12), [22](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L22), [22](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L22), [24](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L24), [24](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/interfaces/IUniswapV3PoolOwnerActions.sol#L24)]


</details>


<a name="GAS-31"></a> 
### [GAS-31] Constructors can be marked as `payable` to save deployment gas
Payable functions cost less gas to execute, because the compiler does not have to add extra checks to ensure that no payment is provided. A constructor can be safely marked as payable, because only the deployer would be able to pass funds, and the project itself would not pass any funds.

*There is one instance of this issue:*
```solidity
File: src/DelegationSurrogate.sol

25:   constructor(IERC20Delegates _token, address _delegatee) {

```
*Github:* [[25](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/DelegationSurrogate.sol#L25)]



<a name="GAS-32"></a> 
### [GAS-32] Using `private` rather than `public` for constants, saves gas
If needed, the values can be read from the verified contract source code, or if there are multiple values there can be a single getter function that [returns a tuple](https://github.com/code-423n4/2022-08-frax/blob/90f55a9ce4e25bceed3a74290b854341d8de6afa/src/contracts/FraxlendPair.sol#L156-L178) of the values of all currently-public constants. Saves **3406-3606 gas** in deployment gas due to the compiler not having to create non-payable getter functions for deployment calldata, not having to store the bytes of the value outside of where it's used, and not adding another entry to the method ID table

*There are <b>8</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

102:   bytes32 public constant STAKE_TYPEHASH = keccak256(

106:   bytes32 public constant STAKE_MORE_TYPEHASH =

109:   bytes32 public constant ALTER_DELEGATEE_TYPEHASH = keccak256(

113:   bytes32 public constant ALTER_BENEFICIARY_TYPEHASH = keccak256(

117:   bytes32 public constant WITHDRAW_TYPEHASH =

120:   bytes32 public constant CLAIM_REWARD_TYPEHASH =

130:   uint256 public constant REWARD_DURATION = 30 days;

134:   uint256 public constant SCALE_FACTOR = 1e36;

```
*Github:* [[102](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L102), [106](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L106), [109](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L109), [113](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L113), [117](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L117), [120](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L120), [130](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L130), [134](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L134)]



<a name="GAS-33"></a> 
### [GAS-33] Use assembly to check for `address(0)`
Saves 6 gas per instance.

*There are <b>4</b> instances of this issue:*
```solidity
File: src/UniStaker.sol

611:     if (address(_surrogate) == address(0)) {

795:     if (_account == address(0)) revert UniStaker__InvalidAddress();

```
*Github:* [[611](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L611), [795](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/UniStaker.sol#L795)]


```solidity
File: src/V3FactoryOwner.sol

95:     if (_admin == address(0)) revert V3FactoryOwner__InvalidAddress();

112:     if (_newAdmin == address(0)) revert V3FactoryOwner__InvalidAddress();

```
*Github:* [[95](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L95), [112](https://github.com/code-423n4/2024-02-uniswap-foundation/blob/d8fee534d3ec63953499d7fbf6de1af2359562a1/src/V3FactoryOwner.sol#L112)]



