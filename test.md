# Report

Audit report for **2023-10-ens** generated by *ubl4nk_bot*.

## Medium Issues


Total <b>6</b> instances over <b>3</b> issues:

|ID|Issue|Instances|
|-|:-|:-:|
| [M-1](#M-1) | Return values of `approve()` not checked | 1 |
| [M-2](#M-2) | Return values of `transfer()`/`transferFrom()` not checked | 3 |
| [M-3](#M-3) | Centralization Risk for trusted owners | 2 |

## Low Issues


Total <b>8</b> instances over <b>7</b> issues:

|ID|Issue|Instances|
|-|:-|:-:|
| [L-1](#L-1) | `approve()`/`safeApprove()` may revert if the current approval is not zero | 1 |
| [L-2](#L-2) | Constructor / initialization function lacks parameter validation | 2 |
| [L-3](#L-3) | Missing zero address check in constructor | 1 |
| [L-4](#L-4) | Owner can renounce Ownership | 1 |
| [L-5](#L-5) | prevent re-setting a state variable with the same value | 1 |
| [L-6](#L-6) | Solidity version 0.8.20 or above may not work on other chains due to PUSH0 | 1 |
| [L-7](#L-7) | Use Ownable2Step instead of Ownable | 1 |

## Non Critical Issues


Total <b>62</b> instances over <b>28</b> issues:

|ID|Issue|Instances|
|-|:-|:-:|
| [NC-1](#NC-1) | Assembly blocks should have extensive comments | 1 |
| [NC-2](#NC-2) | `assert()` should be replaced with `require()` or `revert()` | 1 |
| [NC-3](#NC-3) | Contract declarations should have NatSpec `@author` annotations | 1 |
| [NC-4](#NC-4) | Consider adding a block/deny-list | 2 |
| [NC-5](#NC-5) | Consider adding formal verification proofs | 1 |
| [NC-6](#NC-6) | Constants should be put on the left side of comparisons | 1 |
| [NC-7](#NC-7) | Contracts should have full test coverage | 1 |
| [NC-8](#NC-8) | Events that mark critical parameter changes should contain both the old and the new value | 2 |
| [NC-9](#NC-9) | Enable IR-based code generation | 1 |
| [NC-10](#NC-10) | Events are emitted without the sender information | 1 |
| [NC-11](#NC-11) |  Function ordering does not follow the Solidity Style Guide | 1 |
| [NC-12](#NC-12) | Functions with array parameters should have length checks in place | 1 |
| [NC-13](#NC-13) | Import declarations should import specific identifiers, rather than the whole file | 4 |
| [NC-14](#NC-14) | Large or complicated code bases should implement invariant tests | 1 |
| [NC-15](#NC-15) | Long functions should be refactored into multiple, smaller, functions | 1 |
| [NC-16](#NC-16) | Missing zero address check in functions with address parameters | 8 |
| [NC-17](#NC-17) | Event declarations should have NatSpec descriptions | 2 |
| [NC-18](#NC-18) | NatSpec documentation for function is missing | 8 |
| [NC-19](#NC-19) | Missing NatSpec `@param` | 8 |
| [NC-20](#NC-20) | Public variable declarations should have NatSpec descriptions | 1 |
| [NC-21](#NC-21) | NatSpec `@return` is missing | 3 |
| [NC-22](#NC-22) | There is no need to initialize variables with 0 | 1 |
| [NC-23](#NC-23) | Contract declarations should have NatSpec `@title` annotations | 1 |
| [NC-24](#NC-24) | Solidity compiler version is not fixed | 1 |
| [NC-25](#NC-25) | Use the latest solidity version for deployment | 1 |
| [NC-26](#NC-26) | Names of `private`/`internal` functions should be prefixed with an underscore | 5 |
| [NC-27](#NC-27) | Return values of `approve()` not checked | 1 |
| [NC-28](#NC-28) | Event is missing `indexed` fields | 2 |

## Gas Optimizations


Total <b>42</b> instances over <b>18</b> issues:

|ID|Issue|Instances|Gas|
|-|:-|:-:|:-:|
| [GAS-1](#GAS-1) | Consider activating via-ir for deploying | 1 | - |
| [GAS-2](#GAS-2) | `internal` functions only called once can be inlined to save gas | 6 | 180 |
| [GAS-3](#GAS-3) | Newer versions of solidity are more gas efficient | 1 | - |
| [GAS-4](#GAS-4) | Operator `>=`/`<=` costs less gas than operator `>`/`<` | 10 | 30 |
| [GAS-5](#GAS-5) | Reduce gas usage by moving to Solidity 0.8.19 or later | 1 | 1000 |
| [GAS-6](#GAS-6) | `require()`/`revert()` strings longer than 32 bytes cost extra gas | 2 | 6 |
| [GAS-7](#GAS-7) | The result of a function call should be cached rather than re-calling the function | 1 | 100 |
| [GAS-8](#GAS-8) | Use assembly to compute hashes to save gas | 2 | 160 |
| [GAS-9](#GAS-9) | Use assembly to emit events | 2 | 76 |
| [GAS-10](#GAS-10) | Use a more recent version of solidity | 1 | - |
| [GAS-11](#GAS-11) | Use `calldata` instead of `memory` for function arguments that do not get mutated | 2 | - |
| [GAS-12](#GAS-12) | Don't initialize variables with default value | 1 | - |
| [GAS-13](#GAS-13) | Usage of `int`s/`uint`s smaller than 32 bytes incurs overhead | 4 | 220 |
| [GAS-14](#GAS-14) | Constructors can be marked as `payable` to save deployment gas | 1 | 21 |
| [GAS-15](#GAS-15) | Functions guaranteed to revert when called by normal users can be marked `payable` | 1 | 21 |
| [GAS-16](#GAS-16) | `++i` costs less gas than `i++`, especially when it's used in `for`-loops (`--i`/`i--` too) | 1 | 5 |
| [GAS-17](#GAS-17) | Use `!= 0` instead of `> 0` for unsigned integer comparison | 4 | 16 |
| [GAS-18](#GAS-18) | Using assembly to check for zero can save gas | 1 | 6 |

## Medium Issues

<a name="M-1"></a> 
### [M-1] Return values of `approve()` not checked
Not all IERC20 implementations `revert()` when there's a failure in `approve()`. The function signature has a boolean return value and they indicate errors that way instead. By not checking the return value, operations that should have marked as failed, may potentially go through without actually approving anything

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

17:         _token.approve(msg.sender, type(uint256).max);

```
[#L17](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L17) 

---

<a name="M-2"></a> 
### [M-2] Return values of `transfer()`/`transferFrom()` not checked
Not all ERC20 implementations `revert()` when there's a failure in `transfer()` or `transferFrom()`. The function signature has a boolean return value and they indicate errors that way instead. By not checking the return value, operations that should have marked as failed, may potentially go through without actually transfer anything.

There are <b>3</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

148:         token.transferFrom(proxyAddressFrom, msg.sender, amount);

160:         token.transferFrom(msg.sender, proxyAddress, amount);

170:         token.transferFrom(proxyAddressFrom, proxyAddressTo, amount);

```
[#L148](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L148) [#L160](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L160) [#L170](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L170) 

---

<a name="M-3"></a> 
### [M-3] Centralization Risk for trusted owners
Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

There are <b>2</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

25: contract ERC20MultiDelegate is ERC1155, Ownable {

151:     function setUri(string memory uri) external onlyOwner {

```
[#L25](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L25) [#L151](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L151) 

---


## Low Issues

<a name="L-1"></a> 
### [L-1] `approve()`/`safeApprove()` may revert if the current approval is not zero
Calling `approve()` without first calling `approve(0)` if the current approval is non-zero will revert with some tokens, such as Tether (USDT). While Tether is known to do this, it applies to other tokens as well, which are trying to protect against [this attack vector](https://docs.google.com/document/d/1YLPtQxZu1UAvO9cZ1O2RPXBbT0mooh4DYKjA_jp-RLM/edit). `safeApprove()` itself also implements this protection. Always reset the approval to zero before changing it to a new value (`SafeERC20.forceApprove()` does this for you), or use `safeIncreaseAllowance()`/`safeDecreaseAllowance()`

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

17:         _token.approve(msg.sender, type(uint256).max);

```
[#L17](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L17) 

---

<a name="L-2"></a> 
### [L-2] Constructor / initialization function lacks parameter validation
Constructors and initialization functions play a critical role in contracts by setting important initial states when the contract is first deployed before the system starts. The parameters passed to the constructor and initialization functions directly affect the behavior of the contract / protocol. If incorrect parameters are provided, the system may fail to run, behave abnormally, be unstable, or lack security. Therefore, it's crucial to carefully check each parameter in the constructor and initialization functions. If an exception is found, the transaction should be rolled back.

There are <b>2</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

/// @audit `_token` not validated
/// @audit `_delegate` not validated
16:     constructor(ERC20Votes _token, address _delegate) {

/// @audit `_token` not validated
/// @audit `_metadata_uri` not validated
44:     constructor(
            ERC20Votes _token,
            string memory _metadata_uri
        ) ERC1155(_metadata_uri) {

```
[#L16](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L16) [#L44](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L44) 

---

<a name="L-3"></a> 
### [L-3] Missing zero address check in constructor
Constructors often take address parameters to initialize important components of a contract, such as owner or linked contracts. However, without a checking, there's a risk that an address parameter could be mistakenly set to the zero address (0x0). This could be due to an error or oversight during contract deployment. A zero address in a crucial role can cause serious issues, as it cannot perform actions like a normal address, and any funds sent to it will be irretrievable. It's therefore crucial to include a zero address check in constructors to prevent such potential problems. If a zero address is detected, the constructor should revert the transaction.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

/// @audit Missing zero check for `_delegate`
16:     constructor(ERC20Votes _token, address _delegate) {

```
[#L16](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L16) 

---

<a name="L-4"></a> 
### [L-4] Owner can renounce Ownership
Each of the following contracts implements or inherits the `renounceOwnership()` function. This can represent a certain risk if the ownership is renounced for any other reason than by design. Renouncing ownership will leave the contract without an owner, thereby removing any functionality that is only available to the owner.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

25: contract ERC20MultiDelegate is ERC1155, Ownable {

```
[#L25](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L25) 

---

<a name="L-5"></a> 
### [L-5] prevent re-setting a state variable with the same value
Not only is wasteful in terms of gas, but this is especially problematic when an event is emitted and the old and new values set are the same, as listeners might not expect this kind of scenario.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

48:         token = _token;

```
[#L48](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L48) 

---

<a name="L-6"></a> 
### [L-6] Solidity version 0.8.20 or above may not work on other chains due to PUSH0
Solidity version 0.8.20 or above uses the new [Shanghai EVM](https://blog.soliditylang.org/2023/05/10/solidity-0.8.20-release-announcement/#important-note) which introduces the PUSH0 opcode. This op code may not yet be implemented on all evm-chains or Layer2s, so deployment on these chains will fail. Consider using an earlier solidity version.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

2: pragma solidity ^0.8.2;

```
[#L2](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L2) 

---

<a name="L-7"></a> 
### [L-7] Use Ownable2Step instead of Ownable
`Ownable2Step` and `Ownable2StepUpgradeable` prevent the contract ownership from mistakenly being transferred to an address that cannot handle it (e.g. due to a typo in the address), by requiring that the recipient of the owner permissions actively accept via a contract call of its own.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

25: contract ERC20MultiDelegate is ERC1155, Ownable {

```
[#L25](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L25) 

---


## Non Critical Issues

<a name="NC-1"></a> 
### [NC-1] Assembly blocks should have extensive comments
Assembly blocks take a lot more time to audit than normal Solidity code, and often have gotchas and side-effects that the Solidity versions of the same code do not. Consider adding more comments explaining what is being done in every step of the assembly code, and describe why assembly is being used instead of Solidity.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

180:         assembly {

```
[#L180](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L180) 

---

<a name="NC-2"></a> 
### [NC-2] `assert()` should be replaced with `require()` or `revert()`
In versions of Solidity prior to 0.8.0, when encountering an assert all the remaining gas will be consumed. Even after solidity 0.8.0, the assert function is still not recommended, as described in the [documentation](https://docs.soliditylang.org/en/v0.8.20/control-structures.html#panic-via-assert-and-error-via-require):
> Assert should only be used to test for internal errors, and to check invariants. Properly functioning code should never create a Panic, not even on invalid external input. If this happens, then there is a bug in your contract which you should fix.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

131:         assert(amount <= balance);

```
[#L131](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L131) 

---

<a name="NC-3"></a> 
### [NC-3] Contract declarations should have NatSpec `@author` annotations

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

15: contract ERC20ProxyDelegator {

```
[#L15](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L15) 

---

<a name="NC-4"></a> 
### [NC-4] Consider adding a block/deny-list
Doing so will significantly increase centralization, but will help to prevent hackers from using stolen tokens.

There are <b>2</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

15: contract ERC20ProxyDelegator {

25: contract ERC20MultiDelegate is ERC1155, Ownable {

```
[#L15](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L15) [#L25](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L25) 

---

<a name="NC-5"></a> 
### [NC-5] Consider adding formal verification proofs
Formal verification is the act of proving or disproving the correctness of intended algorithms underlying a system with respect to a certain formal specification/property/invariant, using formal methods of mathematics.

Some tools that are currently available to perform these tests on smart contracts are [SMTChecker](https://docs.soliditylang.org/en/latest/smtchecker.html) and [Certora Prover](https://www.certora.com/).

There is <b>1</b> instance:
```solidity

Global finding

```


---

<a name="NC-6"></a> 
### [NC-6] Constants should be put on the left side of comparisons
Putting constants on the left side of comparison statements is a best practice known as [Yoda conditions](https://en.wikipedia.org/wiki/Yoda_conditions). Although solidity's static typing system prevents accidental assignments within conditionals, adopting this practice can improve code readability and consistency, especially when working across multiple languages.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

185:         if (bytecodeSize == 0) {

```
[#L185](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L185) 

---

<a name="NC-7"></a> 
### [NC-7] Contracts should have full test coverage
While 100% code coverage does not guarantee that there are no bugs, it often will catch easy-to-find bugs, and will ensure that there are fewer regressions when the code invariably has to be modified. Furthermore, in order to get full coverage, code authors will often have to re-organize their code so that it is more modular, so that each component can be tested separately, which reduces interdependencies between modules and layers, and makes for code that is easier to reason about and audit.

There is <b>1</b> instance:
```solidity

Global finding

```


---

<a name="NC-8"></a> 
### [NC-8] Events that mark critical parameter changes should contain both the old and the new value
This should especially be done if the new value is not required to be different from the old value.

There are <b>2</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

136:         emit DelegationProcessed(source, target, amount);

187:             emit ProxyDeployed(delegate, proxyAddress);

```
[#L136](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L136) [#L187](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L187) 

---

<a name="NC-9"></a> 
### [NC-9] Enable IR-based code generation
The IR-based code generator was introduced with an aim to not only allow code generation to be more transparent and auditable but also to enable more powerful optimization passes that span across functions. You can enable it on the command line using `--via-ir` or with the option `{"viaIR": true}`. This will take longer to compile, but you can just simple test it before deploying and if you got a better benchmark then you can add --via-ir to your deploy command More on: https://docs.soliditylang.org/en/v0.8.17/ir-breaking-changes.html

There is <b>1</b> instance:
```solidity

Global finding

```


---

<a name="NC-10"></a> 
### [NC-10] Events are emitted without the sender information
When an action is triggered based on a user's action, not being able to filter based on who triggered the action makes event processing a lot more cumbersome. Including the `msg.sender` the events of these types of action will make events much more useful to end users, especially when `msg.sender` is not `tx.origin`.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

136:         emit DelegationProcessed(source, target, amount);

```
[#L136](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L136) 

---

<a name="NC-11"></a> 
### [NC-11]  Function ordering does not follow the Solidity Style Guide
According to the [solidity style guide](https://docs.soliditylang.org/en/v0.8.17/style-guide.html#order-of-functions), functions should be laid out in the following order: `constructor()`, `receive()`, `fallback()`, `external`, `public`, `internal`, `private`, but the cases below do not follow this pattern

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

/// @audit internal function `_delegateMulti` came earlier from this external function
/// @audit internal function `_processDelegation` came earlier from this external function
/// @audit internal function `_reimburse` came earlier from this external function
151:     function setUri(string memory uri) external onlyOwner {

```
[#L151](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L151) 

---

<a name="NC-12"></a> 
### [NC-12] Functions with array parameters should have length checks in place

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

/// @audit `sources`
/// @audit `targets`
/// @audit `amounts`
57:     function delegateMulti(
            uint256[] calldata sources,
            uint256[] calldata targets,
            uint256[] calldata amounts
        ) external {

```
[#L57](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L57) 

---

<a name="NC-13"></a> 
### [NC-13] Import declarations should import specific identifiers, rather than the whole file
Using import declarations of the form `import {<identifier_name>} from "some/file.sol"` avoids polluting the symbol namespace making flattened files smaller, and speeds up compilation (but does not save any gas).

There are <b>4</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

6: import "@openzeppelin/contracts/access/Ownable.sol";

7: import "@openzeppelin/contracts/token/ERC1155/ERC1155.sol";

8: import "@openzeppelin/contracts/token/ERC20/extensions/ERC20Votes.sol";

9: import "@openzeppelin/contracts/utils/math/Math.sol";

```
[#L6](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L6) [#L7](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L7) [#L8](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L8) [#L9](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L9) 

---

<a name="NC-14"></a> 
### [NC-14] Large or complicated code bases should implement invariant tests
This includes: large code bases, or code with lots of inline-assembly, complicated math, or complicated interactions between multiple contracts. Invariant fuzzers such as Echidna require the test writer to come up with invariants which should not be violated under any circumstances, and the fuzzer tests various inputs and function calls to ensure that the invariants always hold. Even code with 100% code coverage can still have bugs due to the order of the operations a user performs, and invariant fuzzers may help significantly.

There is <b>1</b> instance:
```solidity

Global finding

```


---

<a name="NC-15"></a> 
### [NC-15] Long functions should be refactored into multiple, smaller, functions

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

/// @audit 51 lines
65:     function _delegateMulti(
            uint256[] calldata sources,
            uint256[] calldata targets,
            uint256[] calldata amounts
        ) internal {

```
[#L65](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L65) 

---

<a name="NC-16"></a> 
### [NC-16] Missing zero address check in functions with address parameters
Adding a zero address check for each address type parameter can prevent errors.

There are <b>8</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

/// @audit Missing zero check for `_delegate`
16:     constructor(ERC20Votes _token, address _delegate) {

/// @audit Missing zero check for `source`
/// @audit Missing zero check for `target`
124:     function _processDelegation(
             address source,
             address target,
             uint256 amount
         ) internal {

/// @audit Missing zero check for `source`
144:     function _reimburse(address source, uint256 amount) internal {

/// @audit Missing zero check for `target`
155:     function createProxyDelegatorAndTransfer(
             address target,
             uint256 amount
         ) internal {

/// @audit Missing zero check for `from`
/// @audit Missing zero check for `to`
163:     function transferBetweenDelegators(
             address from,
             address to,
             uint256 amount
         ) internal {

/// @audit Missing zero check for `delegate`
173:     function deployProxyDelegatorIfNeeded(
             address delegate
         ) internal returns (address) {

/// @audit Missing zero check for `delegate`
192:     function getBalanceForDelegate(
             address delegate
         ) internal view returns (uint256) {

/// @audit Missing zero check for `_delegate`
198:     function retrieveProxyContractAddress(
             ERC20Votes _token,
             address _delegate
         ) private view returns (address) {

```
[#L16](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L16) [#L124](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L124) [#L144](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L144) [#L155](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L155) [#L163](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L163) [#L173](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L173) [#L192](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L192) [#L198](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L198) 

---

<a name="NC-17"></a> 
### [NC-17] Event declarations should have NatSpec descriptions

There are <b>2</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

32:     event ProxyDeployed(address indexed delegate, address proxyAddress);

33:     event DelegationProcessed(

```
[#L32](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L32) [#L33](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L33) 

---

<a name="NC-18"></a> 
### [NC-18] NatSpec documentation for function is missing
It is recommended that Solidity contracts are fully annotated using NatSpec for all public interfaces (everything in the ABI). It is clearly stated in the Solidity official documentation. In complex projects such as DeFi, the interpretation of all functions and their arguments and returns is important for code readability and auditability.

There are <b>8</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

16:     constructor(ERC20Votes _token, address _delegate) {

65:     function _delegateMulti(
            uint256[] calldata sources,
            uint256[] calldata targets,
            uint256[] calldata amounts
        ) internal {

151:     function setUri(string memory uri) external onlyOwner {

155:     function createProxyDelegatorAndTransfer(
             address target,
             uint256 amount
         ) internal {

163:     function transferBetweenDelegators(
             address from,
             address to,
             uint256 amount
         ) internal {

173:     function deployProxyDelegatorIfNeeded(
             address delegate
         ) internal returns (address) {

192:     function getBalanceForDelegate(
             address delegate
         ) internal view returns (uint256) {

198:     function retrieveProxyContractAddress(
             ERC20Votes _token,
             address _delegate
         ) private view returns (address) {

```
[#L16](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L16) [#L65](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L65) [#L151](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L151) [#L155](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L155) [#L163](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L163) [#L173](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L173) [#L192](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L192) [#L198](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L198) 

---

<a name="NC-19"></a> 
### [NC-19] Missing NatSpec `@param`
Some functions have an incomplete NatSpec: add a `@param` notation to describe the function parameters to improve the code documentation.

There are <b>8</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

/// @audit Missing @param for _token
/// @audit Missing @param for _delegate
16:     constructor(ERC20Votes _token, address _delegate) {

/// @audit Missing @param for sources
/// @audit Missing @param for targets
/// @audit Missing @param for amounts
65:     function _delegateMulti(
            uint256[] calldata sources,
            uint256[] calldata targets,
            uint256[] calldata amounts
        ) internal {

/// @audit Missing @param for uri
151:     function setUri(string memory uri) external onlyOwner {

/// @audit Missing @param for target
/// @audit Missing @param for amount
155:     function createProxyDelegatorAndTransfer(
             address target,
             uint256 amount
         ) internal {

/// @audit Missing @param for from
/// @audit Missing @param for to
/// @audit Missing @param for amount
163:     function transferBetweenDelegators(
             address from,
             address to,
             uint256 amount
         ) internal {

/// @audit Missing @param for delegate
173:     function deployProxyDelegatorIfNeeded(
             address delegate
         ) internal returns (address) {

/// @audit Missing @param for delegate
192:     function getBalanceForDelegate(
             address delegate
         ) internal view returns (uint256) {

/// @audit Missing @param for _token
/// @audit Missing @param for _delegate
198:     function retrieveProxyContractAddress(
             ERC20Votes _token,
             address _delegate
         ) private view returns (address) {

```
[#L16](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L16) [#L65](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L65) [#L151](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L151) [#L155](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L155) [#L163](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L163) [#L173](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L173) [#L192](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L192) [#L198](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L198) 

---

<a name="NC-20"></a> 
### [NC-20] Public variable declarations should have NatSpec descriptions

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

28:     ERC20Votes public token;

```
[#L28](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L28) 

---

<a name="NC-21"></a> 
### [NC-21] NatSpec `@return` is missing
It is recommended that Solidity contracts are fully annotated using NatSpec

There are <b>3</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

173:     function deployProxyDelegatorIfNeeded(
             address delegate
         ) internal returns (address) {

192:     function getBalanceForDelegate(
             address delegate
         ) internal view returns (uint256) {

198:     function retrieveProxyContractAddress(
             ERC20Votes _token,
             address _delegate
         ) private view returns (address) {

```
[#L173](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L173) [#L192](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L192) [#L198](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L198) 

---

<a name="NC-22"></a> 
### [NC-22] There is no need to initialize variables with 0
Since the variables are automatically set to 0 when created, it is redundant to initialize it with 0 again.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

86:             uint transferIndex = 0;

```
[#L86](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L86) 

---

<a name="NC-23"></a> 
### [NC-23] Contract declarations should have NatSpec `@title` annotations
Some contract definitions have an incomplete NatSpec: add a `@title` notation to describe the contract to improve the code documentation.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

15: contract ERC20ProxyDelegator {

```
[#L15](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L15) 

---

<a name="NC-24"></a> 
### [NC-24] Solidity compiler version is not fixed
To prevent the actual contracts deployed from behaving differently depending on the compiler version, it is recommended to use a fixed solidity version.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

2: pragma solidity ^0.8.2;

```
[#L2](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L2) 

---

<a name="NC-25"></a> 
### [NC-25] Use the latest solidity version for deployment
Upgrading to a newer Solidity release can optimize gas usage, take advantage of new features and improve overall contract efficiency. Where possible, based on compatibility requirements, it is recommended to use newer/latest solidity version to take advantage of the latest optimizations and features.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

2: pragma solidity ^0.8.2;

```
[#L2](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L2) 

---

<a name="NC-26"></a> 
### [NC-26] Names of `private`/`internal` functions should be prefixed with an underscore
It is recommended by the [Solidity Style Guide](https://docs.soliditylang.org/en/v0.8.20/style-guide.html#underscore-prefix-for-non-external-functions-and-variables)

There are <b>5</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

155:     function createProxyDelegatorAndTransfer(
             address target,
             uint256 amount
         ) internal {

163:     function transferBetweenDelegators(
             address from,
             address to,
             uint256 amount
         ) internal {

173:     function deployProxyDelegatorIfNeeded(
             address delegate
         ) internal returns (address) {

192:     function getBalanceForDelegate(
             address delegate
         ) internal view returns (uint256) {

198:     function retrieveProxyContractAddress(
             ERC20Votes _token,
             address _delegate
         ) private view returns (address) {

```
[#L155](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L155) [#L163](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L163) [#L173](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L173) [#L192](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L192) [#L198](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L198) 

---

<a name="NC-27"></a> 
### [NC-27] Return values of `approve()` not checked
Not all IERC20 implementations `revert()` when there's a failure in `approve()`. The function signature has a boolean return value and they indicate errors that way instead. By not checking the return value, operations that should have marked as failed, may potentially go through without actually approving anything

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

17:         _token.approve(msg.sender, type(uint256).max);

```
[#L17](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L17) 

---

<a name="NC-28"></a> 
### [NC-28] Event is missing `indexed` fields
Index event fields make the field more quickly accessible to off-chain tools that parse events. However, note that each index field costs extra gas during emission, so it's not necessarily best to index the maximum allowed per event (three fields). Each event should use three indexed fields if there are three or more fields, and gas usage is not particularly of concern for the events in question. If there are fewer than three fields, all of the fields should be indexed.

There are <b>2</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

32:     event ProxyDeployed(address indexed delegate, address proxyAddress);

33:     event DelegationProcessed(

```
[#L32](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L32) [#L33](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L33) 

---


## Gas Optimizations

<a name="GAS-1"></a> 
### [GAS-1] Consider activating via-ir for deploying
By using `--via-ir` or `{"viaIR": true}`, the compiler is able to use more advanced [multi-function optimizations](https://docs.soliditylang.org/en/v0.8.17/ir-breaking-changes.html#solidity-ir-based-codegen-changes), for extra gas savings.

There is <b>1</b> instance:
```solidity

Global finding

```


---

<a name="GAS-2"></a> 
### [GAS-2] `internal` functions only called once can be inlined to save gas
If an `internal` function is only used once, there is no need to modularize it, unless the function calling it would otherwise be too long and complex. Not inlining costs 20 to 40 gas because of two extra JUMP instructions and additional stack operations needed for function calls.

There are <b>6</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

/// @audit `_delegateMulti` is used only once
65:     function _delegateMulti(

/// @audit `_processDelegation` is used only once
124:     function _processDelegation(

/// @audit `_reimburse` is used only once
144:     function _reimburse(address source, uint256 amount) internal {

/// @audit `createProxyDelegatorAndTransfer` is used only once
155:     function createProxyDelegatorAndTransfer(

/// @audit `transferBetweenDelegators` is used only once
163:     function transferBetweenDelegators(

/// @audit `getBalanceForDelegate` is used only once
192:     function getBalanceForDelegate(

```
[#L65](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L65) [#L124](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L124) [#L144](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L144) [#L155](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L155) [#L163](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L163) [#L192](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L192) 

---

<a name="GAS-3"></a> 
### [GAS-3] Newer versions of solidity are more gas efficient
The solidity language continues to pursue more efficient gas optimization schemes. Adopting a newer version of solidity can be more gas efficient.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

2: pragma solidity ^0.8.2;

```
[#L2](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L2) 

---

<a name="GAS-4"></a> 
### [GAS-4] Operator `>=`/`<=` costs less gas than operator `>`/`<`
The compiler uses opcodes `GT` and `ISZERO` for code that uses `>`, but only requires `LT` for `>=`. A similar behavior applies for `>`, which uses opcodes `LT` and `ISZERO`, but only requires `GT` for `<=`. It can save 3 gas for each. It should be converted to the `<=`/`>=` equivalent when comparing against integer literals.

There are <b>10</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

75:             sourcesLength > 0 || targetsLength > 0,

75:             sourcesLength > 0 || targetsLength > 0,

87:             transferIndex < Math.max(sourcesLength, targetsLength);

90:             address source = transferIndex < sourcesLength

93:             address target = transferIndex < targetsLength

98:             if (transferIndex < Math.min(sourcesLength, targetsLength)) {

101:             } else if (transferIndex < sourcesLength) {

104:             } else if (transferIndex < targetsLength) {

110:         if (sourcesLength > 0) {

113:         if (targetsLength > 0) {

```
[#L75](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L75) [#L75](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L75) [#L87](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L87) [#L90](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L90) [#L93](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L93) [#L98](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L98) [#L101](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L101) [#L104](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L104) [#L110](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L110) [#L113](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L113) 

---

<a name="GAS-5"></a> 
### [GAS-5] Reduce gas usage by moving to Solidity 0.8.19 or later
Solidity version 0.8.19 introduced a number of gas optimizations, refer to the [Solidity 0.8.19 Release Announcement](https://soliditylang.org/blog/2023/02/22/solidity-0.8.19-release-announcement/) for details.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

2: pragma solidity ^0.8.2;

```
[#L2](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L2) 

---

<a name="GAS-6"></a> 
### [GAS-6] `require()`/`revert()` strings longer than 32 bytes cost extra gas
Each extra memory word of bytes past the original 32 [incurs an MSTORE](https://gist.github.com/hrkrshnn/ee8fabd532058307229d65dcd5836ddc#consider-having-short-revert-strings) which costs 3 gas

There are <b>2</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

74:         require(
                sourcesLength > 0 || targetsLength > 0,
                "Delegate: You should provide at least one source or one target delegate"

79:         require(
                Math.max(sourcesLength, targetsLength) == amountsLength,
                "Delegate: The number of amounts must be equal to the greater of the number of sources or targets"

```
[#L74](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L74) [#L79](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L79) 

---

<a name="GAS-7"></a> 
### [GAS-7] The result of a function call should be cached rather than re-calling the function
The function calls in solidity are expensive. If the same result of the same function calls are to be used several times, the result should be cached to reduce the gas consumption of repeated calls.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

/// @audit `retrieveProxyContractAddress` is called 2 times
163:     function transferBetweenDelegators(
             address from,
             address to,
             uint256 amount
         ) internal {

```
[#L163](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L163) 

---

<a name="GAS-8"></a> 
### [GAS-8] Use assembly to compute hashes to save gas
If the arguments to the encode call can fit into the scratch space (two words or fewer), then it's more efficient to use assembly to generate the hash (80 gas):

`keccak256(abi.encodePacked(x, y)) -> assembly {mstore(0x00, a); mstore(0x20, b); let hash := keccak256(0x00, 0x40); }`

There are <b>2</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

206:         bytes32 hash = keccak256(

211:                 keccak256(bytecode)

```
[#L206](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L206) [#L211](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L211) 

---

<a name="GAS-9"></a> 
### [GAS-9] Use assembly to emit events
To efficiently emit events, it's possible to utilize assembly by making use of scratch space and the free memory pointer. This approach has the advantage of potentially avoiding the costs associated with memory expansion.

However, it's important to note that in order to safely optimize this process, it is preferable to cache and restore the free memory pointer.

A good example of such practice can be seen in [Solady's](https://github.com/Vectorized/solady/blob/main/src/tokens/ERC1155.sol#L167) codebase.

There are <b>2</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

136:         emit DelegationProcessed(source, target, amount);

187:             emit ProxyDeployed(delegate, proxyAddress);

```
[#L136](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L136) [#L187](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L187) 

---

<a name="GAS-10"></a> 
### [GAS-10] Use a more recent version of solidity
- Use a solidity version of at least 0.8.2 to get simple compiler automatic inlining.
- Use a solidity version of at least 0.8.3 to get better struct packing and cheaper multiple storage reads.
- Use a solidity version of at least 0.8.4 to get custom errors, which are cheaper at deployment than revert()/require() strings.
- Use a solidity version of at least 0.8.10 to have external calls skip contract existence checks if the external call has a return value.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

2: pragma solidity ^0.8.2;

```
[#L2](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L2) 

---

<a name="GAS-11"></a> 
### [GAS-11] Use `calldata` instead of `memory` for function arguments that do not get mutated
Mark data types as `calldata` instead of `memory` where possible. This makes it so that the data is not automatically loaded into memory. If the data passed into the function does not need to be changed (like updating values in an array), it can be passed in as `calldata`. The one exception to this is if the argument must later be passed into another function that takes an argument that specifies `memory` storage.

There are <b>2</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

46:         string memory _metadata_uri

151:     function setUri(string memory uri) external onlyOwner {

```
[#L46](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L46) [#L151](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L151) 

---

<a name="GAS-12"></a> 
### [GAS-12] Don't initialize variables with default value

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

86:             uint transferIndex = 0;

```
[#L86](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L86) 

---

<a name="GAS-13"></a> 
### [GAS-13] Usage of `int`s/`uint`s smaller than 32 bytes incurs overhead
Using `int`s/`uint`s smaller than 32 bytes may cost more gas. This is because the EVM operates on 32 bytes at a time, so if an element is smaller than 32 bytes, the EVM must perform more operations to reduce the size of the element from 32 bytes to the desired size.

There are <b>4</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

91:                 ? address(uint160(sources[transferIndex]))

94:                 ? address(uint160(targets[transferIndex]))

195:         return ERC1155(this).balanceOf(msg.sender, uint256(uint160(delegate)));

214:         return address(uint160(uint256(hash)));

```
[#L91](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L91) [#L94](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L94) [#L195](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L195) [#L214](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L214) 

---

<a name="GAS-14"></a> 
### [GAS-14] Constructors can be marked as `payable` to save deployment gas
Payable functions cost less gas to execute, because the compiler does not have to add extra checks to ensure that no payment is provided. A constructor can be safely marked as payable, because only the deployer would be able to pass funds, and the project itself would not pass any funds.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

16:     constructor(ERC20Votes _token, address _delegate) {

```
[#L16](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L16) 

---

<a name="GAS-15"></a> 
### [GAS-15] Functions guaranteed to revert when called by normal users can be marked `payable`
If a function modifier such as `onlyOwner` is used, the function will revert if a normal user tries to pay the function. Marking the function as `payable` will lower the gas cost for legitimate callers because the compiler will not include checks for whether a payment was provided.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

151:     function setUri(string memory uri) external onlyOwner {

```
[#L151](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L151) 

---

<a name="GAS-16"></a> 
### [GAS-16] `++i` costs less gas than `i++`, especially when it's used in `for`-loops (`--i`/`i--` too)
*Saves 5 gas per loop*

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

88:             transferIndex++

```
[#L88](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L88) 

---

<a name="GAS-17"></a> 
### [GAS-17] Use `!= 0` instead of `> 0` for unsigned integer comparison
Using `== 0`, `!= 0` instead of `> 0`, `>= 1`, `< 1`, `<= 0` can save gas.

There are <b>4</b> instances:
```solidity
File: contracts/ERC20MultiDelegate.sol

75:             sourcesLength > 0 || targetsLength > 0,

75:             sourcesLength > 0 || targetsLength > 0,

110:         if (sourcesLength > 0) {

113:         if (targetsLength > 0) {

```
[#L75](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L75) [#L75](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L75) [#L110](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L110) [#L113](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L113) 

---

<a name="GAS-18"></a> 
### [GAS-18] Using assembly to check for zero can save gas
Using assembly to check for zero can save gas by allowing more direct access to the evm and reducing some of the overhead associated with high-level operations in solidity.

There is <b>1</b> instance:
```solidity
File: contracts/ERC20MultiDelegate.sol

185:         if (bytecodeSize == 0) {

```
[#L185](https://github.com/code-423n4/2023-10-ens/blob/ed25379c06e42c8218eb1e80e141412496950685/contracts/ERC20MultiDelegate.sol#L185) 

---

